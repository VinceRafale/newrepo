!function(){function e(e){for(var i in O)for(var t=O[i].exercises,n=0;n<t.length;++n){var o=t[n];if(o.exercise==e)return o}}function i(e){for(var i in O)for(var t=O[i].exercises,n=0;n<t.length;++n){var o=t[n];if(o.audio==e)return o}}function t(e){for(var i in O)for(var t=O[i].exercises,n=0;n<t.length;++n){var o=t[n];if(o.activity==e)return o}}function n(e,i,t,n,o,a){if("none"!=e.bgAudioSource){var r=e.bgAudioSource;r+=a.isAndroid()?".ogg":".aifc",e.bgAudio=t.loadMedia("img/background-sounds/"+r,"bgAudio",o),t.setVolume(e.bgAudio,0),e.volumeData={bgVolume:.4};var s=n.getUserPreference("soundscape_volume");s&&(e.volumeData.bgVolume=+s);var c;e.bgVolumeChanged=function(){c&&(i.cancel(c),c=void 0),c=i(function(){n.setUserPreference("soundscape_volume",e.volumeData.bgVolume)},500),e.started&&e.bgAudio&&t.setVolume(e.bgAudio,e.volumeData.bgVolume)}}}function o(e){e>1?e=1:0>e&&(e=0);var i=L[Math.floor(e*C)];return i}function a(e){return e.replace(/ /g,"_").replace(/\+/g,"").replace(/-/g,"").replace(/:/g,"").replace(/__/g,"_")}function r(e,i){var t="RELAX_ACTIVITY_"+e;t=a(t).toUpperCase();var n=i.instant(t);return n}function s(e,i){var t="RELAX_ACTIVITY_"+e+"_TAGLINE";t=a(t).toUpperCase();var n=i.instant(t);return n}function c(e){var i=e.getUserPreference("breathe_cycle_length");return i=i?+i:8,8*i}function l(e){var i=e.getUserPreference("meditation_length");return i=i?+i:10,60*i}function u(e,i,t){var n=y.indexOf(e),o=A[n];if(o>0)return t.getTimeDisplay(o,!0);if("Deep Breathing"==e||"Visualization"==e){var a=c(i);return t.getTimeDisplay(a,!0)}if("Soundscape Mode"==e){var r=l(i);return t.getTimeDisplay(r,!0)}return""}function d(i,t,n){var o,a=e(i);return o="Deep Breathing"==a.exercise||"Visualization"==a.exercise?c(n):"Soundscape Mode"==a.exercise?l(n):a.audioLength,o>0?(o=Math.round(o/60),o+" "+t.instant(o>1?"HABITS_VALUES_MINUTES":"HABITS_VALUES_MINUTE")):""}function p(e,i){var t="RELAX_ACTIVITY_"+e+"_DESCRIPTION";t=a(t).toUpperCase();var n=i.instant(t);return n}function g(e,i){e.bgAudioSources=v,e.soundOptions={options:E,soundOptionOrdinal:0},e.cycleOptions={options:[5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25],cycleOptionOrdinal:1},e.lengthOptions={options:[5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30],lengthOptionOrdinal:1},e.breathingOptions={options:[!0,!1],breathingOptionOrdinal:0},e.continueOptions={options:["Return","Continue Sounds"],continueOptionOrdinal:1},e.enableMeditationMode=!0;var t=i.getUserPreference("bg_audio_src");if(t){var n=e.bgAudioSources.indexOf(t);n>=0&&(e.soundOptions.soundOptionOrdinal=e.bgAudioSources.indexOf(t))}e.bgAudioSource=e.bgAudioSources[e.soundOptions.soundOptionOrdinal];var o=i.getUserPreference("breathe_cycle_length");e.cycleLength=o?parseInt(o):8,e.cycleOptions.cycleOptionOrdinal=e.cycleOptions.options.indexOf(e.cycleLength);var a=i.getUserPreference("meditation_length");e.meditationLength=a?parseInt(a):10,e.lengthOptions.lengthOptionOrdinal=e.lengthOptions.options.indexOf(e.meditationLength);var r=i.getUserPreference("disable_breathing_sounds");e.breathingSoundsOn=r?"false"==r:!0,e.breathingOptions.breathingOptionOrdinal=e.breathingOptions.options.indexOf(e.breathingSoundsOn);var s=i.getUserPreference("enable_meditation_mode");s&&"false"==s&&(e.continueOptions.continueOptionOrdinal=0,e.enableMeditationMode=!1)}var f=angular.module("breatheCtrl",[]),h={playAudioWhenScreenIsLocked:!0},m={playAudioWhenScreenIsLocked:!0,numberOfLoops:1e3},v=["Ocean","SummerNight","Campfire","ForestMorning","Stream","RooftopRain","City","Thunderstorm","Bach","Pinknoise","none"],E=["Ocean Waves","Summer Night","Campfire","Forest Morning","Stream","Rooftop Rain","City","Thunderstorm","Bach Cello Suite #1","White Noise","No Sound"],T=["BASICS","STRESSFUL_SITUATIONS","MINDFULNESS","CALM_DOWN","INNER_STRENGTH"],O={BASICS:{descriptionKey:"RELAX_BASICS_DESC",exercises:[{exercise:"Deep Breathing",audio:"none",audioLength:0,meditation:!1,activeVersion:3,free:!0,activity:"COMPLETED_BREATHING"},{exercise:"Soundscape Mode",audio:"none",audioLength:0,meditation:!1,activeVersion:3,free:!0,activity:"COMPLETED_UNGUIDED_MEDITATION"},{exercise:"Muscle Relaxation",audio:"musclerelaxation.mp3",audioLength:471,meditation:!0,activeVersion:3,free:!0,activity:"COMPLETED_MUSCLE_RELAXATION"}]},CALM_DOWN:{descriptionKey:"RELAX_CALM_DOWN_DESC",exercises:[{exercise:"Calm: Breathe",audio:"calmbreathe.mp3",audioLength:287,meditation:!0,activeVersion:3.1,free:!0,activity:"COMPLETED_CALM_BREATHE"},{exercise:"Calm: Mind",audio:"calmmind.mp3",audioLength:267,meditation:!0,activeVersion:3.1,free:!1,activity:"COMPLETED_CALM_MIND"},{exercise:"Panic: Emergency",audio:"panicemergency.mp3",audioLength:274,meditation:!0,activeVersion:3,free:!1,activity:"COMPLETED_PANIC_EMERGENCY"},{exercise:"Sleep",audio:"sleep.mp3",audioLength:321,meditation:!0,activeVersion:3,free:!1,activity:"COMPLETED_SLEEP"},{exercise:"Gratitude",audio:"gratitude.mp3",audioLength:306,meditation:!0,activeVersion:3,free:!1,activity:"COMPLETED_GRATITUDE"}]},STRESSFUL_SITUATIONS:{descriptionKey:"RELAX_STRESSFUL_SITUATIONS_DESC",exercises:[{exercise:"Social Situations",audio:"ss-social-situations.mp3",audioLength:445,meditation:!0,activeVersion:3.2,free:!0,activity:"COMPLETED_SS_SOCIAL_SITUATIONS"},{exercise:"Flying",audio:"ss-flying.mp3",audioLength:478,meditation:!0,activeVersion:3.2,free:!1,activity:"COMPLETED_SS_FLYING"},{exercise:"Public Speaking",audio:"ss-speaking.mp3",audioLength:556,meditation:!0,activeVersion:3.2,free:!1,activity:"COMPLETED_SS_PUBLIC_SPEAKING"},{exercise:"Public Transit",audio:"ss-public-transit.mp3",audioLength:435,meditation:!0,activeVersion:3.2,free:!1,activity:"COMPLETED_SS_PUBLIC_TRANSIT"},{exercise:"Difficult Experience",audio:"difficultexperience.mp3",audioLength:393,meditation:!0,activeVersion:3,free:!1,activity:"COMPLETED_DIFFICULT_EXPERIENCE"}]},MINDFULNESS:{descriptionKey:"RELAX_MINDFULNESS_DESC",exercises:[{exercise:"Mindful: Senses",audio:"mindfulsenses.mp3",audioLength:279,meditation:!0,activeVersion:3,free:!0,activity:"COMPLETED_MINDFUL_SENSES"},{exercise:"Mindful: Breathe",audio:"mindfulbreathe.mp3",audioLength:177,meditation:!0,activeVersion:3,free:!1,activity:"COMPLETED_MINDFUL_BREATHE"},{exercise:"Mindful: Observe",audio:"mindfulobserve.mp3",audioLength:197,meditation:!0,activeVersion:3,free:!1,activity:"COMPLETED_MINDFUL_OBSERVE"},{exercise:"Mindful: Body Scan",audio:"mindfulbodyscan.mp3",audioLength:209,meditation:!0,activeVersion:3,free:!1,activity:"COMPLETED_MINDFUL_BODY_SCAN"},{exercise:"Mindful: Walk",audio:"mindfulwalk.mp3",audioLength:575,meditation:!0,activeVersion:3.1,free:!1,activity:"COMPLETED_MINDFUL_WALK"}]},INNER_STRENGTH:{descriptionKey:"RELAX_INNER_STRENGTH_DESC",exercises:[{exercise:"Visualization",audio:"",audioLength:0,meditation:!1,activeVersion:3,free:!0,activity:"COMPLETED_POSITIVE_VISUALIZATION"},{exercise:"Become Tree",audio:"becomingthetree.mp3",audioLength:483,meditation:!0,activeVersion:3,free:!1,activity:"COMPLETED_BECOMING_THE_TREE"},{exercise:"Empathy",audio:"empathy.mp3",audioLength:358,meditation:!0,activeVersion:3,free:!1,activity:"COMPLETED_EMPATHY"},{exercise:"Self Compassion",audio:"selfcompassion.mp3",audioLength:340,meditation:!0,activeVersion:3,free:!1,activity:"COMPLETED_SELF_COMPASSION"},{exercise:"Defusion",audio:"intenseemotions.mp3",audioLength:261,meditation:!0,activeVersion:3,free:!1,activity:"COMPLETED_DEFUSION"}]}},y=[],x=[],A=[],S=0;for(var _ in O)for(var b=O[_].exercises,I=0;I<b.length;++I){var M=b[I];y[S]=M.exercise,x[S]=M.audio,A[S]=M.audioLength,++S}var L=[.007,.008,.009,.01,.011,.012,.013,.015,.016,.018,.02,.022,.024,.027,.029,.032,.036,.039,.043,.047,.052,.057,.063,.069,.076,.083,.091,.1,.109,.119,.13,.142,.154,.168,.182,.198,.214,.231,.25,.269,.289,.31,.332,.354,.378,.401,.426,.45,.475,.5,.525,.55,.574,.599,.622,.646,.668,.69,.711,.731,.75,.769,.786,.802,.818,.832,.846,.858,.87,.881,.891,.9,.909,.917,.924,.931,.937,.943,.948,.953,.957,.961,.964,.968,.971,.973,.976,.978,.98,.982,.984,.985,.987,.988,.989,.99,.991,.992,.993,.993],C=L.length-1;f.controller("RelaxActivityConfigCtrl",["$scope","$http","$state","$stateParams","$timeout","$analytics","$translate","$ionicModal","$ionicPopup","AccountService","PayService","Environment",function(i,t,n,o,s,c,l,u,f,h){function m(){h.setUserPreference("bg_audio_src",""+i.bgAudioSource),h.setUserPreference("breathe_cycle_length",""+i.cycleLength),h.setUserPreference("enable_meditation_mode",i.enableMeditationMode),h.setUserPreference("meditation_length",i.meditationLength),h.setUserPreference("disable_breathing_sounds",!i.breathingSoundsOn)}i.exercise=o.exercise,i.exerciseObj=e(i.exercise),i.exerciseName=i.exerciseObj.exercise;i.exerciseObj.meditation;g(i,h),i.goToHelp=function(){n.go("Deep Breathing"==i.exerciseName?"app.breathe-help":"Visualization"==i.exerciseName?"app.relax-record-help":"app.relax-help")},i.showCycleOptions=function(){return"Deep Breathing"==i.exerciseName||"Visualization"==i.exerciseName},i.showLengthOptions=function(){return"Soundscape Mode"==i.exerciseName},i.showContinueOptions=function(){return!0},i.showBreathingOptions=function(){return"Deep Breathing"==i.exerciseName},i.updateSoundOption=function(){i.soundOptions.soundOptionOrdinal;i.bgAudioSource=i.bgAudioSources[i.soundOptions.soundOptionOrdinal],m(),c.eventTrack("setBackgroundAudio",{category:"relax",label:i.bgAudioSource})},i.updateCycleLength=function(){i.cycleLength=i.cycleOptions.options[i.cycleOptions.cycleOptionOrdinal],m(),c.eventTrack("setCycleLength",{category:"relax",label:""+i.cycleLength})},i.updateBreathingOptions=function(){i.breathingSoundsOn=i.breathingOptions.options[i.breathingOptions.breathingOptionOrdinal],m(),c.eventTrack("setBreathingSounds",{category:"relax",label:""+i.breathingSounds})},i.updateMeditationLength=function(){i.meditationLength=i.lengthOptions.options[i.lengthOptions.lengthOptionOrdinal],m(),c.eventTrack("setMeditationLength",{category:"relax",label:""+i.meditationLength})},i.updateContinueOption=function(){i.continueOption=i.continueOptions.options[i.continueOptions.continueOptionOrdinal],i.enableMeditationMode=1==i.continueOptions.continueOptionOrdinal,m(),c.eventTrack("setContinueOption",{category:"relax",label:i.continueOption})},i.getCycleOptionDisplay=function(e){var i="RELAX_ACTIVITY_SECONDS_BREATHING";return e+" "+l.instant(i)},i.getBreathingOptionDisplay=function(e){return l.instant(e?"YES":"NO")},i.getLengthOptionDisplay=function(e){var i="RELAX_ACTIVITY_MINUTES";return e+" "+l.instant(i)},i.getSoundOptionDisplay=function(e){var i="RELAX_ACTIVITY_SOUND_"+e;i=i.replace(/ /g,"_").replace(/#/g,"").toUpperCase();var t=l.instant(i);return t},i.getContinueOptionDisplay=function(e){var i="RELAX_ACTIVITY_CONTINUATION_"+e;i=i.replace(/ /g,"_").replace(/#/g,"").toUpperCase();var t=l.instant(i);return t},i.getExerciseOptionMinuteDisplay=function(){return d(i.exercise,l,h)},i.getActivityName=function(){return r(i.exerciseName,l)},i.getActivityClass=function(){return a(i.exerciseName)},i.getActivityDescription=function(){return p(i.exerciseName,l)},i.startExercise=function(){function e(){var e=h.getUserPreference("completed_breathe_intro");return"undefined"!=typeof e}function t(){var e=h.getUserPreference("completed_visualization_intro");return"undefined"!=typeof e}var o={cycleLength:i.cycleLength,bgAudioSource:i.bgAudioSource,meditationMode:i.enableMeditationMode};"Deep Breathing"==i.exerciseName?(o.breathingSounds=i.breathingSoundsOn,e()?n.go("app.breathe-exercise",o):(o.intro=!0,n.go("app.breathe-help",o))):"Soundscape Mode"==i.exerciseName?(o.meditationLength=i.meditationLength,n.go("app.narration-exercise",o)):"Visualization"==i.exerciseName?(o.maxTime=i.cycleLength,t()?n.go("app.breathe-record",o):(o.nextState="app.breathe-record",o.intro=!0,n.go("app.relax-record-help",o))):(o.src=i.exerciseObj.audio,n.go("app.narration-exercise",o))}}]),f.controller("RelaxCtrl",["$rootScope","$scope","$http","$state","$stateParams","$timeout","$analytics","$translate","$ionicModal","$ionicPopup","$ionicGesture","$ionicHistory","$ionicActionSheet","$ionicScrollDelegate","AccountService","MediaService","PayService","SkillsService","GeneralService","Environment",function(i,n,o,c,l,d,p,f,h,m,v,E,A,S,_,b,I,M,L,C){function D(e){"dragleft"==e.type?(R&&angular.element(R).addClass("hideRemove"),R=e.target,angular.element(e.target).removeClass("hideRemove")):(angular.element(e.target).addClass("hideRemove"),R=void 0)}function w(){for(var e in U)v.off(U[e],"dragleft",D);for(var i in V)v.off(V[i],"dragright",D)}E.clearHistory(),_.setUserPreference("viewed_relax_tooltip",!0);var N;n.$on("$ionicView.afterEnter",function(){var e=M.getSuggestedActivityId();N=e?t(e):void 0,N&&d(function(){window.sg=S;var e=$(".item.suggested");e&&e.length>0&&S.scrollTo(0,e.position().top-100,!0)})});var P=_.getUserPreference("completed_relax_intro");P&&"true"==P||(i.$broadcast("event:viewVideo",{video:_.RELAX_VIDEO}),_.setUserPreference("completed_relax_intro",!0),window.checkExistingFiles&&window.checkExistingFiles()),n.exerciseCategories=T,n.getRelaxLevel=function(){return M.getSkillLevel("relax")},n.goToSkills=function(){window.openURL("/progress/mood?tab=skills")},n.showHelp=function(){var e;e=_.isUMNUser()?[{text:'<i class="icon ion-ios-help-outline"></i> '+f.instant("WHAT_IS_RELAX")},{text:'<i class="icon ion-ios-play-outline"></i> '+f.instant("WATCH_MILO_IS_STRESSED")},{text:'<i class="icon ion-ios-list-outline"></i> '+f.instant("VIEW_COMMON_QUESTIONS")}]:[{text:'<i class="icon ion-ios-help-outline"></i> '+f.instant("WHAT_IS_RELAX")},{text:'<i class="icon ion-ios-play-outline"></i> '+f.instant("WATCH_MILO_IS_STRESSED")},{text:'<i class="icon ion-ios-list-outline"></i> '+f.instant("VIEW_COMMON_QUESTIONS")},{text:'<i class="icon ion-ios-people-outline"></i> '+f.instant("EXPLORE_THE_COMMUNITY")}],A.show({buttons:e,cancelText:f.instant("CANCEL"),cancel:function(){},buttonClicked:function(e){return 0===e?i.$broadcast("event:viewVideo",{video:_.RELAX_VIDEO}):1===e?_.viewVideo(_.RELAX_VIDEO):2==e?window.open("http://help.thinkpacifica.com/hc/en-us/sections/200750777-Relax","_blank","location=no"):3==e&&n.goToCommunity("relax"),!0}})};var R,U=[],V=[];n.$on("$destroy",function(){w()}),d(function(){for(var e=document.getElementsByClassName("dragContainer"),i=0;i<e.length;++i){var t=e[i],n=v.on("dragright",D,angular.element(t)),o=v.on("dragleft",D,angular.element(t));V.push(n),U.push(o)}},1);var k;n.$on("event:downloadProgress",function(e,i){(!k||k.getTime()<(new Date).getTime()-250||i&&i.complete)&&d(function(){k=new Date,n.$$phase||n.$apply()})}),n.$on("event:downloadRemoved",function(){d(function(){R&&(angular.element(R).addClass("hideRemove"),R=void 0),n.$$phase||n.$apply()})}),n.download=function(e,i){e&&(e.stopPropagation(),e.preventDefault());var t=y.indexOf(i),n=x[t];b.downloadMeditationFile(n,function(){},function(){m.alert({template:f.instant("RELAX_DOWNLOAD_PERMISSION_ERROR"),okText:f.instant("OK_GOT_IT"),okType:"button-default"})})},n.removeDownload=function(e,i){e&&(e.stopPropagation(),e.preventDefault());var t=m.confirm({template:'<div class="thisisatest">'+f.instant("DELETE_AUDIO_CONFIRMATION")+"</div>",cancelText:f.instant("CANCEL"),cancelType:"button-default",okText:f.instant("CONFIRM"),okType:"button-default"});t.then(function(e){if(e){var t=y.indexOf(i),n=x[t];b.removeMeditationFile(n)}})},n.goToExercise=function(e){return"Coming Soon"==e?void m.alert({template:f.instant("RELAX_ACTIVITY_COMING_SOON_ALERT"),okText:f.instant("OK_GOT_IT"),okType:"button-default"}):void(n.isPremiumEnabled(e)?n.isDownloaded(e)?c.go("app.relax-activityConfig",{exercise:e}):C.isOnline()?n.download(void 0,e):m.alert({template:f.instant("RELAX_OFFLINE_DOWNLOAD_ATTTEMPT"),okText:f.instant("OK_GOT_IT"),okType:"button-default"}):n.showPremiumModal(e))},g(n,_),n.isPremiumEnabled=function(i){var t=e(i);return t.free||_.isPremiumEnabled()},n.isMeditateActivity=function(i){var t=e(i);return t?t.meditation:!1},n.isDownloaded=function(e){var i=y.indexOf(e);if(!n.isMeditateActivity(e))return!0;var t=x[i];return b.isDownloaded(t)},n.isDownloading=function(e){var i=y.indexOf(e),t=x[i];return b.isDownloading(t)},n.getExerciseClass=function(e){var i=a(e.exercise);return N&&e.activity==N.activity&&(i+=" suggested"),i},n.displayCategory=function(e){return _.isUMNUser()?"STRESSFUL_SITUATIONS"!=e:!0},n.displayExercise=function(e){return _.isUMNUser()?3==e.activeVersion:!0},n.getDownloadPercentage=function(e){var i=y.indexOf(e),t=x[i],n=b.getDownloadPercentage(t);return n},n.getExerciseCategory=function(e){var i="RELAX_CATEGORY_"+e;return i=a(i).toUpperCase(),f.instant(i)},n.getCategoryDescription=function(e){return f.instant(O[e].descriptionKey)},n.getCategoryExercises=function(e){return O[e].exercises},n.getExerciseOptionDisplay=function(e){return r(e,f)},n.getExerciseOptionTagline=function(e){return s(e,f)},n.getExerciseOptionTimeDisplay=function(e){return u(e,_,L)},n.showPremiumModal=function(e){I.showPremiumModal(n,"relax",e,!0)}}]),f.controller("BreatheExerciseCtrl",["$scope","$rootScope","$controller","$http","$timeout","$state","$stateParams","$translate","$ionicModal","$ionicPopup","$ionicHistory","$analytics","AccountService","MediaService","HabitsService","Environment",function(e,i,t,a,r,s,c,l,u,d,p,g,f,v,E,T){function O(){}function y(e,i){return{display:"",ordinate:e,valueInt:i,valueString:null}}function x(e){for(var i=[],t=0;e>t;++t)i[t]=0===t?y(t,3):y(t,t+1);return i}function A(){var i=e.canvas.getContext("2d"),t=e.canvas.width,n=e.canvas.height;i.clearRect(0,0,t,n);var a=96,r=e.valueData.percentage<.5?e.valueData.percentage/.5:(1-e.valueData.percentage)/.5;r=o(r),i.beginPath(),i.arc(Q,Q,a*r,0,2*Math.PI,!1),i.fillStyle="rgba(255, 255, 255, 0.3)",i.fill()}function S(){if(!e.paused&&!e.exited){if(0===e.valueData.percentage){if((e.breathingSoundsOn||e.forceAudio)&&e.playInhaleAudio(!0),e.personalAudio){var i=.5+.5*(e.cycle/e.cycles);e.personalAudio.setVolume(i),e.personalAudio.play(h)}e.graphColors[0]=C,e.graphColors[1]=L,e.graphColors[2]=D,e.inhale=!0}else e.valueData.percentage>=w&&e.inhale&&((e.breathingSoundsOn||e.forceAudio)&&e.playExhaleAudio(!0),e.inhale=!1);var t=(new Date).getTime(),n=e.elapsedTime+(t-e.startTime),o=n/1e3/e.cycleLength;o>=.999?e.cycle<e.cycles||e.enableMeditationMode?(e.cycle==e.cycles&&e.preFinishExercise(),e.valueData.percentage=0,e.elapsedTime=0,e.startTime=(new Date).getTime(),++e.cycle,e.advanceCycle&&e.advanceCycle(),e.inhale=!0,r(S,j)):e.preFinishExercise():(e.valueData.percentage=o,r(S,j)),A()}}function _(){e.bgAudio&&v.setVolume(e.bgAudio,e.volumeData.bgVolume*(J/q)),q>J?(r(_,30),++J):J=0}function b(){e.bgAudio&&v.setVolume(e.bgAudio,e.volumeData.bgVolume*((q-J)/q)),q>J?(r(b,30),++J):J=0}function I(){ei&&M()}function M(){e.paused||e.exited||(ei&&(e.bgSoundOn&&e.bgAudio.play(m),_(),ei=!1),e.valueData.value>0?(e.valueData.value=e.valueData.value-1,Z=r(M,1e3)):e.started?e.finishExercise():e.startExercise())}window.plugins&&window.plugins.bgVideo&&window.plugins.bgVideo.playAudioInBackground();var L="#eee",C="#333",D="#ccc";e.getExerciseHeader=function(){return e.paused?l.instant("PAUSED"):e.started?l.instant(e.finished?"FINISHED":e.inhale?"INHALE":"EXHALE"):l.instant("GET_READY")+"..."},e.getExerciseInstructions=function(){var i;return i=e.started?e.finished?"FINISHED":e.inhale?"RELAX_ACTIVITY_INHALE_INSTRUCTIONS":"RELAX_ACTIVITY_EXHALE_INSTRUCTIONS":"RELAX_ACTIVITY_READY_INSTRUCTIONS",l.instant(i)},e.graphColors=[C,D,L];var w=.5;e.started=!1,e.finished=!1,e.exited=!1,e.cycle=1,e.paused=!1,e.inhale=!0;var N=c.cycles;e.cycles=N?+N:8;var P=c.cycleLength;e.cycleLength=P?+P:10,e.bgAudioSource=c.bgAudioSource,"undefined"==typeof e.bgAudioSource&&(e.bgAudioSource="Ocean"),c.src&&(c.src.indexOf("narration-visualization")>0?e.personalAudio=v.loadMedia(c.src,"personalAudio",function(e){}):v.loadRecording(T,c.src,"personalAudio",e,function(e){})),e.bgSoundOn="none"!=e.bgAudioSource,e.enableMeditationMode="true"==c.meditationMode,e.breathingSoundsOn="true"==c.breathingSounds;var R,U,V;e.bgAudio=void 0;var k,H,B=0,F=0,X=2,G=3,Y=.15,K=.15;e.cycleLength<10?(k="img/breathing-sounds/Inhale-5.mp3",H="img/breathing-sounds/Exhale-5.mp3"):e.cycleLength<15?(k="img/breathing-sounds/Inhale-10.mp3",H="img/breathing-sounds/Exhale-10.mp3"):e.cycleLength<20?(k="img/breathing-sounds/Inhale-15.mp3",H="img/breathing-sounds/Exhale-15.mp3"):e.cycleLength<25?(k="img/breathing-sounds/Inhale-20.mp3",H="img/breathing-sounds/Exhale-20.mp3"):(k="img/breathing-sounds/Inhale-25.mp3",H="img/breathing-sounds/Exhale-25.mp3"),U=window.inhaleAudio=v.loadMedia(k,"inhaleAudio",function(e){B=e}),v.setVolume(U,Y),V=v.loadMedia(H,"exhaleAudio",function(e){F=e}),v.setVolume(V,K),n(e,r,v,f,O,T),R=v.isNative(),e.$on("$ionicView.enter",function(){window.plugins&&window.plugins.insomnia&&window.plugins.insomnia.keepAwake(),window.backButtonOverride=function(){var i=!1;e.paused||(e.pause(),i=!0);var t=d.confirm({template:'<div class="thisisatest">'+l.instant("EXIT_ACTIVITY_CONFIRM")+"</div>",cancelText:l.instant("CANCEL"),cancelType:"button-default",okText:l.instant("CONFIRM"),okType:"button-default"});t.then(function(t){t?(window.backButtonOverride=void 0,e.goBack()):i&&e.pause()})}}),e.destroyCtrl=function(){R?(U.stop(),U.release(),V.stop(),V.release(),e.bgAudio&&(e.bgAudio.stop(),e.bgAudio.release()),e.personalAudio&&(e.personalAudio.stop(),e.personalAudio.release()),e.finishedAudio&&(e.finishedAudio.stop(),e.finishedAudio.release())):(U.pause(),V.pause(),e.bgAudio.pause(),e.personalAudio&&e.personalAudio.pause()),window.backButtonOverride=void 0,e.exited=!0},e.$on("$destroy",function(){e.destroyCtrl(),window.plugins&&window.plugins.insomnia&&window.plugins.insomnia.allowSleepAgain()});var W=e.cycleLength/3;e.getExerciseTitle=function(){if(e.cycle<=e.cycles){var i=l.instant("RELAX_ACTIVITY_CYCLE_X_OF_Y");return i=i.replace("[X]",e.cycle).replace("[Y]",e.cycles)}return l.instant("RELAX_ACTIVITY_COMPLETE")},e.values=x(e.cycleLength),e.valueData={value:e.values[0],valueIndex:0,percentage:0},e.elapsedTime=0,e.startTime=void 0;var z=.003,j=1e3*W/(w/z);e.pause=function(){e.paused=!e.paused,e.paused?(e.started?(e.elapsedTime+=(new Date).getTime()-e.startTime,e.valueData.percentage=e.elapsedTime/1e3/e.cycleLength):Z&&r.cancel(Z),e.breathingSoundsOn&&(B==X||0===B?U.pause():(F==X||0===F)&&V.pause()),e.bgSoundOn&&e.bgAudio.pause(),e.personalAudio&&e.personalAudio.getCurrentPosition(function(i){e.personalAudioPosition=i,e.personalAudio.pause()}),g.eventTrack("pauseBreatheExercise",{category:"relax"})):(e.startTime=(new Date).getTime(),e.started?(S(),e.breathingSoundsOn&&(B==G?e.playInhaleAudio(!1):F==G&&e.playExhaleAudio(!1)),e.personalAudioPosition>0&&e.personalAudio.play(h)):M(),e.bgSoundOn&&e.bgAudio.play(m),g.eventTrack("playBreatheExercise",{category:"relax"}))},e.playInhaleAudio=function(e){!R&&e&&U.load(),U.play(h)},e.playExhaleAudio=function(e){!R&&e&&V.load(),V.play(h)},e.$on("$ionicView.afterEnter",function(){e.canvas=$("#breathingCanvas")[0]});var Q=135;e.finishedExercise=function(){return e.finished},e.startExercise=function(){e.exited||(e.started=!0,e.startTime=(new Date).getTime(),e.values[0].valueInt=1,S())},e.closeRelaxGoalModal=function(){f.setUserPreference("viewed_relax_goal_popup",!0),closeModal(e.relaxGoalModal),e.relaxGoalModal.remove(),e.relaxGoalModal=void 0,e.finishExercise()},e.checkForRelaxGoalModal=function(){var i=!1,t=f.getUserPreference("viewed_relax_goal_popup");if(!t||"false"==t){var n="views/relax/relax.goalModal.html";u.fromTemplateUrl(n,{scope:e,animation:"slide-in-up"}).then(function(i){e.relaxGoalModal=i,openModal(e.relaxGoalModal)}),i=!0}return i},e.preFinishExercise=function(){e.finished=!0,f.recordActivity(e.personalAudio?"COMPLETED_POSITIVE_VISUALIZATION":"COMPLETED_BREATHING"),f.setUserPreference("completed_relax","true"),g.eventTrack("finishBreatheExercise",{category:"relax"}),e.enableMeditationMode||(e.valueData.value=3,r(b,1e3),r(M,1e3))},e.closeHealthKitModal=function(){f.setUserPreference("integrate_with_healthkit","true"),closeModal(e.healthKitModal),e.healthKitModal.remove(),e.healthKitModal=void 0,e.finishExercise()},e.showHealthkitIntegration=function(){var e=f.getUserPreference("integrate_with_healthkit");return!e},e.checkHealthKitModal=function(){return T.isIos()&&!T.isIPad()&&!e.isUMNUser()&&e.showHealthkitIntegration()?(u.fromTemplateUrl("views/habits/habits.healthkitModal.html",{scope:e,animation:"slide-in-up"}).then(function(i){e.healthKitModal=i,openModal(e.healthKitModal)}),!0):!1},e.finishExercise=function(){if(!e.checkHealthKitModal()){var i=(new Date).getTime(),t=(e.elapsedTime+(i-e.startTime))/1e3;t+=(e.cycle-1)*e.cycleLength,e.isUMNUser()||E.saveMindfulMinutes(t),s.go("app.relax"),r(function(){window.openURL("/")})}};var Z,q=100,J=0,ei=!0;r(I,2e3)}]),f.controller("BreatheRecordCtrl",["$scope","$state","$stateParams","$http","$controller","$timeout","$translate","AccountService",function(e,i,t,n,o,a,r,s){o("RethinkRecordCtrl",{$scope:e});var c="female";e.playOptions={options:["Record my own","I am calm","I am strong","I am","I believe in myself","I can accomplish anything","I can handle whatever comes my way","I love myself","This too shall pass"],playOptionOrdinal:0},e.getPlayOptionDisplay=function(e){var i="RELAX_RECORD_ACTIVITY_"+e;return i=i.replace(/ /g,"_").toUpperCase(),r.instant(i)},e.updatePlayOption=function(){e.playOptions.playOptionOrdinal>0&&e.nextStep()},g(e,s),e.nextStep=function(){e.mediaRec.stopRecord(),e.clearCache();var n=s.getUserPreference(i.current.data.nextHelpStatePreference),o=e.src;if(e.playOptions.playOptionOrdinal>0){var r="img/breathing-sounds/narration-visualization/"+c+"/"+e.playOptions.options[e.playOptions.playOptionOrdinal]+".mp3";r=r.replace(/ /g,"-"),o=r}var l={src:o,cycleLength:e.cycleLength,bgAudioSource:e.bgAudioSource,cycles:i.current.data.nextStateCycles,meditationMode:t.meditationMode},u=i.current.data.nextState;n||(u=i.current.data.nextHelpState,l.intro=!0),a(function(){i.go(u,l)},1)}}]),f.controller("RelaxNarrationCtrl",["$scope","$rootScope","$state","$http","$stateParams","$controller","$timeout","$translate","$analytics","$ionicHistory","$ionicPopup","$ionicModal","AccountService","MediaService","HabitsService","GeneralService","Environment",function(e,t,o,a,r,s,c,l,u,d,p,g,f,v,E,T,O){function y(){}function S(i){i!==Media.MEDIA_STOPPED||e.exited||e.preFinishExercise()}function _(){e.bgAudio&&v.setVolume(e.bgAudio,e.volumeData.bgVolume*($/P)),P>$?(c(_,30),++$):$=0}function b(){e.bgAudio&&v.setVolume(e.bgAudio,e.volumeData.bgVolume*((P-$)/P)),P>$?(c(b,30),++$):$=0}function I(){R&&L()}function M(){C&&(e.paused||C.getCurrentPosition(function(i){e.elapsedTime="object"==typeof i?i.status.value:i})),e.exited||(e.narrationTimeout=c(M,100))}function L(){e.paused||e.exited||(R&&(e.bgAudio&&e.bgAudio.play(m),_(),R=!1),U>0?(U-=1,N=c(L,1e3)):e.started?e.finishExercise():e.startExercise())}window.plugins&&window.plugins.bgVideo&&window.plugins.bgVideo.playAudioInBackground(),e.paused=!1,e.started=!1,e.finished=!1,e.exited=!1,e.elapsedTime=0,e.startTime=0,e.enableMeditationMode="true"==r.meditationMode,e.meditationLength=60*+r.meditationLength*1e3,window.plugins&&window.plugins.insomnia&&window.plugins.insomnia.keepAwake(),e.bgAudio=void 0;var C,D=0;if(e.narrationIndex=x.indexOf(r.src),e.expectedNarrationLength=A[e.narrationIndex],e.displayedDownloadPopup=!1,"none"!=r.bgAudioSource&&(e.bgAudioSource=r.bgAudioSource,n(e,c,v,f,y,O)),e.bellSound=v.loadMedia("img/buddhist-bell.mp3",void 0,function(e){}),r.src&&r.src.length>0&&"none"!=r.src){e.exercise=i(r.src);var w="meditations/";C=v.loadMeditationMedia(w+r.src,S),D=C.getDuration(),C.setVolume(.6)}e.getElapsedTime=function(){if(!C){{e.meditationLength}if(!e.started)return"";if(e.paused)return T.getTimeDisplay((e.meditationLength-e.elapsedTime)/1e3);var i=(new Date).getTime(),t=e.meditationLength-(e.elapsedTime+(i-e.startTime));return 0>t&&(t=0,e.preFinishExercise(),e.bellSound&&e.bellSound.play()),T.getTimeDisplay(t/1e3)}if(e.started){if(e.elapsedTime>=0){0>D&&(D=C.getDuration());var n=D-e.elapsedTime;return 0>n&&(n=0),!e.displayedDownloadPopup&&D>0&&D<e.expectedNarrationLength-5&&(p.alert({template:l.instant("RELAX_ACTIVITIY_INCOMPLETE_DOWNLOAD"),okText:l.instant("OK_GOT_IT"),okType:"button-default"}),e.displayedDownloadPopup=!0),T.getTimeDisplay(n)}return T.getTimeDisplay(0)}return 0>D&&(D=C.getDuration()),D>0?T.getTimeDisplay(D):""},e.finishedExercise=function(){return e.finished},e.startExercise=function(){e.exited||(e.started=!0,C&&C.play(h),e.startTime=(new Date).getTime())},e.closeHealthKitModal=function(){f.setUserPreference("integrate_with_healthkit","true"),closeModal(e.healthKitModal),e.healthKitModal.remove(),e.healthKitModal=void 0,e.finishExercise()},e.showHealthkitIntegration=function(){var e=f.getUserPreference("integrate_with_healthkit");return!e},e.checkHealthKitModal=function(){return O.isIos()&&!O.isIPad()&&!e.isUMNUser()&&e.showHealthkitIntegration()?(g.fromTemplateUrl("views/habits/habits.healthkitModal.html",{scope:e,animation:"slide-in-up"}).then(function(i){e.healthKitModal=i,openModal(e.healthKitModal)}),!0):!1},e.finishExercise=function(){if(!e.checkHealthKitModal()){if(!e.isUMNUser())if(e.exercise)E.saveMindfulMinutes(e.exercise.audioLength);else{var i=(new Date).getTime(),t=(e.elapsedTime+(i-e.startTime))/1e3;E.saveMindfulMinutes(t)}o.go("app.relax"),c(function(){window.openURL("/")})}},e.preFinishExercise=function(){if(e.finished=!0,u.eventTrack("finishRelaxExercise",{category:"relax"}),!e.enableMeditationMode){U=C?3:10;var i=C?1e3:7e3;c(b,i),c(L,i)}f.recordActivity(e.exercise?e.exercise.activity:"COMPLETED_UNGUIDED_MEDITATION")},e.pause=function(){e.paused=!e.paused,e.paused?(e.bgAudio&&e.bgAudio.pause(),C&&C.pause(),C||(e.elapsedTime+=(new Date).getTime()-e.startTime,e.startTime=0),u.eventTrack("pauseNarration",{category:"relax"})):(e.started?C&&C.play(h):L(),e.bgAudio&&e.bgAudio.play(m),e.startTime=(new Date).getTime(),u.eventTrack("playNarration",{category:"relax"}))},window.backButtonOverride=function(){var i=!1;e.paused||(e.pause(),i=!0);var t=p.confirm({template:'<div class="thisisatest">'+l.instant("EXIT_ACTIVITY_CONFIRM")+"</div>",cancelText:l.instant("CANCEL"),cancelType:"button-default",okText:l.instant("CONFIRM"),okType:"button-default"});t.then(function(t){t?(window.backButtonOverride=void 0,e.goBack()):i&&e.pause()})},e.destroyCtrl=function(){e.bgAudio&&(e.bgAudio.stop(),e.bgAudio.release()),e.bellSound&&(e.bellSound.stop(),e.bellSound.release()),C&&(C.stop(),C.release()),e.narrationTimeout&&c.cancel(e.narrationTimeout),window.backButtonOverride=void 0,e.exited=!0},e.$on("$destroy",function(){e.destroyCtrl(),window.plugins&&window.plugins.insomnia&&window.plugins.insomnia.allowSleepAgain()});var N,P=100,$=0,R=!0,U=3;e.showElapsedTime=function(){return!0},e.narrationTimeout=c(M,100),c(I,2e3)}]),f.controller("RelaxHelpCtrl",["$scope","$rootScope","$state","$http","$stateParams","$controller","$ionicHistory","AccountService",function(e,i,t,n,o,a,r,s){a("HelpCtrl",{$scope:e}),e.confirm=function(){s.setUserPreference("completed_relax_intro","true"),r.currentView(r.backView()),t.go("app.relax",{},{location:"replace"})}}]),f.controller("MeditateHelpCtrl",["$scope","$rootScope","$state","$http","$stateParams","$controller","$ionicHistory","AccountService",function(e,i,t,n,o,a,r,s){a("HelpCtrl",{$scope:e}),e.confirm=function(){s.setUserPreference("completed_meditate_intro","true"),r.currentView(r.backView()),t.go("app.meditate",{},{location:"replace"})}}]),f.controller("RelaxRecordHelpCtrl",["$scope","$rootScope","$state","$http","$stateParams","$controller","$ionicHistory","AccountService",function(e,i,t,n,o,a,r,s){a("HelpCtrl",{$scope:e}),e.confirm=function(){s.setUserPreference("completed_visualization_intro","true"),r.currentView(r.backView()),t.go(o.nextState,{maxTime:o.maxTime,cycleLength:o.cycleLength,bgAudioSource:o.bgAudioSource,meditationMode:o.meditationMode},{location:"replace"})
}}]),f.controller("BreatheHelpCtrl",["$scope","$rootScope","$state","$http","$stateParams","$controller","$ionicHistory","AccountService",function(e,i,t,n,o,a,r,s){a("HelpCtrl",{$scope:e}),e.confirm=function(){s.setUserPreference("completed_breathe_intro","true"),r.currentView(r.backView()),t.go("app.breathe-exercise",{exercise:o.exercise,cycleLength:o.cycleLength,bgAudioSource:o.bgAudioSource,meditationMode:o.meditationMode,breathingSounds:o.breathingSounds,src:o.src},{location:"replace"})}}])}();