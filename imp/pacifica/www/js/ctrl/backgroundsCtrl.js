var ctrl=angular.module("backgroundsCtrl",[]);ctrl.controller("BackgroundsCtrl",["$scope","$state","$http","$timeout","$translate","$analytics","$ionicLoading","$ionicSlideBoxDelegate","$ionicPopup","AccountService","HabitsService","GoalsService","AudioService","MediaService","PayService","Environment","Token",function(e,n,o,a,t,i,d,r,c,l,u,s,g,v,f){function m(){P&&(angular.element(P).addClass("hideRemove"),P=void 0)}function p(n){l.setUserPreference("background_video",n.code);var o=n.bgAudio;o&&l.setUserPreference("bg_audio_src",o),v.setBackgroundVideo(n.filename,n.blurMethod),e.data.video=n.code}e.languageUpdated=!1,e.videos=v.getBackgroundVideos(),e.data={video:e.videos[0].code},e.isPremiumVideoEnabled=function(e){return e.free?!0:l.isPremiumEnabled()};var D=l.getUserPreference("background_video");if(D)for(var $=0;$<e.videos.length;++$){var b=e.videos[$];if(b.code==D){v.isDownloaded(b.filename)&&e.isPremiumVideoEnabled(b)&&(e.data.video=D);break}}var w;e.$on("event:downloadProgress",function(n,o){(!w||w.getTime()<(new Date).getTime()-250||o&&o.complete)&&a(function(){w=new Date,e.$$phase||e.$apply()})});var P;e.elementDragged=function(e){if("dragleft"==e.type){m();{angular.element(e.currentTarget).scope()}P=e.currentTarget,angular.element(e.currentTarget).removeClass("hideRemove")}else angular.element(e.currentTarget).addClass("hideRemove"),P=void 0},e.getVideoClass=function(e){return"bgVideo_"+e.code},e.removeDownload=function(n,o){n.stopPropagation(),n.preventDefault();var i=c.confirm({template:"<div>"+t.instant("BACKGROUND_VIDEO_REMOVE_PROMPT")+"</div>",cancelText:t.instant("CANCEL"),cancelType:"button-default",okText:t.instant("REMOVE"),okType:"button-default"});i.then(function(n){n&&(v.removeBackgroundVideo(o.filename),e.isActive(o)&&e.selectVideo(e.videos[0]),a(m,500))})},e.$on("event:downloadRemoved",function(){a(function(){P&&(angular.element(P).addClass("hideRemove"),P=void 0),e.$$phase||e.$apply()})}),e.isActive=function(n){return e.data.video==n.code},e.isDownloading=function(e){return v.isDownloading(e.filename)},e.isDownloaded=function(e){return"ocean"==e.code?!0:v.isDownloaded(e.filename)},e.getDownloadPercentage=function(e){return v.getDownloadPercentage(e.filename)},e.selectVideo=function(n){e.isPremiumVideoEnabled(n)?e.isDownloaded(n)?p(n):e.isDownloading(n)||v.downloadBackgroundVideo(n.filename,function(){p(n)},function(){}):f.showPremiumModal(e,"backgrounds",n.name,!0)},e.updateLanguage=function(){l.setLocale(e.data.locale).success(function(){e.languageUpdated=!0,a(function(){e.languageUpdated=!1},3e3)})}}]);