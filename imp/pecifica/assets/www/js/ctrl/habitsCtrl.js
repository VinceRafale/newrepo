!function(){function t(t){return t.valueString?t.valueString:t.valueInt}var e=angular.module("habitsCtrl",[]),a=["FEELING_ANXIOUS","FEELING_STRESSED","FEELING_RELAXED","FEELING_HAPPY","FEELING_SAD","FEELING_LOVED","FEELING_GRATEFUL","FEELING_CALM","FEELING_LONELY","FEELING_EXCITED","FEELING_ANGRY","FEELING_PANICKED","FEELING_INSPIRED","FEELING_TIRED","FEELING_DEPRESSED","FEELING_SICK","FEELING_ANNOYED","FEELING_EXHAUSTED","FEELING_NERVOUS","FEELING_WORRIED","FEELING_CONTENT","FEELING_SLEEPY","FEELING_FRUSTRATED","FEELING_BORED","FEELING_CONFUSED","FEELING_NUMB","FEELING_OVERWHELMED","FEELING_EMPTY","FEELING_SCARED","FEELING_IRRITATED","FEELING_HOPEFUL","FEELING_NEUTRAL","FEELING_ACCOMPLISHED","FEELING_ALONE","FEELING_PRODUCTIVE","FEELING_GUILTY","FEELING_DISAPPOINTED","FEELING_UPSET","FEELING_RELIEVED","FEELING_HOPELESS","FEELING_MOTIVATED","FEELING_HURT","FEELING_IRRITABLE","FEELING_RESTLESS","FEELING_PROUD","FEELING_CHILL","FEELING_UNMOTIVATED","FEELING_CONFIDENT","FEELING_DRAINED","FEELING_TENSE","FEELING_PEACEFUL","FEELING_INDIFFERENT","FEELING_INSECURE","FEELING_UNEASY","FEELING_LAZY","FEELING_OPTIMISTIC","FEELING_UNSURE","FEELING_NAUSEOUS","FEELING_UNCOMFORTABLE","FEELING_SATISFIED","FEELING_HEARTBROKEN","FEELING_DETERMINED","FEELING_POSITIVE","FEELING_JEALOUS","FEELING_APATHETIC","FEELING_AGITATED","FEELING_BLESSED","FEELING_UNWANTED","FEELING_ENERGIZED","FEELING_BUSY","FEELING_PARANOID","FEELING_RESTED","FEELING_FOCUSED","FEELING_ALRIGHT","FEELING_GRUMPY","FEELING_CONFLICTED","FEELING_MELANCHOLY","FEELING_EMOTIONAL","FEELING_LETHARGIC","FEELING_EMBARRASSED","FEELING_ENERGETIC","FEELING_FATIGUED","FEELING_ASHAMED","FEELING_AFRAID","FEELING_DISTRACTED","FEELING_UNCERTAIN","FEELING_BETRAYED","FEELING_APPREHENSIVE","FEELING_THOUGHTFUL","FEELING_DEFEATED","FEELING_IMPATIENT","FEELING_NOSTALGIC","FEELING_REGRETFUL","FEELING_IGNORED","FEELING_CONCERNED","FEELING_HELPLESS","FEELING_HOMESICK","FEELING_DISCONNECTED","FEELING_DISCOURAGED","FEELING_AGGRAVATED","FEELING_HEALTHY","FEELING_MELLOW","FEELING_THANKFUL","FEELING_AMAZING","FEELING_WEAK","FEELING_DYSPHORIC","FEELING_ABANDONED","FEELING_INADEQUATE","FEELING_UNPRODUCTIVE","FEELING_EMOTIONLESS","FEELING_REJECTED","FEELING_ANTSY","FEELING_AWKWARD","FEELING_MOODY","FEELING_GROGGY","FEELING_MISERABLE","FEELING_CRANKY","FEELING_TRAPPED","FEELING_AWESOME","FEELING_BUMMED","FEELING_UNFOCUSED","FEELING_DECENT","FEELING_PENSIVE","FEELING_DISGUSTED","FEELING_TERRIFIED","FEELING_CREATIVE","FEELING_SAFE","FEELING_READY","FEELING_EMPOWERED","FEELING_APPRECIATED","FEELING_UNAPPRECIATED","FEELING_BALANCED","FEELING_WELL","FEELING_AMUSED","FEELING_PRESSURED","FEELING_MANIC","FEELING_PATHETIC","FEELING_FULFILLED","FEELING_FURIOUS","FEELING_HOT","FEELING_POSSESSIVE","FEELING_CYNICAL","FEELING_FRIGHTENED","FEELING_OBSESSED","FEELING_INTRIGUED","FEELING_INTIMIDATED","FEELING_LOYAL","FEELING_COMFORTABLE","FEELING_FASCINATED","FEELING_NEGLECTED","FEELING_DISTURBED","FEELING_MANIPULATED","FEELING_WITHDRAWN","FEELING_RESPECTED","FEELING_FESTIVE","FEELING_CRAZY","FEELING_SORRY","FEELING_ECSTATIC","FEELING_RESPONSIBLE","FEELING_CLAUSTROPHOBIC","FEELING_DEVASTATED","FEELING_AMBIVALENT","FEELING_SHY","FEELING_DELIGHTED","FEELING_SILLY","FEELING_INTERESTED","FEELING_HYSTERICAL","FEELING_SHOCKED","FEELING_GUARDED","FEELING_EUPHORIC","FEELING_DISTRESSED","FEELING_SKEPTICAL","FEELING_TEASED","FEELING_SENSITIVE","FEELING_EAGER","FEELING_CHEATED","FEELING_ENVIOUS","FEELING_PATIENT","FEELING_AGGRESSIVE","FEELING_VIOLENT","FEELING_RECKLESS","FEELING_SYMPATHETIC","FEELING_ATTRACTIVE","FEELING_POWERLESS","FEELING_COOL","FEELING_COURAGEOUS","FEELING_SELF-CONSCIOUS","FEELING_HUMILIATED","FEELING_BRAVE","FEELING_AFFECTIONATE","FEELING_PREPARED","FEELING_INSULTED","FEELING_SASSY","FEELING_IMPORTANT","FEELING_SEXY","FEELING_THRILLED","FEELING_ENCOURAGED","FEELING_ENTERTAINED","FEELING_SUSPICIOUS","FEELING_SARCASTIC","FEELING_THREATENED","FEELING_ADVENTUROUS","FEELING_FUNNY","FEELING_PLAYFUL","FEELING_RELUCTANT","FEELING_DEGRADED","FEELING_HUMBLE","FEELING_FLIRTATIOUS","FEELING_RESENTFUL","FEELING_FRISKY","FEELING_HORNY","FEELING_SURPRISED","FEELING_MISUNDERSTOOD","FEELING_FRIENDLY","FEELING_OFFENDED","FEELING_DESPERATE","FEELING_DEFENSIVE","FEELING_HATEFUL","FEELING_TROUBLED","FEELING_FLUSTERED","FEELING_HOSTILE","FEELING_TEMPTED","FEELING_PROVOKED","FEELING_IN_LOVE","FEELING_VENGEFUL","FEELING_BITTER","FEELING_DARING","FEELING_ALIVE","FEELING_REBELLIOUS","FEELING_ALIENATED","FEELING_GRIEVING","FEELING_CURIOUS","FEELING_PASSIONATE","FEELING_CHALLENGED","FEELING_VULNERABLE","FEELING_JUDGMENTAL","FEELING_CARING","FEELING_INVISIBLE","FEELING_IMPRESSED","FEELING_JOYFUL","FEELING_ALARMED","FEELING_WONDERFUL","FEELING_PESSIMISTIC"];e.controller("HabitsCtrl",["$scope","$rootScope","$controller","$state","$timeout","$http","$translate","$analytics","$ionicScrollDelegate","$ionicHistory","$ionicPopup","$ionicModal","$ionicLoading","$ionicPlatform","$ionicActionSheet","AccountService","HabitsService","GeneralService","NotificationService","SkillsService","PayService","Token","Environment",function(t,e,a,i,n,o,r,s,l,E,u,c,d,I,b,h,N,g,_,D,f,L,v){function T(e){return function(a){a&&(t.habitReminders[e.id]=a,t.$$phase||t.$apply())}}function F(){t.habits=N.getAccountHabits(),t.potentialHabits=N.getPotentialAccountHabits(),N.removeMoodHabit(t),t.habitReminders={};for(var e=0;e<t.habits.length;++e){var a=t.habits[e];_.queryForHabitReminder(a,T(a))}}function G(e){F();for(var a=0;a<t.habits.length;++a){var i=t.habits[a],n=t.getHabitData(i.id);C(i,n,e)}}function p(){var t=h.getSplitTestContext();if(t&&t.splitTestGroups){var e=t.splitTestGroups.habitEntryUI;if(e)return"spinner"==e}return!1}function S(e){e&&_.scheduleHabitReminder(t.habitForReminder,e,function(){t.habitReminders[t.habitForReminder.id]={at:e.getTime()/1e3},t.$$phase||t.$apply(),s.eventTrack("scheduleHabitReminder",{category:"habits"})})}function H(){}function A(){for(var e=[],a=5,i=t.startReminder+a<t.habits.length,o=Math.min(t.habits.length-t.startReminder,a),s=t.startReminder;s<t.startReminder+o;++s){var l,E,u=t.habits[s];t.hasReminder(u)?(l="ion-ios-minus-outline",E=" <span>("+t.getReminderTimeDisplay(u)+")</span>"):(l="ion-ios-plus-outline",E=""),e.push({text:'<i class="icon '+l+'"></i> '+N.getHabitName(u)+E})}if(i){var c=Math.min(t.habits.length-(t.startReminder+a),a);e.push({text:'<i class="icon ion-ios-arrow-thin-right"></i>'+r.instant("NEXT")+" "+c})}b.show({buttons:e,titleText:r.instant("SELECT_A_HABIT"),cancelText:r.instant("CANCEL"),cancel:function(){},buttonClicked:function(o){if(i&&o==e.length-1)t.startReminder+=a,n(A);else{var r=t.startReminder+o,s=t.habits[r];t.hasReminder(s)?t.cancelReminder(s):(t.habitForReminder=s,datePicker.show({date:new Date,mode:"time",allowOldDates:!0,allowFutureDates:!0},S,H))}return!0}})}function m(){n(R)}function R(){if(t.updating)return void(t.requiresUpdate=!0);t.requiresUpdate=!1;var e=[],a=[];for(var i in t.todaysData){var n=t.todaysData[i],o=+n.options.value;if(o>0&&n.updated){var r=n.habitData;r?N.buildMultiHabitDataUpdateArray(a,n.habit,r,o-1,t.date,void 0,void 0,t.isGoalMet(n.habit)):N.buildMultiHabitDataArray(e,n.habit,o-1,t.date,void 0,void 0,t.isGoalMet(n.habit))}}e.length>0&&(t.updating=!0,N.recordMultiHabitData(e).success(function(){G(!0),t.requiresUpdate?(t.updating=!1,m()):a.length>0?N.updateMultiHabitData(a).success(function(){G(!0),t.updating=!1}).error(function(){t.updating=!1}):t.updating=!1}).error(function(){t.updating=!1})),a.length>0&&0===e.length&&(t.updating=!0,N.updateMultiHabitData(a).success(function(){t.updating=!1,G(!0),t.requiresUpdate&&m(),t.updating=!1}).error(function(){t.updating=!1}))}function O(){for(var e=0;e<t.habits.length;++e){var a=t.habits[e],i=t.todaysData[a.id];i.updated&&(a.goalOrdinal=i.habit.goalOrdinal=i.options.value-1,N.updateGoalOrdinal(a))}G(!1)}function C(e,a,i){var n=e.habitValues;e.goalOrdinal>=n.length&&(e.goalOrdinal=n.length-1);var o,r=n[e.goalOrdinal],s=!1,l=r?!!r.valueString:!1;if(a&&!t.editingGoals){var E=N.getHabitValueById(a.habitValueId);E&&(s=!0,o=E.ordinate+1)}s||(o=t.editingGoals?e.goalOrdinal+1:0),t.todaysData[e.id]||(t.todaysData[e.id]={habit:e,options:{value:o}});var u=t.todaysData[e.id];u.hasData=s,u.habitData=s?a:void 0,u.isString=l,++t.redraw,u.options.floor=0,u.options.ceil=n.length,u.options.step=1,u.updated=o!=u.options.value?!0:!1,i||(u.options.value=o)}t.redraw=0;var M;if(t.date=new Date,t.todaysData={},t.updating=!1,"undefined"==typeof t.editingGoals&&(t.editingGoals=!1),N.setIsEditingHabits(!1),t.$on("event:loginRequired",function(){t.habits=[],t.potentialHabits=[],t.todaysData={}}),t.$on("$ionicView.afterEnter",function(){var a=N.getActiveDate();t.date=a?new Date(a):new Date,G(!1);var i=h.getUserPreference("completed_habits_intro");t.nux||i&&"true"==i?(t.nux=!1,window.StatusBar&&StatusBar.styleLightContent()):(e.$broadcast("event:viewVideo",{video:h.HEALTH_VIDEO}),window.StatusBar&&StatusBar.styleDefault(),t.$on("event:introVideoModalClosed",function(){h.setUserPreference("completed_habits_intro",!0),window.StatusBar&&StatusBar.styleLightContent()}))}),t.getHabitsLevel=function(){return D.getSkillLevel("health")},t.goToSkills=function(){window.openURL("/progress/mood?tab=skills")},t.hasReminder=function(e){return!!t.habitReminders[e.id]},t.getReminderTimeDisplay=function(e){var a=t.habitReminders[e.id];if(a){var i=new Date(1e3*a.at);return moment(i).format("LT")}},t.cancelReminder=function(e){s.eventTrack("cancelHabitReminder",{category:"habits"}),_.cancelHabitReminder(e,function(){delete t.habitReminders[e.id],t.$$phase||t.$apply()})},t.showHelp=function(){var a;a=h.isUMNUser()?[{text:'<i class="icon ion-ios-help-outline"></i> '+r.instant("WHAT_IS_HEALTH")},{text:'<i class="icon ion-ios-play-outline"></i> '+r.instant("WATCH_MILO_IS_BUSY")},{text:'<i class="icon ion-ios-list-outline"></i> '+r.instant("VIEW_COMMON_QUESTIONS")}]:[{text:'<i class="icon ion-ios-help-outline"></i> '+r.instant("WHAT_IS_HEALTH")},{text:'<i class="icon ion-ios-play-outline"></i> '+r.instant("WATCH_MILO_IS_BUSY")},{text:'<i class="icon ion-ios-list-outline"></i> '+r.instant("VIEW_COMMON_QUESTIONS")},{text:'<i class="icon ion-ios-people-outline"></i> '+r.instant("EXPLORE_THE_COMMUNITY")}],b.show({buttons:a,cancelText:r.instant("CANCEL"),cancel:function(){},buttonClicked:function(a){return 0===a?e.$broadcast("event:viewVideo",{video:h.HEALTH_VIDEO}):1===a?h.viewVideo(h.HEALTH_VIDEO):2==a?window.open("http://help.thinkpacifica.com/hc/en-us/sections/200750787-Health","_blank","location=no"):3==a&&t.goToCommunity("health"),!0}})},t.getDateString=function(){var e=g.getDayString(t.date),a=g.getDayString(new Date);if(e==a)return r.instant("TODAY");var i=(new Date).addDays(-1),n=g.getDayString(i);if(e==n)return r.instant("YESTERDAY");t.date.getDay(),t.date.getMonth();return moment(t.date).format("dddd, MMMM Do YYYY")},t.previousDay=function(){if(t.canGoBackwards()){if(t.postHabits(),t.date=t.date.addDays(-1),N.setActiveDate(t.date),!M||t.date<M){var e=t.date.addDays(-6);d.show({template:r.instant("LOADING_HISTORY")+"..."}),M=e,N.findHabitData(e,t.date).success(function(e){d.hide(),N.addHabitData(e),G(!1),++t.redraw}).error(function(){d.hide()}),s.eventTrack("previousDay",{category:"habits"})}G(!1)}},t.nextDay=function(){t.canGoForward()&&(t.postHabits(),t.date=t.date.addDays(1),N.setActiveDate(t.date),s.eventTrack("nextDay",{category:"habits"}),G(!1))},t.canGoBackwards=function(){var e=h.getAccountUser();if(!e||!e.user)return!1;var a=new Date(t.date.getFullYear(),t.date.getMonth(),t.date.getDate()),i=new Date(e.user.createdAtStr),n=new Date(i.getFullYear(),i.getMonth(),i.getDate());return a>n},t.canGoForward=function(){var e=new Date,a=e.addDays(-1);return t.date<a},t.showSlider=function(){return t.editingGoals||!p()},t.navigateToHabit=function(e){if(p()&&!t.editingGoals){var a={habitId:e};t.showingTodaysData()||(a.experiencedDate=t.date),i.go("app.habits-generic",a)}},t.showingTodaysData=function(){var e=new Date,a=new Date(e.getTime()+MILLISECONDS_IN_DAY),i=new Date(e.getTime()-MILLISECONDS_IN_DAY);return t.date>i&&t.date<a},t.getHabitName=function(t){return N.getHabitName(t)},t.getEditHabitText=function(e){return t.editingGoals&&t.canEditHabit(e)?""+r.instant("TAP_TO_EDIT"):""},t.getTodaysHabitsClass=function(){var e=0,a=t.habits;for(var i in a){var n=a[i];1!=n.id&&19!=n.id&&++e}var o=t.getCompletedHabits(),r=100*o/e;return 0===e?"zero":0===r?"zero":r>0&&10>r?"one":r>=10&&20>r?"two":r>=20&&30>r?"three":r>=30&&40>r?"four":r>=40&&50>r?"five":r>=50&&60>r?"six":r>=60&&70>r?"seven":r>=70&&80>r?"eight":r>=80&&90>r?"nine":r>=90&&100>r?"ten":"eleven"},t.getCompletedHabits=function(){for(var e=t.habits,a=0,i=0;i<e.length;++i){var n=e[i];if(1!=n.id&&19!=n.id){var o=t.todaysData[n.id],r=o.options.value;(t.editingGoals||r>0&&N.metGoal(n,r-1))&&++a}}return a},t.removeHabit=function(a){var i=u.confirm({template:'<div class="thisisatest">'+r.instant("HABITS_REMOVE_CONFIRMATION")+"</div>",cancelText:r.instant("CANCEL"),cancelType:"button-default",okText:r.instant("REMOVE"),okType:"button-default"});i.then(function(i){i&&(t.cancelReminder(a),N.removeHabit(a.id).success(function(){N.removeLocalHabit(a.id);for(var i in t.todaysData){var o=t.todaysData[a.id];if(o.habit.id==a.id){delete t.todaysData[a.id];break}}F(),n(function(){e.$broadcast("reCalcViewDimensions")})}).error(function(){u.alert({template:r.instant("HABITS_REMOVING_ACTIVITY_ERROR"),okText:r.instant("OK_GOT_IT"),okType:"button-default"})}))})},t.addHabit=function(a){N.addHabit(a.id,!0).success(function(){N.addLocalHabit(a),G(!1),t.stopAddingActivity(),n(function(){e.$broadcast("reCalcViewDimensions")})}).error(function(){window.alert(r.instant("HABITS_ERROR_ADDING_HABIT"))})},t.moveHabit=function(e,a,i){t.habits.splice(a,1),t.habits.splice(i,0,e),N.reorderHabits(t.habits)},t.isGoalMet=function(e){if(t.editingGoals)return!0;var a=t.todaysData[e.id];return 0===a.options.value?!1:N.metGoal(e,a.options.value-1)},t.hasEntry=function(e){var a=t.todaysData[e.id];return a.options.value>0},t.getRangeBackgroundStyle=function(t){var e=t.habitValues.length+1,a=t.goalOrdinal,i=100/e,n=(a+1)*i,o=t.goalMinimized?"green":"red",r=t.goalMinimized?"red":"green";return"background: repeating-linear-gradient(90deg, grey 0%, grey "+i+"%, "+o+" "+i+"%, "+o+" "+n+"%, "+r+" "+n+"%, "+r+" 100%)"},t.showDailyReminders=function(){t.startReminder=0,A()},t.showOptions=function(e,a){e.preventDefault(),e.stopPropagation();var n,o=t.canEditHabit(a),s=o?"EDIT_ACTIVITY":"CUSTOMIZE_ACTIVITY",l=t.hasReminder(a);n=r.instant(l?"REMOVE_DAILY_REMINDER":"SET_DAILY_REMINDER");var E=[{text:'<i class="icon ion-ios-bell-outline"></i> '+n},{text:'<i class="icon ion-ios-checkmark-outline"></i> '+r.instant("CHANGE_DAILY_GOAL")},{text:'<i class="icon ion-ios-trash-outline"></i> '+r.instant("REMOVE_ACTIVITY")},{text:'<i class="icon ion-ios-compose-outline"></i> '+r.instant(s)}];!t.showHealthkitIntegration()||"Sleep"!=a.name&&"Caffeine"!=a.name&&"Exercise"!=a.name||E.push({text:'<i class="icon ion-social-apple-outline"></i> '+r.instant("SYNC_WITH_APPLE_HEALTH")}),b.show({buttons:E,cancelText:r.instant("CANCEL"),cancel:function(){},buttonClicked:function(e){return 0===e?(t.habitForReminder=a,l?t.cancelReminder(a):datePicker.show({date:new Date,mode:"time",allowOldDates:!0,allowFutureDates:!0},S,H)):1==e?t.editGoals():2==e?t.removeHabit(a):3==e?o?t.editHabit(a,!0):i.go("app.habits-create",{habitName:a.name}):4==e&&t.checkHealthKitModal(),!0}})},t.editGoals=function(){t.postHabits(),t.editingGoals=!t.editingGoals,G(!1),++t.redraw,t.date=new Date},t.canAddHabits=function(){return t.potentialHabits.length>0},t.isHabitDisabled=function(e){return t.canEditHabit(e)&&!h.isPremiumEnabled()},t.canEditHabit=function(t){var e=h.getAccountUser();return e&&e.user&&t.creatorId==e.user.id},t.addHabits=function(){return v.isOnline()?void(t.canAddHabits()&&(N.setIsEditingHabits(!0),i.go("app.habits-add"))):void u.alert({template:r.instant("HABITS_ERROR_OFFLINE"),okText:r.instant("OK_GOT_IT"),okType:"button-default"})},t.goToCreateHabit=function(){return v.isOnline()?void i.go("app.habits-create"):void u.alert({template:r.instant("HABITS_ERROR_OFFLINE"),okText:r.instant("OK_GOT_IT"),okType:"button-default"})},t.editHabit=function(e,a){t.canEditHabit(e)&&(t.editingGoals||a)&&(N.setIsEditingHabits(!0),i.go("app.habits-create",{habitId:e.id}))},t.getHabitData=function(e){return N.getHabitDataByHabitId(t.date,e)},t.getTodaysData=function(e){return t.todaysData[e.id]?t.todaysData[e.id]:void 0},t.getTodaysDataDisplay=function(e){return t.todaysData[e.id]?0===t.todaysData[e.id].options.value?r.instant("NO_DATA"):N.getHabitDisplay(e,t.todaysData[e.id].options.value-1):void 0},t.callbacks={valueUpdated:function(e){var a=t.getTodaysData(e);a.updated=!0,l.resize()},valueSet:function(){t.postHabits()},disabledInteraction:function(){f.showPremiumModal(t,"health","disabledHabitInteraction",!0)}},t.$on("$destroy",function(){t.postHabits()}),t.requiresUpdate=!1,t.postHabits=function(){t.editingGoals?O():R()},t.closeHealthKitModal=function(){h.setUserPreference("integrate_with_healthkit","true"),N.initHealthKit(),closeModal(t.healthKitModal),t.healthKitModal.remove(),t.healthKitModal=void 0},t.showHealthkitIntegration=function(){var e=h.getUserPreference("integrate_with_healthkit");return!t.isUMNUser()&&v.isIos()&&!v.isIPad()&&!e},t.checkHealthKitModal=function(){!v.isIos()||v.isIPad()||t.isUMNUser()||t.showHealthkitIntegration()&&c.fromTemplateUrl("views/habits/habits.healthkitModal.html",{scope:t,animation:"slide-in-up"}).then(function(e){t.healthKitModal=e,openModal(t.healthKitModal)})},G(!1),N.requiresHabitDataReload()){var y=t.date.addDays(-6);M=y,d.show({template:r.instant("LOADING_HISTORY")+"..."}),N.findHabitData(y,t.date).success(function(t){d.hide(),N.addHabitData(t),N.clearHabitDataReload()}).error(function(){d.hide()})}}]),e.controller("HabitsTypeCtrl",["$scope","$rootScope","$state","$timeout","$analytics","$stateParams","$translate","$ionicModal","$ionicHistory","$ionicNavBarDelegate","AccountService","HabitsService","GeneralService",function(e,a,i,n,o,r,s,l,E,u,c,d,I){function b(e,a,i,n){var o=0,r=!1,s=n?n:new Date;e.editingHabitData="undefined"!=typeof e.habitDataToEdit;var l=e.editingHabitData?e.habitDataToEdit:a.getHabitDataByHabitId(s,i.id),E=l?a.getHabitValueById(l.habitValueId):void 0;if(E&&!n)if(1==i.frequency)r=!0;else{var u;u="object"==typeof l.experiencedAt?l.experiencedAt.getTime():new Date(l.experiencedAt).getTime();var c=(new Date).getTime();(e.editingHabitData||u>c-3e4)&&(r=!0)}if(r){e.editingHabitData=!0;var d=a.getHabitValueById(l.habitValueId);if(o=d.ordinate,"undefined"!=typeof l.habitSubValueIds&&l.habitSubValueIds.length>0&&i.habitSubValues)for(var b=0;b<i.habitSubValues.length;++b){var h=i.habitSubValues[b];if(l.habitSubValueIds)for(var N=0;N<l.habitSubValueIds.length;++N)if(!(l.habitDataNotes&&l.habitDataNotes.notes&&l.habitDataNotes.notes.indexOf("#"+h.valueString)>=0)&&h.id==l.habitSubValueIds[N]){e.selectedSubValues.push(h);break}}}e.valueData={value:t(i.habitValues[o]),valueIndex:o,hasDaysData:r,habitData:r?l:void 0},r?(e.valueData.userInteracted=!0,l.habitDataNotes&&l.habitDataNotes.notes&&(e.valueData.notes=l.habitDataNotes.notes)):e.valueData.value="?",e.colors=i.goalMinimized?["#ffffff","#ff6669"]:["#ff6669","#5ce59d"],i.goalMinimized&&(e.progressColors=["#5ce59d","#ff6669"]),e.colors.push(i.goalMinimized?"#ff6669":"#ffffff"),1==i.id?e.colors[1]=I.COLORS[e.valueData.valueIndex]:19==i.id&&(e.colors[1]=I.STRESS_COLORS[e.valueData.valueIndex]),e.goalPercentage=i.goalMinimized?(i.goalOrdinal+1)/i.habitValues.length:i.goalOrdinal/i.habitValues.length,e.colorPercentages=[e.goalPercentage,1-e.goalPercentage],e.habitClass=1==i.creatorId?i.name.toLowerCase():"",e.habitName=i.name,e.habitQuestionKey=("HABITS_QUESTION_"+i.name).toUpperCase(),e.habitNotes={notes:""},e.valueData&&e.valueData.notes&&(e.habitNotes.notes=e.valueData.notes)}e.submittingData=!1,e.selectedSubValues=[],e.experiencedDate||(e.experiencedDate=r.experiencedDate?new Date(r.experiencedDate):void 0),e.initialized=!1,n(function(){e.initialized=!0},10),e.habit=d.getAccountHabitValuesById("undefined"==typeof r.habitId?i.current.data.habitId:+r.habitId),e.getInteracted=function(){return e.valueData.userInteracted},e.hasNotes=function(){return e.habitNotes.notes&&e.habitNotes.notes.length>0},e.getHabitValueDisplay=function(){return e.valueData?d.getHabitDisplay(e.habit,e.valueData.valueIndex):void 0},e.checkForGoalTest=function(){return!e.habit.goalMinimized&&e.valueData.valueIndex>=e.habit.goalOrdinal||e.habit.goalMinimized&&e.valueData.valueIndex<=e.habit.goalOrdinal},e.checkForGoal=function(){var t=e.checkForGoalTest();t&&o.eventTrack("reachedHabitGoal",{category:"habits",label:e.habit.name}),19==e.habit.id?(E.currentView(E.backView()),i.go("app.habits-Mood",{habitId:1})):e.goBack()},e.submitData=function(t,a){return"?"==e.valueData.value?void(e.noDataError=!0):(e.noDataError=!1,e.submittingData=!0,void(e.valueData.hasDaysData?(d.updateHabitData(e.habit,e.valueData.habitData,e.valueData.valueIndex,void 0,e.experiencedDate,e.habitNotes.notes,e.checkForGoalTest()).success(function(){e.submittingData=!1,e.checkForGoal(),a&&a()}).error(function(){e.submittingData=!1}),o.eventTrack("updateHabitData",{category:"habits",label:e.habit.name,value:e.valueData.valueIndex})):(d.recordHabitData(e.habit,e.valueData.valueIndex,void 0,e.experiencedDate,e.habitNotes.notes,e.checkForGoalTest()).success(function(t){e.submittingData=!1,e.checkForGoal(),a&&a(t)}).error(function(){e.submittingData=!1}),o.eventTrack("recordHabitData",{category:"habits",label:e.habit.name,value:e.valueData.valueIndex}))))},e.goBack=function(){E.goBack()},e.getHabitHeaderName=function(){var t=e.habitName;return t?s.instant(t.toUpperCase()):void 0},19==e.habit.id&&e.$watch("valueData.valueIndex",function(){if(e.initialized){var t=e.valueData.valueIndex;if(e.lastValueIndex!=t){var a=!1;e.colors[1]!=I.STRESS_COLORS[t]&&(a=!0),e.colors[1]=I.STRESS_COLORS[t],e.lastValueIndex=t,a&&e.valueData.redraw++}}});var h=window.innerHeight,N=!1;e.$watch("valueData.userInteracted",function(){e.valueData.userInteracted&&!N&&(N=!0,n(e.resizeTextArea))}),e.resizeTextArea=function(){var t=$("#habitNote");if(t&&t[0]){var e=t[0].getBoundingClientRect();$("#habitNote").css("height",h-e.top),$("#habitNote").css("min-height",h-e.top)}},b(e,d,e.habit,e.experiencedDate)}]),e.controller("HabitsMoodCtrl",["$scope","$rootScope","$state","$stateParams","$controller","$timeout","$analytics","$translate","$ionicHistory","$ionicModal","$ionicPopup","$ionicScrollDelegate","HabitsService","AccountService","GeneralService","NotificationService","Environment",function(t,e,i,n,o,r,s,l,E,u,c,d,I,b,h,N,g){function _(){var e={};t.recentFeelings=I.getRecentFeelings(),t.presetFeelings=[];for(var i=0;i<a.length;++i){var n=!1,o=l.instant(a[i]);if(!e[o]){e[o]=o;for(var r=0;r<t.recentFeelings.length;++r){var s=t.recentFeelings[r];if(s.valueString==o){n=!0;break}}n||t.presetFeelings.push(o)}}}function D(e){O>e?(e=O,t.experiencedDate=e,c.alert({template:l.instant("MOOD_DATE_BEFORE_CREATION"),okText:l.instant("OK_GOT_IT"),okType:"button-default"})):R>e?(e=R,t.experiencedDate=e,c.alert({template:l.instant("MOOD_DATE_IN_PAST_WARNING"),okText:l.instant("OK_GOT_IT"),okType:"button-default"})):t.experiencedDate=e>m?void 0:e,t.$$phase||t.$apply()}function f(t){}function L(){t.selectedSubValues.length>0?$(".feeling-list").css("margin-top",$(".selected-feelings-wrapper").outerHeight()):$(".feeling-list").css("margin-top",0)}function v(){closeModal(t.notificationModal),t.notificationModal.remove(),t.notificationModal=void 0,t.goBack()}function T(){S=void 0,H=[],A={}}function F(){var e=t.habitNotes.notes;return e&&(e=e.replace(/&nbsp;/gm,""),e=e.replace(/<(?:.|\n)*?>/gm,"")),e}function G(){if(!S&&(S=F(),A={},S)){H=S.split(" ");for(var t=0;t<H.length;++t){var e=H[t];0===e.indexOf("#")&&(e=e.substring(1),e=e.replace(/\W+/g,""),e=e.toLowerCase(),A[e]=e)}}}function p(e,a,i){var n;if(e&&e.length>0){n=[];for(var o=0;o<e.length;++o)n.push(e[o].id)}t.valueData.hasDaysData?(t.editingHabitData&&t.habitDataToEdit&&(t.habitDataToEdit.habitValueId=t.habit.habitValues[t.valueData.valueIndex].id,t.habitDataToEdit.habitSubValueIds=n,t.habitDataToEdit.habitDataNotes?t.habitDataToEdit.habitDataNotes.notes=S:t.habitDataToEdit.habitDataNotes={notes:S},t.updateEditedValue&&t.updateEditedValue()),I.updateHabitData(t.habit,t.valueData.habitData,t.valueData.valueIndex,n,t.experiencedDate,S).success(function(){t.submittingData=!1,t.checkForModal(),a&&a()}).error(function(){t.submittingData=!1,c.alert({template:l.instant("MOOD_ENTRY_ERROR"),okText:l.instant("OK_GOT_IT"),okType:"button-default"}),i&&i()}),s.eventTrack("updateHabitData",{category:"habits",label:t.habit.name,value:t.valueData.valueIndex})):(I.recordHabitData(t.habit,t.valueData.valueIndex,n,t.experiencedDate,S).success(function(e){t.submittingData=!1,t.checkForModal(),a&&a(e)}).error(function(){t.submittingData=!1,c.alert({template:l.instant("MOOD_ENTRY_ERROR"),okText:l.instant("OK_GOT_IT"),okType:"button-default"}),i&&i()}),s.eventTrack("recordHabitData",{category:"habits",label:t.habit.name,value:t.valueData.valueIndex}))}o("HabitsTypeCtrl",{$scope:t}),t.valueData.redraw=0,t.positive=!0,t.neutral=!1;var S="",H=[],A={};_(),t.newFeelingData={text:""};var m=new Date,R=m.addDays(-6);R.setHours(0,0,0,0);var O=new Date(b.getAccountUser().user.createdAt);t.getMoodDate=function(){return t.experiencedDate?moment(t.experiencedDate).calendar():l.instant("RIGHT_NOW")},t.setMoodDate=function(){if(window.datePicker&&!t.isUMNUser()&&!t.editingHabitData){var e=t.experiencedDate?t.experiencedDate:m;datePicker.show({date:e,mode:"datetime",minDate:O>R?O:R,maxDate:m,allowOldDates:!1,allowFutureDates:!1},D,f)}},t.getMoodColor=function(){return h.COLOR_NAMES[t.valueData.valueIndex]},t.getMoodDisplay=function(){var e="MOOD_"+t.valueData.value;return e=e.replace(" ","_"),l.instant(e)},t.closeFeelingPopup=function(){closeModal(t.feelingModal),t.feelingModal.remove(),t.feelingModal=void 0,r(t.resizeTextArea)},t.showFeelingPopup=function(){return g.isOnline()?void u.fromTemplateUrl("views/habits/habits.customFeeling.popup.html",{scope:t,animation:"slide-in-up"}).then(function(e){t.feelingModal=e,openModal(t.feelingModal),r(L)}):void c.alert({template:l.instant("FEELINGS_OFFLINE_ERROR"),okText:l.instant("OK_GOT_IT"),okType:"button-default"})},t.clearCustomFeeling=function(){if(t.selectedCustomFeeling){var e=t.selectedSubValues.indexOf(t.selectedCustomFeeling);e>=0&&t.selectedSubValues.splice(e,1),t.selectedCustomFeeling=void 0}},t.inputFocused=function(){d.scrollTop(!0)},t.filterRecentFeelings=function(e){for(var a=!1,i=0;i<t.selectedSubValues.length;++i){var n=t.selectedSubValues[i];if(n.valueString==e.valueString){a=!0;break}}return!a},t.getFilteredPresetFeelings=function(){if(t.newFeelingData.text.length>0){for(var e=new RegExp(".*"+t.newFeelingData.text.replace(/\s/g,".*")+".*","i"),a=[],i=0;i<t.recentFeelings.length;++i){var n=t.recentFeelings[i];e.test(n.valueString)&&a.push(n.valueString.toLowerCase())}for(var o=0;o<t.presetFeelings.length;++o){var r=t.presetFeelings[o];e.test(r)&&a.push(r)}return a}return t.presetFeelings},t.hasFeelings=function(){var e=!1;for(var a in A){e=!0;break}return t.selectedSubValues.length>0||e},t.getFeelingText=function(){for(var e="",a={},i=0;i<t.selectedSubValues.length;++i){var n=I.getHabitSubValue(t.selectedSubValues,t.selectedSubValues[i].id);a[n]=n}G();for(var o in A)a[o]=o;var r=0;for(var s in a)++r;var l=0;for(var E in a)l>0&&r>2&&(e+=","),e+=" ",e+=" "+E,++l;return e},t.saveCustomFeeling=function(e){var a=e?e:t.newFeelingData.text;if(a&&(a=a.trim()),!a||0===a.length)return void(t.customFeelingError=l.instant("CUSTOM_FEELING_LENGTH_ERROR"));for(var i=0;i<t.selectedSubValues.length;++i){var n=t.selectedSubValues[i];if(n.valueString==a)return void(t.customFeelingError=l.instant("CUSTOM_FELING_EXISTING_ERROR"))}t.customFeelingError=void 0,t.savingCustomFeeling=!0;for(var o=0;o<t.recentFeelings.length;++o){var s=t.recentFeelings[o];if(s.valueString==a)return void t.setCustomFeeling(s)}var E="undefined"!=typeof e;I.saveCustomFeeling(a,E).success(function(e){t.setCustomFeeling(e),t.savingCustomFeeling=!1,r(L)}).error(function(){c.alert({template:l.instant("SAVE_CUSTOM_FEELING_ERROR"),okText:l.instant("OK_GOT_IT"),okType:"button-default"});t.savingCustomFeeling=!0})},t.getNotificationTiming=function(){return t.notificationTiming},t.setNotificationTiming=function(e){t.notificationTiming=e},t.closeNotificationModal=function(e){return e?void v():(t.notificationTiming="after7",b.setUserPreference("notification_timing",t.notificationTiming),void(window.PushNotification?PushNotification.hasPermission(function(e){N.registerNotifications(),e.isEnabled?v():t.grantingPermission=!0},function(){v(),N.registerNotifications()}):(g.isDebug()&&window.alert("No Push Notification Service."),v())))},t.checkForModal=function(){var e=t.valueData.valueIndex;1>=e&&!t.isUMNUser()&&b.checkForRatingPrompt(),"app.habits-Mood"==i.current.name&&t.goBack()},t.notesChanged=function(){T()},t.$watch("valueData.valueIndex",function(){if(t.initialized){var e=t.valueData.valueIndex;if(t.lastValueIndex!=e){var a=!1;t.neutral=3==e,t.positive=2>=e,t.colors[1]!=h.COLORS[e]&&(a=!0),t.colors[1]=h.COLORS[e],t.lastValueIndex=e,a&&t.valueData.redraw++}}}),t.habitSubValues=t.habit.habitSubValues,t.getValueClass=function(){return"value"+(t.valueData.valueIndex+1)},t.setCustomFeeling=function(e){for(var a=!1,i=0;i<t.selectedSubValues.length;++i){var n=t.selectedSubValues[i];if(n.id==e.id){a=!0;break}}a||(t.selectedSubValues.push(e),t.newFeelingData.text="",_(),I.updateMoodHabitSubValues([e]),r(L))},t.removeSelectedSubValue=function(e){for(var a=t.selectedSubValues.length-1;a>=0;--a){var i=t.selectedSubValues[a];if(i.valueString==e){t.selectedSubValues.splice(a,1);break}}r(L),s.eventTrack("removeHabitSubValue",{category:"habits",label:e})},t.submitData=function(e,a,i){if("?"==t.valueData.value)return void(t.noDataError=!0);t.noDataError=!1,t.submittingData=!0,T(),G();var n=[],o=[];for(var r in A){for(var s=!1,E=0;E<t.selectedSubValues.length;++E){var u=t.selectedSubValues[E];if(u.valueString.toLowerCase()==r){n.push(u),s=!0;break}}s||o.push(r)}for(var c=0;c<t.selectedSubValues.length;++c){for(var d=t.selectedSubValues[c],b=!1,h=0;h<n.length;++h){var N=n[h];if(d.id==N.id){b=!0;break}}b||n.push(d)}o.length>0&&g.isOnline()?I.saveCustomFeelings(o).success(function(t){for(var e=0;e<t.length;++e)n.push(t[e]);p(n,a,i)}).error(function(){window.alert(l.instant("SAVE_CUSTOM_FEELING_ERROR")),t.savingMoodData=!1}):p(n,a,i)}}]),e.controller("HabitsMoodHelpCtrl",["$scope","$rootScope","$state","$stateParams","$controller","$ionicHistory","HabitsService","AccountService",function(t,e,a,i,n,o,r,s){n("HelpCtrl",{$scope:t}),t.confirm=function(){s.setUserPreference("completed_mood_intro","true"),o.currentView(o.backView()),a.go("app.habits-Mood",{habitId:1},{location:"replace"})}}]),e.controller("HabitsStressHelpCtrl",["$scope","$rootScope","$state","$stateParams","$controller","$ionicHistory","HabitsService","AccountService",function(t,e,a,i,n,o,r,s){n("HelpCtrl",{$scope:t}),t.confirm=function(){s.setUserPreference("completed_mood_intro","true"),o.currentView(o.backView()),a.go("app.habits-Stress",{habitId:19},{location:"replace"})}}]),e.controller("HabitsNux1Ctrl",["$scope","$rootScope","$state","$analytics","$translate","$ionicHistory","$ionicLoading","$ionicPopup","HabitsService",function(t,e,a){t.next=function(){a.go("app.habits-nux2")}}]),e.controller("HabitsNux2Ctrl",["$scope","$rootScope","$controller","$state","$analytics","$translate","$ionicHistory","$ionicLoading","$ionicPopup","HabitsService","AccountService","Environment",function(t,e,a,i,n,o,r,s,l,E,u,c){a("HabitsAddCtrl",{$scope:t});for(var d=[2,3,4],I=0;I<t.potentialHabits.length;++I){var b=t.potentialHabits[I];d.indexOf(b.id)>=0&&(t.habitsToAdd[b.id]=b)
}t.next=function(){if(!c.isOnline())return void l.alert({template:o.instant("HABITS_ERROR_OFFLINE"),okText:o.instant("OK_GOT_IT"),okType:"button-default"});var e=!1;for(var a in t.habitsToAdd){e=!0;break}e?(t.errorMessage=void 0,t.addHabits(!1,function(){u.setUserPreference("completed_habits_intro",!0),i.go("app.habits")})):t.errorMessage=o.instant("SELECT_HABIT_TO_ADD")}}]),e.controller("HabitsNux3Ctrl",["$scope","$rootScope","$controller","$state","$analytics","$translate","$ionicHistory","$ionicLoading","$ionicPopup","HabitsService","AccountService",function(t,e,a,i,n,o,r,s,l,E,u){t.removeEmptyState=!0,t.nux=!0,t.editingGoals=!0,a("HabitsCtrl",{$scope:t}),window.StatusBar&&StatusBar.styleDefault(),t.finishNUX=function(){t.postHabits(),u.setUserPreference("completed_habits_intro",!0),i.go("app.habits")}}]),e.controller("HabitsCreateCtrl",["$scope","$rootScope","$state","$stateParams","$analytics","$translate","$ionicHistory","$ionicLoading","$ionicPopup","$ionicScrollDelegate","AccountService","HabitsService","PayService",function(t,e,a,i,n,o,r,s,l,E,u,c,d){window.StatusBar&&StatusBar.styleDefault(),t.updating=!1,t.editingHabit=!1,t.showDelete=!1,t.showReorder=!1;var I=!1;if(t.createInputFocused=function(e){I||u.isPremiumEnabled()||(d.showPremiumModal(t,"health","createActivity",!0),I=!0,e&&$(e.target).blur())},t.toggleDelete=function(){t.showReorder=!1,t.showDelete=!t.showDelete},t.toggleReorder=function(){t.showDelete=!1,t.showReorder=!t.showReorder},i.habitId){var b=+i.habitId;t.habit=c.getAccountHabitById(b),t.editingHabit=!0}else t.habit={name:i.habitName?i.habitName:"",goalOrdinal:1,goalMinimized:!1,habitValues:[{valueString:void 0},{valueString:void 0}]};t.isGoalMet=function(e){return c.metGoal(t.habit,e)},t.setGoal=function(e){t.habit.goalOrdinal=t.habit.goalMinimized?e<=t.habit.goalOrdinal&&e>0?e-1:e>0?e:0:e<t.habit.goalOrdinal?e:1==t.habit.habitValues.length?1-t.habit.goalOrdinal:e<t.habit.habitValues.length-1?e+1:t.habit.habitValues.length-1},t.toggleGoalMinimized=function(){t.habit.goalMinimized=!t.habit.goalMinimized,t.habit.goalMinimized?--t.habit.goalOrdinal:++t.habit.goalOrdinal},t.addHabitValue=function(){t.habit.habitValues.push({valueString:""}),E.resize()},t.removeHabitValue=function(e){if(0===e&&1==t.habit.habitValues.length)t.habit.habitValues[0].valueString=void 0;else{var a=t.habit.habitValues[e];a.active=!1,t.habit.habitValues.splice(e,1),t.habit.goalOrdinal>=t.habit.habitValues.length&&(t.habit.goalOrdinal=t.habit.habitValues.length-1),0===t.habit.habitValues.length&&(t.showDelete=!1)}},t.moveHabitValue=function(e,a,i){t.habit.habitValues.splice(a,1),t.habit.habitValues.splice(i,0,e)},t.createHabit=function(){if(!u.isPremiumEnabled())return void d.showPremiumModal(t,"health","createActivity",!0);if(t.habit.name=t.habit.name.trim(),0===t.habit.name.length)return void(t.errorMessage=o.instant("CREATE_HABIT_ERROR_MISSING_NAME"));if(t.habit.habitValues.length<=1)return void(t.errorMessage=o.instant("CREATE_HABIT_ERROR_NO_VALUES"));for(var e=0;e<t.habit.habitValues.length;++e){var a=t.habit.habitValues[e];if(a.valueString&&(a.valueString=a.valueString.trim()),!a.valueString||0===a.valueString.length)return void(t.errorMessage=o.instant("CREATE_HABIT_ERROR_MISSING_VALUE"))}t.updating||(t.updating=!0,t.errorMessage=void 0,t.editingHabit?c.editHabit(t.habit).success(function(){t.updating=!1,r.goBack()}).error(function(){t.updating=!1,l.alert({template:o.instant("HABITS_ERROR_EDITING_HABIT"),okText:o.instant("OK_GOT_IT"),okType:"button-default"})}):c.createHabit(t.habit,!0).success(function(){t.updating=!1,r.goBack()}).error(function(){t.updating=!1,l.alert({template:o.instant("HABITS_ERROR_CREATING_HABIT"),okText:o.instant("OK_GOT_IT"),okType:"button-default"})}))}}]),e.controller("HabitsAddCtrl",["$scope","$rootScope","$state","$analytics","$translate","$ionicHistory","$ionicLoading","$ionicPopup","HabitsService","AccountService","PayService",function(t,e,a,i,n,o,r,s,l,E,u){window.StatusBar&&StatusBar.styleDefault(),t.goBack=function(){window.StatusBar&&StatusBar.styleLightContent(),o.goBack()},t.habits=l.getAccountHabits(),t.potentialHabits=l.getPotentialAccountHabits(),t.potentialHabits.sort(function(t,e){return t.id-e.id}),t.habitsToAdd=[];var c=l.getHabitsToAdd();c&&(t.habitsToAdd=c),l.clearHabitsToAdd();for(var d=l.getCreatedHabits(),I=0;I<d.length;++I){var b=d[I];t.habitsToAdd[b.id]=b}l.clearCreatedHabits(),t.canCreateHabit=function(){return E.isPremiumEnabled()},t.createHabit=function(){return t.canCreateHabit()?(l.setHabitsToAdd(t.habitsToAdd),void a.go("app.habits-create")):void u.showPremiumModal(t,"health","createActivity",!0)},t.getHabitName=function(t){return l.getHabitName(t)},t.toggleHabit=function(e){t.habitsToAdd[e.id]?delete t.habitsToAdd[e.id]:t.habitsToAdd[e.id]=e,t.addHabits(!0)},t.isAddingHabit=function(e){return t.habitsToAdd[e.id]},t.isOwnedHabit=function(t){return t.creatorId==E.getAccountUser().user.id},t.deleteCustomHabit=function(e,a){e.stopPropagation(),e.preventDefault();var i=s.confirm({template:"<div>"+n.instant("CUSTOM_HABIT_REMOVE_CONFIRMATION")+"</div>",cancelText:n.instant("CANCEL"),cancelType:"button-default",okText:n.instant("DELETE"),okType:"button-default"});i.then(function(e){e&&(r.show({template:n.instant("HABITS_REMOVING_ACTIVITY")+"..."}),l.deleteCustomHabit(a.id).success(function(){t.potentialHabits=l.getPotentialAccountHabits(),r.hide()}).error(function(){s.alert({template:n.instant("HABITS_REMOVING_ACTIVITY_ERROR"),okText:n.instant("OK_GOT_IT"),okType:"button-default"}),r.hide()}))})},t.addHabits=function(e,a){var E=[];for(var u in t.habitsToAdd){var c=t.habitsToAdd[u];E.push(c.id)}E.length>0?(r.show({template:n.instant("HABITS_ADDING_ACTIVITY")+"..."}),l.addHabits(E,!0).success(function(){for(var i in t.habitsToAdd){var n=t.habitsToAdd[i];l.addLocalHabit(n)}r.hide(),e&&(window.StatusBar&&StatusBar.styleLightContent(),o.goBack()),a&&a()}).error(function(){s.alert({template:n.instant("HABITS_ERROR_ADDING_HABIT"),okText:n.instant("OK_GOT_IT"),okType:"button-default"})}),i.eventTrack("addHabits",{category:"habits"})):(e&&o.goBack(),a&&a())}}]),e.controller("HabitsHelpCtrl",["$scope","$rootScope","$state","$stateParams","$translate","$ionicHistory","HabitsService","AccountService",function(t,e,a,i,n,o,r,s){t.$on("$ionicView.afterEnter",function(){window.StatusBar&&StatusBar.styleDefault()}),t.$on("$ionicView.beforeLeave",function(){window.StatusBar&&StatusBar.styleLightContent()}),t.intro=!1,i.intro&&(t.intro=i.intro),t.getHabitsHelpLine1=function(){var e=n.instant("HABITS_HELP_LINE_1");return t.isUMNUser()&&(e=e.replace("mood","stress level and mood")),e},t.getHabitsHelpLine2=function(){var e=n.instant("HABITS_HELP_LINE_2");return t.isUMNUser()&&(e=e.replace("mood","stress level and mood")),e},t.confirm=function(){s.setUserPreference("completed_habits_intro","true"),t.intro?(o.currentView(o.backView()),a.go("app.habits",{},{location:"replace"})):e.$ionicGoBack()},t.habits=r.getAccountHabits(),r.removeMoodHabit(t)}]),e.controller("HabitsConfigCtrl",["$scope","$timeout","$analytics","$translate","$ionicHistory","HabitsService",function(t,e,a,i,n,o){t.goalUpdated=!1,t.habits=o.getAccountHabits().slice();for(var r=t.habits.length-1;r>=0;--r){var s=t.habits[r];("Medication"==s.name||"Hygiene"==s.name)&&t.habits.splice(r,1)}t.goBack=function(){n.goBack()},t.getGoalDisplay=function(t){return o.getHabitDisplayFromValue(t)},t.getHabitValues=function(t){var e=t.habitValues.slice();return"Sleep"==t.name?e=e.slice(2):"Exercise"==t.name||"Eating"==t.name||"Water"==t.name||"Outdoors"==t.name||"Family"==t.name||"Friends"==t.name||"Pets"==t.name||"Relationship"==t.name||"Hobbies"==t.name||"Meditation"==t.name?e=e.slice(1):"Alcohol"==t.name||"Caffeine"==t.name||"Cigarettes"==t.name?e=e.slice(0,e.length-2):"Cannabis"==t.name&&(e=e.slice(0,e.length-1)),e},t.updateGoal=function(i){o.updateGoalOrdinal(i).success(function(){t.goalUpdated=!0,e(function(){t.goalUpdated=!1},3e3)}),a.eventTrack("updateHabitGoal",{category:"habits",label:i.name,value:i.goalOrdinal})}}])}();