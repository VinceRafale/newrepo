var ctrl=angular.module("accountCtrl",[]),EMAIL_REGEX=/^[a-zA-Z0-9.!#$%&â€™*+/=?^_`{|}~-]+@[a-zA-Z0-9-]+(?:\.[a-zA-Z0-9-]+)*$/;ctrl.controller("MiloVideosCtrl",["$rootScope","$scope","AccountService",function(e,o,n){o.viewMoodVideo=function(){n.viewVideo(n.MOOD_VIDEO)},o.viewRelaxVideo=function(){n.viewVideo(n.RELAX_VIDEO)},o.viewGoalsVideo=function(){n.viewVideo(n.GOALS_VIDEO)},o.viewHealthVideo=function(){n.viewVideo(n.HEALTH_VIDEO)},o.viewThoughtsVideo=function(){n.viewVideo(n.THOUGHTS_VIDEO)},o.viewCommunityVideo=function(){n.viewVideo(n.COMMUNITY_VIDEO)}}]),ctrl.controller("AccountCtrl",["$rootScope","$scope","$state","$http","$timeout","$analytics","$translate","$ionicDeploy","$ionicLoading","$ionicPopup","$ionicModal","$ionicGesture","$ionicSideMenuDelegate","AccountService","HabitsService","GoalsService","GroupsService","AudioService","MediaService","PayService","Environment","Token",function(e,o,n,t,i,a,s,c,r,d,u,l,m,f,E,P,g,p,T,v,_){function O(){}function A(){}function M(){window.store&&f.canUpgrade()&&_.isIos()&&(r.show({template:s.instant("ACCOUNT_UPGRADE_ATTEMPTING_REFRESH")+"..."}),window.store.forceRefresh(),i(function(){r.hide()},2e3))}o.user=f.getAccountUser(),o.loggedOut=!1,o.openSideMenu=function(){m.toggleLeft()};var S;o.canUpgrade=function(){return f.canUpgrade()},o.upgrade=function(){v.showPremiumModal(o,"account","upgrade",!0)},o.$on("$destroy",function(){l.off(S,"doubletap",M)}),i(function(){for(var e=document.getElementsByClassName("doubleTap"),o=0;o<e.length;++o){var n=e[o];S=l.on("doubletap",M,angular.element(n))}},1),o.closeNicknameModal=function(){closeModal(o.nicknameModal),o.nicknameModal.remove(),o.nicknameModal=void 0},o.updateNickname=function(){var e=$("#updateUserNickname").val();e&&0!==e.length?(o.nicknameError=void 0,f.setNickname(e).success(function(){o.closeNicknameModal()}).error(function(){d.alert({template:s.instant("UPDATE_NICKNAME_ERROR"),okText:s.instant("OK_GOT_IT"),okType:"button-default"})})):o.nicknameError=s.instant("LOGIN_ERROR_MISSING_NAME")},o.showUpdateNickname=function(){o.originalNickname=o.user.user.name,u.fromTemplateUrl("views/account/account.updateNickname.modal.html",{scope:o,animation:"slide-in-up"}).then(function(e){o.nicknameModal=e,openModal(o.nicknameModal)})},o.isEmailValidated=function(){return f.isEmailValidated()},o.closeEmailModal=function(){closeModal(o.emailModal),o.emailModal.remove(),o.emailModal=void 0},o.updateEmail=function(){var e=$("#updateUserEmail").val();EMAIL_REGEX.test(e)?(o.emailError=void 0,f.setEmailAddress(e).success(function(){o.closeEmailModal(),o.user.user.email=e,o.user.user.emailVerifiedAt=void 0}).error(function(){d.alert({template:s.instant("UPDATE_EMAIL_ERROR"),okText:s.instant("OK_GOT_IT"),okType:"button-default"});o.originalEmail&&(o.user.user.email=o.originalEmail)})):o.emailError=s.instant("LOGIN_ERROR_INVALID_EMAIL")},o.resendValidationEmail=function(){f.resendValidationEmail().success(function(){d.alert({template:s.instant("VALIDATION_EMAIL_SENT"),okText:s.instant("OK_GOT_IT"),okType:"button-default"})}).error(function(){d.alert({template:s.instant("GENERIC_ERROR"),okText:s.instant("OK_GOT_IT"),okType:"button-default"})})},o.showUpdateEmail=function(){o.originalEmail=o.user.user.email,u.fromTemplateUrl("views/account/account.updateEmail.modal.html",{scope:o,animation:"slide-in-up"}).then(function(e){o.emailModal=e,openModal(o.emailModal)})},o.sendFeedback=function(){window.plugins.socialsharing.shareViaEmail("","Pacifica Feedback",["info@thinkpacifica.com"],null,null,null,O,A)},o.getAccountType=function(){var e;return e=f.isPremiumEnabled()?s.instant("ACCOUNT_TYPE_FULL_ACCESS")+" - "+o.user.account.paymentType:s.instant("ACCOUNT_TYPE_BASIC")},o.getUserTimeZone=function(){return f.getUserTimeZone()},o.getShortTermPrice=function(){var e=v.getShortTermProductPrice();return e?"("+e+")":""},o.displayIntroVideos=function(){return f.completedIntroVideos()},o.isPremium=function(){return f.isPremiumEnabled()},o.getPremiumExpiration=function(){return f.getPremiumExpiration()},o.goToNotifications=function(){n.go("app.notifications")},o.goToTimeZones=function(){n.go("app.timezones")},o.goToLanguages=function(){n.go("app.languages")},o.goToTour=function(){n.go("app.miloVideos")},o.getPasscodeTitle=function(){return s.instant(o.settingNewPasscode?o.verifyingPasscode?"REENTER_PASSCODE":"SET_PASSCODE":"VERIFY_PASSCODE")},o.hasActivePasscode=function(){var e=f.getAccountUser();return e&&e.user&&e.user.passcode},o.getPasscodeRowTitle=function(){return s.instant(o.hasActivePasscode()?"CLEAR_PASSCODE":"SET_PASSCODE")},o.firstPasscode=void 0,o.superShowPasscodeModal=o.showPasscodeModal,o.hasPasscodeEntry=function(e){return o.enteredPasscode.length>=e},o.clearPasscode=function(){o.enteredPasscode=""},o.deletePasscodeCharacter=function(){o.enteredPasscode.length>0&&(o.enteredPasscode=o.enteredPasscode.substring(0,o.enteredPasscode.length-1))},o.canClosePasscodeModal=function(){return!0},o.forgotPasscode=function(){},o.canShowForgotPasscode=function(){return!1},o.addPasscodeEntry=function(e){o.enteredPasscode+=e,o.settingNewPasscode&&(o.verifyingPasscode?o.enteredPasscode.length>=4&&(o.enteredPasscode==o.firstPasscode?(o.closePasscodeModal(),f.setPasscode(o.enteredPasscode)):(o.passcodeError=s.instant("PASSCODE_MATCH_ERROR"),o.enteredPasscode="",o.firstPasscode="",o.verifyingPasscode=!1)):4==o.enteredPasscode.length&&(o.firstPasscode=o.enteredPasscode,o.enteredPasscode="",o.verifyingPasscode=!0))},o.showPasscodeModal=function(){return _.isOnline()?(o.firstPasscode="",o.enteredPasscode="",o.passcodeError=void 0,o.settingNewPasscode=!o.hasActivePasscode(),void(o.settingNewPasscode?(o.verifyingPasscode=!1,o.superShowPasscodeModal(o)):f.clearPasscode())):void d.alert({template:s.instant("PASSCODE_OFFLINE_ERROR"),okText:s.instant("OK_GOT_IT"),okType:"button-default"})},o.goToBackgrounds=function(){n.go("app.backgrounds")},o.logout=function(){function n(){a.eventTrack("logout",{category:"account"}),r.hide(),e.$broadcast("event:loginRequired")}var t=d.confirm({template:"<div>"+s.instant("ACCOUNT_LOGOUT_POPUP")+"</div>",cancelText:s.instant("CANCEL"),cancelType:"button-default",okText:s.instant("SIGN_OUT"),okType:"button-default"});t.then(function(e){e&&(r.show({template:s.instant("SIGNING_OUT")+"..."}),o.loggedOut=!0,f.logout().success(n).error(n))})}}]);