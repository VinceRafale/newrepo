window.backButtonOverride=void 0,angular.module("pacifica",["ionic","ionic.service.core","ionic.service.deploy","pacificaAnalytics","pacifica-templates","tokenProvider","helpCtrl","homeCtrl","progressCtrl","accountCtrl","breatheCtrl","groupsCtrl","habitsCtrl","loginCtrl","rethinkCtrl","goalsCtrl","notificationCtrl","timeZoneCtrl","languageCtrl","backgroundsCtrl","environmentService","generalService","mediaService","authService","accountService","goalsService","groupsService","habitsService","audioService","errorService","httpTimeoutService","notificationService","payService","storageService","skillsService","pacificaDirectives","pascalprecht.translate"]).config(["$stateProvider","$urlRouterProvider","$logProvider","$locationProvider","$analyticsProvider","$translateProvider","$ionicConfigProvider","$ionicAppProvider",function(e,o,n,t,a,i,r,s){window.checkedPasscode=!1,r.views.maxCache(3),r.views.swipeBackEnabled(!1),r.backButton.text("").icon("ion-ios-arrow-left").previousTitleText(!1),r.views.transition("android"),r.navBar.alignTitle("center"),s.identify({app_id:"424d81a6",api_key:"e6d7b302dbeedb0a4b28e41c8b947d06b36b0b9f90a135f0"}),i.useStaticFilesLoader({prefix:"i18n/",suffix:".json"}),i.preferredLanguage("en"),i.fallbackLanguage("en"),n.debugEnabled(!0),initializeRoutes(e),moment.locale("en",{longDateFormat:{LTS:"h:mm:ss A",LT:"h:mm A",L:"M/D",LL:"MMMM D, YYYY",LLL:"MMMM D, YYYY LT",LLLL:"dddd, MMMM D, YYYY LT"},calendar:{lastDay:"[Yesterday at] LT",sameDay:"[Today at] LT",nextDay:"[Tomorrow at] LT",lastWeek:"L LT",nextWeek:"dddd [at] LT",sameElse:"L LT"}}),moment.locale("en-gb",{longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"D/M",LL:"D MMMM YYYY",LLL:"D MMMM YYYY LT",LLLL:"dddd, D MMMM YYYY LT"},calendar:{sameDay:"[Today at] LT",nextDay:"[Tomorrow at] LT",nextWeek:"dddd [at] LT",lastDay:"[Yesterday at] LT",lastWeek:"L LT",sameElse:"L LT"}}),moment.locale("es",{longDateFormat:{LT:"H:mm",LTS:"LT:ss",L:"D/M",LL:"D [de] MMMM [de] YYYY",LLL:"D [de] MMMM [de] YYYY LT",LLLL:"dddd, D [de] MMMM [de] YYYY LT"},calendar:{sameDay:function(){return"[hoy a la"+(1!==this.hours()?"s":"")+"] LT"},nextDay:function(){return"[mañana a la"+(1!==this.hours()?"s":"")+"] LT"},nextWeek:function(){return"dddd [a la"+(1!==this.hours()?"s":"")+"] LT"},lastDay:function(){return"[ayer a la"+(1!==this.hours()?"s":"")+"] LT"},lastWeek:"L LT",sameElse:"L LT"}}),moment.locale("fr",{longDateFormat:{LT:"HH:mm",LTS:"LT:ss",L:"D/M",LL:"D MMMM YYYY",LLL:"D MMMM YYYY LT",LLLL:"dddd D MMMM YYYY LT"},calendar:{sameDay:"[Aujourd'hui à] LT",nextDay:"[Demain à] LT",nextWeek:"dddd [à] LT",lastDay:"[Hier à] LT",lastWeek:"L LT",sameElse:"L LT"}}),o.otherwise("/app/home")}]).controller("AppCtrl",["$scope","$rootScope","$state","$animate","$http","$templateCache","$timeout","$analytics","$translate","$ionicHistory","$ionicModal","$ionicPopup","$ionicPlatform","$ionicNavBarDelegate","$ionicSlideBoxDelegate","$ionicTabsDelegate","$ionicLoading","Environment","ErrorService","AccountService","HabitsService","MediaService","GoalsService","GroupsService","AudioService","NotificationService","PayService","GeneralService","StorageService","TokenService","SkillsService",function(e,o,n,t,a,i,r,s,c,d,l,u,p,f,g,m,v,w,h,L,T,M,b,P,k,y,U,S,C,D,x){function E(e){var o=u[e];u[e]=function(e){window.StatusBar&&StatusBar.styleDefault();var n=o(e);return n.then(function(){window.StatusBar&&L.getAccountUser().user&&StatusBar.styleLightContent()}),n}}function Y(){e.shouldCheckForUpdate&&w.checkForUpdate(function(o){if(e.hasUpdate=o,e.reachedHome&&!e.forceUpdate){var n=L.getUserPreference("viewed_update_popup");if((!n||"false"==n)&&o){L.setUserPreference("viewed_update_popup",!0);var t=u.confirm({template:"<div>"+c.instant("UPDATE_AVAILABLE")+"</div>",cancelText:c.instant("CANCEL"),cancelType:"button-default",okText:c.instant("UPDATE"),okType:"button-default"});t.then(function(e){if(e)w.performUpdate(L);else{u.alert({template:c.instant("UPDATE_CANCELED"),okText:c.instant("OK_GOT_IT"),okType:"button-default"})}})}}})}function I(){if(L.getAccountUser()){var e=L.getUserPreference("integrate_with_healthkit");e&&"true"==e&&T.initHealthKit()}}function O(){e.loadingUserContext=!0;var t=D.getToken();return t&&0!=t.length?void L.findUserContext().success(function(n){e.shouldCheckForUpdate=!!n.checkForUpdate,e.forceUpdate=n.forceUpdate,n.forceUpdate&&w.checkForUpdate(function(e){e&&w.performUpdate(L)}),initializeUserContext(n,o,L,T,b,k,U,y,x,w),e.loadingUserContext=!1,e.lastUserContextRequest=new Date}).error(function(){e.loadingUserContext=!1}):void n.go("app.login",{},{location:"replace"})}function A(){window.plugins&&window.plugins.bgVideo?$("body").css("background-color","rgba(1,0,0,0)"):w.isWebDebug()&&$("body").css("background-color","#555"),setTimeout(function(){navigator&&navigator.splashscreen&&navigator.splashscreen.hide(),window.plugins&&window.plugins.bgVideo?$("body").css("background-color","rgba(1,0,0,0)"):w.isWebDebug()&&$("body").css("background-color","#555")},1e3)}function _(){s.initialize(w.getGATrackingCode(),w.getAppVersion(),n.current.url),checkLocalePreference(),window.cordova&&window.cordova.plugins&&window.cordova.plugins.Keyboard&&(window.Keyboard=window.cordova.plugins.Keyboard,window.Keyboard.hideKeyboardAccessoryBar(!1),window.Keyboard.close()),R=screen.width<800&&screen.height<800?!1:!0,r(checkExternalURL,1e3),w.isIos()&&window.ionic&&window.ionic.keyboard&&window.ionic.keyboard.disable(),jQuery(function(e){e.preload.images(document,w.isIos())}),o.$broadcast("event:pacificaInitialize")}t.enabled(!1),window.globalClientHeight=window.innerHeight;var R=!1,H=!1;window.onerror=w.isDebug()?function(e,o,n){alert("ERROR:"+e+"\nurl: "+o+"\nline: "+n);var t=new Error;e+="\n"+t.stack,L.postJSError(e,o,n)}:function(e,o,n){var t=new Error;e+="\n"+t.stack,L.postJSError(e,o,n)},E("show"),E("alert"),E("confirm"),E("prompt"),e.serverError=!1,e.downloadedFile=!1,e.showingIntroModal=!1,e.loadingUserContext=!1,e.lastUserContextRequest=void 0,e.getGroupsBadgeCount=function(){var e=P.getGroupNotificationCount();return e},e.getCommunityBadgeCount=function(){var e=P.getPostNotificationCount();return e},e.isLoggedIn=function(){var e=L.getAccountUser();return e&&e.user},e.closeThoughtsIntroModal=function(){L.setUserPreference("viewed_thoughts_popup","true"),closeModal(e.rethinkIntroModal),e.rethinkIntroModal.remove(),e.rethinkIntroModal=void 0,e.showingIntroModal=!1},e.closeExperimentsIntroModal=function(){L.setUserPreference("viewed_experiments_popup","true"),closeModal(e.experimentsIntroModal),e.experimentsIntroModal.remove(),e.experimentsIntroModal=void 0,e.showingIntroModal=!1},e.getShortTermPrice=function(){var e=U.getShortTermProductPrice();return e?"("+e+")":""},e.closePremiumInfoModal=function(){closeModal(e.premiumInfoModal),e.premiumInfoModal.remove(),e.premiumInfoModal=void 0},e.showMorePremiumInfoModal=function(){l.fromTemplateUrl("views/account/account.upgradeInfo.modal.html",{scope:e,animation:"slide-in-up"}).then(function(o){e.premiumInfoModal=o,openModal(e.premiumInfoModal)})},e.hasUpdate=!1,o.$on("event:userContextInitialized",function(){if(window.Crittercism&&w&&!w.isDebug()){var o=L.getAccountUser();window.Crittercism.setUsername(""+o.user.id)}if(!window.preventNotificationRegistration){var n=L.getUserPreference("notification_timing");n&&"none"!=n&&y.registerNotifications()}U.initStore(),I(),checkLocalePreference(),Y(),window.checkedPasscode||e.showPasscodeModal(),s.setUserId(L.getAccountUser().user.id)}),window.playVideo=function(){window.plugins&&window.plugins.bgVideo&&(n.includes("app.home")||n.includes("app.login"))&&window.plugins.bgVideo.play()},window.pauseVideo=function(){window.plugins&&window.plugins.bgVideo&&window.plugins.bgVideo.pause()},e.errorService=h,e.goBack=function(e){event.stopPropagation(),event.preventDefault(),window.backButtonOverride?window.backButtonOverride():d.goBack(e)},e.doUpdate=function(){var e=u.confirm({template:"<div>"+c.instant("UPDATE_VERIFICATION")+"</div>",cancelText:c.instant("CANCEL"),cancelType:"button-default",okText:c.instant("UPDATE"),okType:"button-default"});e.then(function(e){e&&w.performUpdate(L)})},e.sharePacifica=function(){s.eventTrack("shareClick",{category:"account"}),window.plugins.socialsharing.share(c.instant("SHARE_TEXT"),null,null,"http://www.thinkpacifica.com")},e.hideTabOverride=!1,e.setHideTabs=function(o){e.hideTabOverride=o},e.hideTabs=function(){var o=e.hideTabOverride||"app.home"!=n.current.name&&"app.habits"!=n.current.name&&"app.groups"!=n.current.name&&"app.communities"!=n.current.name&&"app.relax"!=n.current.name&&"app.progress-moodTab"!=n.current.name;return o},e.goToHome=function(e){n.includes("app.home")&&(e.stopPropagation(),e.preventDefault())},e.goToGroups=function(e){if(!w.isOnline()){{u.alert({template:c.instant("GROUPS_OFFLINE_ERROR"),okText:c.instant("OK_GOT_IT"),okType:"button-default"})}return e.stopPropagation(),void e.preventDefault()}L.getUserNotification().communityEvents=0},e.goToCommunity=function(e){var o,n=w.isDevelopment();"relax"==e?o=n?118:711:"health"==e?o=n?11:6:"goals"==e&&(o=n?8:3),o&&openURL("/communities/posts?groupId="+o)},e.goToProgress=function(e){return w.isOnline()?void 0:(u.alert({title:"",template:"<div>"+c.instant("HOME_OFFLINE_PROGRESS_ALERT")+"</div>",okText:c.instant("OK_GOT_IT"),okType:"button-default"}),e.stopPropagation(),void e.preventDefault())},e.viewHelp=function(e){e&&(e.preventDefault(),e.stopPropagation()),window.open("http://help.thinkpacifica.com","_blank","location=no")},e.canUpgrade=function(){return L.canUpgrade()},e.upgrade=function(){U.showPremiumModal(e,"account","upgrade",!0)},e.reachedHome=!1,e.$on("$stateChangeSuccess",function(o,n,t,a){var i=angular.element(document.querySelector("body")),r=a.name.replace(".","-");i.removeClass(r);var c=n.name.replace(".","-");i.addClass(c),s.pageTrack(n.url),("app.home"==n.name||"app.relax"==n.name||"app.groups"==n.name||"app.communities"==n.name)&&T.setActiveDate(void 0),"app.home"==n.name||"app.login"==n.name||"app.nux-activities"==n.name?("app.home"==n.name&&(e.reachedHome||(e.reachedHome=!0,Y())),window.plugins&&window.plugins.bgVideo?window.plugins.bgVideo.getVideoDuration(function(e){e>0&&playVideo()}):w.isWebDebug()&&$("body").css("background-color","#555")):pauseVideo()}),window.checkLocalePreference=function(){var o=L.getUserPreference("preferred_locale");"undefined"==typeof o?navigator.globalization&&!e.isUMNUser()?navigator.globalization.getPreferredLanguage(function(e){var o=e.value;L.setLocale(o)},function(){}):L.setLocale("en-US"):L.updateLocale(o)},window.openURL=function(e){"/"==e?e="/home":e.startsWith("#/app")&&(e=e.substring(5));var o=e,t={},a=e.indexOf("?");if(a>=0){o=e.substring(0,a);for(var i=e.substring(a+1),s=i.split("&"),c=0;c<s.length;++c){var d=s[c].split("=");t[d[0]]=d[1]}}for(var l,u=n.get(),p=0;p<u.length;++p){var f=u[p];if(f.url.startsWith(o)){l=f.name;break}}if(l){var g;l.indexOf("progress")>=0||l.toLowerCase().indexOf("mood")>=0||l.toLowerCase().indexOf("stress")>=0?g=0:l.indexOf("habit")>=0?g=1:l.indexOf("relax")>=0?g=2:l.indexOf("group")>=0?g=3:l.indexOf("communit")>=0&&(g=4),m.selectedIndex()<0||m.selectedIndex()!=g?(0==g?window.location.hash="/app/home":1==g?window.location.hash="/app/habits":2==g?window.location.hash="/app/relax":3==g?window.location.hash="/app/groups":4==g&&(window.location.hash="/app/communities"),r(function(){n.go(l,t)},1e3)):n.go(l,t)}},window.checkExternalURL=function(){window.tabs=m;var e=localStorage.getItem("externalLoadURL");e&&(openURL(e),localStorage.removeItem("externalLoadURL"))},window.playGoalSound=function(){},e.isPacificaLiteUser=function(){var e=L.getSplitTestContext();if(e&&e.splitTestGroups){var o=e.splitTestGroups.umnPilot;return"lite"==o}return!1},e.isUMNUser=function(){return L.isUMNUser()},e.$on("event:reachedGoal",function(){}),e.$on("event:createdMessage",function(){}),p.on("pause",function(){L.setOffline()}),p.on("resume",function(){H&&(L.getAccountUser().user&&U.refreshStore(),O(),I(),r(checkExternalURL,500),e.showPasscodeModal(),playVideo())},!1),e.$on("event:loginRequired",function(){e.closePasscodeModal(),L.clearData(),T.logout(),b.logout(),P.logout(),k.logout(),x.logout(),D.clear(),C.clear(),n.go("app.login",{},{location:"replace"})}),e.$on("event:online",function(){e.serverError=!1,e.$apply()}),e.$on("event:offline",function(){e.serverError=!0,e.$apply()}),e.reconnect=function(){O()},e.showMenu=function(){return!n.includes("app.login")&&!n.includes("app.newUser")},e.getPasscodeTitle=function(){return c.instant("ENTER_PASSCODE")},e.closePasscodeModal=function(){e.passcodeModal&&(closeModal(e.passcodeModal),e.passcodeModal.remove(),e.passcodeModal=void 0)},e.canClosePasscodeModal=function(){return!1},e.canShowForgotPasscode=function(){return!0},e.forgotPasscode=function(){function n(){s.eventTrack("logout",{category:"passcode"}),v.hide(),o.$broadcast("event:loginRequired")}var t=u.confirm({template:"<div>"+c.instant("FORGOT_PASSCODE_POPUP")+"</div>",cancelText:c.instant("CANCEL"),cancelType:"button-default",okText:c.instant("SIGN_OUT"),okType:"button-default"});t.then(function(o){o&&(v.show({template:c.instant("SIGNING_OUT")+"..."}),e.loggedOut=!0,L.logout().success(n).error(n))})},e.enteredPasscode="",e.hasPasscodeEntry=function(o){return e.enteredPasscode.length>=o},e.addPasscodeEntry=function(o){e.enteredPasscode+=o,e.enteredPasscode.length>=4&&(e.enteredPasscode==L.getAccountUser().user.passcode?e.passcodeVerified():(e.enteredPasscode="",e.passcodeError=c.instant("PASSCODE_MATCH_ERROR")))},e.clearPasscode=function(){e.enteredPasscode=""},e.deletePasscodeCharacter=function(){e.enteredPasscode.length>0&&(e.enteredPasscode=e.enteredPasscode.substring(0,e.enteredPasscode.length-1))},e.passcodeVerified=function(){e.passcodeError=void 0,e.closePasscodeModal()},e.showPasscodeModal=function(o){if(L.isLoggedIn()){var n=o?o:e;if("undefined"==typeof e.passcodeModal){n.enteredPasscode="",window.checkedPasscode=!0;var t=L.getAccountUser();t&&t.user&&(t.user.passcode&&t.user.passcode.length>0||"undefined"!=typeof o)&&l.fromTemplateUrl("views/account/account.passcode.modal.html",{scope:n,animation:"slide-in-up",backdropClickToClose:!1,hardwareBackButtonClose:!1}).then(function(o){e.passcodeModal=o,openModal(e.passcodeModal)})}}},o.$on("event:pacificaReady",function(){if(r(O),A(),window.device&&window.device.model){var e=window.device.model;(e.toLowerCase().indexOf("ipad2")>=0||"iPad3,1"==e||"iPad3,2"==e||"iPad3,3"==e||"iPhone5,3"==e||"iPhone5,4"==e)&&$("body").addClass("ipad-no-blur")}H=!0}),p.ready(function(){C.initialize(_)})}]);