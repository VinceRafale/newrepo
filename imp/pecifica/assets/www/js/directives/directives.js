!function(){function e(e){return e.valueString?e.valueString:e.valueInt}function t(e,t){var a,i=e.getBoundingClientRect();t.changedTouches&&(a=t.changedTouches[0].pageX),a||(a="undefined"!=typeof t.pageX?t.pageX:t.clientX);var n;return t.changedTouches&&(n=t.changedTouches[0].pageY),n||(n="undefined"!=typeof t.pageY?t.pageY:t.clientY),{x:a-i.left,y:n-i.top}}var a=angular.module("pacificaDirectives",[]),i=Number.MAX_SAFE_INTEGER;a.directive("contenteditable",["$sce","$parse",function(e,t){return{restrict:"A",require:"?ngModel",link:function(a,i,n,r){function o(){var e=t(n.ngModel),r=e(a);i.html(r)}function l(){var e=i.html();n.stripBr&&"<br>"==e&&(e=""),r.$setViewValue(e)}r&&(r.$render=function(){try{i.html(e.getTrustedHtml(r.$viewValue||""))}catch(t){}},i.on("blur keyup change",function(){a.$evalAsync(l)}),o())}}}]),a.directive("goBack",function(){return{restrict:"E",templateUrl:"views/directives/back.html",transclude:!0,controller:["$scope","$ionicNavBarDelegate","$ionicHistory",function(e,t,a){e.goBack=function(){window.backButtonOverride?window.backButtonOverride():a.goBack()}}]}}),a.directive("paEnter",function(){return function(e,t,a){t.bind("keydown keypress",function(t){13===t.which&&(e.$apply(function(){e.$eval(a.paEnter,{event:t})}),t.preventDefault())})}}),a.directive("pacificaIntro",function(){return{restrict:"E",templateUrl:"views/directives/pacificaIntro.html",replace:!0,scope:{forceDisplay:"@",displayTitle:"@"},controller:["$rootScope","$scope","$state","$element","$timeout","$translate","$analytics","$ionicModal","AccountService","MediaService","GeneralService","HabitsService","Environment",function(e,t,a,i,n,r,o,l,c,s,d,u,h){t.$on("event:viewVideo",function(e,a){t.showVideoPopup(a.video)}),t.isUMNUser=function(){return c.isUMNUser()},t.goToActivity=function(a){t.closeIntroVideoModal(),e.$broadcast("event:goToActivity",{activity:a})},t.alwaysDisplay=function(){return"true"==t.forceDisplay},t.showTitle=function(){return"false"!=t.displayTitle},t.getVideoButtonText=function(){return r.instant("OK_GOT_IT")},t.getSocialViewType=function(){return r.instant(a.current.url.indexOf("communities")>=0?"COMMUNITIES":"GROUPS")},t.sharePacifica=function(){o.eventTrack("shareClick",{category:"intro"}),window.plugins.socialsharing.share(r.instant("SHARE_TEXT"),null,null,"http://www.thinkpacifica.com")},t.getIntroVideoTitle=function(e){return 5>e?c.getVideoTitle(e):t.getSocialViewType()},t.getShareableVideoLink=function(e){return c.getShareableVideoLink(e)},t.copyLinkToClipboard=function(e){var a=t.getShareableVideoLink(e);cordova.plugins.clipboard.copy(a,function(){t.urlCopied||(t.urlCopied=!0,t.$$phase||t.$apply(),n(function(){t.urlCopied=!1},2e3))},function(){})},t.shareVideo=function(e){var a=t.getShareableVideoLink(e);window.plugins.socialsharing.share(r.instant("SHARE_TEXT_MILO"),null,null,a)},t.buttonClicked=function(e){t.closeIntroVideoModal(e)},t.determineActivity=function(){"app.home"==a.current.name&&(t.currentVideo==c.MOOD_VIDEO?t.goToActivity("mood"):t.currentVideo==c.THOUGHTS_VIDEO?t.goToActivity("thoughts"):t.currentVideo==c.GOALS_VIDEO&&t.goToActivity("goals"))},t.closeIntroVideoModal=function(a){t.introVideo&&(closeModal(t.introVideo,a),t.introVideo.remove(),t.introVideo=void 0,t.determineActivity(),e.$broadcast("event:introVideoModalClosed"))},t.skipVideo=function(e){c.skipVideo(e),t.closeIntroVideoModal()},t.viewVideo=function(e){c.viewVideo(e,function(){t.$$phase||t.$apply()})},t.showVideoPopup=function(a){return h.isOnline()?void(t.canViewVideo(a)?(t.currentVideo=a,n(function(){l.fromTemplateUrl("views/introVideo.popup.html",{scope:t,animation:"slide-in-up"}).then(function(e){t.introVideo=e,openModal(t.introVideo)})})):e.$broadcast("event:viewAttempt")):void t.determineActivity()},t.hasViewedVideo=function(e){return c.hasViewedVideo(e)},t.canSkipVideos=function(){var e=c.getUserPreference("can_skip_intro_videos");return e&&"true"===e},t.canViewVideo=function(e){return c.canViewVideo(e)},t.viewedVideoToday=function(){return c.viewedVideoToday()}}]}}),a.directive("healthSelector",function(){return{restrict:"E",templateUrl:"views/directives/healthSelector.html",replace:!0,scope:{habit:"=",value:"=",editingGoals:"=",redraw:"=",callbacks:"=",removeEmptyState:"@",disabled:"="},controller:["$scope","$element","$timeout","$analytics","MediaService","GeneralService","HabitsService","Environment",function(e,a,n,r,o,l,c){function s(){var t;t=e.editingGoals?e.value-1:e.habit.goalOrdinal,e.habit.goalMinimized&&(t+=1),y=(1-V)*(t/e.habit.habitValues.length),S=1-V-y}function d(){s();var t=5*e.canvasScale;b.clearRect(0,0,D,T);var a=T/2;b.fillStyle="#aaaaaa",b.beginPath(),b.rect(0,a-t/2,D*V,t),b.fill(),b.fillStyle=e.disabled?"cccccc":e.habit.goalMinimized?"#60d293":"#ff6669",b.beginPath(),b.rect(D*V,a-t/2,D*y,t),b.fill(),b.fillStyle=e.disabled?"cccccc":e.habit.goalMinimized?"#ff6669":"#60d293",b.beginPath(),b.rect(D*(V+y),a-t/2,D*S,t),b.fill(),M>i&&(M=i);var n=u();0===e.value?(b.fillStyle="#ffffff",b.beginPath(),b.arc(n,a,M/2,0,2*Math.PI),b.fill(),b.fillStyle="#cccccc",b.beginPath(),b.arc(n,a,M/2*.7,0,2*Math.PI),b.fill()):(b.fillStyle=e.disabled?"cccccc":c.metGoal(e.habit,e.value-1)||e.editingGoals?"#60d293":"#ff6669",b.beginPath(),b.arc(n,a,M/2,0,2*Math.PI),b.fill())}function u(){if(0===e.value)return D*V/2;var t=e.habit.habitValues.length,a=D*(1-V)/t;return D*V+a/2+(e.value-1)*a}function h(a){if(a.preventDefault(),a.stopPropagation(),e.disabled)return void(e.callbacks.disabledInteraction&&e.callbacks.disabledInteraction());var i=p.width,n=t(p,a);n.x*=e.canvasScale;var r,o=n.x/i;if(V>o)r=e.editingGoals||g>0?1:0;else{var l=e.habit.habitValues.length,c=V*i,s=n.x-c,u=i-c;o=s/u,o>=1&&(o=.9999),r=Math.floor(l*o)+1}r!=e.value&&(e.value=r,d(),e.$$phase||e.$apply(),e.callbacks&&e.callbacks.valueUpdated&&e.callbacks.valueUpdated(e.habit))}function v(a){var i=t(p,a),n=u(),r=Math.abs(i.x-n/e.canvasScale),o=Math.abs(i.y-T/e.canvasScale/2),l=r<=M/e.canvasScale&&o<=M/e.canvasScale;return l}function f(){e.callbacks&&e.callbacks.valueSet&&e.callbacks.valueSet(e.habit)}var g=e.value;e.$watch("redraw",function(){d()}),e.canvasScale=window.devicePixelRatio;var p=a.find("canvas")[0],b=p.getContext("2d"),m=$(p).innerWidth(),w=$(p).innerHeight();p.width!=m*e.canvasScale&&(p.width=m*e.canvasScale),p.height!=w*e.canvasScale&&(p.height=w*e.canvasScale);var y,S,k,D=p.width,T=p.height,V=e.removeEmptyState?0:.1,M=30*e.canvasScale;for(k=e.removeEmptyState?D*(1/e.habit.habitValues.length):Math.min(D*V,D*(1-V)*(1/e.habit.habitValues.length));M>k;)M*=.8;i>M&&(i=M);var P=!1;p.addEventListener("touchstart",function(e){P=v(e)},!1),p.addEventListener("touchend",function(){P=!1,f()},!1),p.addEventListener("touchmove",function(e){P&&h(e)},!1),p.addEventListener("mousedown",function(e){P=v(e)}),p.addEventListener("mouseup",function(){P=!1,f()}),p.addEventListener("mousemove",function(e){P&&h(e)}),d()}]}});var n=[];a.directive("audioLineItem",function(){return{restrict:"E",templateUrl:"views/directives/audioLineItem.html",replace:!0,scope:{src:"=",duration:"=",tags:"=",bgColor:"@",hide:"="},controller:["$scope","$element","$timeout","$analytics","$translate","$ionicPopup","MediaService","GeneralService","Environment",function(e,t,a,i,r,o,l,c,s){function d(){var t=n.indexOf(e);t>=0&&n.splice(t,1)}function u(t){if(t.stopPropagation(),t.preventDefault(),e.media){var a=parseInt($(v).css("padding-left")),i=parseInt($(v).css("padding-right")),n=$(v).outerWidth()-a-i,r=($(v).outerHeight(),0);t.changedTouches&&(r=t.changedTouches[0].pageX-v.getBoundingClientRect().left-a);var o=r/n,l=e.media.getDuration();e.media.seekTo(o*l*1e3)}}function h(){var t=v.width,a=v.height;if(f.clearRect(0,0,t,a),f.beginPath(),f.rect(0,0,t,a),f.fillStyle=e.bgColor?e.bgColor:"#969696",f.fill(),e.tags)for(var i=0;i<e.tags.length;++i){var n=e.tags[i],r=Math.floor(n.tagTime/e.duration*t);f.beginPath(),f.rect(r-3,0,7,a),f.fillStyle="positive"==n.tagTypeString?"#60d293":"#ff6669",f.fill()}var o=Math.floor(e.currentTime/e.duration*t);f.beginPath(),f.rect(o,0,2,a),f.fillStyle="#fff",f.fill()}e.media=void 0,e.loading=!1,e.playing=!1,e.currentTime=0,e.status=window.Media?Media.MEDIA_STOPPED:0,e.canvasScale=window.devicePixelRatio,e.getDuration=function(){return c.getTimeDisplay(e.duration)},e.getAudioClass=function(){return e.loading?"loading":e.playing?"playing":e.status==(window.Media?Media.MEDIA_STOPPED:0)?"stopped":"paused"},e.monitorPlay=function(){e.media.getCurrentPosition(function(t){0>t&&(t=0),(0!==t||e.status!=Media.MEDIA_PAUSED)&&(e.currentTime=t,h(),e.playing&&a(e.monitorPlay,5))})},e.$watch("hide",function(){e.playing&&e.hide&&e.playPause()}),e.playPause=function(){function t(){if(e.media){if(e.playing)d(),e.media.pause(),i.eventTrack("playAudioLineItem",{category:"thoughts"});else{if(n.length>0){var t=n[0];n.length=0,t.playPause()}n.push(e),e.media.play(),e.monitorPlay();var a=Math.floor(e.currentTime/e.duration*100);i.eventTrack("pauseAudioLineItem",{category:"thoughts",value:a})}e.playing=!e.playing}}if(event.stopPropagation(),event.preventDefault(),e.media)t();else{$loading=!0;var a=function(t){e.loading=!1,e.status=t,t==Media.MEDIA_STOPPED&&(e.playing=!1,d(),i.eventTrack("finishedAudioLineItem",{category:"thoughts"})),e.$apply()};s.isIos()&&e.src.indexOf(".amr")>=0?o.alert({title:"Warning",template:r.instant("UNSUPPORTED_AUDIO_FORMAT_ERROR"),okText:"OK, GOT IT.",okType:"button-default"}):s.isIos()||e.src.startsWith("http")?(e.media=l.loadMedia(e.src,"",a),t()):c.loadFile(e.src,function(i){var n=i.nativeURL;e.media=new Media(n,function(){},function(e){},a),t()})}},e.$on("$destroy",function(){d(),e.playing=!1,e.media&&(e.media.stop(),e.media.release())});var v=t.find("canvas")[0];v.width=250*e.canvasScale,v.height=3*e.canvasScale;var f=v.getContext("2d");v.addEventListener("touchstart",function(e){u(e)},!1),h()}]}}),a.directive("anxietyGraph",function(){return{restrict:"E",templateUrl:"views/directives/anxietyGraph.html",replace:!0,scope:{series:"=",hasData:"=",showBreathe:"=",showRethink:"=",showHabits:"=",showGoals:"="},controller:["$scope","$element",function(e){function t(e,t,a,i){return{yAxis:i,type:"spline",name:e,data:t,visible:a,marker:{enabled:!1},lineWidth:2,animation:!1,borderColor:"transparent",states:{hover:{enabled:!1}}}}function a(){var a=$(".progressContainer")[0];e.chart=new Highcharts.Chart({chart:{width:300,spacing:[10,0,3,0],renderTo:a,backgroundColor:"rgba(0,0,0, 0.3)"},tooltip:{enabled:!1},title:{text:""},legend:{enabled:!1},credits:{enabled:!1},xAxis:{tickLength:3,labels:{enabled:!1},lineWidth:0,minorGridLineWidth:0,tickColor:"#ffffff",tickInterval:7,tickPosition:"outside"},yAxis:[{title:"",gridLineWidth:0,labels:{enabled:!1},min:0,max:2,startOnTick:!0,endOnTick:!0},{title:"",gridLineWidth:0,labels:{enabled:!1},min:0,max:6,startOnTick:!0,endOnTick:!0},{title:"",gridLineWidth:0,labels:{enabled:!1},min:0,max:6,startOnTick:!0,endOnTick:!0,tickColor:"#ffffff",tickInterval:1,tickPosition:"inside",tickWidth:1,tickLength:3}],colors:["#73e5e4","#ffbe66","#ff8d6e","#5ce59d","#ffffff","#ffffff"],series:[t("Breathe Data",e.series.breatheData,e.showBreathe,0),t("Rethink Data",e.series.rethinkData,e.showRethink,0),t("Goal Data",e.series.goalData,e.showGoals,0),t("Habit Data",e.series.habitData,e.showHabits,1),{yAxis:2,type:"spline",name:"Mood Data",data:e.series.missingMoodData,marker:{enabled:!1},lineWidth:2,animation:!1,borderColor:"transparent",states:{hover:{enabled:!1}}},{yAxis:2,type:"spline",name:"Missing Mood Data",data:e.series.moodData,marker:{enabled:!0,fillColor:"#ffffff",symbol:"circle",radius:2},lineWidth:2,animation:!1,borderColor:"transparent",states:{hover:{enabled:!1}}}],loading:{style:{background:"transparent"}}}),e.chart.showLoading();var i=$("#progressContainer").find("rect"),n=+i.attr("width");i.attr("width",n-3),i.attr("x",3),i.attr("height",147)}e.chart=void 0,a(),e.$watch("hasData",function(){e.hasData&&(e.chart.hideLoading(),e.chart.series[0].setData(e.series.breatheData,!1),e.chart.series[1].setData(e.series.rethinkData,!1),e.chart.series[2].setData(e.series.habitData,!1),e.chart.series[3].setData(e.series.goalData,!1),e.chart.series[4].setData(e.series.missingMoodData,!1),e.chart.series[5].setData(e.series.moodData,!1),e.updateSeries())}),e.updateSeries=function(){e.chart&&e.chart.series&&(e.chart.series[0].setVisible(e.showBreathe),e.chart.series[1].setVisible(e.showRethink),e.chart.series[2].setVisible(e.showHabits),e.chart.series[3].setVisible(e.showGoals),e.chart.redraw())},e.$watch("showBreathe",function(){e.updateSeries()}),e.$watch("showRethink",function(){e.updateSeries()}),e.$watch("showHabits",function(){e.updateSeries()}),e.$watch("showGoals",function(){e.updateSeries()})}]}});a.directive("graphSelector",["$timeout",function(a){return{restrict:"E",templateUrl:"views/directives/graphSelector.html",replace:!0,transclude:!0,scope:{values:"=",valueData:"=",goalPercentage:"=",showInnerCircle:"@",segmented:"@",selectable:"=",colors:"=",progressColors:"=",colorPercentages:"=",showTicks:"@",breakWords:"@"},controller:["$sce","$scope","$element","$translate","Environment",function(i,n,r,o,l){function c(){(!n.selectable||n.valueData.userInteracted)&&(n.valueData.value=e(n.values[n.valueData.valueIndex]))}function s(e,a){n.valueData.userInteracted=!0,e.preventDefault(),e.stopPropagation();var i=t(T,e),r=T.getBoundingClientRect(),o=i.x-r.width/2,l=i.y-r.height/2,c=Math.atan2(l,o);c+=Math.PI/2;var s=180*c/Math.PI;if(0>s&&(s+=360),a){var d=360/v;s=Math.floor(s/d)*d+.5*d}var u=s/360;n.updateValues(u),n.$apply()}function d(e){s(e,!0)}function u(){if(k)return k;var e=n.valueData.valueIndex/v;return e>0&&(e+=.5/v),e}var h="true"==n.breakWords;$("html").addClass("is_spinner"),n.$on("$destroy",function(){$("html").removeClass("is_spinner")}),"undefined"==typeof n.selectable&&(n.selectable=!0),"undefined"!=typeof n.valueData.percentage&&n.$watch("valueData.percentage",function(){0===n.valueData.percentage||isNaN(n.valueData.percentage)||n.updateValues(n.valueData.percentage)}),n.$watch("valueData.redraw",function(){n.updateValues(u())}),"undefined"==typeof n.colors&&(n.colors=["#fff","#ddd"]);var v=n.values.length;c(),n.getDisplayValue=function(){var e=n.valueData.value;if(!isNumeric(e)){var t="HABITS_VALUES_"+e;t=t.replace(/ /g,"_").toUpperCase(),e=o.instant(t),e==t&&(e=n.valueData.value)}return e},n.getDisplayText=function(t){for(var a,r=0;v>r;++r)if(e(n.values[r])==n.valueData.value){a=n.values[r].display;break}a||(a=n.valueData.value);var l="HABITS_VALUES_"+a;l=l.replace(/ /g,"_").toUpperCase();var c=o.instant(l);return h&&!t&&(c=c.replace(/ /g,"<br>")),i.trustAsHtml(c)},n.isMultiWord=function(){var e=""+n.getDisplayText(!0);return e.indexOf(" ")>=0};var f=135,g=120,p=96,b=(g+p)/2,m=g-p,w=2*Math.PI,y=Math.PI/2,S=!1,k=0,D=!1;n.canvasScale=window.devicePixelRatio;var T=r.find("canvas")[0];T.width=T.width*n.canvasScale,T.height=T.height*n.canvasScale;var V=0;if(n.updateValues=function(e){if(++V,k=e,l.isAndroid()&&V%25===0){var t=T.width;T.width=1,T.width=t}var a=T.getContext("2d");a.save(),a.scale(n.canvasScale,n.canvasScale),a.clearRect(0,0,a.canvas.width,a.canvas.height);for(var i,r=n.colors.length-1,o=0,s=0,d=0;r>d;++d){var u,h=n.colorPercentages?n.colorPercentages[o]:e;u=hexToRgb(n.progressColors?n.progressColors[d]:n.colors[d]);var S="rgba("+u.r+","+u.g+","+u.b+", 0.7)";if(a.strokeStyle=S,i=S,a.lineWidth=m,!(e>=s+h)){var M;M=n.segmented?Math.ceil(e*v)/v:e,a.beginPath(),a.arc(f,f,b,w*s-y,w*M-y,!1),a.stroke();var P=w*M-y;if(e<n.goalPercentage){var I=hexToRgb(n.colors[d]),E="rgba("+I.r+","+I.g+","+I.b+", 0.25)";a.strokeStyle=E,a.beginPath(),a.arc(f,f,b,w*M-y,w*n.goalPercentage-y,!1),a.stroke(),P=w*n.goalPercentage-y}a.beginPath();var x=hexToRgb(n.colors[n.colors.length-1]),A="rgba("+x.r+","+x.g+","+x.b+", 0.25)";a.strokeStyle=A,a.arc(f,f,b,P,w-y,!1),a.stroke();break}a.beginPath(),a.arc(f,f,b,w*s-y,w*(s+h)-y,!1),a.stroke(),++o,s+=h}var C=n.values.length;if((!n.selectable||n.valueData.userInteracted)&&(n.valueData.valueIndex=Math.floor(e*C),n.valueData.valueIndex>=C&&(n.valueData.valueIndex=C-1),c()),n.showTicks){a.save(),a.setTransform(n.canvasScale,0,0,n.canvasScale,f*n.canvasScale,f*n.canvasScale),a.lineWidth=2,a.strokeStyle="#fff";for(var L=0;v>L;++L){a.save();var O=360/v*L*Math.PI/180;a.rotate(O),a.beginPath(),a.moveTo(0,-p),a.lineTo(0,-g),a.stroke(),a.restore()}a.restore()}var R=e*Math.PI*2;R=Math.PI-R;var _=Math.sin(R)*b,U=Math.cos(R)*b;n.selectable&&(a.beginPath(),a.arc(f+_,f+U,16,0,2*Math.PI,!1),a.fillStyle=i,a.fill(),a.lineWidth=6,a.strokeStyle="#fff",a.stroke()),a.clearRect(0,0,1,1),a.restore();var G=n.isMultiWord();D!=G&&(G?$(".habitSelector").addClass("multi-word"):$(".habitSelector").removeClass("multi-word"),D=G)},n.selectable){T.addEventListener("mousedown",function(){S=!0}),T.addEventListener("mouseup",function(){S=!1});{T.addEventListener("mousemove",function(e){S&&s(e)})}T.addEventListener("touchmove",function(e){s(e)},!1),T.addEventListener("touchend",function(e){d(e)},!1)}a(function(){n.updateValues(u())},1)}]}}])}();