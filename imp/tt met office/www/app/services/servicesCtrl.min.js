angular.module("ionic.metApp").controller("ServicesCtrl",["Radars","metApi","$scope","$ionicLoading","$timeout","$ionicModal","$cordovaDevice","$ionicPlatform","$cordovaPush","$ionicSlideBoxDelegate","$ionicScrollDelegate",function(t,a,i,e,n,o,l,s,r,d,c){function u(t,a,i){for(x=0;x<t.length;x++){var e=new Image;e.src=t[x],e.style.maxWidth="100%";var n=$(a+(x+1));n.html(e),n.find("img").wrap('<a href="'+t[x]+'" class="swipebox" title="'+i+'"></a>')}}var m=this;i.disableSwipe=function(){d.enableSlide(!1)},m.refresh_all_a=function(){},m.get_o_aviation=function(){a.get_o_aviation().then(function(t){m.aviation_items=t.items},function(t){})},m.get_aviation_radar=function(){},m.get_elninos=function(){a.get_elninos().then(function(t){m.el_infos=t[0]},function(t){}),a.get_option_files("/file/search?category=elnino").then(function(t){m.ii=[i.image1="data: ;base64,"+t.elnino0.data,i.image2="data: ;base64,"+t.elnino1.data,i.image3="data: ;base64,"+t.elnino2.data],u(m.ii,".nino_i","El Nino")},function(t){})},$("body").on("click",".swipebox",function(t){t.preventDefault();var a=$(this).attr("href");i.showImages(a)}),i.showImages=function(t){i.showModal("app/services/radar/radar_image_modal.html"),n(function(){var a=new Image;a.src=t;var i=$(".modal_img");i.html(a)},300)},i.showModal=function(t){o.fromTemplateUrl(t,{scope:i,animation:"slide-in-up"}).then(function(t){i.modal=t,i.modal.show()})},i.closeModal=function(){i.modal.hide()},i.updateSlideStatus=function(t){var a=c.$getByHandle("scrollHandle"+t).getScrollPosition.zoom;d.enableSlide(a==i.zoomMin?!0:!1)},m.get_rainandtemp=function(){a.get_rainandtemp().then(function(t){if(m.rt=t.items[0],m.key_list=t.items[0].para1?t.items[0].para1.split("\r\n"):null,m.ir_list=t.items[0].para12?t.items[0].para12.split("\r\n"):null,m.key_list)for(x=0;x<m.key_list.length;x++)m.key_list[x].trim();if(m.ir_list)for(x=0;x<m.ir_list.length;x++)m.ir_list[x].trim()},function(t){}),a.get_option_files("/file/search?category=rainandtemp").then(function(t){m.rti=[i.image4="data: ;base64,"+t.rainandtemp0.data,i.image5="data: ;base64,"+t.rainandtemp1.data],u(m.rti,".rt_i","Rainfall - Temp")},function(t){})},m.get_drywet=function(){a.get_drywet().then(function(t){m.dw=t.items[0]},function(t){}),a.get_option_files("/file/search?category=dryandwetspell").then(function(t){m.dwi=[i.image6="data: ;base64,"+t.dryandwetspell0.data],u(m.dwi,".dw_i","Dry/Wet Outlook")},function(t){})},m.agrotrini=function(){a.get_agrotrini().then(function(t){m.atrin=t.items[0]},function(t){}),a.get_option_files("/file/search?category=agrotrini").then(function(t){i.image_agro_trin=["data: ;base64,"+t.agrotrini0.data],u(i.image_agro_trin,".trin_i","Trinidad Agromet")},function(t){}),a.get_agroData("summary").then(function(t){m.sum=t},function(t){})},m.agrotbg=function(){a.get_agrotbg().then(function(t){m.atbg=t.items[0]},function(t){}),a.get_option_files("/file/search?category=agrotobago").then(function(t){i.image_agro_bago=["data: ;base64,"+t.agrotobago0.data],u(i.image_agro_bago,".bago_i","Tobago Agromet")},function(t){}),a.get_agroDataTbg("summary").then(function(t){m.sumtbg=t},function(t){})},i.slideHasChanged_a=function(t){m.update_slide_a(t)},m.update_slide_a=function(t){titles=["Satellite","Radar","Weather Report","Forecast"],i.sub_title=titles[t]},i.slideHasChanged_c=function(t){m.update_slide_c(t)},m.update_slide_c=function(t){titles=["El Nino Update","Rainfall & Temp","Dry/Wet Outlook"],i.sub_title=titles[t]},i.slideHasChanged_m=function(t){m.update_slide_m(t)},m.update_slide_m=function(t){titles=[""],i.sub_title=titles[t]},i.slideHasChanged_t=function(t){m.update_slide_t(t)},m.update_slide_t=function(t){titles=["3-day Natinwide","3-day Tobago"],i.sub_title=titles[t]},i.slideHasChanged_ag=function(t){m.update_slide_ag(t)},m.update_slide_ag=function(t){titles=["Trinidad","Tobago"],i.sub_title=titles[t]},i.slide=function(t){c.scrollTop(),d.slide(t)},m.radars_150=function(){m.radars_150_list=t.all_of_cat(150)},m.radars_250=function(){m.radars_250_list=t.all_of_cat(250)},m.get_radar_400=function(){m.radars_400_list=t.all_of_cat(400)},m.sigmet=function(){a.get_sigmet().then(function(t){m.sig=t.items},function(t){})}}]).controller("RadarDetailCtrl",["$scope","$stateParams","metApi","Radars","$http","$cordovaPush","$ionicPlatform","$rootScope","$ionicLoading","$state","$ionicBackdrop","$ionicModal","$ionicScrollDelegate","$ionicSlideBoxDelegate","$timeout",function(t,a,i,e,n,o,l,s,r,d,c,u,m,g,f){var _=this;t.close_loading=function(){r.hide()},t.get_radar_detail=function(){t.zoomMin=1,_.radar=e.get(a.id),i.get_radar(_.radar.code).then(function(a){var i=new Image;i.src=a.data,t.image=a.data,i.style.maxWidth="100%";var e=$(".img_holder");e.html(i),e.find("img").wrap('<a href="'+t.image+'" class="swipebox2" title="'+_.radar.title+'"></a>')},function(t){}),_.radar=e.get(a.id),_.radar.title="Satellite"!=_.radar.title?_.radar.title:"Infared Satellite",$("body").on("click",".swipebox2",function(a){a.preventDefault(),t.showImages()})},t.reload_page=function(){t.get_radar_detail(a.id)},t.$on("loading:show",function(){r.show({template:' <ion-spinner class="light"></ion-spinner><br><button class="button button-light button-block" ng-click="close_loading()">Cancel</button>',scope:t})}),t.showImages=function(a){t.showModal("app/services/radar/radar_image_modal.html"),f(function(){var a=new Image;a.src=t.image;var i=$(".modal_img");i.html(a)},300)},t.showModal=function(a){$(".modal-backdrop").length>0&&$(".modal-backdrop:not(:last)").remove(),t.modal?t.modal.show():u.fromTemplateUrl(a,function(a){t.modal=a,t.modal.show()},{scope:t,animation:"slide-in-up"})},t.closeModal=function(){t.modal.hide().then(function(){$(".modal-backdrop").remove(),t.modal=null})},t.$on("$stateChangeStart",function(){t.modal.remove()}),t.updateSlideStatus=function(a){var i=m.$getByHandle("scrollHandle"+a).getScrollPosition.zoom;g.enableSlide(i==t.zoomMin?!0:!1)}}]).controller("AWSCtrl",["weatherHelperService","$filter","metApi","$scope","$timeout","$ionicModal","$ionicPlatform","$ionicPopup","$interval","$ionicBackdrop","$state","$route","$rootScope","$ionicLoading","NgMap",function(t,a,i,e,n,o,l,s,r,d,c,u,m,g,f){e.ai=[],e.lat=10.611439,e.lng=-61.16756,e.cities=[{city:"Piarco",desc:"Piarco (BASE) AWS",pos:[10.602912,-61.33564]},{city:"Brasso",desc:"Brasso Venado AWS",pos:[10.399413,-61.317268]},{city:"Caroni",desc:"Caroni AWS",pos:[10.606881,-61.383883]},{city:"Chatham",desc:"Chatham  AWS",pos:[10.115793,-61.74162]},{city:"El Reposo",desc:"El Reposo AWS",pos:[10.589908,-61.114339]},{city:"Penal",desc:"Penal AWS",pos:[10.168662,-61.43783]},{city:"Guayaguayare",desc:"Guayaguayare AWS",pos:[10.215853,-61.071504]},{city:"Crown Point",desc:"Crown Point AWS",pos:[11.152917,-60.835251]}],e.mapCreated=function(t){e.map=t},e.centerOnMe=function(){g.show({template:"Centering map..."}),n(function(){f.getMap().then(function(t){t.setCenter(new google.maps.LatLng(e.lat,e.lng))}),g.hide()},1e3)},e.closeModal=function(t){l.ready(function(){window.StatusBar&&StatusBar.styleLightContent()}),e[t].hide()},e.$on("modal.hidden",function(){d.release()}),m.ace=function(a,n){e.do_split=!1,e.ai=[],l.ready(function(){window.StatusBar&&StatusBar.styleBlackTranslucent()}),e.title=n,i.get_aws(n).then(function(a){if(e.has_aws=!1,void 0!=a.items){var i=a.items.length;e.has_aws=!0,e.do_split=!0;var n=a.items;for(z=0;z<i;z++)"Temperature"==n[z].item&&(e.ai[0]=n[z]),"Pressure"==n[z].item&&(e.ai[1]=n[z]),"Gust"==n[z].item&&(e.ai[2]=n[z]),"Precipitation"==n[z].item&&(e.ai[3]=n[z]),"Humidity"==n[z].item&&(e.ai[4]=n[z]),"Wind Direction"==n[z].item&&(e.ai[5]=n[z]),"Wind Speed"==n[z].item&&(e.ai[6]=n[z])}else if("Crown Point"==a.location){var l=["humidity","precipitation","pressure","temperature","wd","ws"];for(e.has_aws=!0,e.do_split=!1,e.ai=[],x=0;x<l.length;x++)e.ai[x]={},e.ai[x].value=a[l[x]],e.ai[x].item="wd"==l[x]?" Wind Direction":"ws"==l[x]?"Wind Speed":t.capFLetter(l[x])}if(e.ai&&e.has_aws){if(e.do_split){var s=e.ai[0].aws_date.split("/"),r=e.ai[0].aws_time.split(":");e.updated_at=new Date(s[2],s[0]>0?s[0]-1:s[0],s[1],r[0],r[1],r[2])}e.aws_modal?e.aws_modal.show():o.fromTemplateUrl("app/services/aws_details.html",function(t){e.aws_modal=t,e.aws_modal.show()},{animation:"scale-in",scope:e})}else m.doAlert(e.title,": No data")},function(t){})}}]);