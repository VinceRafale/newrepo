var qrcode=function(){function r(t,e){if("undefined"==typeof t.length)throw new Error(t.length+"/"+e);var n=function(){for(var r=0;r<t.length&&0==t[r];)r+=1;for(var n=new Array(t.length-r+e),o=0;o<t.length-r;o+=1)n[o]=t[o+r];return n}(),o={};return o.getAt=function(r){return n[r]},o.getLength=function(){return n.length},o.multiply=function(t){for(var e=new Array(o.getLength()+t.getLength()-1),n=0;n<o.getLength();n+=1)for(var a=0;a<t.getLength();a+=1)e[n+a]^=i.gexp(i.glog(o.getAt(n))+i.glog(t.getAt(a)));return r(e,0)},o.mod=function(t){if(o.getLength()-t.getLength()<0)return o;for(var e=i.glog(o.getAt(0))-i.glog(t.getAt(0)),n=new Array(o.getLength()),a=0;a<o.getLength();a+=1)n[a]=o.getAt(a);for(var a=0;a<t.getLength();a+=1)n[a]^=i.gexp(i.glog(t.getAt(a))+e);return r(n,0).mod(t)},o}var t=function(t,e){var o=236,i=17,c=t,h=n[e],v=null,l=0,w=null,d=new Array,y={},A=function(r,t){l=4*c+17,v=function(r){for(var t=new Array(r),e=0;r>e;e+=1){t[e]=new Array(r);for(var n=0;r>n;n+=1)t[e][n]=null}return t}(l),B(0,0),B(l-7,0),B(0,l-7),T(),p(),D(r,t),c>=7&&M(r),null==w&&(w=L(c,h,d)),k(w,t)},B=function(r,t){for(var e=-1;7>=e;e+=1)if(!(-1>=r+e||r+e>=l))for(var n=-1;7>=n;n+=1)-1>=t+n||t+n>=l||(v[r+e][t+n]=e>=0&&6>=e&&(0==n||6==n)||n>=0&&6>=n&&(0==e||6==e)||e>=2&&4>=e&&n>=2&&4>=n?!0:!1)},E=function(){for(var r=0,t=0,e=0;8>e;e+=1){A(!0,e);var n=a.getLostPoint(y);(0==e||r>n)&&(r=n,t=e)}return t},p=function(){for(var r=8;l-8>r;r+=1)null==v[r][6]&&(v[r][6]=r%2==0);for(var t=8;l-8>t;t+=1)null==v[6][t]&&(v[6][t]=t%2==0)},T=function(){for(var r=a.getPatternPosition(c),t=0;t<r.length;t+=1)for(var e=0;e<r.length;e+=1){var n=r[t],o=r[e];if(null==v[n][o])for(var i=-2;2>=i;i+=1)for(var u=-2;2>=u;u+=1)v[n+i][o+u]=-2==i||2==i||-2==u||2==u||0==i&&0==u?!0:!1}},M=function(r){for(var t=a.getBCHTypeNumber(c),e=0;18>e;e+=1){var n=!r&&1==(t>>e&1);v[Math.floor(e/3)][e%3+l-8-3]=n}for(var e=0;18>e;e+=1){var n=!r&&1==(t>>e&1);v[e%3+l-8-3][Math.floor(e/3)]=n}},D=function(r,t){for(var e=h<<3|t,n=a.getBCHTypeInfo(e),o=0;15>o;o+=1){var i=!r&&1==(n>>o&1);6>o?v[o][8]=i:8>o?v[o+1][8]=i:v[l-15+o][8]=i}for(var o=0;15>o;o+=1){var i=!r&&1==(n>>o&1);8>o?v[8][l-o-1]=i:9>o?v[8][15-o-1+1]=i:v[8][15-o-1]=i}v[l-8][8]=!r},k=function(r,t){for(var e=-1,n=l-1,o=7,i=0,u=a.getMaskFunction(t),f=l-1;f>0;f-=2)for(6==f&&(f-=1);;){for(var g=0;2>g;g+=1)if(null==v[n][f-g]){var c=!1;i<r.length&&(c=1==(r[i]>>>o&1));var h=u(n,f-g);h&&(c=!c),v[n][f-g]=c,o-=1,-1==o&&(i+=1,o=7)}if(n+=e,0>n||n>=l){n-=e,e=-e;break}}},C=function(t,e){for(var n=0,o=0,i=0,u=new Array(e.length),f=new Array(e.length),g=0;g<e.length;g+=1){var c=e[g].dataCount,h=e[g].totalCount-c;o=Math.max(o,c),i=Math.max(i,h),u[g]=new Array(c);for(var v=0;v<u[g].length;v+=1)u[g][v]=255&t.getBuffer()[v+n];n+=c;var l=a.getErrorCorrectPolynomial(h),s=r(u[g],l.getLength()-1),w=s.mod(l);f[g]=new Array(l.getLength()-1);for(var v=0;v<f[g].length;v+=1){var d=v+w.getLength()-f[g].length;f[g][v]=d>=0?w.getAt(d):0}}for(var y=0,v=0;v<e.length;v+=1)y+=e[v].totalCount;for(var A=new Array(y),B=0,v=0;o>v;v+=1)for(var g=0;g<e.length;g+=1)v<u[g].length&&(A[B]=u[g][v],B+=1);for(var v=0;i>v;v+=1)for(var g=0;g<e.length;g+=1)v<f[g].length&&(A[B]=f[g][v],B+=1);return A},L=function(r,t,e){for(var n=u.getRSBlocks(r,t),g=f(),c=0;c<e.length;c+=1){var h=e[c];g.put(h.getMode(),4),g.put(h.getLength(),a.getLengthInBits(h.getMode(),r)),h.write(g)}for(var v=0,c=0;c<n.length;c+=1)v+=n[c].dataCount;if(g.getLengthInBits()>8*v)throw new Error("code length overflow. ("+g.getLengthInBits()+">"+8*v+")");for(g.getLengthInBits()+4<=8*v&&g.put(0,4);g.getLengthInBits()%8!=0;)g.putBit(!1);for(;;){if(g.getLengthInBits()>=8*v)break;if(g.put(o,8),g.getLengthInBits()>=8*v)break;g.put(i,8)}return C(g,n)};return y.addData=function(r){var t=g(r);d.push(t),w=null},y.isDark=function(r,t){if(0>r||r>=l||0>t||t>=l)throw new Error(r+","+t);return v[r][t]},y.getModuleCount=function(){return l},y.make=function(){A(!1,E())},y.createTableTag=function(r,t){r=r||2,t="undefined"==typeof t?4*r:t;var e="";e+='<table style="',e+=" border-width: 0px; border-style: none;",e+=" border-collapse: collapse;",e+=" padding: 0px; margin: "+t+"px;",e+='">',e+="<tbody>";for(var n=0;n<y.getModuleCount();n+=1){e+="<tr>";for(var o=0;o<y.getModuleCount();o+=1)e+='<td style="',e+=" border-width: 0px; border-style: none;",e+=" border-collapse: collapse;",e+=" padding: 0px; margin: 0px;",e+=" width: "+r+"px;",e+=" height: "+r+"px;",e+=" background-color: ",e+=y.isDark(n,o)?"#000000":"#ffffff",e+=";",e+='"/>';e+="</tr>"}return e+="</tbody>",e+="</table>"},y.createImgTag=function(r,t){r=r||2,t="undefined"==typeof t?4*r:t;var e=y.getModuleCount()*r+2*t,n=t,o=e-t;return s(e,e,function(t,e){if(t>=n&&o>t&&e>=n&&o>e){var a=Math.floor((t-n)/r),i=Math.floor((e-n)/r);return y.isDark(i,a)?0:1}return 1})},y};t.stringToBytes=function(r){for(var t=new Array,e=0;e<r.length;e+=1){var n=r.charCodeAt(e);t.push(255&n)}return t},t.createStringToBytes=function(r,t){var e=function(){for(var e=v(r),n=function(){var r=e.read();if(-1==r)throw new Error;return r},o=0,a={};;){var i=e.read();if(-1==i)break;var u=n(),f=n(),g=n(),c=String.fromCharCode(i<<8|u),h=f<<8|g;a[c]=h,o+=1}if(o!=t)throw new Error(o+" != "+t);return a}(),n="?".charCodeAt(0);return function(r){for(var t=new Array,o=0;o<r.length;o+=1){var a=r.charCodeAt(o);if(128>a)t.push(a);else{var i=e[r.charAt(o)];"number"==typeof i?(255&i)==i?t.push(i):(t.push(i>>>8),t.push(255&i)):t.push(n)}}return t}};var e={MODE_NUMBER:1,MODE_ALPHA_NUM:2,MODE_8BIT_BYTE:4,MODE_KANJI:8},n={L:1,M:0,Q:3,H:2},o={PATTERN000:0,PATTERN001:1,PATTERN010:2,PATTERN011:3,PATTERN100:4,PATTERN101:5,PATTERN110:6,PATTERN111:7},a=function(){var t=[[],[6,18],[6,22],[6,26],[6,30],[6,34],[6,22,38],[6,24,42],[6,26,46],[6,28,50],[6,30,54],[6,32,58],[6,34,62],[6,26,46,66],[6,26,48,70],[6,26,50,74],[6,30,54,78],[6,30,56,82],[6,30,58,86],[6,34,62,90],[6,28,50,72,94],[6,26,50,74,98],[6,30,54,78,102],[6,28,54,80,106],[6,32,58,84,110],[6,30,58,86,114],[6,34,62,90,118],[6,26,50,74,98,122],[6,30,54,78,102,126],[6,26,52,78,104,130],[6,30,56,82,108,134],[6,34,60,86,112,138],[6,30,58,86,114,142],[6,34,62,90,118,146],[6,30,54,78,102,126,150],[6,24,50,76,102,128,154],[6,28,54,80,106,132,158],[6,32,58,84,110,136,162],[6,26,54,82,110,138,166],[6,30,58,86,114,142,170]],n=1335,a=7973,u=21522,f={},g=function(r){for(var t=0;0!=r;)t+=1,r>>>=1;return t};return f.getBCHTypeInfo=function(r){for(var t=r<<10;g(t)-g(n)>=0;)t^=n<<g(t)-g(n);return(r<<10|t)^u},f.getBCHTypeNumber=function(r){for(var t=r<<12;g(t)-g(a)>=0;)t^=a<<g(t)-g(a);return r<<12|t},f.getPatternPosition=function(r){return t[r-1]},f.getMaskFunction=function(r){switch(r){case o.PATTERN000:return function(r,t){return(r+t)%2==0};case o.PATTERN001:return function(r,t){return r%2==0};case o.PATTERN010:return function(r,t){return t%3==0};case o.PATTERN011:return function(r,t){return(r+t)%3==0};case o.PATTERN100:return function(r,t){return(Math.floor(r/2)+Math.floor(t/3))%2==0};case o.PATTERN101:return function(r,t){return r*t%2+r*t%3==0};case o.PATTERN110:return function(r,t){return(r*t%2+r*t%3)%2==0};case o.PATTERN111:return function(r,t){return(r*t%3+(r+t)%2)%2==0};default:throw new Error("bad maskPattern:"+r)}},f.getErrorCorrectPolynomial=function(t){for(var e=r([1],0),n=0;t>n;n+=1)e=e.multiply(r([1,i.gexp(n)],0));return e},f.getLengthInBits=function(r,t){if(t>=1&&10>t)switch(r){case e.MODE_NUMBER:return 10;case e.MODE_ALPHA_NUM:return 9;case e.MODE_8BIT_BYTE:return 8;case e.MODE_KANJI:return 8;default:throw new Error("mode:"+r)}else if(27>t)switch(r){case e.MODE_NUMBER:return 12;case e.MODE_ALPHA_NUM:return 11;case e.MODE_8BIT_BYTE:return 16;case e.MODE_KANJI:return 10;default:throw new Error("mode:"+r)}else{if(!(41>t))throw new Error("type:"+t);switch(r){case e.MODE_NUMBER:return 14;case e.MODE_ALPHA_NUM:return 13;case e.MODE_8BIT_BYTE:return 16;case e.MODE_KANJI:return 12;default:throw new Error("mode:"+r)}}},f.getLostPoint=function(r){for(var t=r.getModuleCount(),e=0,n=0;t>n;n+=1)for(var o=0;t>o;o+=1){for(var a=0,i=r.isDark(n,o),u=-1;1>=u;u+=1)if(!(0>n+u||n+u>=t))for(var f=-1;1>=f;f+=1)0>o+f||o+f>=t||(0!=u||0!=f)&&i==r.isDark(n+u,o+f)&&(a+=1);a>5&&(e+=3+a-5)}for(var n=0;t-1>n;n+=1)for(var o=0;t-1>o;o+=1){var g=0;r.isDark(n,o)&&(g+=1),r.isDark(n+1,o)&&(g+=1),r.isDark(n,o+1)&&(g+=1),r.isDark(n+1,o+1)&&(g+=1),(0==g||4==g)&&(e+=3)}for(var n=0;t>n;n+=1)for(var o=0;t-6>o;o+=1)r.isDark(n,o)&&!r.isDark(n,o+1)&&r.isDark(n,o+2)&&r.isDark(n,o+3)&&r.isDark(n,o+4)&&!r.isDark(n,o+5)&&r.isDark(n,o+6)&&(e+=40);for(var o=0;t>o;o+=1)for(var n=0;t-6>n;n+=1)r.isDark(n,o)&&!r.isDark(n+1,o)&&r.isDark(n+2,o)&&r.isDark(n+3,o)&&r.isDark(n+4,o)&&!r.isDark(n+5,o)&&r.isDark(n+6,o)&&(e+=40);for(var c=0,o=0;t>o;o+=1)for(var n=0;t>n;n+=1)r.isDark(n,o)&&(c+=1);var h=Math.abs(100*c/t/t-50)/5;return e+=10*h},f}(),i=function(){for(var r=new Array(256),t=new Array(256),e=0;8>e;e+=1)r[e]=1<<e;for(var e=8;256>e;e+=1)r[e]=r[e-4]^r[e-5]^r[e-6]^r[e-8];for(var e=0;255>e;e+=1)t[r[e]]=e;var n={};return n.glog=function(r){if(1>r)throw new Error("glog("+r+")");return t[r]},n.gexp=function(t){for(;0>t;)t+=255;for(;t>=256;)t-=255;return r[t]},n}(),u=function(){var r=[[1,26,19],[1,26,16],[1,26,13],[1,26,9],[1,44,34],[1,44,28],[1,44,22],[1,44,16],[1,70,55],[1,70,44],[2,35,17],[2,35,13],[1,100,80],[2,50,32],[2,50,24],[4,25,9],[1,134,108],[2,67,43],[2,33,15,2,34,16],[2,33,11,2,34,12],[2,86,68],[4,43,27],[4,43,19],[4,43,15],[2,98,78],[4,49,31],[2,32,14,4,33,15],[4,39,13,1,40,14],[2,121,97],[2,60,38,2,61,39],[4,40,18,2,41,19],[4,40,14,2,41,15],[2,146,116],[3,58,36,2,59,37],[4,36,16,4,37,17],[4,36,12,4,37,13],[2,86,68,2,87,69],[4,69,43,1,70,44],[6,43,19,2,44,20],[6,43,15,2,44,16]],t=function(r,t){var e={};return e.totalCount=r,e.dataCount=t,e},e={},o=function(t,e){switch(e){case n.L:return r[4*(t-1)+0];case n.M:return r[4*(t-1)+1];case n.Q:return r[4*(t-1)+2];case n.H:return r[4*(t-1)+3];default:return void 0}};return e.getRSBlocks=function(r,e){var n=o(r,e);if("undefined"==typeof n)throw new Error("bad rs block @ typeNumber:"+r+"/errorCorrectLevel:"+e);for(var a=n.length/3,i=new Array,u=0;a>u;u+=1)for(var f=n[3*u+0],g=n[3*u+1],c=n[3*u+2],h=0;f>h;h+=1)i.push(t(g,c));return i},e}(),f=function(){var r=new Array,t=0,e={};return e.getBuffer=function(){return r},e.getAt=function(t){var e=Math.floor(t/8);return 1==(r[e]>>>7-t%8&1)},e.put=function(r,t){for(var n=0;t>n;n+=1)e.putBit(1==(r>>>t-n-1&1))},e.getLengthInBits=function(){return t},e.putBit=function(e){var n=Math.floor(t/8);r.length<=n&&r.push(0),e&&(r[n]|=128>>>t%8),t+=1},e},g=function(r){var n=e.MODE_8BIT_BYTE,o=t.stringToBytes(r),a={};return a.getMode=function(){return n},a.getLength=function(r){return o.length},a.write=function(r){for(var t=0;t<o.length;t+=1)r.put(o[t],8)},a},c=function(){var r=new Array,t={};return t.writeByte=function(t){r.push(255&t)},t.writeShort=function(r){t.writeByte(r),t.writeByte(r>>>8)},t.writeBytes=function(r,e,n){e=e||0,n=n||r.length;for(var o=0;n>o;o+=1)t.writeByte(r[o+e])},t.writeString=function(r){for(var e=0;e<r.length;e+=1)t.writeByte(r.charCodeAt(e))},t.toByteArray=function(){return r},t.toString=function(){var t="";t+="[";for(var e=0;e<r.length;e+=1)e>0&&(t+=","),t+=r[e];return t+="]"},t},h=function(){var r=0,t=0,e=0,n="",o={},a=function(r){n+=String.fromCharCode(i(63&r))},i=function(r){if(0>r);else{if(26>r)return 65+r;if(52>r)return 97+(r-26);if(62>r)return 48+(r-52);if(62==r)return 43;if(63==r)return 47}throw new Error("n:"+r)};return o.writeByte=function(n){for(r=r<<8|255&n,t+=8,e+=1;t>=6;)a(r>>>t-6),t-=6},o.flush=function(){if(t>0&&(a(r<<6-t),r=0,t=0),e%3!=0)for(var o=3-e%3,i=0;o>i;i+=1)n+="="},o.toString=function(){return n},o},v=function(r){var t=r,e=0,n=0,o=0,a={};a.read=function(){for(;8>o;){if(e>=t.length){if(0==o)return-1;throw new Error("unexpected end of file./"+o)}var r=t.charAt(e);if(e+=1,"="==r)return o=0,-1;r.match(/^\s$/)||(n=n<<6|i(r.charCodeAt(0)),o+=6)}var a=n>>>o-8&255;return o-=8,a};var i=function(r){if(r>=65&&90>=r)return r-65;if(r>=97&&122>=r)return r-97+26;if(r>=48&&57>=r)return r-48+52;if(43==r)return 62;if(47==r)return 63;throw new Error("c:"+r)};return a},l=function(r,t){var e=r,n=t,o=new Array(r*t),a={};a.setPixel=function(r,t,n){o[t*e+r]=n},a.write=function(r){r.writeString("GIF87a"),r.writeShort(e),r.writeShort(n),r.writeByte(128),r.writeByte(0),r.writeByte(0),r.writeByte(0),r.writeByte(0),r.writeByte(0),r.writeByte(255),r.writeByte(255),r.writeByte(255),r.writeString(","),r.writeShort(0),r.writeShort(0),r.writeShort(e),r.writeShort(n),r.writeByte(0);var t=2,o=u(t);r.writeByte(t);for(var a=0;o.length-a>255;)r.writeByte(255),r.writeBytes(o,a,255),a+=255;r.writeByte(o.length-a),r.writeBytes(o,a,o.length-a),r.writeByte(0),r.writeString(";")};var i=function(r){var t=r,e=0,n=0,o={};return o.write=function(r,o){if(r>>>o!=0)throw new Error("length over");for(;e+o>=8;)t.writeByte(255&(r<<e|n)),o-=8-e,r>>>=8-e,n=0,e=0;n=r<<e|n,e+=o},o.flush=function(){e>0&&t.writeByte(n)},o},u=function(r){for(var t=1<<r,e=(1<<r)+1,n=r+1,a=f(),u=0;t>u;u+=1)a.add(String.fromCharCode(u));a.add(String.fromCharCode(t)),a.add(String.fromCharCode(e));var g=c(),h=i(g);h.write(t,n);var v=0,l=String.fromCharCode(o[v]);for(v+=1;v<o.length;){var s=String.fromCharCode(o[v]);v+=1,a.contains(l+s)?l+=s:(h.write(a.indexOf(l),n),a.size()<4095&&(a.size()==1<<n&&(n+=1),a.add(l+s)),l=s)}return h.write(a.indexOf(l),n),h.write(e,n),h.flush(),g.toByteArray()},f=function(){var r={},t=0,e={};return e.add=function(n){if(e.contains(n))throw new Error("dup key:"+n);r[n]=t,t+=1},e.size=function(){return t},e.indexOf=function(t){return r[t]},e.contains=function(t){return"undefined"!=typeof r[t]},e};return a},s=function(r,t,e,n){for(var o=l(r,t),a=0;t>a;a+=1)for(var i=0;r>i;i+=1)o.setPixel(i,a,e(i,a));var u=c();o.write(u);for(var f=h(),g=u.toByteArray(),v=0;v<g.length;v+=1)f.writeByte(g[v]);f.flush();var s="";return s+="<img",s+=' src="',s+="data:image/gif;base64,",s+=f,s+='"',s+=' width="',s+=r,s+='"',s+=' height="',s+=t,s+='"',n&&(s+=' alt="',s+=n,s+='"'),s+="/>"};return t}();
angular.module("monospaced.qrcode",[]).directive("qrcode",["$window",function(e){var r=!!e.CanvasRenderingContext2D,n={L:"Low",M:"Medium",Q:"Quartile",H:"High"},o=function(e,r,n,o){for(var t=0;n>t;t++)for(var i=0;n>i;i++){var a=Math.ceil((i+1)*o)-Math.floor(i*o),c=Math.ceil((t+1)*o)-Math.floor(t*o);e.fillStyle=r.isDark(t,i)?"#000":"#fff",e.fillRect(Math.round(i*o),Math.round(t*o),a,c)}};return{restrict:"E",template:'<canvas class="qrcode"></canvas>',link:function(e,t,i){var a,c,d,f,l,s,u,v,h,m=t[0],g=t.find("canvas"),M=g[0],w=r?M.getContext("2d"):null,q="download"in i,p=i.href,$=q||p?document.createElement("a"):"",C=/^\s+|\s+$/g,L=function(e){c=Math.max(1,Math.min(parseInt(e,10),10))||4},b=function(e){d=e in n?e:"M"},D=function(e){if(e){f=e.replace(C,""),v=qrcode(c,d),v.addData(f);try{v.make()}catch(r){return void(a=r.message)}a=!1,s=v.getModuleCount()}},k=function(e){l=parseInt(e,10)||2*s,u=l/s,M.width=M.height=l},H=function(){if(v){if(a)return $&&($.removeAttribute("download"),$.title="",$.href="#_"),r||(m.innerHTML='<img src width="'+l+'"height="'+l+'"class="qrcode">'),void e.$emit("qrcode:error",a);if(q&&(m.download="qrcode.png",m.title="Download QR code"),r){if(o(w,v,s,u),q)return void(m.href=M.toDataURL("image/png"))}else if(m.innerHTML=v.createImgTag(u,0),h=t.find("img"),h.addClass("qrcode"),q)return void(m.href=h[0].src);p&&(m.href=p)}};$&&($.className="qrcode-link",g.wrap($),m=$),L(i.version),b(i.errorCorrectionLevel),k(i.size),i.$observe("version",function(e){e&&(L(e),D(f),k(l),H())}),i.$observe("errorCorrectionLevel",function(e){e&&(b(e),D(f),k(l),H())}),i.$observe("data",function(e){e&&(D(e),k(l),H())}),i.$observe("size",function(e){e&&(k(e),H())}),i.$observe("href",function(e){e&&(p=e,H())})}}}]);
var ImgCache={version:"0.7.5",options:{debug:!1,localCacheFolder:"imgcache",useDataURI:!1,chromeQuota:10485760,usePersistentCache:!0,cacheClearSize:0,headers:{},skipURIencoding:!1},overridables:{hash:function(e){function t(e,t,a){for(;0<a--;)e.push(t)}function a(e,t){return e<<t|e>>>32-t}function o(e,t,a){return e^t^a}function r(e,t){var a=(65535&t)+(65535&e),o=(t>>>16)+(e>>>16)+(a>>>16);return(65535&o)<<16|65535&a}var i="0123456789abcdef";return function(e){for(var t,a=[],o=4*e.length,r=0;o>r;r++)t=e[r>>2]>>8*(3-r%4),a.push(i.charAt(t>>4&15)+i.charAt(15&t));return a.join("")}(function(e,i){var n,c,s,l,u,d=e.length,g=1732584193,h=4023233417,m=2562383102,f=271733878,I=3285377520,C=[];t(C,1518500249,20),t(C,1859775393,20),t(C,2400959708,20),t(C,3395469782,20),e[i>>5]|=128<<24-i%32,e[(i+65>>9<<4)+15]=i;for(var L=0;d>L;L+=16){n=g,c=h,s=m,l=f,u=I;for(var v=0,E=[];80>v;v++){E[v]=16>v?e[v+L]:a(E[v-3]^E[v-8]^E[v-14]^E[v-16],1);var b=function(e,t,a,o,r){var i=(65535&r)+(65535&e)+(65535&t)+(65535&a)+(65535&o),n=(r>>>16)+(e>>>16)+(t>>>16)+(a>>>16)+(o>>>16)+(i>>>16);return(65535&n)<<16|65535&i}(20>v?function(e,t,a){return e&t^~e&a}(c,s,l):40>v?o(c,s,l):60>v?function(e,t,a){return e&t^e&a^t&a}(c,s,l):o(c,s,l),u,C[v],E[v],a(n,5));u=l,l=s,s=a(c,30),c=n,n=b}g=r(g,n),h=r(h,c),m=r(m,s),f=r(f,l),I=r(I,u)}return[g,h,m,f,I]}(function(e){for(var t=[],a=255,o=8*e.length,r=0;o>r;r+=8)t[r>>5]|=(e.charCodeAt(r/8)&a)<<24-r%32;return t}(e).slice(),8*e.length))},log:function(e,t){"use strict";ImgCache.options.debug&&(t===LOG_LEVEL_INFO&&(e="INFO: "+e),t===LOG_LEVEL_WARNING&&(e="WARN: "+e),t===LOG_LEVEL_ERROR&&(e="ERROR: "+e))}},jQuery:window.jQuery||window.Zepto?!0:!1,jQueryLite:"undefined"!=typeof window.angular&&window.angular.element?!0:!1,ready:!1,attributes:{}},LOG_LEVEL_INFO=1,LOG_LEVEL_WARNING=2,LOG_LEVEL_ERROR=3;!function(e){"use strict";var t={};t.sanitizeURI=function(e){if(ImgCache.options.skipURIencoding)return e;var t=encodeURI(e);return t},t.URI=function(e){e||(e="");var t=/^(?:([^:\/?\#]+):)?(?:\/\/([^\/?\#]*))?([^?\#]*)(?:\?([^\#]*))?(?:\#(.*))?/,a=e.match(t);this.scheme=a[1]||null,this.authority=a[2]||null,this.path=a[3]||null,this.query=a[4]||null,this.fragment=a[5]||null},t.URIGetFileName=function(e){if(e){var t=e.lastIndexOf("/");if(t)return e.substr(t+1).toLowerCase()}},t.URIGetPath=function(e){if(e){var a=t.URI(e);return a.path.toLowerCase()}},t.FileGetExtension=function(e){if(!e)return"";e=e.split("?")[0];var t=e.split(".").pop();return!t||t.length>4?"":t},t.isCordova=function(){return"undefined"!=typeof cordova||"undefined"!=typeof phonegap},t.isCordovaAndroid=function(){return t.isCordova()&&device&&device.platform&&device.platform.toLowerCase().indexOf("android")>=0},t.isCordovaWindowsPhone=function(){return t.isCordova()&&device&&device.platform&&device.platform.toLowerCase().indexOf("win32nt")>=0},t.isCordovaAndroidOlderThan4=function(){return t.isCordovaAndroid()&&device.version&&(0===device.version.indexOf("2.")||0===device.version.indexOf("3."))},t.EntryToURL=function(e){return t.isCordovaAndroidOlderThan4()&&"function"==typeof e.toNativeURL?e.toNativeURL():e.toURL()},t.EntryGetURL=function(e){return"function"==typeof e.toURL?t.EntryToURL(e):e.toURI()},t.EntryGetPath=function(e){return t.isCordova()?"ios"==device.platform.toLowerCase()?e.fullPath:"function"==typeof e.toURL?t.EntryToURL(e):e.fullPath:e.fullPath},t.getCordovaStorageType=function(e){if("undefined"!=typeof LocalFileSystem){if(e&&LocalFileSystem.hasOwnProperty("PERSISTENT"))return LocalFileSystem.PERSISTENT;if(!e&&LocalFileSystem.hasOwnProperty("TEMPORARY"))return LocalFileSystem.TEMPORARY}return e?window.PERSISTENT:window.TEMPORARY};var a={};a.trigger=function(a,o){ImgCache.jQuery?e(a).trigger(o):((t.isCordovaWindowsPhone()||!window.CustomEvent)&&(window.CustomEvent=function(e,t){var a;t=t||{bubbles:!1,cancelable:!1,detail:void 0};try{a=document.createEvent("CustomEvent"),a.initCustomEvent(e,t.bubbles,t.cancelable,t.detail)}catch(o){a=document.createEvent("Event"),a.initEvent(e,t.bubbles,t.cancelable),a.detail=t.detail}return a}),a.dispatchEvent(new CustomEvent(o)))},a.removeAttribute=function(e,t){ImgCache.jQuery||ImgCache.jQueryLite?e.removeAttr(t):e.removeAttribute(t)},a.setAttribute=function(e,t,a){ImgCache.jQuery||ImgCache.jQueryLite?e.attr(t,a):e.setAttribute(t,a)},a.getAttribute=function(e,t){return ImgCache.jQuery||ImgCache.jQueryLite?e.attr(t):e.getAttribute(t)},a.getBackgroundImage=function(e){if(ImgCache.jQuery||ImgCache.jQueryLite)return e.attr("data-old-background")?"url("+e.attr("data-old-background")+")":e.css("background-image");var t=window.getComputedStyle(e,null);if(t)return e.getAttribute("data-old-background")?"url("+e.getAttribute("data-old-background")+")":t.backgroundImage},a.setBackgroundImage=function(e,t){ImgCache.jQuery||ImgCache.jQueryLite?e.css("background-image",t):e.style.backgroundImage=t};var o={attributes:{}};o.isImgCacheLoaded=function(){return ImgCache.attributes.filesystem&&ImgCache.attributes.dirEntry?!0:(ImgCache.overridables.log("ImgCache not loaded yet! - Have you called ImgCache.init() first?",LOG_LEVEL_WARNING),!1)},o.attributes.hasLocalStorage=!1,o.hasLocalStorage=function(){if(o.attributes.hasLocalStorage)return o.attributes.hasLocalStorage;try{var e=ImgCache.overridables.hash("imgcache_test");return localStorage.setItem(e,e),localStorage.removeItem(e),o.attributes.hasLocalStorage=!0,!0}catch(t){return ImgCache.overridables.log("Could not write to local storage: "+t.message,LOG_LEVEL_INFO),!1}},o.setCurrentSize=function(e){ImgCache.overridables.log("current size: "+e,LOG_LEVEL_INFO),o.hasLocalStorage()&&localStorage.setItem("imgcache:"+ImgCache.options.localCacheFolder,e)},o.getCachedFilePath=function(e){return ImgCache.options.localCacheFolder+"/"+o.getCachedFileName(e)},o.getCachedFileFullPath=function(e){var a=t.EntryGetPath(ImgCache.attributes.dirEntry);return(a?a+"/":"/")+o.getCachedFileName(e)},o.getCachedFileName=function(e){if(!e)return void ImgCache.overridables.log("No source given to getCachedFileName",LOG_LEVEL_WARNING);var a=ImgCache.overridables.hash(e),o=t.FileGetExtension(t.URIGetFileName(e));return a+(o?"."+o:"")},o.setNewImgPath=function(e,t,o){a.setAttribute(e,"src",t),a.setAttribute(e,r,o)},o.createCacheDir=function(e,o){if(!ImgCache.attributes.filesystem)return ImgCache.overridables.log("Filesystem instance was not initialised",LOG_LEVEL_ERROR),void(o&&o());var r=function(e){ImgCache.overridables.log("Failed to get/create local cache directory: "+e.code,LOG_LEVEL_ERROR),o&&o()},i=function(o){if(ImgCache.attributes.dirEntry=o,ImgCache.overridables.log("Local cache folder opened: "+t.EntryGetPath(o),LOG_LEVEL_INFO),t.isCordovaAndroid()){var i=function(){ImgCache.overridables.log(".nomedia file created.",LOG_LEVEL_INFO),e&&e()};o.getFile(".nomedia",{create:!0,exclusive:!1},i,r)}else t.isCordovaWindowsPhone()?e&&e():(o.setMetadata&&o.setMetadata(function(){ImgCache.overridables.log("com.apple.MobileBackup metadata set",LOG_LEVEL_INFO)},function(){ImgCache.overridables.log("com.apple.MobileBackup metadata could not be set",LOG_LEVEL_WARNING)},{"com.apple.MobileBackup":1}),e&&e());ImgCache.ready=!0,a.trigger(document,n)};ImgCache.attributes.filesystem.root.getDirectory(ImgCache.options.localCacheFolder,{create:!0,exclusive:!1},i,r)},o.FileTransferWrapper=function(e){t.isCordova()&&(this.fileTransfer=new FileTransfer),this.filesystem=e},o.FileTransferWrapper.prototype.download=function(e,t,a,o,r){var i=ImgCache.options.headers||{},n="function"==typeof r;if(this.fileTransfer)return n&&(this.fileTransfer.onprogress=r),this.fileTransfer.download(e,t,a,o,!1,{headers:i});var c=this.filesystem,s=function(a,o,r){ImgCache.overridables.log(a,o),r&&r({code:0,source:e,target:t})},l=new XMLHttpRequest;l.open("GET",e,!0),n&&(l.onprogress=r),l.responseType="blob";for(var u in i)l.setRequestHeader(u,i[u]);l.onload=function(){!l.response||200!==l.status&&0!==l.status?s("Image "+e+" could not be downloaded - status: "+l.status,3,o):c.root.getFile(t,{create:!0},function(e){e.createWriter(function(t){t.onerror=o,t.onwriteend=function(){a(e)},t.write(l.response,o)},o)},o)},l.onerror=function(){s("XHR error - Image "+e+" could not be downloaded - status: "+l.status,3,o)},l.send()},o.getBackgroundImageURL=function(e){var t=a.getBackgroundImage(e);if(t){var o=/\((.+)\)/,r=o.exec(t)[1];return r.replace(/(['"])/g,"")}},o.loadCachedFile=function(e,a,r,i,n){if(o.isImgCacheLoaded()&&e){var c=t.URIGetFileName(a),s=function(o){if(ImgCache.options.useDataURI){var s=function(t){var o=new FileReader;o.onloadend=function(t){var o=t.target.result;return o?(r(e,o,a),ImgCache.overridables.log("File "+c+" loaded from cache",LOG_LEVEL_INFO),void(i&&i(e))):(ImgCache.overridables.log("File in cache "+c+" is empty",LOG_LEVEL_WARNING),void(n&&n(e)))},o.readAsDataURL(t)},l=function(t){ImgCache.overridables.log("Failed to read file "+t.code,LOG_LEVEL_ERROR),n&&n(e)};o.file(s,l)}else{var u=t.EntryGetURL(o);r(e,u,a),ImgCache.overridables.log("File "+c+" loaded from cache",LOG_LEVEL_INFO),i&&i(e)}},l=function(){ImgCache.overridables.log("File "+c+" not in cache",LOG_LEVEL_INFO),n&&n(e)};ImgCache.attributes.filesystem.root.getFile(o.getCachedFilePath(a),{create:!1},s,l)}};var r="data-old-src",i="data-old-background",n="ImgCacheReady";ImgCache.init=function(e,a){ImgCache.attributes.init_callback=e;var r=function(e){if(ImgCache.options.cacheClearSize>0){var t=ImgCache.getCurrentSize();t>1024*ImgCache.options.cacheClearSize*1024?ImgCache.clearCache(e,e):e&&e()}else e&&e()},i=function(e){ImgCache.overridables.log("LocalFileSystem opened",LOG_LEVEL_INFO),ImgCache.attributes.filesystem=e,o.createCacheDir(function(){r(ImgCache.attributes.init_callback)},a)},n=function(e){ImgCache.overridables.log("Failed to initialise LocalFileSystem "+e.code,LOG_LEVEL_ERROR),a&&a()};if(t.isCordova())window.requestFileSystem(t.getCordovaStorageType(ImgCache.options.usePersistentCache),0,i,n);else{if(window.requestFileSystem=window.requestFileSystem||window.webkitRequestFileSystem,window.storageInfo=window.storageInfo||(ImgCache.options.usePersistentCache?navigator.webkitPersistentStorage:navigator.webkitTemporaryStorage),!window.storageInfo)return ImgCache.overridables.log("Your browser does not support the html5 File API",LOG_LEVEL_WARNING),void(a&&a());var c=ImgCache.options.chromeQuota;window.storageInfo.requestQuota(c,function(){var e=ImgCache.options.usePersistentCache?window.storageInfo.PERSISTENT:window.storageInfo.TEMPORARY;window.requestFileSystem(e,c,i,n)},function(e){ImgCache.overridables.log("Failed to request quota: "+e.message,LOG_LEVEL_ERROR),a&&a()})}},ImgCache.getCurrentSize=function(){if(o.hasLocalStorage()){var e=localStorage.getItem("imgcache:"+ImgCache.options.localCacheFolder);return null===e?0:parseInt(e,10)}return 0},ImgCache.cacheFile=function(e,a,r,i){if(o.isImgCacheLoaded()&&e){e=t.sanitizeURI(e);var n=o.getCachedFileFullPath(e),c=new o.FileTransferWrapper(ImgCache.attributes.filesystem);c.download(e,n,function(e){e.getMetadata(function(e){e&&e.hasOwnProperty("size")?(ImgCache.overridables.log("Cached file size: "+e.size,LOG_LEVEL_INFO),o.setCurrentSize(ImgCache.getCurrentSize()+parseInt(e.size,10))):ImgCache.overridables.log("No metadata size property available",LOG_LEVEL_INFO)}),ImgCache.overridables.log("Download complete: "+t.EntryGetPath(e),LOG_LEVEL_INFO),e.setMetadata&&e.setMetadata(function(){ImgCache.overridables.log("com.apple.MobileBackup metadata set",LOG_LEVEL_INFO)},function(){ImgCache.overridables.log("com.apple.MobileBackup metadata could not be set",LOG_LEVEL_WARNING)},{"com.apple.MobileBackup":1}),a&&a()},function(e){e.source&&ImgCache.overridables.log("Download error source: "+e.source,LOG_LEVEL_ERROR),e.target&&ImgCache.overridables.log("Download error target: "+e.target,LOG_LEVEL_ERROR),ImgCache.overridables.log("Download error code: "+e.code,LOG_LEVEL_ERROR),r&&r()},i)}},ImgCache.getCachedFile=function(e,a){if(o.isImgCacheLoaded()&&a){e=t.sanitizeURI(e);var r=o.getCachedFilePath(e);t.isCordovaAndroid()&&0===r.indexOf("file://")&&(r=r.substr(7)),ImgCache.attributes.filesystem.root.getFile(r,{create:!1},function(t){a(e,t)},function(){a(e,null)})}},ImgCache.getCachedFileURL=function(e,a,o){var r=function(e,r){r?a(e,t.EntryGetURL(r)):o&&o(e)};ImgCache.getCachedFile(e,r)},ImgCache.isCached=function(e,t){ImgCache.getCachedFile(e,function(e,a){t(e,null!==a)})},ImgCache.useOnlineFile=function(e){if(o.isImgCacheLoaded()&&e){var t=a.getAttribute(e,r);t&&a.setAttribute(e,"src",t),a.removeAttribute(e,r)}},ImgCache.useCachedFile=function(e,t,r){o.isImgCacheLoaded()&&o.loadCachedFile(e,a.getAttribute(e,"src"),o.setNewImgPath,t,r)},ImgCache.useCachedFileWithSource=function(e,a,r,i){if(o.isImgCacheLoaded()){var n=t.sanitizeURI(a);o.loadCachedFile(e,n,o.setNewImgPath,r,i)}},ImgCache.clearCache=function(e,t){o.isImgCacheLoaded()&&ImgCache.attributes.dirEntry.removeRecursively(function(){ImgCache.overridables.log("Local cache cleared",LOG_LEVEL_INFO),o.setCurrentSize(0),o.createCacheDir(e,t)},function(e){ImgCache.overridables.log("Failed to remove directory or its contents: "+e.code,LOG_LEVEL_ERROR),t&&t()})},ImgCache.removeFile=function(e,a,r){e=t.sanitizeURI(e);var i=o.getCachedFilePath(e),n=function(e){ImgCache.overridables.log("Failed to remove file due to "+e.code,LOG_LEVEL_ERROR),r&&r()};ImgCache.attributes.filesystem.root.getFile(i,{create:!1},function(e){e.remove(function(){a&&a()},n)},n)},ImgCache.isBackgroundCached=function(e,t){var a=o.getBackgroundImageURL(e);ImgCache.getCachedFile(a,function(e,a){t(e,null!==a)})},ImgCache.cacheBackground=function(e,t,a,r){if(o.isImgCacheLoaded()){var i=o.getBackgroundImageURL(e);if(!i)return ImgCache.overridables.log("No background to cache",LOG_LEVEL_WARNING),void(a&&a());ImgCache.overridables.log("Background image URL: "+i,LOG_LEVEL_INFO),ImgCache.cacheFile(i,t,a,r)}},ImgCache.useCachedBackground=function(e,t,r){if(o.isImgCacheLoaded()){var n=o.getBackgroundImageURL(e);if(!n)return ImgCache.overridables.log("No background to cache",LOG_LEVEL_WARNING),void(r&&r());var c=function(e,t,o){a.setBackgroundImage(e,'url("'+t+'")'),a.setAttribute(e,i,o)};o.loadCachedFile(e,n,c,t,r)}},ImgCache.useBackgroundOnlineFile=function(e){if(e){var t=a.getAttribute(e,i);t&&a.setBackgroundImage(e,'url("'+t+'")'),a.removeAttribute(e,i)}},ImgCache.getCacheFolderURI=function(){return o.isImgCacheLoaded()?t.EntryGetURL(ImgCache.attributes.dirEntry):void 0},"function"==typeof define&&define.amd?define("imgcache",[],function(){return ImgCache}):"object"==typeof module&&module.exports?module.exports=ImgCache:window.ImgCache=ImgCache}(window.jQuery||window.Zepto||function(){throw"jQuery is not available"});
function handleOpenURL(e){var t=new CustomEvent("DeepLinkUrlCalled",{detail:{url:e}});setTimeout(function(){window.dispatchEvent(t)},0)}function getQueryVariable(e,t){for(var a=e.substring(e.indexOf("?")+1),n=a.split("&"),i=0;i<n.length;i++){var r=n[i].split("=");if(decodeURIComponent(r[0])==t)return decodeURIComponent(r[1])}return void 0}angular.module("app",["ionic","ngSanitize","app.controllers","app.services","ngCordova","ngImgCache","lbServices","ngCookies","pascalprecht.translate","monospaced.qrcode"]).constant("SERVER_DOMAIN","https://partypics.co").constant("SERVER_API_URL","https://partypics.co/rest").run(["$ionicPlatform","$ionicScrollDelegate","$ionicPopover","$ionicListDelegate","$ionicActionSheet","$translate","CameraService","PartyService","GuestService","$rootScope","$ionicPopover","$ionicModal","$localstorage","User","UserReduced","$state","$location","cordovaWrapper","SERVER_DOMAIN","LoopBackAuth","$cordovaSocialSharing","PartySettingsService","PictureService","$ionicPopup","$window","$q",function(e,t,a,n,i,r,o,c,s,p,a,l,E,d,u,R,P,h,_,g,A,y,v,G,T,f){p.appData={language:"en",allowSuccessPage:!1},p.selected={activeParty:""},p.appGenericMethods={},p.appGenericMethods.displayToast=function(e,t,a){h.displayToast(e,t,a)},p.appGenericMethods.getQrHtmlCode=function(e){var t=f.defer();return c.getQrCode().then(function(a){var n='<qrcode version="4" error-correction-level="Q" size="'+e+'" data="'+a+'"></qrcode>';t.resolve(n)},function(e){t.reject(e)}),t.promise},p.appGenericMethods.sendAppDownloadLink=function(){h.getGoogleAnalytics().trackEvent("app","sendAppDownloadLink","start"),r(["APP.SEND_DOWNLOAD_LINK_ERROR","APP.SEND_DOWNLOAD_LINK_ERROR_OFFLINE","APP.SEND_DOWNLOAD_LINK_TEXT","GENERIC.CURRENTLY_OFFLINE"]).then(function(e){return p.appGenericMethods.isOnline()?void A.share(e["APP.SEND_DOWNLOAD_LINK_TEXT"]).then(function(e){h.getGoogleAnalytics().trackEvent("app","sendAppDownloadLink","success")},function(t){p.appGenericMethods.displayToast(e["APP.SEND_DOWNLOAD_LINK_ERROR"]),h.getGoogleAnalytics().trackEvent("app","sendAppDownloadLink","failShare")}):(p.appGenericMethods.displayToast(e["GENERIC.CURRENTLY_OFFLINE"]+" "+e["APP.SEND_DOWNLOAD_LINK_ERROR_OFFLINE"]),void h.getGoogleAnalytics().trackEvent("app","sendAppDownloadLink","failOffline"))})},p.appGenericMethods.inviteGuests=function(){h.getGoogleAnalytics().trackEvent("app","inviteGuest","start"),r(["APP.INVITE_GUESTS_ERROR","APP.INVITE_GUESTS_ERROR_OFFLINE","APP.INVITE_GUESTS_TEXT","GENERIC.CURRENTLY_OFFLINE"],{partyname:p.appData.activeParty.name}).then(function(e){return p.appGenericMethods.isOnline()?void c.getQrCode().then(function(t){var a="https://partypics.co/#/join?code="+t;A.share(e["APP.INVITE_GUESTS_TEXT"],null,null,a).then(function(e){h.getGoogleAnalytics().trackEvent("app","inviteGuest","success")},function(t){p.appGenericMethods.displayToast(e["APP.INVITE_GUESTS_ERROR"]),h.getGoogleAnalytics().trackEvent("app","inviteGuest","failShare")})},function(t){p.appGenericMethods.displayToast(e["APP.INVITE_GUESTS_ERROR"]),h.getGoogleAnalytics().trackEvent("app","inviteGuest","failQrCode")}):(p.appGenericMethods.displayToast(e["GENERIC.CURRENTLY_OFFLINE"]+" "+e["APP.INVITE_GUESTS_ERROR_OFFLINE"]),void h.getGoogleAnalytics().trackEvent("app","inviteGuest","failOffline"))})},p.appGenericMethods.displayQrCode=function(){h.getGoogleAnalytics().trackEvent("app","displayQrCode","start"),r(["APP.QR_CODE_ERROR_OFFLINE","APP.QR_CODE_POPUP_TITLE","APP.QR_CODE_POPUP_TEXT","APP.QR_CODE_ERROR","GENERIC.CURRENTLY_OFFLINE","GENERIC.DONE"]).then(function(e){return p.appGenericMethods.isOnline()?void p.appGenericMethods.getQrHtmlCode(200).then(function(t){h.getGoogleAnalytics().trackEvent("app","displayQrCode","success");G.alert({title:e["APP.QR_CODE_POPUP_TITLE"],buttons:[{text:e["GENERIC.DONE"],type:"button-transparent"}],template:e["APP.QR_CODE_POPUP_TEXT"]+'<br /><br /><div class="qrcode-popup">'+t+"</qrcode></div>"})},function(t){h.displayToast(e["APP.QR_CODE_ERROR"]),h.getGoogleAnalytics().trackEvent("app","displayQrCode",t)}):void p.appGenericMethods.displayToast(e["GENERIC.CURRENTLY_OFFLINE"]+" "+e["APP.QR_CODE_ERROR_OFFLINE"])})},p.appGenericMethods.getPictureUrl=function(e,t){var a="";return"small"===t?a="_2":"medium"===t&&(a="_1"),_+"/images/id/"+e.fileId+a+"."+e.fileType},p.appGenericMethods.takePicture=function(){o.takePicture()},p.appGenericMethods.findPicture=function(){o.findPicture()},p.appGenericMethods.sharePicture=function(e){r(["APP.SHARE_ERROR","APP.SHARE_ERROR_OFFLINE","GENERIC.CURRENTLY_OFFLINE"]).then(function(t){if(!p.appGenericMethods.isOnline())return void p.appGenericMethods.displayToast(t["GENERIC.CURRENTLY_OFFLINE"]+" "+t["APP.SHARE_ERROR_OFFLINE"]);var a=p.appGenericMethods.getPictureUrl(e,"small");h.getGoogleAnalytics().trackEvent("app","sharePicture","start"),A.share(null,null,a).then(function(e){h.getGoogleAnalytics().trackEvent("app","sharePicture","success")},function(e){p.appGenericMethods.displayToast(t["APP.SHARE_ERROR"]),h.getGoogleAnalytics().trackEvent("app","sharePicture","fail")})})},p.appGenericMethods.likePicture=function(e){p.appGenericMethods.displayToast("Like not implemented yet.")},p.fullScreenPictureModal={pictureUrl:"",modal:void 0,resolution:{height:T.innerHeight,width:T.innerWidth}},l.fromTemplateUrl("image-modal.html",{scope:p,animation:"slide-in-up"}).then(function(e){p.fullScreenPictureModal.modal=e}),p.appGenericMethods.displayFullscreenPicture=function(e){r(["APP.FULLSCREEN_ERROR_OFFLINE","GENERIC.CURRENTLY_OFFLINE"]).then(function(a){if(!p.appGenericMethods.isOnline())return void p.appGenericMethods.displayToast(a["GENERIC.CURRENTLY_OFFLINE"]+" "+a["APP.FULLSCREEN_ERROR_OFFLINE"]);p.fullScreenPictureModal.pictureUrl=e,p.fullScreenPictureModal.modal.show();for(var n in t._instances){var i=t._instances[n];if("fullscreenImage"==i.$$delegateHandle)return void i.zoomTo(1,!1,0,0)}})},p.appGenericMethods.closeFullscreenPicture=function(){p.fullScreenPictureModal.modal.hide()},p.appGenericMethods.displayInPartyView=function(e){r(["APP.DISPLAY_PARTY_VIEW_ERROR","APP.DISPLAY_PARTY_VIEW_ERROR_OFFLINE","APP.DISPLAY_PARTY_VIEW_TEXT","APP.DISPLAY_PARTY_VIEW_TITLE","GENERIC.CURRENTLY_OFFLINE","GENERIC.NO","GENERIC.YES"]).then(function(t){if(!p.appGenericMethods.isOnline())return void p.appGenericMethods.displayToast(t["GENERIC.CURRENTLY_OFFLINE"]+" "+t["APP.DISPLAY_PARTY_VIEW_ERROR_OFFLINE"]);var a=y.get();a.then(function(a){if("selectedImage"!=a.displayMode.value){var n=G.confirm({title:t["APP.DISPLAY_PARTY_VIEW_TITLE"],template:t["APP.DISPLAY_PARTY_VIEW_TEXT"],cancelText:t["GENERIC.NO"],okText:t["GENERIC.YES"]});n.then(function(t){t&&p.appGenericMethods.setDisplayInPartyView(a,e)})}else p.appGenericMethods.setDisplayInPartyView(a,e)},function(e){p.appGenericMethods.displayToast(t["APP.DISPLAY_PARTY_VIEW_ERROR"])})})},p.appGenericMethods.setDisplayInPartyView=function(e,t){r(["APP.DISPLAY_PARTY_VIEW_ERROR","APP.DISPLAY_PARTY_VIEW_SUCCESS"]).then(function(a){e.displayMode={value:"selectedImage"},e.selectedPictureId=t.id;var n=y.set(e);n.then(function(e){p.appGenericMethods.displayToast(a["APP.DISPLAY_PARTY_VIEW_SUCCESS"])},function(e){p.appGenericMethods.displayToast(a["APP.DISPLAY_PARTY_VIEW_ERROR"])})})},p.appGenericMethods.cameraSheet=function(e){r(["GENERIC.CANCEL","GENERIC.CAMERA","GENERIC.CURRENTLY_OFFLINE","CAMERA.NO_ACTIVE_PARTY","CAMERA.TAKE_PICTURE","CAMERA.SELECT_PICTURE","CAMERA.UPLOAD_ERROR_OFFLINE"]).then(function(e){if(!p.appGenericMethods.isOnline())return void p.appGenericMethods.displayToast(e["GENERIC.CURRENTLY_OFFLINE"]+" "+e["CAMERA.UPLOAD_ERROR_OFFLINE"]);if(""==p.appData.activeParty.id)return void p.appGenericMethods.displayToast(e["CAMERA.NO_ACTIVE_PARTY"]);i.show({buttons:[{text:'<i class="icon ion-android-camera"></i>&nbsp;&nbsp;'+e["CAMERA.TAKE_PICTURE"]},{text:'<i class="icon ion-image"></i>&nbsp;&nbsp;'+e["CAMERA.SELECT_PICTURE"]}],titleText:e["GENERIC.CAMERA"],cancelText:e["GENERIC.CANCEL"],cancel:function(){},buttonClicked:function(e){return 0==e?p.appGenericMethods.takePicture():1==e&&p.appGenericMethods.findPicture(),!0}})})},p.appGenericMethods.deletePicture=function(e,t){r(["PICTURES.DELETE_ERROR_OFFLINE","PICTURES.DELETE_ERROR","PICTURES.DELETE_TITLE","PICTURES.DELETE_TEXT","PICTURES.DELETE_SUCCESS","GENERIC.CURRENTLY_OFFLINE","GENERIC.NO","GENERIC.YES"]).then(function(a){if(!p.appGenericMethods.isOnline())return void p.appGenericMethods.displayToast(a["GENERIC.CURRENTLY_OFFLINE"]+" "+a["PICTURES.DELETE_ERROR_OFFLINE"]);h.getGoogleAnalytics().trackEvent("app","deletePicture","start");var n=G.confirm({title:a["PICTURES.DELETE_TITLE"],template:a["PICTURES.DELETE_TEXT"],cancelText:a["GENERIC.NO"],okText:a["GENERIC.YES"]});n.then(function(n){if(!n)return void h.getGoogleAnalytics().trackEvent("app","deletePicture","cancel");var i=v["delete"](t);i.then(function(n){e.getPictures(!0),p.appGenericMethods.displayToast(a["PICTURES.DELETE_SUCCESS"]),p.$broadcast("pictureDeleted",t),h.getGoogleAnalytics().trackEvent("app","deletePicture","success")},function(e){p.appGenericMethods.displayToast(a["PICTURES.DELETE_ERROR"]),h.getGoogleAnalytics().trackEvent("app","deletePicture","fail",1)})})})},p.appGenericMethods.blockGuest=function(e,t){r(["GUESTS.BLOCK_GUEST_TITLE","GUESTS.BLOCK_GUEST_TEXT","GUESTS.BLOCK_ERROR","GUESTS.BLOCK_ERROR_OFFLINE","GUESTS.BLOCK_SUCCESS","GENERIC.NO","GENERIC.YES"],{name:t.name}).then(function(a){if(!p.appGenericMethods.isOnline())return void p.appGenericMethods.displayToast(a["GUESTS.BLOCK_ERROR_OFFLINE"]);h.getGoogleAnalytics().trackEvent("app","blockGuest","start");var i=G.confirm({title:a["GUESTS.BLOCK_GUEST_TITLE"],template:a["GUESTS.BLOCK_GUEST_TEXT"],cancelText:a["GENERIC.NO"],okText:a["GENERIC.YES"]});i.then(function(i){if(!i)return void h.getGoogleAnalytics().trackEvent("app","blockGuest","cancel");var r=s["delete"](t);r.then(function(i){n.closeOptionButtons(),e.getGuests(),p.appGenericMethods.displayToast(a["GUESTS.BLOCK_SUCCESS"]),p.$broadcast("guestDeleted",t),h.getGoogleAnalytics().trackEvent("app","blockGuest","success")},function(t){var i=p.appGenericMethods.getReturnErrorMessage(t);n.closeOptionButtons(),e.getGuests(),p.appGenericMethods.displayToast(a["GUESTS.BLOCK_ERROR"]+': "'+i+'"'),h.getGoogleAnalytics().trackEvent("app","blockGuest",i)})})})},p.appGenericMethods.savePictureToPhone=function(e,t,a){var n,i,r,o,c=new Image;c.onload=function(){n=document.createElement("canvas"),n.width=c.width,n.height=c.height,i=n.getContext("2d"),i.drawImage(c,0,0);try{r=n.toDataURL("image/jpeg",1),o=r.replace(/data:image\/jpeg;base64,/,""),cordova.exec(t,a,"Canvas2ImagePlugin","saveImageDataToLibrary",[o])}catch(e){a(e.message)}};try{c.src=e}catch(s){a(s.message)}},p.appGenericMethods.adminPageCheck=function(){p.appData.activeParty.ownerId!=d.getCurrentId()&&R.go("tab.party")},p.appGenericMethods.cleanupResponse=function(e){var t=[];for(var a in e)if(0!==a.indexOf("$")){var n=e[a];t.push(n)}return t},p.appGenericMethods.isOnline=h.isOnline,p.appGenericMethods.displayHeaders=function(){return"login"==R.current.name?!1:!0},p.appData.backPages={"tab.party-new-success":{parent:"tab.party"},"tab.party-new":{parent:"tab.party"},"tab.party-admin":{parent:"tab.party"},"tab.party-admin-bg-select":{parent:"tab.party-admin"},"tab.pictures-user":{parent:"tab.pictures"}},p.appGenericMethods.displayBackButton=function(){return R.current.name in p.appData.backPages?!0:!1},p.appGenericMethods.backButton=function(){var e="tab.party";R.current.name in p.appData.backPages&&(e=p.appData.backPages[R.current.name].parent),R.go(e)},p.appGenericMethods.offlineModeInfo=function(){r(["APP.CURRENTLY_OFFLINE"]).then(function(e){p.appGenericMethods.displayToast(e["APP.CURRENTLY_OFFLINE"])})},p.appGenericMethods.getReturnErrorMessage=function(e){var t="unknow",a=void 0;return e.hasOwnProperty("body")?a=JSON.parse(e.body):e.hasOwnProperty("data")&&(a=e.data),a&&a.hasOwnProperty("error")&&a.error.hasOwnProperty("message")&&(t=a.error.message),t},p.appGenericMethods.qrJoinParty=function(e){h.getGoogleAnalytics().trackEvent("app","joinParty","start"),r(["APP.JOIN_PARTY_ERROR","APP.JOIN_PARTY_ERROR_NOT_VALID","APP.JOIN_PARTY_SUCCESS"]).then(function(t){var a=c.resolveQrCode(e);if(!a)return void p.appGenericMethods.displayToast(t["APP.JOIN_PARTY_ERROR_NOT_VALID"]);var n=a.partyId,i=a.joinCode,r=c.join(n,i);r.then(function(e){p.appGenericMethods.displayToast(t["APP.JOIN_PARTY_SUCCESS"]+' "'+e.name+'"'),h.getGoogleAnalytics().trackEvent("app","joinParty","success")},function(e){p.appGenericMethods.displayToast(t["APP.JOIN_PARTY_ERROR"]+' "'+e+'"'),h.getGoogleAnalytics().trackEvent("app","joinParty",e)})})},p.appGenericMethods.juliusclaim=function(e){h.showSpinnerDialog(),h.getGoogleAnalytics().trackEvent("app","juliusClaim","start"),u.addViaPartner({partnerId:"54b0633ee4b0aa674b2585cd",data:{claimPath:e}},function(e,t){R.go("tab.party"),r(["APP.JULIUS_REWARD_SUCCESS"]).then(function(e){p.appGenericMethods.displayToast(e["APP.JULIUS_REWARD_SUCCESS"])}),h.getGoogleAnalytics().trackEvent("app","juliusClaim","success"),h.hideSpinnerDialog()},function(e){var t=p.appGenericMethods.getReturnErrorMessage(e);h.getGoogleAnalytics().trackEvent("app","juliusClaim",t),h.hideSpinnerDialog(),r(["APP.JULIUS_REWARD_ERROR"],{error:t}).then(function(e){p.appGenericMethods.displayToast(e["APP.JULIUS_REWARD_ERROR"])})})},p.appGenericMethods.logout=function(e){r(["APP.LOGOUT_ERROR_OFFLINE","GENERIC.CURRENTLY_OFFLINE"]).then(function(t){return void 0===e&&(e=!1),!p.appGenericMethods.isOnline()&&e?(p.appGenericMethods.displayToast(t["GENERIC.CURRENTLY_OFFLINE"]+" "+t["APP.LOGOUT_ERROR_OFFLINE"]),void h.getGoogleAnalytics().trackEvent("app","logout","fail",1)):void d.logout(function(){P.path("/login")},function(e){g.clearUser(),g.clearStorage(),P.path("/login")})})},p.$on("$locationChangeStart",function(t,a,n){e.ready(function(){var e=a.split("#")[1];d.isAuthenticated()?"/login"==e&&P.path("/tab/party"):"/login"==e||P.path("/login")})}),p.$on("$stateChangeSuccess",function(t,a,n,i,r){e.ready(function(){h.getGoogleAnalytics().trackView(a.name)})}),p.appData.parties={},p.partyChange=function(e){c.setActive(e),p.$broadcast("activePartyChanged",e)},p.checkActivePartyAllowed=function(){var e=angular.copy(p.appData.activeParty);""!=p.appData.activeParty.id&&(p.appData.parties.hasOwnProperty(p.appData.activeParty.id)||(p.appData.activeParty=c.getActive(),c.setFirstActive(),p.selected={activeParty:p.appData.activeParty.id},r(["APP.NO_LONGER_GUEST"],{partyname:e.name}).then(function(e){p.appGenericMethods.displayToast(e["APP.NO_LONGER_GUEST"])}),p.$broadcast("activePartyChanged",p.appData.activeParty)))},p.syncAndSetParties=function(){var e=c.sync();e.then(function(e){p.updateUserParties().then(function(e){""==p.appData.activeParty.id&&c.setFirstActive(),p.selected={activeParty:p.appData.activeParty.id}})})},p.updateUserParties=function(){var e=f.defer();return c.sync().then(function(t){angular.copy(t,p.appData.parties),p.checkActivePartyAllowed(),e.resolve(t)},function(t){e.reject(t)}),e.promise},p.$on("activePartyChanged",function(e,t){s.sync(!1)}),a.fromTemplateUrl("party-select-popover.html",{scope:p}).then(function(e){p.popover=e}),p.openPopover=function(e){p.popover.show(e)},p.closePopover=function(){p.popover.hide()},p.$on("$destroy",function(){p.popover.remove()}),p.$on("popover.hidden",function(){}),p.$on("popover.removed",function(){}),e.ready(function(){h.getPreferredLanguage().then(function(e){var t=e.value.split("-");if(t.length>0){var a=t[0];["en","de","es"].indexOf(a)<0&&(a="en"),r.use(a),p.appData.language=a}},function(e){r.use("en")}),h.getGoogleAnalytics().startTrackerWithId("UA-56919724-1");var e=d.getCurrentId();e&&h.getGoogleAnalytics().setUserId(e),window.cordova&&window.cordova.plugins.Keyboard&&cordova.plugins.Keyboard.hideKeyboardAccessoryBar(!0),window.StatusBar&&StatusBar.styleDefault(),d.getCurrent(function(e,t){},function(e){401==e.status&&p.appGenericMethods.logout()}),ImgCache.options.debug=!1,ImgCache.options.chromeQuota=52428800,ImgCache.init(function(){},function(){}),p.appData.activeParty=c.getActive(),p.syncAndSetParties(),s.sync(!0)})}]).config(["$ionicConfigProvider",function(e){e.tabs.position("bottom"),e.navBar.alignTitle("center"),e.navBar.positionPrimaryButtons("left"),e.navBar.positionSecondaryButtons("right")}]).config(["LoopBackResourceProvider","SERVER_API_URL",function(e,t){e.setAuthHeader("X-Access-Token"),e.setUrlBase(t)}]).config(["$translateProvider",function(e){e.useStaticFilesLoader({prefix:"languages/locale-",suffix:".json"}).preferredLanguage("en").fallbackLanguage(["en"])}]).config(["$cordovaFacebookProvider","$stateProvider","$urlRouterProvider","SERVER_DOMAIN",function(e,t,a,n){t.state("tab",{url:"/tab","abstract":!0,templateUrl:"templates/tabs.html"}).state("tab.party",{url:"/party",views:{"tab-party":{templateUrl:"templates/tab-party.html",controller:"PartyCtrl"}}}).state("tab.party-new",{url:"/party/new",views:{"tab-party":{templateUrl:"templates/party-new.html",controller:"PartyNewCtrl"}}}).state("tab.party-new-success",{url:"/party/new-success",views:{"tab-party":{templateUrl:"templates/party-new-success.html",controller:"PartyNewSuccessCtrl"}}}).state("tab.party-admin",{url:"/party/admin",views:{"tab-party":{templateUrl:"templates/party-admin.html",controller:"PartyAdminCtrl"}}}).state("tab.party-admin-bg-select",{url:"/party/admin/select-bg",views:{"tab-party":{templateUrl:"templates/party-admin-bg-select.html",controller:"PartyAdminBgSelectCtrl"}}}).state("tab.guests",{url:"/guests",views:{"tab-guests":{templateUrl:"templates/tab-guests.html",controller:"GuestsCtrl"}}}).state("tab.pictures-user",{url:"/pictures/:userId",cache:!1,views:{"tab-pictures":{templateUrl:"templates/tab-pictures-user.html",controller:"PicturesCtrl"}}}).state("tab.pictures",{url:"/pictures",cache:!1,views:{"tab-pictures":{templateUrl:"templates/tab-pictures.html",controller:"PicturesCtrl"}}}).state("login",{url:"/login",templateUrl:"templates/login.html",controller:"LoginCtrl"}),a.otherwise("/tab/party")}]).run(["$rootScope","$state","User","$window","PartyService","PostponedActionsService","cordovaWrapper","$translate",function(e,t,a,n,i,r,o,c){n.addEventListener("DeepLinkUrlCalled",function(t){var n=t.detail.url,i="partypicsco://";if(0==n.indexOf(i))if(0===n.indexOf(i+"juliusclaim")){var s=getQueryVariable(n,"claimPath");if(!s)return e.appGenericMethods.displayToast("Sorry but the called claim url is incomplete!"),void o.getGoogleAnalytics().trackEvent("app","juliusClaim","claimPathMissing");var p=!1;e.appGenericMethods.isOnline()&&a.isAuthenticated()&&(e.appGenericMethods.juliusclaim(s),p=!0),p||r.addAction("loginSuccess","juliusclaim",s)}else if(0===n.indexOf(i+"invite")){var l=getQueryVariable(n,"code"),E=!1;e.appGenericMethods.isOnline()&&a.isAuthenticated()&&(e.appGenericMethods.qrJoinParty(l),E=!0),E||r.addAction("loginSuccess","qrJoinParty",l)}else c(["APP.DEEPLINK_ERROR"]).then(function(t){e.appGenericMethods.displayToast(t["APP.DEEPLINK_ERROR"])})})}]),function(){function e(e,t){t=t||{bubbles:!1,cancelable:!1,detail:void 0};var a=document.createEvent("CustomEvent");return a.initCustomEvent(e,t.bubbles,t.cancelable,t.detail),a}e.prototype=window.Event.prototype,window.CustomEvent=e}();
angular.module("app.controllers",[]).controller("AppCtrl",["$scope","$ionicModal","$timeout",function(o,n,l){o.loginData={},n.fromTemplateUrl("templates/login.html",{scope:o}).then(function(n){o.modal=n}),o.closeLogin=function(){o.modal.hide()},o.login=function(){o.modal.show()},o.doLogin=function(){l(function(){o.closeLogin()},1e3)}}]),angular.module("app.services",[]);
angular.module("app.services").factory("CacheService",["$q","$localstorage","$rootScope","$translate","PartyServiceBase","cordovaWrapper",function(t,e,a,r,n,_){var i={};return i.__data={},i.__syncMode="ids",i.__dataName="base",i.__dataPartyDependent=!0,i.__storageKey=function(){return this.__dataPartyDependent?"Cached_"+this.__dataName+"_"+n.getActiveID():"Cached_"+this.__dataName},i.__getCurrentParty=function(){return n.getActiveID()},i.__delete=function(e,a){var r=t.defer(),n=this.__deleteObject(a);return n.then(function(t){e.dataDelete(a.id),r.resolve(t)},function(t){r.reject(t)}),r.promise},i.__sync=function(e,i,o){void 0===i&&(i=!1),void 0===o&&(o=!1);var s=t.defer();if(this.__dataPartyDependent&&!n.getActiveID())return r(["GENERIC.NO_PARTY_ACTIVE"]).then(function(t){s.reject(t["GENERIC.NO_PARTY_ACTIVE"])}),s.promise;if(_.isOnline()&&!i)if(o&&e.__saveData({}),"full"==e.__syncMode||0==e.getDataCount()){var u=e.__getServerData("full");u.then(function(t){e.__saveData(t),s.resolve(t)},function(t){s.resolve(e.__sync(e,!0))})}else{var c=e.__getServerData("ids");c.then(function(t){currentIds=e.getDataKeys(),resultIds=e.__dataCompare(currentIds,t);var a=0;a=resultIds.notNeeded.length;for(var n=0;a>n;n++)delete e.__data[resultIds.notNeeded[n]];if(resultIds.missing.length){var _=e.__getServerData("full",resultIds.missing);_.then(function(t){angular.extend(e.__data,t),e.__saveDataToLocalStorage(),s.resolve(e.__data)},function(t){r(["GENERIC.NO_SERVER_IDS"]).then(function(t){s.reject(t["GENERIC.NO_SERVER_IDS"])})})}else e.__saveDataToLocalStorage(),s.resolve(e.__data)},function(t){a.updateUserParties(),s.resolve(e.__sync(e,!0))})}else s.resolve(this.getData());return s.promise},i.__dataCompare=function(t,e){var a=0,r=[];a=t.length;for(var n=0;a>n;n++){var _=t[n];e.indexOf(_)<0&&r.push(_)}var i=[];a=e.length;for(var n=0;a>n;n++){var _=e[n];t.indexOf(_)<0&&i.push(_)}return{missing:i,notNeeded:r}},i.__getData=function(){return this.__data.length>0?this.__data:(this.__data=e.getObject(this.__storageKey()),this.__data)},i.__saveData=function(t,e){void 0===e?this.__data=t:this.__data[e]=t,this.__saveDataToLocalStorage()},i.__saveDataToLocalStorage=function(){e.setObject(this.__storageKey(),this.__data)},i.dataDelete=function(t){return void 0==t?!1:(delete this.getData()[t],this.__saveDataToLocalStorage(),!0)},i.getDataCount=function(){return this.getDataKeys().length},i.getDataKeys=function(){return Object.keys(this.getData())},i.getData=function(t){var e=this.__getData();return void 0===t?e:t in e?e[t]:void 0},i.getDataCacheJunks=function(t,e){var a,r=this.__getData(),n=[],_=0;for(var i in r)if(_++,!(t>=_)){if(_>t+e)return n;a=r[i],n.push(a)}return n},i.getDataArray=function(){return this.objectToArray(this.getData())},i.objectToArray=function(t){return Object.keys(t).map(function(e){return t[e]})},i.arrayToObject=function(t,e){var a={};for(var r in t)if(0!==r.indexOf("$")){var n=t[r];a[n[e]]=n}return a},i.__getServerData=function(t){},i.__deleteObject=function(t){},i}]);
angular.module("app.services").factory("CameraService",["$rootScope","$translate","PartyService","cordovaWrapper","LoopBackAuth","SERVER_API_URL",function(e,t,a,n,i,c){var o={};return o.picturePath=void 0,o.takePicture=function(){if(n.getGoogleAnalytics().trackEvent("app","takePicture","start"),!e.appGenericMethods.isOnline())return t(["CAMERA.UPLOAD_ERROR_OFFLINE","GENERIC.CURRENTLY_OFFLINE"]).then(function(t){e.appGenericMethods.displayToast(t["GENERIC.CURRENTLY_OFFLINE"]+" "+t["CAMERA.UPLOAD_ERROR_OFFLINE"])}),void n.getGoogleAnalytics().trackEvent("app","takePicture","notOnline");var a={quality:80,targetWidth:1920,targetHeight:1920,destinationType:Camera.DestinationType.FILE_URI,sourceType:Camera.PictureSourceType.CAMERA,encodingType:Camera.EncodingType.JPEG},i=this;navigator.camera.getPicture(function(t){i.picturePath=t,e.$apply(),n.getGoogleAnalytics().trackEvent("app","takePicture","success"),i.__upload()},function(a){"Camera cancelled."==a?n.getGoogleAnalytics().trackEvent("app","takePicture","cancel"):(n.getGoogleAnalytics().trackEvent("app","takePicture",a),t(["CAMERA.TAKE_PICTURE_ERROR"]).then(function(t){e.appGenericMethods.displayToast(t["CAMERA.TAKE_PICTURE_ERROR"])}))},a)},o.findPicture=function(){if(n.getGoogleAnalytics().trackEvent("app","findPicture","start"),!e.appGenericMethods.isOnline())return t(["CAMERA.UPLOAD_ERROR_OFFLINE","GENERIC.CURRENTLY_OFFLINE"]).then(function(t){e.appGenericMethods.displayToast(t["GENERIC.CURRENTLY_OFFLINE"]+" "+t["CAMERA.UPLOAD_ERROR_OFFLINE"])}),void n.getGoogleAnalytics().trackEvent("app","findPicture","notOnline");var a={quality:80,targetWidth:1920,targetHeight:1920,destinationType:Camera.DestinationType.FILE_URI,sourceType:Camera.PictureSourceType.PHOTOLIBRARY,encodingType:Camera.EncodingType.JPEG},i=this;navigator.camera.getPicture(function(t){i.picturePath=t,e.$apply(),n.getGoogleAnalytics().trackEvent("app","findPicture","success"),i.__upload()},function(a){"Selection cancelled."==a?n.getGoogleAnalytics().trackEvent("app","findPicture","cancel"):(n.getGoogleAnalytics().trackEvent("app","findPicture",a),t(["CAMERA.SELECT_PICTURE_ERROR"]).then(function(t){e.appGenericMethods.displayToast(t["CAMERA.SELECT_PICTURE_ERROR"])}))},a)},o.__upload=function(){var n=this.picturePath,o=a.getActiveID();if(!o){var r=this;return void t(["CAMERA.UPLOAD_ERROR_NO_PARTY_ACTIVE"]).then(function(e){r.__onUploadFail({error:{message:e["CAMERA.UPLOAD_ERROR_NO_PARTY_ACTIVE"]}})})}t(["CAMERA.UPLOAD_STARTED"]).then(function(t){e.appGenericMethods.displayToast(t["CAMERA.UPLOAD_STARTED"],"short")});var p={};p.party_id=o,p.filename=n;var E=new FileUploadOptions;E.fileKey="picture",E.chunkedMode=!1,E.params=p,E.mimeType="image/jpeg";var R=new FileTransfer;R.upload(n,encodeURI(c+"/Parties/"+o+"/pictures/upload?access_token="+i.accessTokenId),this.__onUploadSuccess,this.__onUploadFail,E)},o.__onUploadSuccess=function(a){t(["CAMERA.UPLOAD_SUCCESS"]).then(function(t){e.appGenericMethods.displayToast(t["CAMERA.UPLOAD_SUCCESS"])}),n.getGoogleAnalytics().trackEvent("app","uploadPicture","success"),e.$broadcast("picturesChanged",{})},o.__onUploadFail=function(a){var i=e.appGenericMethods.getReturnErrorMessage(a);e.checkActivePartyAllowed(),n.getGoogleAnalytics().trackEvent("app","uploadPicture",i),e.appGenericMethods.savePictureToPhone(this.picturePath,function(a){t(["CAMERA.UPLOAD_ERROR_SAVED_PICTURE"],{error:i}).then(function(t){e.appGenericMethods.displayToast(t["CAMERA.UPLOAD_ERROR_SAVED_PICTURE"])})},function(a){t(["CAMERA.UPLOAD_ERROR"],{error:i}).then(function(t){e.appGenericMethods.displayToast(t["CAMERA.UPLOAD_ERROR"])})})},o}]);
angular.module("app.services").factory("FacebookService",["$rootScope","$cordovaFacebook","UserIdentity","$translate","$q",function(e,n,t,o,i){var r={};return r.userData={},r.__login=function(){return n.login(["public_profile","email","user_birthday"])},r.__getUserData=function(){return n.api("/me",[])},r.login=function(){var r=i.defer();return n.login(["public_profile","email","user_birthday"]).then(function(i){n.api("/me",["user_birthday"]).then(function(n){n.language=e.appData.language,t.mobileLogin({},{profile:n,accessToken:i.authResponse.accessToken},function(e,n){r.resolve(e)},function(e){o(["LOGIN.LOGIN_ERROR"]).then(function(e){r.reject(e["LOGIN.LOGIN_ERROR"])})})},function(e){o(["LOGIN.LOGIN_ERROR"]).then(function(e){r.reject(e["LOGIN.LOGIN_ERROR"])})})},function(e){o(["LOGIN.FACEBOOK_ERROR_CONNECT"]).then(function(e){r.reject(e["LOGIN.FACEBOOK_ERROR_CONNECT"])})}),r.promise},r}]);
angular.module("app.services").factory("GoogleService",["$rootScope","UserIdentity","$cordovaOauth","$translate","$q",function(e,o,n,t,a){var c={};return c.login=function(){var c=a.defer();return n.google("763492657042-jhfgqm0mcg42h0c5c54b5e6hi53v2ajr.apps.googleusercontent.com",["https://www.googleapis.com/auth/userinfo.email"]).then(function(n){o.mobileLoginGoogle({accessToken:n.access_token,profileAdditions:{language:e.appData.language}},function(e,o){c.resolve(e)},function(e){t(["LOGIN.LOGIN_ERROR"]).then(function(e){c.reject(e["LOGIN.LOGIN_ERROR"])})})},function(e){c.reject(e)}),c.promise},c}]);
angular.module("app.services").factory("GuestService",["CacheService","Party","$q",function(e,t,r){var i=angular.copy(e);return i.__dataName="Guests",i.__syncMode="ids",i.sync=function(e){return void 0===e&&(e=!1),this.__sync(this,!1,e)},i["delete"]=function(e){return this.__delete(this,e)},i.__getServerData=function(e,i){var n=r.defer(),s=void 0;return void 0!==i&&(Array.isArray(i)||n.reject("The ids have to be given as array."),s={where:{guests:i}}),t.guestss({id:this.__getCurrentParty(),filter:s,mode:e},function(e,t){n.resolve(e.guests)},function(e){n.reject(e)}),n.promise},i.__deleteObject=function(e){var i=r.defer();return t.blockGuest({id:this.__getCurrentParty(),fk:e.id},{},function(e,t){i.resolve(e)},function(e){i.reject(e)}),i.promise},i}]);
angular.module("app.services").factory("PartyService",["PartyServiceBase","CacheService","$rootScope","$translate","Party","User","$localstorage","$q",function(e,t,r,i,n,a,s,c){var o=angular.copy(t);return o=angular.extend(o,e),o.__dataName="Parties",o.__syncMode="full",o.__dataPartyDependent=!1,o.emptyParty={id:"",name:""},o.sync=function(){return this.__sync(this)},o["delete"]=function(e){return this.__delete(this,e)},o.__getServerData=function(){var e=c.defer();return n.guestOf({},function(t,r){e.resolve(t.parties)},function(t){e.reject(t)}),e.promise},o.__deleteObject=function(e){var t=c.defer();return n.cascadingDeleteParty({id:e.id},function(e,r){t.resolve(e)},function(e){t.reject(e)}),t.promise},o.join=function(e,t){var s=c.defer(),o=this.getData(e);if(o)return this.setActive(o),i(["APP.JOIN_PARTY_ERROR_ALREADY_GUEST"]).then(function(e){s.reject(e["APP.JOIN_PARTY_ERROR_ALREADY_GUEST"])}),s.promise;var u=this;return n.join({id:e,data:{id:a.getCurrentId(),joinCode:t}},function(e,t){u.__saveData(e,e.id),u.setActive(e),s.resolve(e)},function(e){var t=r.appGenericMethods.getReturnErrorMessage(e);s.reject(t)}),s.promise},o.resolveQrCode=function(e){var t="partypics-";if(0!=e.indexOf(t))return void 0;var r=e.substr(t.length).split("-");if(2==r.length){var i=r[0],n=r[1];return{partyId:i,joinCode:n}}return void 0},o.getQrCode=function(){var e=c.defer(),t=this.getActive();return n.qrcode({id:t.id,fk:t.ownerId},function(t,r){e.resolve(t.qrCode)},function(t){var i=r.appGenericMethods.getReturnErrorMessage(t);e.reject(i)}),e.promise},o.setActive=function(e){this.setActiveID(e.id),r.appData.activeParty=e},o.getActive=function(){var e=this.getActiveID();return""==e?this.emptyParty:this.partyExists(e)?this.getData(e):(this.setActive(this.emptyParty),this.emptyParty)},o.setFirstActive=function(){var e=Object.keys(this.getData());if(e.length>0){var t=e[e.length-1];this.setActive(this.getData(t))}},o.partyExists=function(e){var t=this.getData(e);return t?!0:!1},o}]);
angular.module("app.services").factory("PartyServiceBase",["$localstorage",function(t){var e={};return e.setActiveID=function(e){t.set("activeParty",e)},e.getActiveID=function(){return t.get("activeParty","")},e}]);
angular.module("app.services").factory("PartySettingsService",["$rootScope","$translate","Party","$q",function(t,e,n,r){var a={};return a.get=function(){var a=r.defer();return n.getSettings({id:t.appData.activeParty.id},function(t,e){a.resolve(t.settings)},function(t){e(["PARTY_ADMIN.SETTINGS_GET_ERROR"]).then(function(t){a.reject(t["PARTY_ADMIN.SETTINGS_GET_ERROR"])})}),a.promise},a.set=function(a){var i=r.defer();return n.setSettings({id:t.appData.activeParty.id},{data:a},function(t,e){i.resolve(t)},function(t){e(["PARTY_ADMIN.SETTINGS_SET_ERROR"]).then(function(t){i.reject(t["PARTY_ADMIN.SETTINGS_SET_ERROR"])})}),i.promise},a}]);
angular.module("app.services").factory("PaymentService",["$rootScope","$ionicPlatform","$cordovaNetwork","$translate","$timeout","$q",function(r,e,t,o,i,n){var a={};return a.products=[],a.priceCategory="normal",a._getIdKeyName=function(){var r;if(ionic.Platform.isAndroid())r="id_android";else{if(!ionic.Platform.isIOS())return"id_android";r="id_ios"}return r},a._getStoreProductId=function(r,e){if(void 0==e&&(e=!1),"free"==this.priceCategory&&0==e)return void 0;var t=this._getIdKeyName(),o=this.priceCategory;e&&(o="normal");var i=r[t][o];return i?i:void 0},a.init=function(r,e){if(!window.store)return ionic.Platform.isAndroid()||ionic.Platform.isIOS()?!1:(this.products=r,!0);this.priceCategory=e;var t=this;return r.forEach(function(r){t.__storeRegister(r),r.displayName=t.__getTranslatedName(r)}),store.refresh(),this.products=r,!0},a.__getTranslatedName=function(e){return languageKey=r.appData.language,e.name.hasOwnProperty(languageKey)||(languageKey="en"),e.name[languageKey]},a.__storeRegister=function(r){var e=this._getIdKeyName();for(key in r[e]){var t=r[e][key];if(t){for(var o=store.products.length,i=!1,n=0;o>n;n++)store.products[n].id==t&&(i=!0);i||store.register({id:t,alias:t,type:store.CONSUMABLE})}}return!0},a.__updateProduct=function(r){var e=this;this.products.forEach(function(t){var o=e._getStoreProductId(t);o==r.id&&i(function(){t.storeProduct=r})})},a.resolvedProducts=function(){if(ionic.Platform.isAndroid()||ionic.Platform.isIOS()){var r=this;this.products.forEach(function(e){var t=r._getStoreProductId(e);if(!t)return void r.__updateProduct({id:t,price:0});var o=store.get(t);r.__updateProduct(o),store.when(o.id).loaded(function(e){r.__updateProduct(e)})})}},a.buyProduct=function(r){var e=n.defer(),t=this._getStoreProductId(r),i=this._getStoreProductId(r,!0),a="normal";return"normal"!=this.priceCategory&&void 0!=i&&(a=this.priceCategory),!t&&0==r.price||"free"==this.priceCategory?(e.resolve(a),e.promise):window.store?t?(store.order(t),store.when(t).approved(function(r){r.finish(),e.resolve(a,r)}).cancelled(function(r){r.finish(),o(["PARTY_CREATE.BUY_ERROR_CANCELLED"]).then(function(r){e.reject(r["PARTY_CREATE.BUY_ERROR_CANCELLED"])})}).error(function(r){r.finish(),o(["PARTY_CREATE.BUY_ERROR_PROCESSING"]).then(function(r){e.reject(r["PARTY_CREATE.BUY_ERROR_PROCESSING"])})}),e.promise):(o(["PARTY_CREATE.BUY_ERROR_NO_ID"]).then(function(r){e.reject(r["PARTY_CREATE.BUY_ERROR_NO_ID"])}),e.promise):(o(["PARTY_CREATE.BUY_ERROR_STORE_NOT_AVAILABLE"]).then(function(r){e.reject(r["PARTY_CREATE.BUY_ERROR_STORE_NOT_AVAILABLE"])}),e.promise)},a}]);
angular.module("app.services").factory("PictureService",["CacheService","GuestService","Party","$q",function(e,r,t,n){var i=angular.copy(e);return i.__dataName="Pictures",i.__syncMode="full",i.sync=function(e){return this.__sync(this,e)},i["delete"]=function(e){return this.__delete(this,e)},i.__getServerData=function(){var r=n.defer();return t.pictures({id:this.__getCurrentParty()},function(t,n){var i=e.arrayToObject(t,"id");r.resolve(i)},function(e){r.reject(e)}),r.promise},i.__deleteObject=function(e){var r=n.defer();return t.cascadingDeletePicture({id:this.__getCurrentParty(),fk:e.id},function(e,t){r.resolve(e)},function(e){r.reject(e)}),r.promise},i.prepareDisplay=function(e){if(e.hasOwnProperty("id"))return e.owner=i.getOwner(e),e;var r,t=[];for(var n in e)r=e[n],r.owner=i.getOwner(r),t.push(r);return t},i.getOwner=function(e){return r.getData(e.ownerId)},i.getDataUser=function(e){var r=this.getData(),t=[];return angular.forEach(r,function(r,n){r.ownerId==e&&t.push(r)}),t},i}]);
angular.module("app.services").factory("PostponedActionsService",["$rootScope","$localstorage",function(t,n){var e={};return e.__getKeyName=function(t){return"postponedActions_"+t},e.addAction=function(t,e,o){for(var r=this.getActions(t),a=r.length,i=0;a>i;i++){var c=r[i];if(c.action==e&&c.data==o)return}var c={action:e,data:o};r.push(c);var s=this.__getKeyName(t);n.setArray(s,r)},e.getActions=function(t){var e=this.__getKeyName(t);return n.getArray(e)},e.runActions=function(t){for(var e=this.getActions(t),o=e.length,r=0;o>r;r++){var a=e[r];this.__runAction(a.action,a.data)}var i=this.__getKeyName(t);n.setArray(i,[])},e.__runAction=function(n,e){t.appGenericMethods.hasOwnProperty(n)&&t.appGenericMethods[n](e)},t.$on("loginSuccess",function(t,n){e.runActions("loginSuccess")}),e}]);
angular.module("app.services").factory("ViewBackgroundImageService",["$rootScope","$translate","BackgroundImage","PartySettingsService","SERVER_DOMAIN","$q",function(e,n,t,r,a,o){var c={};return c.backgrounds=[],c.getBackgrounds=function(){var r=o.defer();return t.find({active:!0},function(n,t){c.backgrounds=e.appGenericMethods.cleanupResponse(n),r.resolve(n)},function(e){n(["GENERIC.NO_INTERNET_CONNECTION"]).then(function(e){r.reject(e["GENERIC.NO_INTERNET_CONNECTION"])}),$state.go("tab.party-admin")}),r.promise},c.getImageUrl=function(e,n){var t="";return t="small"==n?"thumb_small_":"medium"==n?"thumb_medium_":"",a+"/images/backgrounds/"+t+e.filename},c.changeViewBackgroundImage=function(e){var n=o.defer(),t=r.get();return t.then(function(r){c.setViewBackgroundImage(r,e);t.then(function(e){n.resolve(e)},function(e){n.reject(e)})},function(e){n.reject(e)}),n.promise},c.setViewBackgroundImage=function(t,a){var c=o.defer();t.background={value:"image"},t.backgroundImage=a;var i=r.set(t);return i.then(function(t){n(["PARTY_ADMIN.BACKGROUND_CHANGE_SUCCESS"]).then(function(n){e.appGenericMethods.displayToast(n["PARTY_ADMIN.BACKGROUND_CHANGE_SUCCESS"])}),c.resolve(t)},function(t){n(["PARTY_ADMIN.BACKGROUND_CHANGE_ERROR"]).then(function(n){e.appGenericMethods.displayToast(n["PARTY_ADMIN.BACKGROUND_CHANGE_ERROR"]),c.reject(n["PARTY_ADMIN.BACKGROUND_CHANGE_ERROR"])})}),c.promise},c}]);
angular.module("app.services").factory("cordovaWrapper",["$ionicPlatform","$cordovaNetwork","$cordovaGlobalization","$cordovaAppAvailability","$cordovaGoogleAnalytics","$ionicLoading","$cordovaSpinnerDialog","$q",function(o,n,i,r,a,e,t,c){var d={};return d.__cordovaCheck=function(n,i,r){if(window.cordova){var a=r;return o.ready(function(){a=n()}),a}return i},d.getGoogleAnalytics=function(){var o={};return o.debugMode=function(){},o.startTrackerWithId=function(){},o.setUserId=function(){},o.trackView=function(){},o.addCustomDimension=function(){},o.trackEvent=function(){},o.addTransaction=function(){},o.addTransactionItem=function(){},window.cordova?a:o},d.getNetwork=function(){return d.__cordovaCheck(n.getNetwork,"wifi","wifi")},d.isOnline=function(){return d.__cordovaCheck(n.isOnline,!0,!1)},d.getPreferredLanguage=function(){var o=function(){var o=c.defer();return o.resolve({value:"en-US"}),o.promise};return window.cordova?i.getPreferredLanguage():o()},d.__appAvailability=function(o){var n=function(){var o=c.defer();return o.resolve(!0),o.promise};return window.cordova?r.check(o):n()},d.facebookAvailable=function(){if(!window.cordova){var o=c.defer();return o.reject(!1),o.promise}return ionic.Platform.isAndroid()?d.__appAvailability("com.facebook.katana"):ionic.Platform.isIOS()?d.__appAvailability("fb://"):void 0},d.displayToast=function(o,n,i){window.cordova&&(n||(n="long"),i||(i="center"),window.plugins.toast.show(o,n,i,function(o){},function(o){}))},d.showSpinnerDialog=function(){window.cordova?t.show(null,null,!0):e.show({template:"Loading..."})},d.hideSpinnerDialog=function(){window.cordova?t.hide():e.hide()},d}]);
!function(e,r,t){"use strict";var s="https://partypics.co/rest",o="authorization",u=r.module("lbServices",["ngResource"]);u.factory("User",["LoopBackResource","LoopBackAuth","$injector",function(e,r,t){var o=e(s+"/users/:id",{id:"@id"},{login:{params:{include:"user"},interceptor:{response:function(e){var t=e.data;return r.setUser(t.id,t.userId,t.user),r.rememberMe=e.config.params.rememberMe!==!1,r.save(),e.resource}},url:s+"/users/login",method:"POST"},logout:{interceptor:{response:function(e){return r.clearUser(),r.clearStorage(),e.resource}},url:s+"/users/logout",method:"POST"},confirm:{url:s+"/users/confirm",method:"GET"},resetPassword:{url:s+"/users/reset",method:"POST"},prototype$__unlink__parties:{url:s+"/users/:id/parties/rel/:fk",method:"DELETE"},prototype$__get__identities:{isArray:!0,url:s+"/users/:id/identities",method:"GET"},prototype$__get__parties:{isArray:!0,url:s+"/users/:id/parties",method:"GET"},findById:{url:s+"/users/:id",method:"GET"},getCurrent:{url:s+"/users/:id",method:"GET",params:{id:function(){var e=r.currentUserId;return null==e&&(e="__anonymous__"),e}},interceptor:{response:function(e){return r.currentUserData=e.data,e.resource}},__isGetCurrentUser__:!0}});return o.getCachedCurrent=function(){var e=r.currentUserData;return e?new o(e):null},o.isAuthenticated=function(){return null!=this.getCurrentId()},o.getCurrentId=function(){return r.currentUserId},o.modelName="User",o.parties=function(){var e=t.get("Party"),r=e["::get::user::parties"];return r.apply(o,arguments)},o.parties.unlink=function(){var e=t.get("Party"),r=e["::unlink::user::parties"];return r.apply(o,arguments)},o.identities=function(){var e=t.get("UserIdentity"),r=e["::get::user::identities"];return r.apply(o,arguments)},o}]),u.factory("UserIdentity",["LoopBackResource","LoopBackAuth","$injector",function(e,r,t){var o=e(s+"/userIdentities/:id",{id:"@id"},{mobileLogin:{url:s+"/userIdentities/mobileLogin",method:"POST"},mobileLoginGoogle:{url:s+"/userIdentities/mobileLoginGoogle",method:"POST"},"::get::user::identities":{isArray:!0,url:s+"/users/:id/identities",method:"GET"}});return o.modelName="UserIdentity",o}]),u.factory("Party",["LoopBackResource","LoopBackAuth","$injector",function(e,r,t){var o=e(s+"/Parties/:id",{id:"@id"},{prototype$__get__pictures:{isArray:!0,url:s+"/Parties/:id/pictures",method:"GET"},create:{url:s+"/Parties",method:"POST"},resetDemo:{url:s+"/Parties/resetDemo",method:"POST"},upload:{url:s+"/Parties/:id/pictures/upload",method:"POST"},guestOf:{url:s+"/Parties/user/guest_of",method:"GET"},guestOfOld:{url:s+"/Parties/user/:id/guest_of",method:"GET"},partiesOwned:{url:s+"/Parties/user/parties_owned",method:"GET"},join:{url:s+"/Parties/:id/join",method:"POST"},blockGuest:{url:s+"/Parties/:id/block/:fk",method:"POST"},guestss:{url:s+"/Parties/:id/guestss",method:"GET"},qrcode:{url:s+"/Parties/:id/qrcode/:fk",method:"GET"},setSettings:{url:s+"/Parties/:id/settings",method:"POST"},getSettings:{url:s+"/Parties/:id/settings",method:"GET"},picturesFull:{url:s+"/Parties/:id/picturesFull",method:"GET"},cascadingDeleteParty:{url:s+"/Parties/:id/cascadingDelete",method:"GET"},cascadingDeletePicture:{url:s+"/Parties/:id/pictures/:fk/cascadingDelete",method:"DELETE"},overview:{url:s+"/Parties/overview",method:"GET"},upgrade:{url:s+"/Parties/:id/upgrade",method:"GET"},"::unlink::user::parties":{url:s+"/users/:id/parties/rel/:fk",method:"DELETE"},"::get::user::parties":{isArray:!0,url:s+"/users/:id/parties",method:"GET"}});return o.modelName="Party",o.pictures=function(){var e=t.get("Picture"),r=e["::get::Party::pictures"];return r.apply(o,arguments)},o}]),u.factory("Picture",["LoopBackResource","LoopBackAuth","$injector",function(e,r,t){var o=e(s+"/Pictures/:id",{id:"@id"},{"::get::Party::pictures":{isArray:!0,url:s+"/Parties/:id/pictures",method:"GET"}});return o.modelName="Picture",o}]),u.factory("Plan",["LoopBackResource","LoopBackAuth","$injector",function(e,r,t){var o=e(s+"/Plans/:id",{id:"@id"},{find:{isArray:!0,url:s+"/Plans",method:"GET"}});return o.modelName="Plan",o}]),u.factory("BackgroundImage",["LoopBackResource","LoopBackAuth","$injector",function(e,r,t){var o=e(s+"/BackgroundImages/:id",{id:"@id"},{find:{isArray:!0,url:s+"/BackgroundImages",method:"GET"}});return o.modelName="BackgroundImage",o}]),u.factory("UserReduced",["LoopBackResource","LoopBackAuth","$injector",function(e,r,t){var o=e(s+"/UsersReduced/:id",{id:"@id"},{prototype$__get__partner:{url:s+"/UsersReduced/:id/partner",method:"GET"},add:{url:s+"/UsersReduced/add",method:"GET"},addViaPartner:{url:s+"/UsersReduced/addViaPartner",method:"GET"},check:{url:s+"/UsersReduced/check",method:"GET"},use:{url:s+"/UsersReduced/use",method:"POST"}});return o.modelName="UserReduced",o.partner=function(){var e=t.get("Partner"),r=e["::get::UserReduced::partner"];return r.apply(o,arguments)},o}]),u.factory("Partner",["LoopBackResource","LoopBackAuth","$injector",function(e,r,t){var o=e(s+"/Partners/:id",{id:"@id"},{getCampaign:{url:s+"/Partners/:id/getCampaign/:fk",method:"GET"},"::get::UserReduced::partner":{url:s+"/UsersReduced/:id/partner",method:"GET"}});return o.modelName="Partner",o}]),u.factory("LoopBackAuth",function(){function e(){var e=this;o.forEach(function(r){e[r]=s(r)}),this.rememberMe=t,this.currentUserData=null}function r(e,r,t){var s=u+r;null==t&&(t=""),e[s]=t}function s(e){var r=u+e;return localStorage[r]||sessionStorage[r]||null}var o=["accessTokenId","currentUserId"],u="$LoopBack$";return e.prototype.save=function(){var e=this,t=this.rememberMe?localStorage:sessionStorage;o.forEach(function(s){r(t,s,e[s])})},e.prototype.setUser=function(e,r,t){this.accessTokenId=e,this.currentUserId=r,this.currentUserData=t},e.prototype.clearUser=function(){this.accessTokenId=null,this.currentUserId=null,this.currentUserData=null},e.prototype.clearStorage=function(){o.forEach(function(e){r(sessionStorage,e,null),r(localStorage,e,null)})},new e}).config(["$httpProvider",function(e){e.interceptors.push("LoopBackAuthRequestInterceptor")}]).factory("LoopBackAuthRequestInterceptor",["$q","LoopBackAuth",function(e,r){return{request:function(u){if(u.url.substr(0,s.length)!==s)return u;if(r.accessTokenId)u.headers[o]=r.accessTokenId;else if(u.__isGetCurrentUser__){var i={body:{error:{status:401}},status:401,config:u,headers:function(){return t}};return e.reject(i)}return u||e.when(u)}}}]).provider("LoopBackResource",function(){this.setAuthHeader=function(e){o=e},this.setUrlBase=function(e){s=e},this.$get=["$resource",function(e){return function(r,t,s){var o=e(r,t,s);return o.prototype.$save=function(e,r){var t=o.upsert.call(this,{},this,e,r);return t.$promise||t},o}}]})}(window,window.angular);
angular.module("app.services").factory("$localstorage",["$window",function(t){return{set:function(r,e){t.localStorage[r]=e},get:function(r,e){return t.localStorage[r]||e},setObject:function(r,e){t.localStorage[r]=JSON.stringify(e)},getObject:function(r){return JSON.parse(t.localStorage[r]||"{}")},setArray:function(r,e){t.localStorage[r]=JSON.stringify(e)},getArray:function(r){return JSON.parse(t.localStorage[r]||"[]")}}}]);
angular.module("app.controllers").controller("GuestsCtrl",["$scope","GuestService","User","$ionicListDelegate","$translate","SERVER_DOMAIN",function(e,t,n,o,r,i){e.server_domain=i,e.User=n,e.guests=[],e.first_entry={text:"",icon:"ion-loading-d"},e.doRefresh=function(){r(["GUESTS.REFRESH_ERROR_OFFLINE","GENERIC.CURRENTLY_OFFLINE"]).then(function(t){return e.appGenericMethods.isOnline()?void e.getGuests():(e.appGenericMethods.displayToast(ranslations["GENERIC.CURRENTLY_OFFLINE"]+" "+t["GUESTS.REFRESH_ERROR_OFFLINE"]),void e.$broadcast("scroll.refreshComplete"))})},e.init=function(){r(["GENERIC.DATA_WAITING"]).then(function(t){e.first_entry.text=t["GENERIC.DATA_WAITING"]}),o.closeOptionButtons(),e.getGuests()},e.openFacebookAccount=function(t){r(["GUESTS.OPEN_PROFILE_ERROR_OFFLINE","GENERIC.CURRENTLY_OFFLINE"]).then(function(n){return e.appGenericMethods.isOnline()?void window.open(t.profileUrl,"location=no"):void e.appGenericMethods.displayToast(n["GENERIC.CURRENTLY_OFFLINE"]+" "+n["GUESTS.OPEN_PROFILE_ERROR_OFFLINE"])})},e.getGuests=function(){r(["GENERIC.DATA_ERROR","GENERIC.DATA_OFFLINE","GENERIC.DATA_NO_PARTY","GUESTS.DATA_NO_GUESTS"]).then(function(n){var o=t.getData();e.guests=t.objectToArray(o);var r=Object.keys(o);if(delete o,""==e.appData.activeParty.id)return e.$broadcast("scroll.refreshComplete"),e.first_entry.text=n["GENERIC.DATA_NO_PARTY"],void(e.first_entry.icon=void 0);if(!e.appGenericMethods.isOnline())return e.$broadcast("scroll.refreshComplete"),e.first_entry.text=n["GENERIC.DATA_OFFLINE"],void(e.first_entry.icon=void 0);var i=t.sync();i.then(function(o){e.$broadcast("scroll.refreshComplete");var i=Object.keys(o);angular.equals(r,i)||(e.guests=t.objectToArray(o)),e.first_entry.text=n["GUESTS.DATA_NO_GUESTS"],e.first_entry.icon=void 0},function(t){e.$broadcast("scroll.refreshComplete"),e.first_entry.text=n["GENERIC.DATA_ERROR"],e.first_entry.icon=void 0})})},e.blockUser=function(t){e.appGenericMethods.blockGuest(e,t)},e.$on("activePartyChanged",function(t,n){e.getGuests()}),e.$on("$ionicView.beforeEnter",function(t,n){e.init()}),e.init()}]);
angular.module("app.controllers").controller("LoginCtrl",["$scope","$rootScope","$location","$http","GoogleService","$cordovaOauth","FacebookService","PartyService","LoopBackAuth","$state","cordovaWrapper","User","SERVER_DOMAIN","$q",function(o,e,t,n,a,i,c,r,g,l,s,p,d,u){o.__login=function(t){s.getGoogleAnalytics().trackEvent("login",t,"start"),s.showSpinnerDialog();var n;n="google"==t?a.login():c.login(),n.then(function(n){g.currentUserId=n.user.id,g.accessTokenId=n.accessToken.id,g.rememberMe=!0,g.save(),s.hideSpinnerDialog(),e.appData.activeParty=r.getActive(),o.syncAndSetParties(),l.go("tab.party"),s.getGoogleAnalytics().trackEvent("login",t,"success"),e.$broadcast("loginSuccess"),s.getGoogleAnalytics().setUserId(p.getCurrentId())},function(e){s.hideSpinnerDialog(),o.appGenericMethods.displayToast(e),s.getGoogleAnalytics().trackEvent("login",t,"fail",1)})},o.facebookLogin=function(){o.__login("facebook")},o.googleLogin=function(){o.__login("google")}}]);
angular.module("app.controllers").controller("PartyAdminBgSelectCtrl",["$scope","ViewBackgroundImageService","PartySettingsService","$translate","$q",function(e,n,a,t,c){e.ViewBackgroundImageService=n,e.currentBackground=void 0,e.init=function(){e.appGenericMethods.adminPageCheck();var n=e.ViewBackgroundImageService.getBackgrounds();n.then(function(e){},function(n){e.appGenericMethods.displayToast(n),$state.go("tab.party-admin")});var c=a.get();c.then(function(n){e.currentBackground=n.backgroundImage.id},function(n){t(["PARTY_ADMIN.LOAD_SETTINGS_ERROR"]).then(function(n){e.appGenericMethods.displayToast(n["PARTY_ADMIN.LOAD_SETTINGS_ERROR"])}),$state.go("tab.party")})},e.changeViewBackgroundImage=function(a){var t=n.changeViewBackgroundImage(a);t.then(function(n){e.currentBackground=n.backgroundImage.id})},e.$on("activePartyChanged",function(n,a){e.appGenericMethods.adminPageCheck()}),e.init()}]);
angular.module("app.controllers").controller("PartyAdminCtrl",["$scope","$ionicPopup","PartyService","Party","Plan","UserReduced","PaymentService","$state","$translate","GuestService","PictureService","PartySettingsService","ViewBackgroundImageService","cordovaWrapper","$ionicModal","$q",function(e,t,a,n,i,r,E,o,c,s,R,l,p,d,_,A){e.currentPlan={},e.plans=[],e.dbPlans=[],e.upgradePossible=!1,e.usedPriceCategory="normal",e.ViewBackgroundImageService=p,e.displayMode=[{name:"",key:"PARTY_ADMIN.DISPLAY_MODE_LATEST",value:"latest"},{name:"",key:"PARTY_ADMIN.DISPLAY_MODE_REPEAT",value:"repeat"},{name:"",key:"PARTY_ADMIN.DISPLAY_MODE_SELECTED",value:"selectedImage"}],e.background=[{name:"",key:"PARTY_ADMIN.BACKGROUND_TYPE_COLOR",value:"color"},{name:"",key:"PARTY_ADMIN.BACKGROUND_TYPE_IMAGE",value:"image"}],e.backgroundColor=[{name:"",key:"GENERIC.BLACK",value:"#000000"},{name:"",key:"GENERIC.WHITE",value:"#FFFFFF"},{name:"",key:"GENERIC.RED",value:"#FF0000"},{name:"",key:"GENERIC.GREEN",value:"#00FF00"},{name:"",key:"GENERIC.BLUE",value:"#0000FF"}],e.positionRecentImages=[{name:"",key:"GENERIC.TOP",value:"top"},{name:"",key:"GENERIC.BOTTOM",value:"bottom"}],e.partySettings={displayMode:{value:"latest"},displayTime:5,background:{value:"image"},backgroundColor:{value:"#000000"},backgroundImage:{filename:"dance-club-254520.jpg"},displayRecentImages:!1,positionRecentImages:{value:"bottom"},numRecentImages:5,sizeRecentImages:100},e.__preSelectField=function(t){for(var a=0;a<e[t].length;a++)if(e[t][a].value==e.partySettings[t].value){e.partySettings[t]=e[t][a];break}},e._translateSettings=function(e,t){for(var a in e){var n=e[a];n.name=t[n.key]}},e.init=function(){d.showSpinnerDialog(),c(["PARTY_ADMIN.BACKGROUND_TYPE_COLOR","PARTY_ADMIN.BACKGROUND_TYPE_IMAGE","PARTY_ADMIN.DISPLAY_MODE_LATEST","PARTY_ADMIN.DISPLAY_MODE_REPEAT","PARTY_ADMIN.DISPLAY_MODE_SELECTED","GENERIC.BLACK","GENERIC.BLUE","GENERIC.BOTTOM","GENERIC.GREEN","GENERIC.PLAN_UNLIMITED","GENERIC.RED","GENERIC.TOP","GENERIC.WHITE"]).then(function(t){e._translateSettings(e.displayMode,t),e._translateSettings(e.background,t),e._translateSettings(e.backgroundColor,t),e._translateSettings(e.positionRecentImages,t),e.appGenericMethods.adminPageCheck();var a=l.get();a.then(function(a){angular.extend(e.partySettings,a),e.__preSelectField("displayMode"),e.__preSelectField("positionRecentImages"),e.__preSelectField("background"),e.__preSelectField("backgroundColor"),i.find({filter:{where:{active:!0}}},function(a,n){e.dbPlans=e.appGenericMethods.cleanupResponse(a);for(var i=a.length,r=0;i>r;r++){var E=a[r];E.guests_text=E.guests,-1==E.guests&&(E.guests_text=t["GENERIC.PLAN_UNLIMITED"]),E.pictures_text=E.pictures,-1==E.pictures&&(E.pictures_text=t["GENERIC.PLAN_UNLIMITED"]),E.id==e.partySettings.info.planId&&(e.currentPlan=E)}for(var r=0;i>r;r++){var E=a[r];E.id!=e.currentPlan.id&&(E.guests>e.currentPlan.guests||-1==E.guests)&&(e.upgradePossible=!0)}d.hideSpinnerDialog()},function(a){d.hideSpinnerDialog(),e.appGenericMethods.displayToast(t["GENERIC.NO_INTERNET_CONNECTION"]),o.go("tab.party")})},function(a){d.hideSpinnerDialog(),e.appGenericMethods.displayToast(t["GENERIC.NO_INTERNET_CONNECTION"]),o.go("tab.party")})})},e.deleteParty=function(){c(["PARTY_ADMIN.DELETE_PARTY_ERROR","PARTY_ADMIN.DELETE_PARTY_ERROR_OFFLINE","PARTY_ADMIN.DELETE_PARTY_SUCCESS","PARTY_ADMIN.DELETE_PARTY_TEXT","PARTY_ADMIN.DELETE_PARTY_TITLE","GENERIC.CANCEL","GENERIC.CURRENTLY_OFFLINE"]).then(function(n){if(d.getGoogleAnalytics().trackEvent("tab.party-admin","deleteParty","start"),!e.appGenericMethods.isOnline())return e.appGenericMethods.displayToast(n["GENERIC.CURRENTLY_OFFLINE"]+" "+n["PARTY_ADMIN.DELETE_PARTY_ERROR_OFFLINE"]),void d.getGoogleAnalytics().trackEvent("tab.party-admin","deleteParty","fail",1);var i=t.confirm({title:n["PARTY_ADMIN.DELETE_PARTY_TITLE"],template:n["PARTY_ADMIN.DELETE_PARTY_TEXT"],cancelText:n["GENERIC.CANCEL"]});i.then(function(t){if(!t)return void d.getGoogleAnalytics().trackEvent("tab.party","deleteParty","cancel");var i=a["delete"](e.appData.activeParty);i.then(function(t){d.getGoogleAnalytics().trackEvent("tab.party-admin","deleteParty","success"),o.go("tab.party"),a.setActive(a.emptyParty),e.updateUserParties().then(function(e){a.setFirstActive()}),e.appGenericMethods.displayToast(n["PARTY_ADMIN.DELETE_PARTY_SUCCESS"])},function(t){e.appGenericMethods.displayToast(n["PARTY_ADMIN.DELETE_PARTY_ERROR"]),d.getGoogleAnalytics().trackEvent("tab.party-admin","deleteParty","fail",2)})})})},e.updateParty=function(){c(["PARTY_ADMIN.UPDATE_PARTY_ERROR","PARTY_ADMIN.UPDATE_PARTY_ERROR_OFFLINE","PARTY_ADMIN.UPDATE_PARTY_SUCCESS","GENERIC.CURRENTLY_OFFLINE"]).then(function(t){if(d.getGoogleAnalytics().trackEvent("tab.party-admin","changeParty","start"),!e.appGenericMethods.isOnline())return e.appGenericMethods.displayToast(t["GENERIC.CURRENTLY_OFFLINE"]+" "+t["PARTY_ADMIN.UPDATE_PARTY_ERROR_OFFLINE"]),void d.getGoogleAnalytics().trackEvent("tab.party-admin","changeParty","fail",1);var a=l.set(e.partySettings);a.then(function(a){e.appGenericMethods.displayToast(t["PARTY_ADMIN.UPDATE_PARTY_SUCCESS"]),d.getGoogleAnalytics().trackEvent("tab.party-admin","changeParty","success")},function(a){e.appGenericMethods.displayToast(t["PARTY_ADMIN.UPDATE_PARTY_ERROR"]),d.getGoogleAnalytics().trackEvent("tab.party-admin","changeParty","fail",2)})})},e.upgradeParty=function(){d.showSpinnerDialog(),c(["GENERIC.NO_INTERNET_CONNECTION","PARTY_ADMIN.UPGRADE_NOT_POSSIBLE"]).then(function(t){r.check({},function(a,n){E.init(e.dbPlans,a.category),E.resolvedProducts(),e.plans=E.products,d.hideSpinnerDialog(),e.upgradePossible||e.appGenericMethods.displayToast(t["PARTY_ADMIN.UPGRADE_NOT_POSSIBLE"]),e.modal.show()},function(a){d.hideSpinnerDialog(),e.appGenericMethods.displayToast(t["GENERIC.NO_INTERNET_CONNECTION"]),o.go("tab.party")})})},_.fromTemplateUrl("upgrade-modal.html",{scope:e,animation:"slide-in-up"}).then(function(t){e.modal=t}),e.closeUpgradeModal=function(){e.modal.hide()},e.$on("$destroy",function(){e.modal.remove()}),e.upgradeToPlan=function(t){d.getGoogleAnalytics().trackEvent("tab.party-admin","upgradeParty","start"),c(["GENERIC.CURRENTLY_OFFLINE","GENERIC.THERE_WAS_A_PROBLEM","PARTY_ADMIN.UPGRADE_PARTY_ERROR_OFFLINE"]).then(function(a){return e.appGenericMethods.isOnline()?void E.buyProduct(t).then(function(a,i){e.usedPriceCategory=a,n.upgrade({id:e.appData.activeParty.id,planId:t.id,order:i},e.partyUpgradeSuccess,e.partyUpgradeError)},function(t){d.getGoogleAnalytics().trackEvent("tab.party-admin","upgradeParty",t),e.appGenericMethods.displayToast(a["GENERIC.THERE_WAS_A_PROBLEM"]+" "+t)}):(e.appGenericMethods.displayToast(a["GENERIC.CURRENTLY_OFFLINE"]+" "+a["PARTY_ADMIN.UPGRADE_PARTY_ERROR_OFFLINE"]),void d.getGoogleAnalytics().trackEvent("tab.party-admin","upgradeParty","fail",1))})},e.partyUpgradeSuccess=function(t,a){"normal"!=e.usedPriceCategory&&r.use({partyId:t.id},function(){},function(e){}),c(["PARTY_ADMIN.UPGRADE_PARTY_SUCCESS"]).then(function(t){e.appGenericMethods.displayToast(t["PARTY_ADMIN.UPGRADE_PARTY_SUCCESS"])}),d.getGoogleAnalytics().trackEvent("tab.party-admin","upgradeParty","success")},e.partyUpgradeError=function(t){c(["PARTY_ADMIN.UPGRADE_PARTY_ERROR"]).then(function(t){e.appGenericMethods.displayToast(t["PARTY_ADMIN.UPGRADE_PARTY_ERROR"])}),d.getGoogleAnalytics().trackEvent("tab.party-admin","upgradeParty","fail",2)},e.selectBgImage=function(){o.go("tab.party-admin-bg-select")},e.$on("$ionicView.beforeEnter",function(t,a){e.init()}),e.$on("activePartyChanged",function(t,a){e.appGenericMethods.adminPageCheck()})}]);
angular.module("app.controllers").controller("PartyCtrl",["$ionicPlatform","$scope","$cordovaBarcodeScanner","PartyService","$state","$translate","Party","User","cordovaWrapper","$localstorage","$ionicPopup","cordovaWrapper","$q",function(t,e,a,n,i,r,E,o,R,c,A,R,P){e.User=o,e.networkType="",e.isOnline=!0,e.fullAccount={},e.init=function(){t.ready(function(){e.networkType=R.getNetwork(),e.isOnline=R.isOnline()})},e.init(),e.createParty=function(){i.go("tab.party-new")},e.leaveParty=function(){r(["PARTIES.LEAVE_PARTY_ERROR_OFFLINE","PARTIES.LEAVE_PARTY_TEXT","PARTIES.LEAVE_PARTY_TITLE","PARTIES.LEAVE_PARTY_SUCCESS","GENERIC.CANCEL","GENERIC.CURRENTLY_OFFLINE"]).then(function(t){if(R.getGoogleAnalytics().trackEvent("tab.party","leaveParty","start"),!e.appGenericMethods.isOnline())return e.appGenericMethods.displayToast(t["GENERIC.CURRENTLY_OFFLINE"]+" "+t["PARTIES.LEAVE_PARTY_ERROR_OFFLINE"]),void R.getGoogleAnalytics().trackEvent("tab.party","leaveParty","fail",1);var a=A.confirm({title:t["PARTIES.LEAVE_PARTY_TITLE"],template:t["PARTIES.LEAVE_PARTY_TEXT"],cancelText:t["GENERIC.CANCEL"]});a.then(function(a){return a?void o.parties.unlink({id:o.getCurrentId(),fk:e.appData.activeParty.id},function(a,i){n.setActive(n.emptyParty),e.updateUserParties().then(function(t){n.setFirstActive()}),e.appGenericMethods.displayToast(t["PARTIES.LEAVE_PARTY_SUCCESS"]),R.getGoogleAnalytics().trackEvent("tab.party","leaveParty","success")},function(t){R.getGoogleAnalytics().trackEvent("tab.party","leaveParty","fail",2)}):void R.getGoogleAnalytics().trackEvent("tab.party","leaveParty","fail",3)})})},e.partyAdmin=function(){r(["PARTY_ADMIN.UPDATE_PARTY_ERROR_OFFLINE","GENERIC.CURRENTLY_OFFLINE"]).then(function(t){return e.appGenericMethods.isOnline()?void i.go("tab.party-admin"):void e.appGenericMethods.displayToast(t["GENERIC.CURRENTLY_OFFLINE"]+" "+t["PARTY_ADMIN.UPDATE_PARTY_ERROR_OFFLINE"])})},e.scanCode=function(){r(["APP.JOIN_PARTY_ERROR","APP.JOIN_PARTY_ERROR_NOT_VALID","APP.JOIN_PARTY_ERROR_OFFLINE","APP.JOIN_PARTY_ERROR_SCAN","APP.JOIN_PARTY_SUCCESS","GENERIC.CURRENTLY_OFFLINE"]).then(function(n){if(!e.appGenericMethods.isOnline())return void e.appGenericMethods.displayToast(n["GENERIC.CURRENTLY_OFFLINE"]+" "+n["APP.JOIN_PARTY_ERROR_OFFLINE"]);e.updateUserParties();var i=t.registerBackButtonAction(function(){},100);e.$on("$destroy",i),a.scan().then(function(t){if(!t.cancelled){var a=t.text;e.appGenericMethods.qrJoinParty(a)}},function(t){e.appGenericMethods.displayToast(n["APP.JOIN_PARTY_ERROR_SCAN"]),R.getGoogleAnalytics().trackEvent("tab.party","joinParty","fail",3)})})}}]);
angular.module("app.controllers").controller("PartyNewCtrl",["$scope","$rootScope","PartyService","$state","$translate","cordovaWrapper","PaymentService","Party","Plan","User","UserReduced","$timeout","$q",function(e,t,a,r,n,i,o,c,s,E,p,l,R){e.party={ownerId:E.getCurrentId()},e.errorMessages=[],e.plans=[],e.selected={plan:{}},e.usedPriceCategory="normal",e.init=function(){i.showSpinnerDialog(),n(["GENERIC.NO_INTERNET_CONNECTION"]).then(function(t){s.find({filter:{where:{active:!0}}},function(a,n){p.check({},function(t,r){var n=e.appGenericMethods.cleanupResponse(a);o.init(n,t.category),o.resolvedProducts(),e.plans=o.products,e.selected.plan=e.plans[0],i.hideSpinnerDialog()},function(a){i.hideSpinnerDialog(),e.appGenericMethods.displayToast(t["GENERIC.NO_INTERNET_CONNECTION"]),r.go("tab.party")})},function(a){i.hideSpinnerDialog(),e.appGenericMethods.displayToast(t["GENERIC.NO_INTERNET_CONNECTION"]),r.go("tab.party")})})},e.createParty=function(){i.showSpinnerDialog(),n(["GENERIC.CURRENTLY_OFFLINE","GENERIC.THERE_WAS_A_PROBLEM","PARTY_CREATE.CREATE_PARTY_ERROR_OFFLINE","PARTY_CREATE.CREATE_PARTY_MISSING_DATE","PARTY_CREATE.CREATE_PARTY_MISSING_NAME"]).then(function(t){if(i.getGoogleAnalytics().trackEvent("tab.party-new","createParty","start"),!e.appGenericMethods.isOnline())return e.appGenericMethods.displayToast(t["GENERIC.CURRENTLY_OFFLINE"]+" "+t["PARTY_CREATE.CREATE_PARTY_ERROR_OFFLINE"]),void i.hideSpinnerDialog();if(e.errorMessages.length=0,e.party.name||e.errorMessages.push(t["PARTY_CREATE.CREATE_PARTY_MISSING_NAME"]),e.party.date||(e.party.date=new Date),e.errorMessages.length)return i.getGoogleAnalytics().trackEvent("tab.party-new","createParty","fail",1),void i.hideSpinnerDialog();var a=angular.copy(e.party);a.planId=e.selected.plan.id,o.buyProduct(e.selected.plan).then(function(t,r){e.usedPriceCategory=t,c.create(a,e.partyCreateSuccess,e.partyCreateError)},function(a){i.getGoogleAnalytics().trackEvent("tab.party-new","createParty",a),e.appGenericMethods.displayToast(t["GENERIC.THERE_WAS_A_PROBLEM"]+" "+a),i.hideSpinnerDialog()})})},e.partyCreateSuccess=function(n,o){"normal"!=e.usedPriceCategory&&p.use({partyId:n.id},function(){},function(e){}),e.party.name="",e.party.date="",a.sync().then(function(){a.setActive(n),t.appData.allowSuccessPage=!0,r.go("tab.party-new-success"),i.hideSpinnerDialog()},function(){t.appData.allowSuccessPage=!0,r.go("tab.party-new-success"),i.hideSpinnerDialog()}),i.getGoogleAnalytics().trackEvent("tab.party-new","createParty","success")},e.partyCreateError=function(t){n(["PARTY_CREATE.CREATE_PARTY_ERROR"]).then(function(t){e.appGenericMethods.displayToast(t["PARTY_CREATE.CREATE_PARTY_ERROR"])}),i.getGoogleAnalytics().trackEvent("tab.party-new","createParty","fail",2),i.hideSpinnerDialog()},e.init()}]);
angular.module("app.controllers").controller("PartyNewSuccessCtrl",["$scope","$rootScope","PartyService","$state","$q",function(e,o,t,a,n){e.qrCode="",e.init=function(){o.appData.allowSuccessPage?o.appData.allowSuccessPage=!1:a.go("tab.party"),t.getQrCode().then(function(o){e.qrCode=o})},e.$on("$ionicView.beforeEnter",function(o,t){e.init()})}]);
angular.module("app.controllers").controller("PicturesCtrl",["$scope","$timeout","$state","$ionicListDelegate","$stateParams","$http","PictureService","PartyService","User","GuestService","cordovaWrapper","$translate","$ionicActionSheet",function(e,t,i,r,n,s,o,a,c,u,E,p,l){e.User=c,e.deviceGrade=ionic.Platform.grade,e.guestName="unknown",e.first_entry={text:"",icon:"ion-loading-d"},e.pictures=[],e.junkSize=15,e.numberOfItemsToDisplay=30,e.doRefresh=function(){p(["PICTURES.REFRESH_ERROR_OFFLINE","GENERIC.CURRENTLY_OFFLINE"]).then(function(t){return e.appGenericMethods.isOnline()?void e.getPictures(!1):(e.appGenericMethods.displayToast(t["GENERIC.CURRENTLY_OFFLINE"]+" "+t["PICTURES.REFRESH_ERROR_OFFLINE"]),void e.$broadcast("scroll.refreshComplete"))})},e.init=function(){p(["GENERIC.DATA_WAITING"]).then(function(i){if(e.first_entry.text=i["GENERIC.DATA_WAITING"],r.closeOptionButtons(),e.getPictures(!1),n.userId){var s=u.getData(n.userId);void 0!=s&&t(function(){e.guestName=s.name},50)}})},e.deletePicture=function(t){e.appGenericMethods.deletePicture(e,t)},e.__setPictures=function(t){if(n.userId){var i=o.getDataUser(n.userId);e.pictures=o.prepareDisplay(i)}else{var r=t;if(void 0===r&&(r=o.getData()),e.pictures.length){var s=[],a=!1;for(var c in e.pictures){var u=e.pictures[c];s.push(u.id.toString()),u.owner||(a=!0)}var E=Object.keys(r);(!angular.equals(s,E)||a)&&(e.pictures=o.prepareDisplay(r))}else e.pictures=o.prepareDisplay(r)}},e.getPictures=function(t){p(["GENERIC.DATA_ERROR","GENERIC.DATA_OFFLINE","GENERIC.DATA_NO_PARTY","PICTURES.DATA_NO_PICTURES"]).then(function(i){if(void 0===t&&(t=!1),e.__setPictures(),!t){if(e.appData.activeParty&&""==e.appData.activeParty.id)return e.$broadcast("scroll.refreshComplete"),e.first_entry.text=i["GENERIC.DATA_NO_PARTY"],void(e.first_entry.icon=void 0);if(!e.appGenericMethods.isOnline())return e.$broadcast("scroll.refreshComplete"),e.first_entry.text=i["GENERIC.DATA_OFFLINE"],void(e.first_entry.icon=void 0);var r=u.sync(!1),n=o.sync(!1);r.then(function(t){n.then(function(t){e.__setPictures(t),e.$broadcast("scroll.refreshComplete"),e.first_entry.text=i["PICTURES.DATA_NO_PICTURES"],e.first_entry.icon=void 0},function(t){e.$broadcast("scroll.refreshComplete"),e.first_entry.text=i["GENERIC.DATA_ERROR"],e.first_entry.icon=void 0})})}})},e.moreDataCanBeLoaded=function(){return e.pictures.length>e.numberOfItemsToDisplay},e.loadMoreData=function(){e.$apply(function(){e.pictures.length>e.numberOfItemsToDisplay&&(e.numberOfItemsToDisplay+=e.junkSize),e.$broadcast("scroll.infiniteScrollComplete")})},e.savePicture=function(t){p(["PICTURES.DOWNLOAD_ERROR","PICTURES.DOWNLOAD_SUCCESS"]).then(function(e){});var i=function(t){e.appGenericMethods.displayToast(translations["PICTURES.DOWNLOAD_SUCCESS"],"short"),E.getGoogleAnalytics().trackEvent("tab.picture","savePicture","success")},r=function(t){e.appGenericMethods.displayToast(translations["PICTURES.DOWNLOAD_ERROR"],"short"),E.getGoogleAnalytics().trackEvent("tab.picture","savePicture","fail")};e.appGenericMethods.savePictureToPhone(t,i,r)},e.savePictureSheet=function(t){p(["GENERIC.CURRENTLY_OFFLINE","PICTURES.DOWNLOAD_ERROR_OFFLINE","PICTURES.DOWNLOAD_TITLE","PICTURES.DOWNLOAD_FULL_RESOLUTION","PICTURES.DOWNLOAD_MEDIUM_RESOLUTION","GENERIC.CANCEL"]).then(function(i){if(!e.appGenericMethods.isOnline())return void e.appGenericMethods.displayToast(i["GENERIC.CURRENTLY_OFFLINE"]+" "+i["PICTURES.DOWNLOAD_ERROR_OFFLINE"]);E.getGoogleAnalytics().trackEvent("tab.picture","savePicture","click");l.show({buttons:[{text:'<i class="icon ion-monitor"></i>&nbsp;&nbsp;'+i["PICTURES.DOWNLOAD_FULL_RESOLUTION"]},{text:'<i class="icon ion-iphone"></i>&nbsp;&nbsp;'+i["PICTURES.DOWNLOAD_MEDIUM_RESOLUTION"]}],titleText:i["PICTURES.DOWNLOAD_TITLE"],cancelText:i["GENERIC.CANCEL"],cancel:function(){},buttonClicked:function(i){var r=[e.appGenericMethods.getPictureUrl(t),e.appGenericMethods.getPictureUrl(t,"medium")];return E.getGoogleAnalytics().trackEvent("tab.picture","savePicture","start",i),e.savePicture(r[i]),!0}})})},e.$on("picturesChanged",function(t,i){e.getPictures(!1)}),e.$on("activePartyChanged",function(t,r){e.getPictures(!1),i.go("tab.pictures")}),e.init()}]);
!function(e){"use strict";var c=e.module("ngImgCache",[]);c.directive("ngCache",function(){return{restrict:"A",link:function(e,c,n){var i="img/picture_missing.svg";c.bind("error",function(e){c.attr("src",i)}),n.$observe("ngSrc",function(e){ImgCache.isCached(e,function(n,i){i?ImgCache.useCachedFile(c):ImgCache.cacheFile(e,function(){ImgCache.useCachedFile(c)})})})}}})}(angular);