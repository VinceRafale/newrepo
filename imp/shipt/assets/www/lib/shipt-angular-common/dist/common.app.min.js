"use strict";function ngTouchstart(){return{controller:["$scope","$element","$attrs",function(e,r,t){function n(t){var n=r.attr("ng-touchstart");e.$event=t,e.$apply(n)}r.bind("touchstart",n)}]}}function validated(e){return{restrict:"AEC",require:"^form",link:function(e,r,t,n){for(var o=r.find("*"),a=0;a<o.length;a++)!function(t){var o=t.attributes;if(void 0!=o.getNamedItem("ng-model")&&void 0!=o.getNamedItem("name")){var a=n[o.name.value];void 0!=a&&(angular.element(t).bind("blur",function(){e.$apply(function(){a.$blurred=!0})}),e.$watch(function(){return n.$submitted+"_"+a.$valid+"_"+a.$blurred},function(){if(console.log(arguments),a.$blurred||1==n.$submitted){var e=angular.element(t);e.hasClass("ng-invalid")?(r.removeClass("has-success"),r.addClass("has-error")):r.removeClass("has-error").addClass("has-success")}}))}}(o[a])}}}function onValidSubmit(e,r){return{require:"^form",restrict:"A",link:function(r,t,n,o){o.$submitted=!1;var a=e(n.onValidSubmit);t.on("submit",function(e){r.$apply(function(){t.addClass("ng-submitted"),o.$submitted=!0,o.$valid&&"function"==typeof a&&a(r,{$event:e})})})}}}function _classCallCheck(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}function ionSearchBar(e,r,t,n,o,a,i,s,u,c){return{restrict:"E",replace:!0,scope:{searchValue:"=searchValue",showCancelButton:"=showCancelButton",startTouchIntoSearchBar:"&",search:"=?filter",ngModel:"=ngModel",searchFunction:"&",instantSearch:"=instantSearch",filterSortOptions:"=filterSortOptions",hideScanButton:"=hideScanButton"},link:function(l,p,d){function f(){n.info("algolia instant search enabled"),l.$watch("searchValue",function(r){r?l.formSubmit(r):e.$broadcast(c.EVENTS.CLEAR_FILTER)})}l.hideScanButton===!0?l.showScanButton=!1:l.showScanButton=s.getFeatureToggle(u.BARCODE_SCAN_SEARCH),l.isAlgoliaFilterSortFeatureEnabled=s.getFeatureToggle(u.ALGOLIA_FILTER_SORT_ENABLED),l.isInstantSearchEnabled=s.getFeatureToggle(u.ALGOLIA_INSTANT_SEARCH_ENABLED),l.instantSearch&&l.isInstantSearchEnabled&&f(),l.placeholder=d.placeholder||"",l.search={value:"",focus:!1},d.class&&p.addClass(d.class);var m=p.find("input")[0],h=!1;l.scanClick=function(){try{i.track("search-barcode-scan-click");var e=t.defer();return h?(e.reject(),e.promise):(h=!0,cordova.plugins.barcodeScanner.scan(function(r){h=!1,r.cancelled?(i.track("search-barcode-scan-cancelled"),e.reject()):(i.track("search-barcode-scan-scanned",{upc:r.text}),l.searchValue=r.text,l.$apply(),setTimeout(function(){l.formSubmit()},500),e.resolve(r.text))},function(r){a.showAlert("Error",r),h=!1,e.reject()}),e.promise)}catch(e){h=!1,a.showAlert("Barcode Scanner Not Available",""),n.error(e)}},l.clearTextButtonClick=function(){r(function(){l.searchValue="",i.track("clearTextButtonClick"),e.$broadcast(c.EVENTS.CLEAR_FILTER)},100)},l.shouldShowClearText=function(){return!(!l.searchValue||""==l.searchValue)},l.formSubmit=function(r){l.isAlgoliaFilterSortFeatureEnabled&&l.filterSortOptions&&l.filterSortOptions.isFilterSortActive()?(e.$broadcast(c.EVENTS.CLEAR_FILTER,{refreshSearch:!0,searchTerm:r}),r&&""!==r&&(l.filterSortOptions.extras.AlgoliaFinder.searchTermText=r),l.filterSortOptions.updateFilterSortSearchResults()):l.searchFunction?l.searchFunction():l.$parent.searchSubmit()},l.startTouchSearchBar=function(){i.track("startTouchIntoSearchBar"),l.startTouchIntoSearchBar()},angular.element(m).bind("focus",function(){l.search.focus=1,p.addClass("search-bar-focused"),angular.element(document.querySelector(".has-search-bar")).addClass("search-bar-focused"),l.$digest()}),angular.element(m).bind("blur",function(e){try{l.search.focus=0,p.removeClass("search-bar-focused"),angular.element(document.querySelector(".has-search-bar")).removeClass("search-bar-focused"),o.close()}catch(e){}})},templateUrl:"templates/ionSearchBar.html"}}!function(){function e(e,r,t,n,o,a,i,s,u,c,l,p,d,f,m,h){function v(e){var r,t,n,o,a,i,s,u,c=1e-15;for(u=e,s=Math.floor(u),t=1,a=0,r=s,o=1;u-s>c*o*o;)u=1/(u-s),s=Math.floor(u),n=t,t=r,i=a,a=o,r=n+s*t,o=i+s*a;return r+"/"+o}function g(){return[{text:"Contact Me",value:"contact_me"},{text:"Use Best Judgment",value:"use_best_judgment"},{text:"Don't Substitute",value:"do_not_substitute"}]}function y(e){try{var r=g();return r.find(function(r){return r.value==e}).text}catch(e){return d.error(e),"n/a"}}function S(e){e=$.trim(e);var r=e.split(" "),t=r.length;t>1&&(r[t-1]=r[t-1].charAt(0)+".");var n=r.join(" ");return n}function _(){try{var e=i.getCustomerInfo();d.configUserLogInfo(e)}catch(e){o.error("Error configureRollBarUserInfo",e)}}function b(){return i.isAuthenticated()}function A(){var e=b();o.info("is auth: ",e),e||(u.track("loginModalStart"),P.show())}function E(){var r=e.defer();return i.logoutCurrentUser().then(function(e){e?(r.resolve(),C(),f.logout()):r.reject()}),r.promise}function w(){P&&P.hide()}function C(){var e="templates/login.html";webVersion&&nonMobileWebApp&&(e="templates/webLogin.html"),n.fromTemplateUrl(e,{scope:r,backdropClickToClose:!1,hardwareBackButtonClose:!1,animation:"asdf",focusFirstInput:!0}).then(function(e){P=e,A()})}function k(){return r.$broadcast.apply(r,arguments)}function M(e){return/^[-]?\d+$/.test(e)}function N(e,r){return e&&-1!==e.toLowerCase().indexOf(r.toLowerCase())}function T(e,r){return a("number")(parseInt(100*r/(100*e.unit_weight)))}function O(e){m.loadConfig(e).then(function(e){o.info("successfully loaded config: "+JSON.stringify(e))},function(e){o.error(e)})}var I={$broadcast:k,$q:e,$timeout:t,getFraction:v,isNumber:M,textContains:N,checkLogin:C,logoutCurrentUser:E,userLoggedIn:w,getNameWithLastRemoved:S,getCustomerOrderSubstitutionPreferenceOptions:g,getSubstitutionPreferenceText:y,GroceryCartItem:s,Order:c,OrderLine:l,CustomOrderLine:p,configureRollBarUserInfo:_,weightedQuantity:T,loadConfiguration:O};return I;var P}var r=angular.module("common",["ionic","ngCordova","ngIOS9UIWebViewPatch","common.inAppMessaging"]);r.factory("$exceptionHandler",["$injector",function(e){return function(r,t){try{var n=e.get("LogService");n.error(r)}catch(e){}}}]),r.run(["OpenUrlService",function(e){e&&(document.addEventListener("handleopenurl",e.handleOpenUrl,!1),document.addEventListener("resume",e.onResume,!1))}]),r.factory("common",["$q","$rootScope","$timeout","$ionicModal","$log","$filter","AuthService","GroceryCartItem","AppAnalytics","Order","OrderLine","CustomOrderLine","LogService","KahunaService","ConfigService","CommonConfig",e])}(),angular.module("common").constant("CommonConfig",{groceriesContext:"GroceriesApp",groceriesConfigUrl:"api/v1/app_config.json",shopperContext:"ShopperApp",shopperConfigUrl:"api/v1/shopper/app_config.json",configStoreKey:"appConfig",shopperAppIdentity:"shopperAppIdentity",groceryAppIdentity:"groceryAppIdentity",webAppIdentity:"webAppIdentity",kahunaKey:"c7f0f05869b34099be54a22b5336710e",stagingEnvironmentName:"staging",productionEnvironmentName:"production"}).constant("IN_APP_MESSAGE",{TYPES:{NEW_STORE_ANNOUNCEMENT:"newStoreAnnouncement",ACKNOWLEDGEMENT:"acknowledgement"},EVENTS:{OPEN_CHOOSE_STORE_MODAL:"event.openChooseStoreModal"}}).constant("FILTER_SORT",{EVENTS:{APPLY_FILTER:"apply-filter-sort",CLEAR_FILTER:"clear-search-filtersort",RESET:"reset-filter-sort"},OPTIONS:{SORT_POPULARITY:"Popularity",SORT_PRICE_LOW_HIGH:"Price: Low to High",SORT_PRICE_HIGH_LOW:"Price: High to Low",SORT_BRAND_A_Z:"Brand: A-Z",SORT_BRAND_Z_A:"Brand: Z-A",DEFAULT_CATEGORIES:"All Categories",DEFAULT_BRANDS:"All Brands"},FACETS:{BRANDS:"brand_name",CATEGORIES:"categories.name"},INDEXES:{STAGING:{SORT_PRICE_LOW_HIGH:"StoreProductSetting_staging_price_asc",SORT_PRICE_HIGH_LOW:"StoreProductSetting_staging_price_desc",SORT_BRAND_A_Z:"StoreProductSetting_staging_brand_az",SORT_BRAND_Z_A:"StoreProductSetting_staging_brand_za"},PRODUCTION:{SORT_PRICE_LOW_HIGH:"StoreProductSetting_production_price_asc",SORT_PRICE_HIGH_LOW:"StoreProductSetting_production_price_desc",SORT_BRAND_A_Z:"StoreProductSetting_production_brand_az",SORT_BRAND_Z_A:"StoreProductSetting_production_brand_za"}}}),function(){angular.module("common").constant("COMMON_FEATURE_TOGGLES",{BARCODE_SCAN_SEARCH:"barcode_scan_search",ALGOLIA_SEARCH_ENABLED:"use_algolia_client_search_results",ALGOLIA_INSTANT_SEARCH_ENABLED:"algolia_instant_search",ALGOLIA_FILTER_SORT_ENABLED:"algolia_filter_sort",ALGOLIA_SORT_ENABLED:"algolia_sort_indexes"})}(),angular.module("common").directive("ngTouchstart",ngTouchstart),angular.module("common").directive("validated",["$parse",validated]),function(){angular.module("ionic.rating",[]).constant("ratingConfig",{max:5}).controller("RatingController",["$scope","$attrs","ratingConfig",function(e,r,t){var n;return n={$setViewValue:angular.noop},this.init=function(o){var a;return n=o,n.$render=this.render,a=angular.isDefined(r.max)?e.$parent.$eval(r.max):t.max,e.range=this.buildTemplateObjects(n.$modelValue,a)},this.buildTemplateObjects=function(e,r){var t,n=[];for(t=0;t<r;t++)e>t&&e<t+1?n[t]=2:e>t?n[t]=1:n[t]=0;return n},e.rate=function(r){if(!e.readonly&&r>=0&&r<=e.range.length)return n.$setViewValue(r),n.$render()},e.onKeydown=function(r){if(/(37|38|39|40)/.test(r.which))return r.preventDefault(),r.stopPropagation(),e.rate(e.value+(38===r.which||39===r.which?{1:-1}:void 0))},this.render=function(){return e.value=n.$viewValue},this}]).directive("rating",["$timeout",function(e){return{restrict:"EA",require:["rating","ngModel"],scope:{readonly:"=?"},controller:"RatingController",templateUrl:"templates/rating.html",replace:!0,link:function(r,t,n,o){var a,i;i=o[0],a=o[1],a&&e(function(){return i.init(a)})}}}])}.call(void 0),angular.module("common").directive("selectOnClick",function(){return{restrict:"A",link:function(e,r,t){var n=!1;r.on("click",function(e){if(!n)try{this.selectionStart=0,this.selectionEnd=this.value.length+1,n=!0}catch(e){this.select(),n=!0}}),r.on("blur",function(e){n=!1})}}}),angular.module("common").directive("stopEvent",function(){function e(e){e.stopPropagation()}return{restrict:"A",link:function(r,t,n){t.bind(n.stopEvent,e)}}}),angular.module("common").directive("onValidSubmit",["$parse","$timeout",onValidSubmit]),angular.module("common").filter("capitalize",function(){return function(e,r){return e?e.replace(/([^\W_]+[^\s-]*) */g,function(e){return e.charAt(0).toUpperCase()+e.substr(1).toLowerCase()}):""}}),angular.module("common").filter("driverNameFilter",function(){return function(e){e=$.trim(e);var r=e.split(" "),t=r.length;t>1&&(r[t-1]=r[t-1].charAt(0)+".");var n=r.join(" ");return n}}),angular.module("common").filter("tel",function(){return function(e){if(!e)return"";var r=e.toString().trim().replace(/^\+/,"");if(r.match(/[^0-9]/))return e;var t,n,o;switch(r.length){case 10:t=1,n=r.slice(0,3),o=r.slice(3);break;case 11:t=r[0],n=r.slice(1,4),o=r.slice(4);break;case 12:t=r.slice(0,3),n=r.slice(3,5),o=r.slice(5);break;default:return e}return 1==t&&(t=""),o=o.slice(0,3)+"-"+o.slice(3),(t+" ("+n+") "+o).trim()}});var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol?"symbol":typeof e};!function(e){var r=function(){var e={0:{pattern:/\d/,_default:"0"},9:{pattern:/\d/,optional:!0},"#":{pattern:/\d/,optional:!0,recursive:!0},S:{pattern:/[a-zA-Z]/},$:{escape:!0}},r=function(r,t){for(var n=0,o=t-1,a={escape:!0};o>=0&&a&&a.escape;)a=e[r.charAt(o)],n+=a&&a.escape?1:0,o--;return n>0&&n%2===1},t=function(e,r){var t=e.replace(/[^0]/g,"").length,n=r.replace(/[^\d]/g,"").length;return n-t},n=function(e,r,t){return t.reverse?r+e:e+r},o=function r(t,n,o){var a=t.charAt(n),i=e[a];return""!==a&&(!(!i||i.escape)||r(t,n+o,o))},a=function(e,r,t){var n=e.split("");return n.splice(t>=0?t:0,0,r),n.join("")},i=function i(s,u){this.options=u||{},this.options={reverse:this.options.reverse||!1,usedefaults:this.options.usedefaults||this.options.reverse},this.pattern=s,i.prototype.process=function(i){if(!i)return"";i+="";for(var s=this.pattern,u=!0,c="",l=this.options.reverse?i.length-1:0,p=t(s,i),d=!1,f=[],m=!1,h={start:this.options.reverse?s.length-1:0,end:this.options.reverse?-1:s.length,inc:this.options.reverse?-1:1},v=function(e){if(!m&&o(s,g,h.inc))return!0;if(m||(m=f.length>0),m){var r=f.shift();if(f.push(r),e.reverse&&l>=0)return g++,s=a(s,r,g),!0;if(!e.reverse&&l<i.length)return s=a(s,r,g),!0}return g<s.length&&g>=0},g=h.start;v(this.options);g+=h.inc){var y=s.charAt(g),S=i.charAt(l),_=e[y];if(!m||S){if(this.options.reverse&&r(s,g)){c=n(c,y,this.options),g+=h.inc;continue}if(!this.options.reverse&&d){c=n(c,y,this.options),d=!1;continue}if(!this.options.reverse&&_&&_.escape){d=!0;continue}}if(!m&&_&&_.recursive)f.push(y);else{if(m&&!S){_&&_.recursive||(c=n(c,y,this.options));continue}if(f.length>0&&_&&!_.recursive){u=!1;continue}if(!m&&f.length>0&&!S)continue}if(_)if(_.optional){if(_.pattern.test(S)&&p)c=n(c,S,this.options),l+=h.inc,p--;else if(f.length>0&&S){u=!1;break}}else if(_.pattern.test(S))c=n(c,S,this.options),l+=h.inc;else{if(S||!_._default||!this.options.usedefaults){u=!1;break}c=n(c,_._default,this.options)}else c=n(c,y,this.options),!m&&f.length&&f.push(y)}return{result:c,valid:u}},i.prototype.apply=function(e){return this.process(e).result},i.prototype.validate=function(e){return this.process(e).valid}};return i.process=function(e,r,t){return new i(r,t).process(e)},i.apply=function(e,r,t){return new i(r,t).apply(e)},i.validate=function(e,r,t){return new i(r,t).validate(e)},i}(),t={boolean:!1,function:!0,object:!0,number:!1,string:!1,undefined:!1};t["undefined"==typeof module?"undefined":_typeof(module)]&&(module.exports=r),e.module("ui.utils.masks.us",["ui.utils.masks.helpers","ui.utils.masks.us.phone","ui.utils.masks.us.ssn","ui.utils.masks.us.card","ui.utils.masks.us.expDate"]),e.module("ui.utils.masks.us.expDate",[]).directive("uiUsExpDate",[function(){function e(e){return e.replace(/[^0-9]/g,"")}function t(e){var r;return r=n.apply(e)||"",r.trim().replace(/[^0-9]$/,"")}var n=new r("00/00");return{restrict:"A",require:"ngModel",link:function(r,n,o,a){function i(r){return a.$isEmpty(r)?r:t(e(r))}function s(r){if(a.$isEmpty(r))return r;var n=t(e(r)),o=e(n);return a.$viewValue!==n&&(a.$setViewValue(n),a.$render()),o}function u(e){var r=a.$isEmpty(e)||e.length>9;return a.$setValidity("usExpDate",r),e}a.$formatters.push(i),a.$formatters.push(u),a.$parsers.push(s),a.$parsers.push(u)}}}]),e.module("ui.utils.masks.us.card",[]).directive("uiUsCardNumber",[function(){function e(e){return e.replace(/[^0-9]/g,"")}function t(e){var r;return r=n.apply(e)||"",r.trim().replace(/[^0-9]$/,"")}var n=new r("0000 0000 0000 0000 0000");return{restrict:"A",require:"ngModel",link:function(r,n,o,a){function i(r){return a.$isEmpty(r)?r:t(e(r))}function s(r){if(a.$isEmpty(r))return r;var n=t(e(r)),o=e(n);return a.$viewValue!==n&&(a.$setViewValue(n),a.$render()),o}function u(e){var r=a.$isEmpty(e)||e.length>9;return a.$setValidity("usCardNumber",r),e}a.$formatters.push(i),a.$formatters.push(u),a.$parsers.push(s),a.$parsers.push(u)}}}]),e.module("ui.utils.masks.us.ssn",[]).directive("uiUsSsnNumber",[function(){function e(e){return e.replace(/[^0-9]/g,"")}function t(e){var r;return r=n.apply(e)||"",r.trim().replace(/[^0-9]$/,"")}var n=new r("000-00-0000");return{restrict:"A",require:"ngModel",link:function(r,n,o,a){function i(r){return a.$isEmpty(r)?r:t(e(r))}function s(r){if(a.$isEmpty(r))return r;var n=t(e(r)),o=e(n);return a.$viewValue!==n&&(a.$setViewValue(n),a.$render()),o}function u(e){var r=a.$isEmpty(e)||e.length>9;return a.$setValidity("usSsnNumber",r),e}a.$formatters.push(i),a.$formatters.push(u),a.$parsers.push(s),a.$parsers.push(u)}}}]),e.module("ui.utils.masks.us.phone",[]).directive("uiUsPhoneNumber",[function(){function e(e){return e.replace(/[^0-9]/g,"")}function t(e){var r;return r=e.length<11?n.apply(e)||"":o.apply(e),r.trim().replace(/[^0-9]$/,"")}var n=new r("(000) 000-0000"),o=new r("+00-00-000-000000");return{restrict:"A",require:"ngModel",link:function(r,n,o,a){function i(r){return a.$isEmpty(r)?r:t(e(r))}function s(r){if(a.$isEmpty(r))return r;var n=t(e(r)),o=e(n);return a.$viewValue!==n&&(a.$setViewValue(n),a.$render()),o}function u(e){var r=a.$isEmpty(e)||e.length>9;return a.$setValidity("usPhoneNumber",r),e}a.$formatters.push(i),a.$formatters.push(u),a.$parsers.push(s),a.$parsers.push(u)}}}]),e.module("ui.utils.masks.global",["ui.utils.masks.helpers","ui.utils.masks.global.date","ui.utils.masks.global.money","ui.utils.masks.global.weight","ui.utils.masks.global.number","ui.utils.masks.global.percentage","ui.utils.masks.global.scientific-notation","ui.utils.masks.global.time"]);var n;"undefined"!=typeof moment&&(n=moment);var o=[];try{e.module("angular-momentjs"),o.push("angular-momentjs")}catch(e){}e.module("ui.utils.masks.global.date",o).directive("uiDateMask",["$locale","$log","$injector",function(e,t,o){var a;if("undefined"==typeof n){if(!o.has("MomentJS"))throw new Error("Moment.js not found. Check if it is available.");a=o.get("MomentJS")}else a=n;var i={"pt-br":"DD/MM/YYYY"},s=i[e.id]||"YYYY-MM-DD";return{restrict:"A",require:"ngModel",link:function(e,n,o,i){function u(e){var r=e.replace(/[^0-9]/g,""),t=d.process(r).result||"";return t.trim().replace(/[^0-9]$/,"")}function c(e){if(t.debug("[uiDateMask] Formatter called: ",e),i.$isEmpty(e))return e;var r=u(a(e).format(s));return p(r),r}function l(e){if(t.debug("[uiDateMask] Parser called: ",e),i.$isEmpty(e))return p(e),e;var r=u(e);t.debug("[uiDateMask] Formated value: ",r),i.$viewValue!==r&&(i.$setViewValue(r),i.$render()),p(r);var n=a(r,s);return n.toDate()}function p(e){t.debug("[uiDateMask] Validator called: ",e);var r=a(e,s).isValid()&&e.length===s.length;i.$setValidity("date",i.$isEmpty(e)||r)}var d=new r(s.replace(/[YMD]/g,"0"));i.$formatters.push(c),i.$parsers.push(l)}}}]),e.module("ui.utils.masks.global.money",["ui.utils.masks.helpers"]).directive("uiMoneyMask",["$locale","$parse","PreFormatters","NumberValidators",function(t,n,o,a){return{restrict:"A",require:"ngModel",link:function(i,s,u,c){function l(e){if(c.$isEmpty(e))return e;var r=o.prepareNumberToFormatter(e,h);return y.apply(r)}function p(e){if(c.$isEmpty(e))return e;var r=e.replace(/[^\d]+/g,"");r=r.replace(/^[0]+([1-9])/,"$1");var t=y.apply(r);return e!==t&&(c.$setViewValue(t),c.$render()),t?parseInt(t.replace(/[^\d]+/g,""))/Math.pow(10,h):null}var d=t.NUMBER_FORMATS.DECIMAL_SEP,f=t.NUMBER_FORMATS.GROUP_SEP,m=t.NUMBER_FORMATS.CURRENCY_SYM,h=n(u.uiMoneyMask)(i);e.isDefined(u.uiHideGroupSep)&&(f=""),isNaN(h)&&(h=2);var v=h>0?d+new Array(h+1).join("0"):"",g=m+" #"+f+"##0"+v,y=new r(g,{reverse:!0});c.$formatters.push(l),c.$parsers.push(p),u.uiMoneyMask&&i.$watch(u.uiMoneyMask,function(e){isNaN(e)&&(e=2),v=e>0?d+new Array(e+1).join("0"):"",g=m+" #"+f+"##0"+v,y=new r(g,{reverse:!0}),p(c.$viewValue)}),u.min&&(c.$parsers.push(function(e){var r=n(u.min)(i);return a.minNumber(c,e,r)}),i.$watch(u.min,function(e){a.minNumber(c,c.$modelValue,e)})),u.max&&(c.$parsers.push(function(e){var r=n(u.max)(i);return a.maxNumber(c,e,r)}),i.$watch(u.max,function(e){a.maxNumber(c,c.$modelValue,e)}))}}}]),e.module("ui.utils.masks.global.weight",["ui.utils.masks.helpers"]).directive("uiWeightMask",["$locale","$parse","PreFormatters","NumberValidators",function(t,n,o,a){return{restrict:"A",require:"ngModel",link:function(i,s,u,c){function l(e){if(c.$isEmpty(e))return e;var r=o.prepareNumberToFormatter(e,h);return y.apply(r)}function p(e){if(c.$isEmpty(e))return e;var r=e.replace(/[^\d]+/g,"");r=r.replace(/^[0]+([1-9])/,"$1");var t=y.apply(r);return e!==t&&(c.$setViewValue(t),c.$render()),t?parseInt(t.replace(/[^\d]+/g,""))/Math.pow(10,h):null}var d=t.NUMBER_FORMATS.DECIMAL_SEP,f=t.NUMBER_FORMATS.GROUP_SEP,m=n(u.uiWeightMask)(i),h=2;e.isDefined(u.uiHideGroupSep)&&(f=""),isNaN(h)&&(h=2);var v=h>0?d+new Array(h+1).join("0"):"",g="#"+f+"##0"+v+" "+m,y=new r(g,{reverse:!0});c.$formatters.push(l),c.$parsers.push(p),u.uiWeightMask&&i.$watch(u.uiWeightMask,function(e){isNaN(e)&&(e=2),v=e>0?d+new Array(e+1).join("0"):"",g="#"+f+"##0"+v+" "+m,y=new r(g,{reverse:!0}),p(c.$viewValue)}),u.min&&(c.$parsers.push(function(e){var r=n(u.min)(i);return a.minNumber(c,e,r)}),i.$watch(u.min,function(e){a.minNumber(c,c.$modelValue,e)})),u.max&&(c.$parsers.push(function(e){var r=n(u.max)(i);return a.maxNumber(c,e,r)}),i.$watch(u.max,function(e){a.maxNumber(c,c.$modelValue,e)}))}}}]),e.module("ui.utils.masks.global.number",["ui.utils.masks.helpers"]).directive("uiNumberMask",["$locale","$parse","PreFormatters","NumberMasks","NumberValidators",function(r,t,n,o,a){return{restrict:"A",require:"ngModel",link:function(i,s,u,c){function l(r){if(c.$isEmpty(r))return r;var t=n.clearDelimitersAndLeadingZeros(r)||"0",o=h.apply(t),a=parseFloat(v.apply(t));if(e.isDefined(u.uiNegativeNumber)){var i="-"===r[0],s="-"===r.slice(-1);s^i&&a&&(a*=-1,o="-"+o)}return c.$viewValue!==o&&(c.$setViewValue(o),c.$render()),a}function p(r){if(c.$isEmpty(r))return r;var t="";e.isDefined(u.uiNegativeNumber)&&r<0&&(t="-");var o=n.prepareNumberToFormatter(r,m);return t+h.apply(o)}var d=r.NUMBER_FORMATS.DECIMAL_SEP,f=r.NUMBER_FORMATS.GROUP_SEP,m=t(u.uiNumberMask)(i);e.isDefined(u.uiHideGroupSep)&&(f=""),isNaN(m)&&(m=2);var h=o.viewMask(m,d,f),v=o.modelMask(m);c.$formatters.push(p),c.$parsers.push(l),u.uiNumberMask&&i.$watch(u.uiNumberMask,function(e){isNaN(e)&&(e=2),h=o.viewMask(e,d,f),v=o.modelMask(e),l(c.$viewValue)}),u.min&&(c.$parsers.push(function(e){var r=t(u.min)(i);return a.minNumber(c,e,r)}),i.$watch(u.min,function(e){a.minNumber(c,c.$modelValue,e)})),u.max&&(c.$parsers.push(function(e){var r=t(u.max)(i);return a.maxNumber(c,e,r)}),i.$watch(u.max,function(e){a.maxNumber(c,c.$modelValue,e)}))}}}]),e.module("ui.utils.masks.global.percentage",["ui.utils.masks.helpers"]).directive("uiPercentageMask",["$locale","$parse","PreFormatters","NumberMasks","NumberValidators",function(r,t,n,o,a){function i(e,r){return n.clearDelimitersAndLeadingZeros((100*parseFloat(e)).toFixed(r))}return{restrict:"A",require:"ngModel",link:function(s,u,c,l){function p(e){if(l.$isEmpty(e))return e;var r=i(e,h);return g.apply(r)+" %"}function d(e){if(l.$isEmpty(e))return e;var r=n.clearDelimitersAndLeadingZeros(e)||"0";e.length>1&&e.indexOf("%")===-1&&(r=r.slice(0,r.length-1));var t=g.apply(r)+" %",o=parseFloat(y.apply(r));return l.$viewValue!==t&&(l.$setViewValue(t),l.$render()),o}var f=r.NUMBER_FORMATS.DECIMAL_SEP,m=r.NUMBER_FORMATS.GROUP_SEP,h=parseInt(c.uiPercentageMask);e.isDefined(c.uiHideGroupSep)&&(m=""),isNaN(h)&&(h=2);var v=h+2,g=o.viewMask(h,f,m),y=o.modelMask(v);l.$formatters.push(p),l.$parsers.push(d),c.uiPercentageMask&&s.$watch(c.uiPercentageMask,function(e){isNaN(e)&&(e=2),v=e+2,g=o.viewMask(e,f,m),y=o.modelMask(v),d(l.$viewValue)}),c.min&&(l.$parsers.push(function(e){var r=t(c.min)(s);return a.minNumber(l,e,r)}),s.$watch("min",function(e){a.minNumber(l,l.$modelValue,e)})),c.max&&(l.$parsers.push(function(e){var r=t(c.max)(s);return a.maxNumber(l,e,r)}),s.$watch("max",function(e){a.maxNumber(l,l.$modelValue,e)}))}}}]),e.module("ui.utils.masks.global.scientific-notation",[]).directive("uiScientificNotationMask",["$locale","$parse","$log",function(t,n,o){function a(e){var t="0";if(e>0){t+=i;for(var n=0;n<e;n++)t+="0"}return new r(t,{reverse:!0})}var i=t.NUMBER_FORMATS.DECIMAL_SEP,s=2;return{restrict:"A",require:"ngModel",link:function(r,t,u,c){function l(e){var r=e.toString(),t=r.match(/(-?[0-9]*)[\.]?([0-9]*)?[Ee]?([\+-]?[0-9]*)?/);return{integerPartOfSignificand:t[1],decimalPartOfSignificand:t[2],exponent:0|t[3]}}function p(r){if(o.debug("[uiScientificNotationMask] Formatter called: ",r),c.$isEmpty(r))return r;"string"==typeof r?r=r.replace(i,"."):"number"==typeof r&&(r=r.toExponential(m));var t,n,a=l(r),s=a.integerPartOfSignificand||0,u=s.toString();e.isDefined(a.decimalPartOfSignificand)&&(u+=a.decimalPartOfSignificand);var p=(s>=1||s<=-1)&&(e.isDefined(a.decimalPartOfSignificand)&&a.decimalPartOfSignificand.length>m||0===m&&u.length>=2);return p&&(n=u.slice(m+1,u.length),u=u.slice(0,m+1)),t=h.apply(u),0!==a.exponent&&(n=a.exponent),e.isDefined(n)&&(t+="e"+n),t}function d(e){if(o.debug("[uiScientificNotationMask] Parser called: ",e),c.$isEmpty(e))return e;var r=p(e),t=parseFloat(r.replace(i,"."));return c.$viewValue!==r&&(c.$setViewValue(r),c.$render()),t}function f(e){if(o.debug("[uiScientificNotationMask] Validator called: ",e),c.$isEmpty(e))return e;var r=e<Number.MAX_VALUE;return c.$setValidity("max",r),e}var m=n(u.uiScientificNotationMask)(r);isNaN(m)&&(m=s);var h=a(m);c.$formatters.push(p),c.$formatters.push(f),c.$parsers.push(d),c.$parsers.push(f)}}}]),e.module("ui.utils.masks.global.time",[]).directive("uiTimeMask",["$log",function(t){if("undefined"==typeof r)throw new Error("StringMask not found. Check if it is available.");return{restrict:"A",require:"ngModel",link:function(n,o,a,i){function s(e){return e.replace(/[^0-9]/g,"").slice(0,p)}function u(e){if(t.debug("[uiTimeMask] Formatter called: ",e),i.$isEmpty(e))return e;var r=s(e);if(0===r.length)return"";var n=m.process(r).result;return n.replace(/[^0-9]$/,"")}function c(e){t.debug("[uiTimeMask] Parser called: ",e);var r=u(e),n=r;return i.$viewValue!==r&&(i.$setViewValue(r),i.$render()),n}function l(r){if(t.debug("[uiTimeMask] Validator called: ",r),e.isUndefined(r))return r;var n=r.toString().split(/:/).filter(function(e){return!!e}),o=parseInt(n[0]),a=parseInt(n[1]),s=parseInt(n[2]||0),u=r.toString().length===d&&o<24&&a<60&&s<60;return i.$setValidity("time",i.$isEmpty(r)||u),r}var p=6,d=8,f="00:00:00";e.isDefined(a.uiTimeMask)&&"short"===a.uiTimeMask&&(p=4,d=5,f="00:00");var m=new r(f);i.$formatters.push(u),i.$formatters.push(l),i.$parsers.push(c),i.$parsers.push(l)}}}]),e.module("ui.utils.masks.helpers",[]).factory("PreFormatters",[function(){function e(e){var r=e.replace(/^-/,"").replace(/^0*/,"");return r=r.replace(/[^0-9]/g,"")}function r(r,t){return e(parseFloat(r).toFixed(t))}return{clearDelimitersAndLeadingZeros:e,prepareNumberToFormatter:r}}]).factory("NumberValidators",[function(){return{maxNumber:function(e,r,t){var n=parseFloat(t),o=e.$isEmpty(r)||isNaN(n)||r<=n;return e.$setValidity("max",o),r},minNumber:function(e,r,t){var n=parseFloat(t),o=e.$isEmpty(r)||isNaN(n)||r>=n;return e.$setValidity("min",o),r}}}]).factory("NumberMasks",[function(){return{viewMask:function(e,t,n){var o="#"+n+"##0";if(e>0){o+=t;for(var a=0;a<e;a++)o+="0"}return new r(o,{reverse:!0})},modelMask:function(e){var t="###0";if(e>0){t+=".";for(var n=0;n<e;n++)t+="0"}return new r(t,{reverse:!0})}}}]);var a=["ui.utils.masks.global","ui.utils.masks.br","ui.utils.masks.us"].filter(function(r){try{return e.module(r),!0}catch(e){return!1}});e.module("ui.utils.masks",a).config(["$logProvider",function(e){e.debugEnabled(!1)}])}(angular),function(){function e(e,r,t,n,o,a){r.info("LoginController loaded"),e.appName=appName,"grocery"==e.appName?(e.userInputType="email",e.userInputLabel="Email",e.title="Shipt"):(e.userInputType="text",e.userInputLabel="Email",e.title="Pilot Shopper"),e.invalidLogin=!1,e.login={username:null,password:null},e.invalidLoginMessage="",e.errorLoginMessage="There was an error.",e.loginSubmit=function(a){return!loginForm.$valid&&(n.showLoading(),void o.authenticateUser(a).then(function(o){r.info("login success"),a=null,e.login={username:null,password:null},e.loginError=!1,e.invalidLogin=!1,t.$broadcast("user.loggedin",o),n.hideLoading()},function(t){r.error("error",t),t?(t.errors?e.invalidLoginMessage=t.errors:e.invalidLoginMessage="Invalid credentials",e.invalidLogin=!0,e.loginError=!1):(e.loginError=!0,e.invalidLogin=!1),n.hideLoading()}))},e.signUp=function(){r.info("signup"),t.$broadcast("show-register-page")},e.resetPassword=function(){if(webVersion){var e="https://app.shipt.com/password_resets/new";return window.open(e,"_blank"),!1}var e="https://app.shipt.com/password_resets/new";return window.open(e,"_system","location=yes"),!1},e.resetPasswordShopper=function(){var e="https://app.shipt.com/shopper/password_resets/new";return window.open(e,"_system","location=yes"),!1}}angular.module("common").controller("LoginController",["$scope","$log","$rootScope","UIUtil","AuthService","AppAnalytics",e])}(),function(){function e(e,r,t,n){function o(){this.requested_product_attributes={cost:0,description:null},this.requested_product_type="CustomProduct",this.requested_qty=0}return o}angular.module("common").factory("CustomOrderLine",["$http","$q","$timeout","$log",e])}(),function(){function e(){function e(e){this.product=null,this.qty=0,this.note=null;var r=this;e&&(r.product=e.product,r.note=e.note,e.qty?r.qty=e.qty:e.count&&(r.qty=e.count))}return e}var r="GroceryCartItem";angular.module("common").factory(r,e)}(),function(){function e(e,r,t,n,o){function a(){this.id=0,this.store_location_id=null,this.time_window="",this.customer_id=null,this.credit_card_id=null,this.stripe_transaction_id="",this.total=0,this.driver_id=null,this.delivery_id=null,this.notes="",this.customer_address_id=null,this.created_at=null,this.updated_at=null,this.order_lines=[],this.substitution_preference=null,this.source="customer-"+o.getPlatformName()}return a}var r="Order";angular.module("common").factory(r,["$http","$q","$timeout","$log","VersionProvider",e])}(),function(){function e(e,r,t,n){function o(){this.id=null,this.requested_product_id=0,this.store_order_id=0,this.requested_qty=0,this.notes="",this.created_at=null,this.updated_at=null}return o}var r="OrderLine";angular.module("common").factory(r,["$http","$q","$timeout","$log",e])}(),function(){function e(e,r,t,n,o,a,i,s,u){function c(){try{var e=a.getCustomerInfo().store.name;return console.log("store",e),e}catch(e){return null}}function l(){try{var e=a.getCustomerInfo().metro.name;return console.log("metro",e),e}catch(e){return null}}function p(e){try{var r=e;return e.split(" ").length>0&&(r=e.split(" ")[0]),r}catch(r){return e}}function d(e){try{var r=e;return e.split(" ").length>1&&(r=e.split(" ")[1]),r}catch(r){return e}}function f(e,r){return"app.addEditCard"===e&&"app.checkout"===toState.name||""===e&&"app.home"===r}this.initSegment=function(){try{var r=window.analytics,t="UBvTMXnqZhfJlYn8fWfG4blYql7lpWol",n="BIaY9OeQh3JzvmufawdnMtWPJGcQUUyx",o="3BzfhEj7hf6HZpeyGSz8ACco2j8xQ0ih";u.isProduction()?u.isGroceryApp()?r.load(n):u.isShopperApp()&&r.load(o):r.load(t),r.page()}catch(r){e.info(r)}},this.page=function(r,t,n,o,a){try{if(n=0!=Object.keys(n).length?JSON.parse(n[Object.keys(n)[0]]):null,a=0!=Object.keys(a).length?JSON.parse(a[Object.keys(a)[0]]):null,f(o.name,t.name))return;analytics.page(t.name,{fromName:o.name,toParams:n,fromParams:a,store:c(),metro:l()})}catch(r){e.error(r)}},this.track=function(r){var t=arguments.length<=1||void 0===arguments[1]?{}:arguments[1],n=arguments.length<=2||void 0===arguments[2]||arguments[2];try{n&&(t.store=c(),t.metro=l()),analytics.track(r,t)}catch(r){e.error(r)}},this.login=function(){try{analytics.track("login",{store:c(),metro:l()}),o.login()}catch(r){e.error(r)}},this.identify=function(){try{var e;!function(){var r=function(r){if(a.isAuthenticated())if("grocery"==appName){var o=a.getUserInfo();analytics.identify(o.id,{name:o.name,firstName:p(o.name),lastName:d(o.name),email:o.email,guest:o.guest_account,metro:o.metro.name,platform:e,version:r,feature_toggles:o.features,accountAge:n(o),subscriptionAge:t(o)})}else if("shopper"==appName){var o=a.getUserInfo();analytics.identify(o.id,{name:o.name,firstName:p(o.name),lastName:d(o.name),email:o.email,metro:o.metro.name,platform:e,version:r,accountAge:n(o)})}},t=function(e){try{if(e.subscription){var r=moment(),t=moment(e.subscription.created_at),n=r.diff(t,"days");return n}return null}catch(e){return null}},n=function(e){try{if(!e.created_at)return null;var r=moment(),t=moment(e.created_at),n=r.diff(t,"days");return n}catch(e){return null}};e=ionic.Platform.platform(),webVersion?(e="web",r()):i.getVersionString().then(function(e){r(e)},function(){r()})}()}catch(e){}},this.signup=function(){try{analytics.track("signup",{store:c(),metro:l()}),o.signup()}catch(r){e.error(r);
}},this.addProductToCart=function(r,t){var n=!(arguments.length<=2||void 0===arguments[2])&&arguments[2];try{analytics.track("addProductToCart",{product:r,source:t,fromDetail:n,store:c(),metro:l()}),o.addProductToCart(r,t)}catch(r){e.error(r)}},this.addSpecialRequest=function(r){try{analytics.track("addSpecialRequest",{specialRequest:r,store:c(),metro:l()}),o.addSpecialRequest(r.name)}catch(r){e.error(r)}},this.createSpecialRequest=function(r){try{analytics.track("createSpecialRequest",{specialRequest:r,store:c(),metro:l()}),o.addSpecialRequest(r.name)}catch(r){e.error(r)}},this.productSearch=function(r){try{analytics.track("search",{search:r,store:c(),metro:l()}),o.productSearch(r)}catch(r){e.error(r)}},this.viewProduct=function(r,t){try{analytics.track("viewProduct",{product:r,source:t,store:c(),metro:l()}),o.viewProduct(r,t)}catch(r){e.error(r)}},this.viewCategory=function(r){try{analytics.track("viewCategory",{categoryName:r,store:c(),metro:l()}),o.viewCategory(r)}catch(r){e.error(r)}},this.checkoutComplete=function(r,t,n){try{analytics.track("checkoutComplete",{order_id:r.id,revenue:r.charge_total,order_lines:t,delivery_zip:n?n.zip_code:null,store:c(),metro:l()}),o.checkoutComplete(r,t)}catch(r){e.error(r)}},this.membershipPurchase=function(r){try{analytics.track("membershipPurchase",{plan_id:r.plan.id,revenue:r.plan.amount/100,store:c(),metro:l()}),o.membershipPurchase(r)}catch(r){e.error(r)}},this.beginCheckout=function(){try{o.beginCheckout()}catch(r){e.error(r)}},this.checkoutButtonClicked=function(r){try{analytics.track("checkoutButtonClicked",{store:c(),metro:l()})}catch(r){e.error(r)}},this.checkoutButtonClickedError=function(){try{analytics.track("checkoutButtonClickedError",{store:c(),metro:l()})}catch(r){e.error(r)}},this.editOrder=function(){try{analytics.track("editOrder",{store:c(),metro:l()})}catch(r){e.error(r)}},this.cancelOrder=function(){try{analytics.track("cancelOrder",{store:c(),metro:l()})}catch(r){e.error(r)}},this.rateShopper=function(r){try{analytics.track("rateShopper",{rating:r,store:c(),metro:l()}),o.rateShopper(r)}catch(r){e.error(r)}},this.tipShopper=function(r){try{analytics.track("tipShopper",{tip:r,store:c(),metro:l()}),o.tipShopper()}catch(r){e.error(r)}},this.addAddress=function(r){try{analytics.track("addAddress",{address:r,store:c(),metro:l()}),o.addAddress(r)}catch(r){e.error(r)}},this.updateUser=function(){try{analytics.track("updateUser",{store:c(),metro:l()}),o.updateUser()}catch(e){}finally{}},this.addCard=function(){try{analytics.track("addCard",{store:c(),metro:l()}),o.addCard()}catch(r){e.error(r)}},this.filterSort=function(r){try{r?analytics.track("filterSort",{sortBy:r.sortBy,filterCategories:r.filterCategories,filterBrands:r.filterBrands}):analytics.track("filterSortModalOpened")}catch(r){e.error(r)}}}angular.module("common").service("AppAnalytics",e),e.$inject=["$log","$q","$filter","LogService","KahunaService","AuthService","VersionProvider","ApiEndpoint","AppIdentity"]}(),function(){function e(e){this.identity=function(){return webVersion&&webVersion===!0?e.webAppIdentity:"grocery"===appName?e.groceryAppIdentity:"shopper"===appName?e.shopperAppIdentity:void 0},this.isShopperApp=function(){return this.identity()===e.shopperAppIdentity},this.isGroceryApp=function(){return this.identity()===e.groceryAppIdentity},this.isWebApp=function(){return this.identity()===e.webAppIdentity},this.isProduction=function(e){e||(e=document.location.hostname);var r=e.indexOf("localhost")>-1,t=e.indexOf("staging")>-1;return!r&&!t},this.isLocalhost=function(){return"localhost"===document.location.hostname}}angular.module("common").service("AppIdentity",e),e.$inject=["CommonConfig"]}(),function(){function e(e,r,n,o,a,i){function s(){var t=r.defer();e.defaults.headers.common["X-Shipt-API-Token"]=u();var n={method:"GET",url:o.apiurl+"/api/v1/metros.json"};return e(n).success(function(e){t.resolve(e)}).error(function(e){t.reject(e)}),t.promise}function u(){var e=window.localStorage[t];if(e){var r=angular.fromJson(e).auth_token;return r}return null}function c(){return l()}function l(){var e=u();return!!e}function p(e){try{var r=d(e);null==r||r||(e=r),window.localStorage[t]=angular.toJson(e)}catch(e){n.error(e)}}function d(e){try{var r=g();return!e.credit_cards&&r.credit_cards&&(e.credit_cards=r.credit_cards),!e.customer_addresses&&r.customer_addresses&&(e.customer_addresses=r.customer_addresses),!e.orders&&r.orders&&(e.orders=r.orders),e}catch(e){return n.error(e),null}}function f(t){var a=r.defer(),s={method:"POST",url:o.authurl,data:t};return e(s).success(function(e){n.info("auth success"),p(e),i.info("Successful Login"),a.resolve(e)}).error(function(e){n.error("error",e),i.error(e),a.reject(e)}),a.promise}function m(){var e=r.defer();return a.showYesNoConfirm("Sign Out","Are you sure you want to sign out?").then(function(r){r&&(i.info("User Sign Out"),h()),e.resolve(r)}),e.promise}function h(){var e=localStorage.getItem("intro-modal-shown");localStorage.clear(),localStorage.setItem("intro-modal-shown",e)}function v(){var e=g();return e?e.id:null}function g(){var e=window.localStorage[t];if(e){var r=angular.fromJson(e);return r}return null}function y(t){var a=r.defer(),s={method:"POST",url:o.apiurl+"/api/v1/customers.json",headers:{Accept:"application/vnd.shiptauthapi.v1+json"},data:t};return e(s).success(function(e){n.info("register success"),p(e),i.info("Successful Register"),a.resolve(e)}).error(function(e){n.error("error",e),i.error(e),a.reject(e)}),a.promise}var S={isAuthenticated:l,shouldMakeShiptApiCall:c,authenticateUser:f,registerUser:y,logoutCurrentUser:m,getCustomerId:v,getAuthToken:u,getCustomerInfo:g,getUserInfo:g,saveAuthToken:p,saveAccountData:p,getMetros:s};return S}var r="AuthService";angular.module("common").factory(r,["$http","$q","$log","ApiEndpoint","UIUtil","LogService",e]);var t="authToken"}(),function(){function e(e,r,t,n,o,a,i){function s(n){var o=r.defer(),i=u(n);return e({method:"GET",url:t.apiurl+i}).then(function(e){p(e.data),a.$broadcast("config.data.changed"),o.resolve(e.data)},function(e){o.reject(e)}),o.promise}function u(e){var r;return e===n.groceriesContext?(o.customer(),r=n.groceriesConfigUrl):e===n.shopperContext&&(o.shopper(),r=n.shopperConfigUrl),r}function c(){var e=r.defer(),t=d();return t?(e.resolve(t),e.promise):s(l())}function l(){return i.isGroceryApp()?n.groceriesContext:n.shopperContext}function p(e){localStorage.setItem(n.configStoreKey,JSON.stringify(e))}function d(){var e=localStorage.getItem(n.configStoreKey);return e?JSON.parse(e):null}return{loadConfig:s,getConfig:c,getLocalConfig:d}}angular.module("common").factory("ConfigService",["$http","$q","ApiEndpoint","CommonConfig","DefaultHeaders","$rootScope","AppIdentity",e])}(),function(){function e(e,r,t,n,o,a){function i(){a.ready(function(){t.isAuthenticated()&&n.getCurrentPosition()}),u(),c(),l()}function s(){u(),l(),c()}function u(){r.defaults.headers.common["X-Shipt-API-Token"]=t.getAuthToken()}function c(){r.defaults.headers.common["X-Shipt-Geo-Lat"]=n.latitude(),r.defaults.headers.common["X-Shipt-Geo-Long"]=n.longitude()}function l(){o.getVersionString().then(function(e){r.defaults.headers.common["X-Shipt-App-Version"]=e})}var p={shopper:i,customer:s};return p}angular.module("common").factory("DefaultHeaders",["$log","$http","AuthService","Geolocator","VersionProvider","$ionicPlatform",e])}(),function(){function e(e,r,t,n,o){function a(r){var t="";try{return r.errors?"string"==typeof r.errors?t=r.errors:Object.keys(r.errors).forEach(function(n,o){t+=i(n)+" "+s(r,n),e.info(t)}):r.status&&(r.statusText&&(t+=r.statusText+". "),r.status&&(t+="Response status was "+r.status+". ")),t}catch(r){return e.error(r),""}}function i(e){var r=u("_"," ",e);return r=u("."," ",r),r=t("capitalize")(r),"Base"!=r?r:""}function s(e,r){var n=u("_"," ",e.errors[r].toString());return n=u("."," ",n),n=t("capitalize")(n),n.includes(".")||(n+="."),n}function u(e,r,t){return t=t.replace(e,r),t.includes(e)?u(e,r,t):t}this.handlError=function(e){arguments.length<=1||void 0===arguments[1]?"Error":arguments[1],arguments.length<=2||void 0===arguments[2]?"":arguments[2]},this.displayError=function(e){arguments.length<=1||void 0===arguments[1]?"Error":arguments[1],arguments.length<=2||void 0===arguments[2]?"":arguments[2]},this.handleAPIError=function(e){arguments.length<=1||void 0===arguments[1]?"Error":arguments[1],arguments.length<=2||void 0===arguments[2]?"":arguments[2]},this.displayShiptAPIError=function(r){var t=arguments.length<=1||void 0===arguments[1]?"Error":arguments[1],n=arguments.length<=2||void 0===arguments[2]?"":arguments[2];try{var i=a(r);return o.showAlert(t,n+" "+i),i}catch(r){return e.error(r),!1}},this.displayStripeError=function(r){var t=arguments.length<=1||void 0===arguments[1]?"Error":arguments[1];arguments.length<=2||void 0===arguments[2]?"":arguments[2];try{if(!r.errors&&!r.status)return o.showAlert(t,r),r;this.displayShiptAPIError(r,"Couldn't Save Card")}catch(r){return e.error(r),!1}}}angular.module("common").service("ErrorHandler",e),e.$inject=["$log","$q","$filter","LogService","UIUtil"]}(),function(){function e(e,r,t,n,o,a,i){function s(e){try{return o.getCustomerInfo().features[e]===!0}catch(e){return null}}function u(){try{var e=o.getCustomerInfo();return!(!e||!e.features)&&e.features.category_search_goes_to_global_search===!0}catch(e){return n.error(["FeatureService.categorySearchGoesToGlobalSearch",e]),!1}}function c(){try{var e=o.getCustomerInfo();return!(!e||!e.features)&&e.features.choose_store_in_app===!0}catch(e){return n.error(["FeatureService.chooseStoreInApp",e]),!1}}function l(){try{var e=o.getCustomerInfo();return!(!e||!e.features)&&e.features.subscription_cancellation===!0}catch(e){return n.error(["FeatureService.subscriptionCancellation",e]),!1}}function p(){try{var e=o.getCustomerInfo();return!(!e||!e.features)&&e.features.use_algolia_client_search_results===!0}catch(e){return n.error(["FeatureService.useAlgoliaClientSearchResults",e]),!1}}function d(){try{var e=o.getCustomerInfo();return!(!e||!e.features)&&e.features.favorites===!0}catch(e){return n.error(["FeatureService.favorites",e]),!1}}function f(){try{var e=o.getCustomerInfo();return!(!e||!e.features)&&e.features.subscription_management===!0}catch(e){return n.error(["FeatureService.subscription_management",e]),!1}}function m(){try{var e=o.getCustomerInfo();return!(!e||!e.features)&&e.features.meal_kits===!0}catch(e){return n.error(["FeatureService.mealKits",e]),!1}}function h(){try{var e=o.getCustomerInfo();if(e&&e.features)return e.features.customer_order_line_feedback}catch(e){return!1}}function v(){try{var e=o.getCustomerInfo();if(e&&e.features)return e.features.tipping}catch(e){return!1}}function g(){i.shopper()}function y(){try{var e=o.getCustomerInfo();return!(!e||!e.features)&&(void 0==e.features.show_tax_exempt_reminder||e.features.show_tax_exempt_reminder===!0)}catch(e){return n.error(["FeatureService.show_tax_exempt_reminder",e]),!0}}function S(){try{var e=o.getCustomerInfo();return!(!e||!e.features)&&e.features.multiple_stores===!0}catch(e){return n.error(["FeatureService.choose_store_in_app",e]),!1}}function _(){var i=t.defer();if(o.getCustomerInfo()){g();var s={method:"GET",url:a.apiurl+"api/v1/shopper/shopper/info.json"};e(s).success(function(e){o.saveAuthToken(e)}).error(function(e){r.error("error",e),n.error(e),i.reject(e)})}return i.promise}function $(){var e=t.defer(),r=o.getCustomerInfo();return r?e.resolve(r.features):e.reject(null),e.promise}function b(){t.defer();return $().then(function(e){return!e.order_assignment},function(e){n.critical(["Error FeatureService showAvailableOrders",e])})}function A(){try{var e=o.getCustomerInfo();return!(!e||!e.features)&&e.features.ambassador}catch(e){return!1}}return{getFeatureToggle:s,getAllFeatureToggles:$,showTipping:v,showOrderLineReconciliation:h,mealKits:m,subscription:f,subscriptionCancellation:l,favorites:d,chooseStoreInApp:c,categorySearchGoesToGlobalSearch:u,useAlgoliaClientSearchResults:p,multipleStores:S,showAvailableOrders:b,refreshFeatures:_,showAmbassador:A,showTaxExemptReminder:y}}angular.module("common").factory("FeatureService",["$http","$log","$q","LogService","AuthService","ApiEndpoint","DefaultHeaders",e])}(),function(){function e(e,r,t,n,o){function a(e){try{var t=r.defer(),a={timeout:1e4,maximumAge:3e4,enableHighAccuracy:!1};return e&&(a={timeout:1e4,maximumAge:0,enableHighAccuracy:!0}),n.getCurrentPosition(a).then(function(e){d=e.coords.latitude,f=e.coords.longitude,t.resolve(e.coords)},function(e){o.error(e),t.reject(e)}),t.promise}catch(e){o.error(e)}}function i(){try{var e={timeout:3e3,maximumAge:3e4,enableHighAccuracy:!1};null==p&&(p=n.watchPosition(e),p.then(null,function(e){o.error(e)},function(e){d=e.coords.latitude,f=e.coords.longitude}))}catch(e){o.error(e)}}function s(){try{p.clearWatch(),p=null}catch(e){o.error(e)}}function u(){return d}function c(){return f}var l={latitude:u,longitude:c,startWatch:i,stopWatch:s,getCurrentPosition:a},p=null,d=null,f=null;return l}angular.module("common").factory("Geolocator",["$log","$q","$timeout","$cordovaGeolocation","LogService",e])}(),function(){function e(e,r,t,n,o,a,i,s,u){function c(){var t=r.defer();u.customer();var n=a.apiurl,o=n+"/api/v1/faqs.json";return e({url:o,method:"get"}).success(function(e){t.resolve(e)}).error(function(e){t.reject(e)}),t.promise}function l(t){var n=r.defer();u.customer();var o=a.apiurl,i=o+"/api/v1/faqs/category_questions.json?id="+t;return e({url:i,method:"get"}).success(function(e){n.resolve(e)}).error(function(e){n.reject(e)}),n.promise}function p(t){var n=r.defer();u.customer();var o=a.apiurl,i=o+"/api/v1/faqs/question.json?id="+t;return e({url:i,method:"get"}).success(function(e){n.resolve(e)}).error(function(e){n.reject(e)}),n.promise}function d(){var t=r.defer();u.shopper();var n=a.apiurl,o=n+"/api/v1/shopper/faqs.json";return e({url:o,method:"get"}).success(function(e){t.resolve(e)}).error(function(e){t.reject(e)}),t.promise}function f(t){var n=r.defer();u.shopper();var o=a.apiurl,i=o+"/api/v1/shopper/faqs/category_questions.json?id="+t;return e({url:i,method:"get"}).success(function(e){n.resolve(e)}).error(function(e){n.reject(e)}),n.promise}function m(t){var n=r.defer();u.shopper();var o=a.apiurl,i=o+"/api/v1/shopper/faqs/question.json?id="+t;return e({url:i,method:"get"}).success(function(e){n.resolve(e)}).error(function(e){n.reject(e)}),n.promise}var h={getFaqs:c,getFaqCategories:c,getFaqsForCategory:l,getFaq:p,getShopperFaqs:d,getShopperFaqsForCategory:f,getShopperFaq:m};return h}var r="HelpService";angular.module("common").factory(r,["$http","$q","LogService","$log","AuthService","ApiEndpoint","$rootScope","$timeout","DefaultHeaders",e])}(),function(){function e(e,r,t,n,o,a,i,s,u,c){function l(){u.isWebApp()?d():p()}function p(){try{Kahuna.launchWithKey(c.kahunaKey),Kahuna.enablePush(),Kahuna.setKahunaCallback(f)}catch(r){e.error(r)}}function d(){try{var r=null;r=u.isProduction()?"p":"s",Kahuna.setEnvironment(r),Kahuna.init(c.kahunaKey,"Shipt","web"),a.isAuthenticated()&&(S(),y()),Kahuna.setInAppMessageCallBack(f)}catch(r){e.error(r)}}function f(e){var r=e.type;e.message;e.parameters=m(e),h(r)&&i.show(e,function(){u.isWebApp()&&Kahuna.dismissInAppMessage()})}function m(e){var r=e.extras,t=e.additionalParameters;return r?r:t?t:void 0}function h(e){return e?"inAppMessage"===e:!!u.isWebApp()||void 0}function v(e){try{var r=e;return e.split(" ").length>0&&(r=e.split(" ")[0]),r}catch(r){return e}}function g(e){try{var r=e;return e.split(" ").length>1&&(r=e.split(" ")[1]),r}catch(r){return e}}function y(){try{var r=a.getUserInfo();if(u.isWebApp()){var t=Kahuna.createUserCredentials();t.add(t.USERNAME_KEY,r.email),t.add(t.EMAIL_KEY,r.email),Kahuna.login(t)}else{var n=KahunaUserCredentials();n.addUserCredential(KahunaUserCredentials().USERNAME_KEY,r.email),n.addUserCredential(KahunaUserCredentials().EMAIL_KEY,r.email),Kahuna.login(n)}}catch(r){e.info(r)}}function S(){try{var e=a.getUserInfo(),r={};r.first_name=v(e.name),r.last_name=g(e.name),r.guest_account=e.guest_account,r.metro_id=e.metro_id,r.metro=e.metro.name,Kahuna.setUserAttributes(r)}catch(e){}}this.productSearch=function(r){try{var t=new KahunaEventBuilder("search");t.addProperty("term",r),Kahuna.track(t.build())}catch(r){e.error(r)}},this.addAddress=function(r){try{var t=new KahunaEventBuilder("add_address");t.addProperty("city",r.city),t.addProperty("state",r.state),t.addProperty("zip",r.zip_code),Kahuna.track(t.build());var n={};n.city=r.city,n.state=r.state,n.zip=r.zip_code,Kahuna.setUserAttributes(n),S()}catch(r){e.error(r)}},this.viewCategory=function(r){try{var t=new KahunaEventBuilder("view_category");t.addProperty("category_viewed",r),Kahuna.track(t.build());var n={};n.last_category_viewed=r,Kahuna.setUserAttributes(n),S()}catch(r){e.error(r)}},this.viewProduct=function(r,t){try{var n="";n+=r.brand_name?r.brand_name+" "+r.name:r.name;var o=new KahunaEventBuilder("view_product");o.addProperty("product_viewed_name",n),o.addProperty("product_viewed_category",t),Kahuna.track(o.build());var a={};a.last_product_viewed_name=n,a.last_product_viewed_category=t,Kahuna.setUserAttributes(a),S()}catch(r){e.error(r)}},this.addProductToCart=function(r,t){try{var n="";n+=r.brand_name?r.brand_name+" "+r.name:r.name;var o=new KahunaEventBuilder("add_product_to_cart");o.addProperty("product_added_name",n),o.addProperty("product_added_category",t),Kahuna.track(o.build());var a={};a.last_product_added_name=n,a.last_product_added_category=t,Kahuna.setUserAttributes(a),S()}catch(r){e.error(r)}},this.addSpecialRequest=function(r){try{Kahuna.trackEvent("add_special_request")}catch(r){e.error(r)}},this.beginCheckout=function(){try{Kahuna.trackEvent("checkout_begin")}catch(r){e.error(r)}},this.addCard=function(){try{Kahuna.trackEvent("add_card")}catch(r){e.error(r)}},this.inviteFriend=function(){try{Kahuna.trackEvent("invite_friend")}catch(r){e.error(r)}},this.tipShopper=function(){try{Kahuna.trackEvent("tip_shoppers")}catch(r){e.error(r)}},this.rateShopper=function(){try{Kahuna.trackEvent("rate_shoppers")}catch(r){e.error(r)}},this.checkoutComplete=function(r,t){try{var n=new KahunaEventBuilder("checkout_complete"),o=!0,a=!1,i=void 0;try{for(var s,u=t[Symbol.iterator]();!(o=(s=u.next()).done);o=!0){var c=s.value;try{if(c.product){var l=c.product,p="";l.brand_name?p+=l.brand_name+" "+l.name:l.name&&(p+=l.name),n.addProperty("product_purchased_name",p)}}catch(r){e.error(r)}}}catch(e){a=!0,i=e}finally{try{!o&&u.return&&u.return()}finally{if(a)throw i}}n.setPurchaseData(r.order_lines.length,100*r.charge_total),Kahuna.track(n.build());var d={};d.last_purchase_date=moment(r.created_at).format(),Kahuna.setUserAttributes(d),S()}catch(r){e.error(r)}},this.updateUser=function(){try{S(),y()}catch(r){e.error(r)}},this.membershipPurchase=function(r){try{var t=new KahunaEventBuilder("membership_purchase");t.addProperty("plan",r.plan.id),t.setPurchaseData(1,r.plan.amount),Kahuna.track(t.build());var n={};n.membership_start_date=moment().format(),n.membership_type=r.plan.id,Kahuna.setUserAttributes(n),S()}catch(r){e.error(r)}},this.bindDeviceEvents=function(){try{u.isGroceryApp()&&!u.isWebApp()?(document.addEventListener("deviceready",this.onDeviceReady,!1),document.addEventListener("pause",this.onPaused,!1),document.addEventListener("resume",this.onResume,!1)):u.isWebApp()&&l()}catch(r){e.error(r)}},this.signup=function(){try{S(),Kahuna.trackEvent("sign_up"),y()}catch(r){e.error(r)}},this.login=function(){try{S(),y()}catch(r){e.error(r)}},this.logout=function(){try{Kahuna.logout()}catch(r){e.error(r)}},this.onDeviceReady=function(){try{l()}catch(r){e.error(r)}},this.onPaused=function(){try{e.info("kahunaService.onPaused"),Kahuna.onStop()}catch(r){e.error(r)}},this.onResume=function(){try{e.info("kahunaService.onResume"),Kahuna.onStart()}catch(r){e.error(r)}},this.bindDeviceEvents()}angular.module("common").service("KahunaService",e),e.$inject=["$log","$q","$filter","LogService","UIUtil","AuthService","inAppMessage","IN_APP_MESSAGE","AppIdentity","CommonConfig"]}(),function(){function e(e){function r(r){try{e.info(r),Rollbar&&"localhost"!=document.location.hostname&&Rollbar.info(r)}catch(e){}}function t(r){try{e.debug(r),Rollbar&&"localhost"!=document.location.hostname&&Rollbar.debug(r)}catch(e){}}function n(r){try{e.error(r),Rollbar&&"localhost"!=document.location.hostname&&Rollbar.critical(r)}catch(e){}}function o(r){try{e.error(r),Rollbar&&"localhost"!=document.location.hostname&&Rollbar.error(r)}catch(e){}}function a(r){try{e.warn(r),Rollbar&&"localhost"!=document.location.hostname&&Rollbar.warning(r)}catch(e){}}function i(e){try{e&&"localhost"!=document.location.hostname&&Rollbar.configure({payload:{person:{id:e.id,username:e.name,email:e.email}}})}catch(e){}}var s={info:r,debug:t,critical:n,error:o,errorLog:o,warning:a,configUserLogInfo:i};return s}angular.module("common").factory("LogService",["$log",e])}(),function(){function e(e,r,t){function n(){try{return navigator.connection?r.isOnline():navigator.onLine}catch(e){return t.error(["networkIsOnline",e]),!0}}function o(){try{return navigator.connection?r.isOffline():!navigator.onLine}catch(e){return t.error(["networkIsOffline",e]),!1}}var a={isOnline:n,isOffline:o};return a}angular.module("common").factory("NetworkConnectionService",["LogService","$cordovaNetwork","$log",e]),angular.module("common").directive("offlineMessage",function(){return{restrict:"EA",require:["offlineMessage"],scope:{readonly:"=?",onHover:"&",onLeave:"&"},controller:"OfflineMessageController",template:'<div ng-if="isOffline()" class="offline-alert"><h2><i class="icon ion-alert-circled"></i><br/>Offline</h2></div>',replace:!0,link:function(e,r,t,n){var o,a;if(a=n[0],o=n[1])return a.init(o)}}}),angular.module("common").controller("OfflineMessageController",["$scope","$attrs","NetworkConnectionService",function(e,r,t){e.isOffline=function(){return t.isOffline()}}])}(),angular.module("common").factory("OpenUrlService",["$log","$location","$rootScope","$ionicHistory",function(e,r,t,n){var o=function(e){e&&(e=decodeURIComponent(e),e=e.substr(e.indexOf("#")-1,e.length-1),setTimeout(function(){var r=e.substr(e.indexOf("#"),e.lastIndexOf("#")),n=e.substr(e.lastIndexOf("#")+1);t.$emit("handleOpenUrl.action."+n),window.location.hash=r},500),window.cordova.removeDocumentEventHandler("handleopenurl"),window.cordova.addStickyDocumentEventHandler("handleopenurl"),document.removeEventListener("handleopenurl",a))},a=function(e){var r=e.url||e.detail.url;o(r)},i=function(){document.addEventListener("handleopenurl",a,!1)};return{handleOpenUrl:a,onResume:i,openUrl:o}}]),function(){function e(e,r,t,n,o,a,i,s,u){function c(e){var o=r.defer(),i=n.photoUploadUrl;u.shopper();try{var s={fileKey:"photo[data]",fileName:"abc123.png",chunkedMode:!1,mimeType:"image/png"};t.debug("uploadFile url",i),t.debug("uploadFile options",s),a.upload(i,e,s,!0).then(function(e){var r=JSON.parse(e.response);t.debug("upload file resp",r),o.resolve(r.id)},function(e){t.error(e),o.reject(e)})}catch(e){o.reject(e)}return o.promise}var l={savePhoto:c};return l}angular.module("common").factory("PhotoService",["$http","$q","$log","ApiEndpoint","UIUtil","$cordovaFileTransfer","LogService","AuthService","DefaultHeaders",e])}(),function(){function e(e,r,t,n,o,a,i){function s(n,o){var a="";a="localhost"!=document.location.hostname||1==webVersion?"https://maps.googleapis.com":"http://localhost:8100/googleapis",a+="/maps/api/geocode/json";var s=n+","+o,u={method:"GET",url:a,params:{latlng:s,key:GOOGLE_PLACES_API_KEY}},c=r.defer();if(i.info("calling google reverseGeolocationSearch lat long: "+s),webVersion){var l=new google.maps.Geocoder,p={lat:parseFloat(n),lng:parseFloat(o)};l.geocode({location:p},function(e){e={results:e},t.info(e),c.resolve(e)})}else e(u).success(function(e){i.info("google reverseGeolocationSearch",e),c.resolve(e)}).error(function(e){i.error("google reverseGeolocationSearch",e),c.reject(e)});return c.promise}function u(n){var o="";o="localhost"!=document.location.hostname||1==webVersion?"https://maps.googleapis.com":"http://localhost:8100/googleapis",o+="/maps/api/place/details/json";var a={method:"GET",url:o,params:{reference:n.reference,key:GOOGLE_PLACES_API_KEY}},s=r.defer();if(i.info("calling google places api "+a.url),webVersion){var a={placeId:n.place_id},u=new google.maps.places.PlacesService(document.createElement("div"));u.getDetails(a,function(e){t.info(e),s.resolve(e)})}else e(a).success(function(e){i.info("google places api success",e),s.resolve(e)}).error(function(e){i.error("google places apierror",e),s.reject(e)});return s.promise}function c(n){t.info("searchquery: "+n);var o="";o="localhost"!=document.location.hostname||1==webVersion?"https://maps.googleapis.com":"http://localhost:8100/googleapis",o+="/maps/api/place/autocomplete/json";var a={method:"GET",url:o,params:{input:n,key:GOOGLE_PLACES_API_KEY}},s=r.defer();if(i.info("calling google places api "+a.url),webVersion){var u=new google.maps.places.AutocompleteService;u.getQueryPredictions({input:n},function(e){e={predictions:e},t.info(e),s.resolve(e)})}else e(a).success(function(e){i.info("google places api success",e),s.resolve(e)}).error(function(e){i.error("google places apierror",e),s.reject(e)});return s.promise}function l(e,n){var o=r.defer();return s(e,n).then(function(e){t.info("results",e),t.info("first result",e.results[0]);var r=p(e.results[0]);o.resolve(r)},function(){}),o.promise}function p(e){try{if(e.other)return null;var r=e;if(r.address_components){var n={result:r},o=d(n);return o}u(r).then(function(e){var r=d(e);return r},function(e){return null})}catch(e){t.error(e)}}function d(e){try{var r={},n={},o={street_number:"short_name",route:"long_name",locality:"long_name",administrative_area_level_1:"long_name",postal_code:"short_name"},a=e;a.result||(a={result:e});var i=!0,s=!1,u=void 0;try{for(var c,l=a.result.address_components[Symbol.iterator]();!(i=(c=l.next()).done);i=!0){var p=c.value,d=p.types[0];if(o[d]){var f=p[o[d]];r[d]=f}}}catch(e){s=!0,u=e}finally{try{!i&&l.return&&l.return()}finally{if(s)throw u}}return r.street_number||r.route?(n.street1=(r.street_number?r.street_number:"")+" "+(r.route?r.route:""),n.city=r.locality,n.state=r.administrative_area_level_1,n.zip_code=r.postal_code,n):null}catch(e){return t.error(e),errorSoHandleAsManualEntry(),null}}var f={searchText:c,reverseGeolocationSearch:s,getReverseGeoAddress:l,getPlaceDetails:u,parseResult:p};return f}angular.module("common").factory("PlacesAutocomplete",["$http","$q","$log","ApiEndpoint","AuthService","Geolocator","LogService",e])}(),function(){function e(e,r,t,n,o,a,i,s,u){function c(e,r){try{if(e.addButton)return!0;if(!r)return!0;if(e.name.toLowerCase().indexOf(r.toLowerCase())>-1||e.brand_name.toLowerCase().indexOf(r.toLowerCase())>-1)return!0;if((e.name.toLowerCase()+" "+e.brand_name.toLowerCase()).indexOf(r.toLowerCase())>-1)return!0;if((e.brand_name.toLowerCase()+" "+e.name.toLowerCase()).indexOf(r.toLowerCase())>-1)return!0;var t=!0,n=!1,o=void 0;try{for(var a,i=e.categories[Symbol.iterator]();!(t=(a=i.next()).done);t=!0){var s=a.value,u=s.name.toLowerCase();if(u.indexOf(r.toLowerCase())>-1)return!0}}catch(e){n=!0,o=e}finally{try{!t&&i.return&&i.return()}finally{if(n)throw o}}return!1}catch(e){return!0}}function l(e,r){a.shopper();var t=n.apiurl+"/api/v1/shopper/products/search.json";if(r)var o={method:"GET",url:t,params:{q:e,page:r}};else var o={method:"GET",url:t,params:{q:e}};return m(o)}function p(e,r){return s.getFeatureToggle(u.ALGOLIA_SEARCH_ENABLED)?i.searchTerm(e,r):f(e,r)}function d(e){var r=arguments.length<=1||void 0===arguments[1]?0:arguments[1],t=arguments[2],n=arguments.length<=3||void 0===arguments[3]?null:arguments[3];return i.searchTerm(e,r,t,n)}function f(e,r){a.customer();var t=encodeURIComponent(e);r?r+=1:r=1;var o=n.apiurl+"/api/v1/products/search/"+t+".json",i={method:"GET",url:o,params:{page:r}};return m(i)}function m(n){var o=r.defer();return e(n).success(function(e){o.resolve(e)}).error(function(e){t.error("error",e),o.reject(e)}),o.promise}var h={searchForShopperProducts:l,searchForGroceryProducts:p,searchForFilterSortGroceryProducts:d,fuzzyMatchProductWithTermFilter:c};return h}angular.module("common").factory("ProductService",["$http","$q","$log","ApiEndpoint","AuthService","DefaultHeaders","AlgoliaFinder","FeatureService","COMMON_FEATURE_TOGGLES",e])}(),function(){function e(e,r,t,n,o,a,i,s,u,c,l,p,d){function f(){var t=r.defer(),n={method:"GET",url:a.apiurl+"/api/v1/shopper/referral_codes.json"};return e(n).success(function(e){t.resolve(e)}).error(function(e){t.reject(data)}),t.promise}function m(){var t=r.defer();d.customer();var n={method:"GET",url:a.apiurl+"/api/v1/referral_codes.json"};return e(n).success(function(e){t.resolve(e)}).error(function(e){t.reject(data)}),t.promise}function h(t){var n=r.defer(),o={method:"POST",url:a.apiurl+"/api/v1/shopper/referral_codes.json",data:{code:t}};return e(o).success(function(e){n.resolve(e)}).error(function(e){n.reject(e)}),n.promise}d.shopper();var v={getCustomerCodes:m,getShopperCodes:f,saveNewShopperCode:h};return v}angular.module("common").factory("ReferralService",["$http","$q","$log","LogService","AuthService","ApiEndpoint","$rootScope","$cordovaFileTransfer","$ionicActionSheet","$cordovaEmailComposer","UIUtil","$cordovaSms","DefaultHeaders",e])}(),function(){function e(e,r,t){function n(r){try{void 0!=r&&(e.info("savePushesWhileShopping pushesWhileShopping",r),localStorage.setItem("setting.pushesWhileShopping",r))}catch(e){return!0}}function o(){try{var r=localStorage.getItem("setting.pushesWhileShopping");return e.info("get pushesWhileShopping",r),!r||(r=JSON.parse(r))}catch(e){return!0}}var a={pushesWhileShopping:o,savePushesWhileShopping:n};return a}angular.module("common").factory("Settings",["$log","$timeout","LogService",e])}(),function(){function e(e,r,t,n){function o(r,n,o,a){if("cordova"in window)e.share(r,n,o,a).then(function(e){},function(e){});else{var i="";a&&(i+=a),t.showSocailShareUrl(i)}}function a(r,t,n){"cordova"in window&&e.shareViaTwitter(r,t,n).then(function(e){},function(e){})}function i(r,t,n){"cordova"in window&&e.shareViaFacebook(r,t,n).then(function(e){},function(e){})}function s(r,t){e.shareViaSMS(r,t).then(function(e){},function(e){})}function u(r,t,n,o,a,i){e.shareViaEmail(r,t,n,o,a,i).then(function(e){},function(e){})}var c={shareNativeShareSheet:o,shareTwitter:a,shareFacebook:i,shareViaEmail:u,shareSMS:s};return c}angular.module("common").factory("SharingService",["$cordovaSocialSharing","$q","UIUtil","$http",e])}(),function(){function e(e,r,t,n,o,a,i,s){function u(){s.customer()}function c(t,o,i){var s=r.defer();u();var c={method:"POST",url:n.apiurl+"/api/v1/log_items/increment_count.json",data:{type:t,event:o,key:i}};return e(c).success(function(e){a.info(["Success log_items/increment_count",e]),s.resolve(e)}).error(function(e){a.error(["Error log_items/increment_count",e]),s.reject(e)}),s.promise}function l(t,o,a){var i=r.defer();u();var s={method:"POST",url:n.apiurl+"/api/v1/log_items/log_info.json",data:{type:t,event:o,info:a}};return e(s),i.resolve(),i.promise}var p={incrementLogItem:c,logInfo:l};return p}var r="ShiptLogItemsService";angular.module("common").factory(r,["$http","$q","$log","ApiEndpoint","UIUtil","LogService","AuthService","DefaultHeaders",e])}(),function(){function e(e,r,t,n,o){function a(r){var t=r?r:"Loading...";e.show({template:"<ion-spinner></ion-spinner><br/>"+t})}function i(){u("Thank you for rating your Shipt Shopper","Since you did not have a great experience with this shopper we will not offer any orders that you place in the future to them. <br/><br/>This is in an effort to provide a great and consistent experience on every Shipt order you place!","Close","button-positive button-clear strong")}function s(){e.hide()}function u(e,n,o,a){return o=o?o:"OK",a=a?a:"button-positive",window.cordova?r.alert(n,e,"OK"):t.alert({title:e,template:n,okText:o,okType:a})}function c(e,o,a,i){var s=n.defer();
if(a=a||"Yes",i=i||"No",window.cordova)r.confirm(o,e,[a,i]).then(function(e){var r=1==e;s.resolve(r)});else{t.show({template:o,title:e,buttons:[{text:i,onTap:function(e){s.resolve(!1)}},{text:"<b>"+a+"</b>",type:"button-positive",onTap:function(e){s.resolve(!0)}}]})}return s.promise}function l(e,o){var a=n.defer();if(window.cordova)r.confirm(o,e,["OK","Cancel"]).then(function(e){var r=1==e;a.resolve(r)});else{var i=t.confirm({title:e,template:o});i.then(function(e){a.resolve(e)})}return a.promise}function p(e){return window.cordova?r.alert(e,"Error","OK"):t.alert({title:"<i  class='icon ion-alert-circled tax-pop-icon'></i>",template:e})}function d(e){var r="";if(_.isArray(e)){var t=!0,n=!1,o=void 0;try{for(var a,i=e[Symbol.iterator]();!(t=(a=i.next()).done);t=!0){var s=a.value;r+=s+"<br><br>"}}catch(e){n=!0,o=e}finally{try{!t&&i.return&&i.return()}finally{if(n)throw o}}p(r)}else p(e)}function f(e){var r=t.alert({title:"<i  class='icon ion-alert-circled warning-pop-icon'></i>",template:"<div class='text-center'>"+e+"</div>"});return r}function m(e){var r=t.alert({title:"<i  class='icon ion-ios-information-outline warning-pop-icon'></i>",template:"<div class='text-center'>"+e+"</div>"});return r}function h(e){e=e;var r=n.defer();e.data.popupWeightInput=null;var o='<label class=\'item item-input\'><input size="font-size: 100%;" type="tel" ui-number-mask="2" placeholder="0.00"  ng-model="data.popupWeightInput"></label>';t.show({template:o,title:"Product Weight",subTitle:"What is the weight of this product?",scope:e,buttons:[{text:"Cancel"},{text:"<b>Save Weight</b>",type:"button-positive",onTap:function(t){e.data.popupWeightInput?r.resolve(angular.copy(e.data.popupWeightInput)):t.preventDefault()}}]});return r.promise}function v(e,r,o,a){var i=n.defer();return a||(a=""),t.prompt({title:e,template:r,inputType:"number",inputPlaceholder:a}).then(function(e){console.log("Your input is",e),e?i.resolve(e):i.reject(e)}),i.promise}function g(e,t,o){var a=n.defer();if(window.cordova)r.prompt(t,e,["Cancel",o]).then(function(e){2==e.buttonIndex?a.resolve(e.input1):defer.reject()});else{var i=prompt(e+"\n\n"+t);a.resolve(i)}return a.promise}function y(e){t.alert({title:"Share This Link!",cssClass:"share-popup",template:"<p>The URL to share is below. Copy it to easily share with friends.</p><label class='item item-input'><input id='shareUrlTextInput' type='text'  value='"+e+"'></label>"});o(function(){var e=angular.element("#shareUrlTextInput");e.select()},100)}var S={showLoading:a,hideLoading:s,showAlert:u,showConfirm:l,showYesNoConfirm:c,showErrorAlert:p,showMultiErrorAlert:d,promptForInput:g,promptForNumber:v,showWarningAlertMessage:f,showInfoAlertMessage:m,showSocailShareUrl:y,promptForProductWeightInput:h,showPromptAfterLowRatingShopper:i};return S}angular.module("common").factory("UIUtil",["$ionicLoading","$cordovaDialogs","$ionicPopup","$q","$timeout",e])}(),function(){function e(e,r,t,n,o,a,i,s){function u(){d().then(function(r){e.defaults.headers.common["X-Shipt-App-Version"]=r})}function c(){var r=n.defer();return v.getVersionObject().then(function(t){var n=s.apiurl+"/api/v1/shopper/shopper/check_shopper_app_version.json",o={method:"POST",url:n,data:t};e(o).success(function(e){r.resolve(e.is_valid)}).error(function(e){r.resolve(!0)})}),r.promise}function l(){var e=n.defer();if("cordova"in window)try{document.addEventListener("deviceready",function(){cordova.getAppVersion.getVersionNumber(function(r){e.resolve(r)})},!1)}catch(e){o.critical(["getVersionNumber",e])}else e.resolve("0");return e.promise}function p(){var e=n.defer();if("cordova"in window)try{document.addEventListener("deviceready",function(){cordova.getAppVersion.getVersionCode(function(r){e.resolve(r)})},!1)}catch(e){o.critical(["getBuildNumber",e])}else e.resolve("0");return e.promise}function d(){var e=n.defer();try{var r=l(),t=p();return n.all([r,t]).then(function(r){var t=r[0],n=r[1];a.info(t+"("+n+")"),e.resolve(t+"("+n+")")},function(){e.reject()}),e.promise}catch(r){return e.reject(),e.promise}}function f(){this.platform=null,this.platformVersion=null,this.version=null,this.build=null,this.app=null}function m(){var e=n.defer(),r=l(),t=p();return n.all([r,t]).then(function(r){var t=new v.version;t.version=r[0],t.build=r[1],t.platform=ionic.Platform.platform(),t.platformVersion=ionic.Platform.version(),a.info(["Version Info",t]),e.resolve(t)}),e.promise}function h(){try{var e=ionic.Platform.device();a.info(e);var r=ionic.Platform.isIPad(),t=ionic.Platform.isIOS(),n=ionic.Platform.isAndroid();if(webVersion)return"web";if(r)return"ipad";if(t)return"ios";if(n)return"android"}catch(e){return a.error(["error :: getPlatform",e]),""}}var v={getPlatformName:h,checkShopperAppVersionForUpdates:c,getVersionObject:m,version:f,getVersionString:d,addVersionToHeaders:u};return u(),v}angular.module("common").factory("VersionProvider",["$http","AuthService","$cordovaAppVersion","$q","LogService","$log","$ionicModal","ApiEndpoint",e])}(),function(){angular.module("common.inAppMessaging",[])}(),function(){function e(e,r,t){r.events={openChooseStoreModal:t.EVENTS.OPEN_CHOOSE_STORE_MODAL},r.inAppMessageTypes={newStoreAnnouncement:t.TYPES.NEW_STORE_ANNOUNCEMENT,acknowledgement:t.TYPES.ACKNOWLEDGEMENT},r.closeModal=function(){r.modal.hide(),r.inAppMessage.callback()},r.$on("$destroy",function(){r.modal.remove()}),r.callToAction=function(n){switch(r.closeModal(),n){case t.TYPES.NEW_STORE_ANNOUNCEMENT:e.$broadcast(t.EVENTS.OPEN_CHOOSE_STORE_MODAL);break;case t.TYPES.ACKNOWLEDGEMENT:}}}angular.module("common.inAppMessaging").controller("InAppMessageController",["$rootScope","$scope","IN_APP_MESSAGE",e])}();var _createClass=function(){function e(e,r){for(var t=0;t<r.length;t++){var n=r[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(r,t,n){return t&&e(r.prototype,t),n&&e(r,n),r}}();!function(){angular.module("common.inAppMessaging").factory("inAppMessage",["$rootScope","$ionicModal","$log",function(e,r,t){var n=function(){function e(r){_classCallCheck(this,e),this.imageUrl=r.parameters.image_url,this.title=r.message,this.content=r.parameters.message_body,this.messageType=r.parameters.type,this.template=this.getTemplate(r.parameters.type)||null}return _createClass(e,[{key:"getTemplate",value:function(e){return{newStoreAnnouncement:"templates/inAppMessageModal.html",acknowledgement:"templates/inAppMessageModal.html"}[e]||"templates/inAppMessageModal.html"}}]),e}();return{show:function(o,a){var i=e.$new();i.inAppMessage=new n(o),i.inAppMessage.callback=a,i.inAppMessage.template?r.fromTemplateUrl(i.inAppMessage.template,{scope:i,animation:"slide-in-up",backdropClickToClose:!1,hardwareBackButtonClose:!1}).then(function(e){i.modal=e,i.modal.show()}):t.error("Unable to display in app message template")}}}])}(),function(){function e(e,r){var t=this;t.cancel=function(){e.cancelModal()},t.save=function(r){e.saveModal(r)},t.currentMetroId=e.currentMetroId,t.metros=e.metros,t.selectedMetro=null;var n=!0,o=!1,a=void 0;try{for(var i,s=t.metros[Symbol.iterator]();!(n=(i=s.next()).done);n=!0){var u=i.value;u.id==t.currentMetroId&&(t.selectedMetro=u)}}catch(e){o=!0,a=e}finally{try{!n&&s.return&&s.return()}finally{if(o)throw a}}}angular.module("common").controller("metroSelectModalController",["$scope","$rootScope",e])}(),function(){function e(e,r,t){function n(e){var n=t.defer(),a="templates/metroSelectModal.html";return r.fromTemplateUrl(a,{scope:e,focusFirstInput:!0}).then(function(e){o=e,n.resolve(o)}),n.promise}var o=null,a=function(r,a,i){var s=t.defer();return r=r||e.$new(),r.currentMetroId=a,r.metros=i,n(r).then(function(e){e.show()}),r.saveModal=function(e){s.resolve(e),o.hide(),o.remove(),o=null},r.cancelModal=function(){s.reject(),o.hide(),o.remove(),o=null},r.$on("$destroy",function(){o&&o.remove()}),s.promise};return{showModal:a}}angular.module("common").factory("metroSelectModalProvider",["$rootScope","$ionicModal","$q",e])}(),function(){function e(e,r){var t=this;t.placeholder="Instructions from you to the shopper about this product.",t.text="",t.cancelNotes=function(){e.cancelModal()},t.saveNotes=function(){e.saveModal(t.text)},t.title=e.title,t.text=e.text,t.placeholder=e.placeholder}angular.module("common").controller("TextNotesModalController",["$scope","$rootScope",e])}(),function(){function e(e,r,t){function n(e){var n=t.defer(),a="templates/textNotesModal.html";return r.fromTemplateUrl(a,{scope:e,focusFirstInput:!0}).then(function(e){o=e,n.resolve(o)}),n.promise}var o=null,a=function(r,a,i,s){var u=t.defer();return r=r||e.$new(),r.text=null,r.text=s,r.title=a,r.placeholder=i,n(r).then(function(e){e.show()}),r.saveModal=function(e){u.resolve(e),o.hide(),o.remove(),o=null},r.cancelModal=function(){u.reject(),o.hide(),o.remove(),o=null},r.$on("$destroy",function(){o&&o.remove()}),u.promise};return{showModal:a}}angular.module("common").factory("TextNotesModalProvider",["$rootScope","$ionicModal","$q",e])}(),angular.module("common").directive("ionSearchBar",["$rootScope","$timeout","$q","$log","$cordovaKeyboard","UIUtil","AppAnalytics","FeatureService","COMMON_FEATURE_TOGGLES","FILTER_SORT",ionSearchBar]),function(){function e(e,r,t,n,o,a,i){function s(){i.getFaq(u.q.id).then(function(e){u.question=e})}var u=this;u.question=void 0,u.q=angular.fromJson(r.q),s()}angular.module("common").controller("ArticleController",["$scope","$stateParams","$state","UIUtil","$log","AccountService","HelpService",e])}(),function(){function e(e,r,t,n){function o(){a.loadingSpinner=!0,t.getFaqsForCategory(a.category.id).then(function(e){a.articles=e,a.loadingSpinner=!1},function(e){a.errorHappened=!0,a.loadingSpinner=!1})}var a=this;a.searchArticles=[],a.searchQuery="",a.showSearch=!1,a.category=angular.fromJson(n.category),a.clearSearch=function(){a.searchQuery=""},a.showList=function(){return!!a.articles&&(!(a.articles.length<1)&&!(r("filter")(a.articles,a.searchQuery).length<1))},a.articleClick=function(r){e.go("app.faqArticle",{q:angular.toJson(r)})},o()}angular.module("common").controller("FaqController",["$state","$filter","HelpService","$stateParams",e])}();