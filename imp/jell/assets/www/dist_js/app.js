!function(){"use strict";var e=angular.module("jell",["ionic","ngCordova","ngResource","angularMoment","templates","jell.controllers","jell.controllers.organization","jell.controllers.team","jell.controllers.member","jell.controllers.report","jell.services","jell.directives","jell.resolvers","jell.filters","jell.constants"]);e.config(["$stateProvider","$urlRouterProvider",function(e,t){e.state("splash",{url:"/splash",templateUrl:"splash.html",controller:"SplashCtrl"}).state("app",{url:"/app",cache:!1,"abstract":!0,templateUrl:"app.html",controller:"AppCtrl",resolve:{currentUser:["Auth",function(e){return e.currentUser()}]}}).state("app.home",{url:"/home",cache:!1,templateUrl:"home.html",controller:"HomeCtrl",resolve:{organizations:["AppResolver",function(e){return e.organizations()}]}}).state("app.organization",{url:"/organizations","abstract":!0,template:"<ion-nav-view/>",params:{organizationId:null},resolve:{organization:["$stateParams","AppResolver",function(e,t){return t.organization(e.organizationId)}]}}).state("app.organization.home",{url:"/:organizationId/home",templateUrl:"organization/home.html",controller:"OrganizationHomeCtrl",resolve:{reportsDue:["$stateParams","AppResolver",function(e,t){return t.organizationReportsDue(e.organizationId)}]}}).state("app.organization.reports",{url:"/:organizationId/reports",templateUrl:"organization/reports.html",controller:"OrganizationReportsCtrl",resolve:{reports:["$stateParams","AppResolver",function(e,t){return t.organizationReports(e.organizationId)}]}}).state("app.organization.teams",{url:"/:organizationId/teams",templateUrl:"organization/teams.html",controller:"OrganizationTeamsCtrl"}).state("app.organization.members",{url:"/:organizationId/members",templateUrl:"organization/members.html",controller:"OrganizationMembersCtrl"}).state("app.team",{url:"/teams","abstract":!0,template:"<ion-nav-view/>",params:{teamId:null},resolve:{team:["$stateParams","AppResolver",function(e,t){return t.team(e.teamId)}]}}).state("app.team.home",{url:"/:teamId/home?date",templateUrl:"team/home.html",controller:"TeamHomeCtrl",resolve:{teamStatuses:["$stateParams","AppResolver",function(e,t){return t.teamStatuses(e.teamId,e.date)}],reportsDue:["$stateParams","AppResolver",function(e,t){return t.teamReportsDue(e.teamId)}]}}).state("app.team.members",{url:"/:teamId/members",templateUrl:"team/members.html",controller:"TeamMembersCtrl",resolve:{team:["$stateParams","AppResolver",function(e,t){return t.team(e.teamId,!0)}]}}).state("app.team.add-members",{url:"/:teamId/add-members",templateUrl:"team/add-members.html",controller:"TeamAddMembersCtrl",resolve:{team:["$stateParams","AppResolver",function(e,t){return t.team(e.teamId,!0)}]}}).state("app.member",{url:"/members","abstract":!0,template:"<ion-nav-view/>",params:{organizationId:null,userId:null},resolve:{organization:["$stateParams","AppResolver",function(e,t){return t.organization(e.organizationId)}],organizationMember:["$stateParams","AppResolver",function(e,t){return t.organizationMember(e.organizationId,e.userId)}]}}).state("app.member.home",{url:"/:organizationId/:userId/home",templateUrl:"member/home.html",controller:"MemberHomeCtrl"}).state("app.comments",{url:"/status/:statusId/:answerId/comments",params:{statusId:null,answerId:null,status:null,answer:null},templateUrl:"status/comments.html",controller:"CommentsCtrl"}).state("app.report",{url:"/:organizationId/reports/:reportId","abstract":!0,template:"<ion-nav-view/>",params:{organizationId:null,reportId:null},resolve:{organization:["$stateParams","AppResolver",function(e,t){return t.organization(e.organizationId)}],report:["$stateParams","AppResolver",function(e,t){return t.report(e.reportId)}]}}).state("app.report.statuses",{url:"/statuses?date",templateUrl:"report/statuses.html",controller:"ReportStatusesCtrl",resolve:{reportStatuses:["$stateParams","AppResolver",function(e,t){return t.reportStatuses(e.reportId,e.date)}]}}),t.otherwise("/splash")}]),e.run(["$rootScope","$cordovaGoogleAnalytics","$ionicPlatform","$ionicPopup","$ionicLoading","$window","$timeout","$state","Auth","Track","config",function(e,t,n,a,i,r,o,s,c,u,l){e.$on("jell.error",function(e,t){var n="Unknown error.";t&&("string"==typeof t?n=t:t.data&&t.data.error?n=t.data.error:t.error&&(n=t.error)),a.alert({title:"Error",template:n})}),e.$on("jell.success",function(e,t){a.alert({title:"Success",template:t})}),e.$on("jell.unauthorized",function(){i.hide(),c.removeSession(),s.go("splash")}),e.$on("$stateChangeStart",function(){i.show({delay:300,hideOnStateChange:!0,noBackdrop:!0})}),e.$on("$stateChangeSuccess",function(){var e=s.current.controller.replace(/Ctrl$/,"").replace(/(?!^)([A-Z])/g," $1");u.view(e)}),e.$on("$stateChangeError",function(){i.hide()}),n.ready(function(){navigator&&navigator.splashscreen&&o(function(){navigator.splashscreen.hide()},500),window.cordova&&(t.startTrackerWithId(l.GA_ID),window.StatusBar&&StatusBar.styleLightContent())})}])}(),function(){"use strict";var e=angular.module("jell.controllers",[]);e.controller("SplashCtrl",["$scope","$state","$ionicHistory","Auth",function(e,t,n,a){a.isLoggedIn()&&(e.hide=!0,n.nextViewOptions({disableAnimate:!0,disableBack:!0,historyRoot:!0}),t.go("app.home")),e.signup=function(){e.$emit("signup.show")},e.login=function(){e.$emit("login.show")}}]),e.controller("AppCtrl",["$rootScope","$window","$scope","$state","$ionicHistory","$ionicPopup","Auth","Track","currentUser",function(e,t,n,a,i,r,o,s,c){n.currentUser=c,o.currentOrganization().then(function(e){n.organization=e}),n.$on("auth.currentUser.modified",function(e,t){n.currentUser=t.user}),window.intercom&&intercom.registerIdentifiedUser({userId:c.id_str,email:c.email}),n.showTasks=function(){n.$emit("tasksEdit.show",{organization_id_str:n.organization.id_str})},n.showSettings=function(){n.$emit("memberSettings.show",{user:n.currentUser})},n.showNotifications=function(){n.$emit("memberNotifications.show",{user:n.currentUser,organization:n.organization})},n.switchOrganization=function(e){o.setOrganization(e),n.organization=e,i.nextViewOptions({disableBack:!0,historyRoot:!0}),a.go("app.organization.home",{organizationId:e.id_str})},n.createOrganization=function(){n.$emit("organizationCreate.show")},n.logout=function(){r.confirm({title:"Logout",template:"Are you sure you want to logout?"}).then(function(e){if(e){var t=o.logout();t.then(function(){s.event("User","Logout"),window.intercom&&intercom.reset()}),t["catch"](function(e){n.$emit("jell.error",e)}),t["finally"](function(){a.go("splash")})}})}}]),e.controller("HomeCtrl",["$scope","$state","$ionicHistory","Auth",function(e,t,n,a){e.welcome=!1,a.currentOrganization().then(function(e){n.nextViewOptions({disableAnimate:!0,disableBack:!0,historyRoot:!0}),t.go("app.organization.home",{organizationId:e.id_str})})["catch"](function(){e.welcome=!0}),e.createOrganization=function(){e.$emit("organizationCreate.show")}}]),e.controller("CommentsCtrl",["$scope","$state","$stateParams","$timeout","Status","Comment",function(e,t,n,a,i,r){e.status=n.status,e.answer=n.answer,e.comment_text=null,window.cordova&&window.cordova.plugins.Keyboard&&(cordova.plugins.Keyboard.disableScroll(!0),e.$on("$destroy",function(){cordova.plugins.Keyboard.disableScroll(!1)})),e.refresh=function(){var t=i.get({id:n.statusId}).$promise;t.then(function(t){e.status=t.status;e:for(var a=0;a<e.status.answers.length;a++)for(var i=e.status.answers[a],r=0;r<i.answers.length;r++){var o=i.answers[r];if(o.id_str===n.answerId){e.answer=o;break e}}}),t["catch"](function(t){e.$emit("jell.error",t)}),t["finally"](function(){e.$broadcast("scroll.refreshComplete")})},e.status&&e.answer||e.refresh(),e.submit=function(){if(e.comment_text.match(/\S/)){e.submitting=!0;var t=new r({status_update_id:e.answer.id_str,text:e.comment_text}),n=t.$save();n.then(function(t){e.answer.commented=!0,e.answer.comments.push(t.comment),e.comment_text=""}),n["catch"](function(t){e.$emit("jell.error",t)}),n["finally"](function(){e.submitting=!1})}}}])}(),function(){"use strict";var e=angular.module("jell.controllers.organization",[]);e.controller("OrganizationHomeCtrl",["$rootScope","$scope","$q","$ionicActionSheet","$ionicModal","$filter","Organization","currentUser","organization","reportsDue",function(e,t,n,a,i,r,o,s,c,u){t.currentUser=s,t.$on("auth.currentUser.modified",function(e,n){t.currentUser=n.user}),t.$emit("pushNotifications.register"),t.init=function(e,n){t.organization=e,t.reportsDue=n,t.teams=[],t.hasStandupTeams=!1,angular.forEach(e.teams,function(e){(e.is_member||e.is_subscriber)&&t.teams.push(e),e.is_member&&e.enable_standup&&(t.hasStandupTeams=!0)})},t.init(c,u),t.refresh=function(){var e=[];e.push(o.get({id:t.organization.id_str}).$promise),e.push(o.statusReports({id:t.organization.id_str,is_due:!0,exclude_standups:!1}).$promise),n.all(e).then(function(e){var n,a;angular.forEach(e,function(e){e.organization&&(n=e.organization),e.status_reports&&(a=e.status_reports)}),t.init(n,a)})["catch"](function(e){t.$emit("jell.error",e)})["finally"](function(){t.$broadcast("scroll.refreshComplete")})},e.$on("jell.organization.refresh",function(e,n){n.organization_id_str===t.organization.id_str&&t.refresh()}),e.$on("jell.status.reload",function(){t.refresh()}),t.createTeam=function(){t.$emit("teamCreate.show",{organization:t.organization})},t.showSettings=function(){t.$emit("organizationSettings.show",{organization:t.organization})},t.postStatus=function(){if(0!==t.reportsDue.length)if(1===t.reportsDue.length)t.$emit("reportSubmit.show",{report:t.reportsDue[0]});else{var e=[];angular.forEach(t.reportsDue,function(t){var n=angular.copy(t);n.text=r("limitTo")(t.name,25)+(t.name.length>25?"...":""),e.push(n)});a.show({buttons:e,titleText:"Select Your Report",cancelText:"Cancel",buttonClicked:function(n){return t.$emit("reportSubmit.show",{report:e[n]}),!0}})}}}]),e.controller("OrganizationReportsCtrl",["$rootScope","$scope","$filter","Organization","organization","reports",function(e,t,n,a,i,r){t.organization=i,t.init=function(e){t.reports=n("filter")(e,{archived:!1})},t.init(r),t.refresh=function(){var e=a.statusReports({id:t.organization.id_str}).$promise;e.then(function(e){t.init(e.status_reports)}),e["catch"](function(e){t.$emit("jell.error",e)}),e["finally"](function(){t.$broadcast("scroll.refreshComplete")})},e.$on("jell.status.reload",function(){t.refresh()})}]),e.controller("OrganizationTeamsCtrl",["$scope","Organization","organization",function(e,t,n){e.organization=n,e.refresh=function(){var n=t.get({id:e.organization.id_str}).$promise;n.then(function(t){e.organization=t.organization,e.$apply()}),n["catch"](function(t){e.$emit("jell.error",t)}),n["finally"](function(){e.$broadcast("scroll.refreshComplete")})},e.createTeam=function(){e.$emit("teamCreate.show",{organization:e.organization})}}]),e.controller("OrganizationMembersCtrl",["$scope","$cordovaContacts","$state","$ionicHistory","$ionicActionSheet","$ionicPopup","Organization","OrganizationMember","Track","currentUser","organization",function(e,t,n,a,i,r,o,s,c,u,l){e.currentUser=u,e.organization=l,e.refresh=function(){var t=o.get({id:e.organization.id_str}).$promise;t.then(function(t){e.organization=t.organization,e.$apply()}),t["catch"](function(t){e.$emit("jell.error",t)}),t["finally"](function(){e.$broadcast("scroll.refreshComplete")})},e.invite=function(){if(window.cordova){i.show({buttons:[{text:"Select Contacts"},{text:"Enter Email Addresses"}],titleText:"Invite Members",cancelText:"Cancel",buttonClicked:function(t){return 0===t?e.pickContact():e.showInvite(),!0}})}else e.showInvite()},e.showInvite=function(){e.$emit("organizationInvite.show",{organization:e.organization})},e.pickContact=function(){window.cordova?(c.view("Organization Invite Contacts"),t.pickContact().then(function(t){if(t.emails&&t.emails.length&&t.emails[0].value){var n=t.emails[0].value;e.inviting=!0;var a=new o({id_str:e.organization.id_str,email:n}).$invite();a.then(function(t){e.$emit("jell.success","An invite to "+n+" was sent successfully."),e.organization.invites.push(t.invites[0]),c.event("Organization","Invite Contact")}),a["catch"](function(t){e.$emit("jell.error",t)}),a["finally"](function(){e.inviting=!1})}else e.$emit("jell.error","Could not find an email address for the selected contact.")},function(t){e.$emit("jell.error",t)})):e.$emit("jell.error","Contacts functionality is not supported.")},e.resendInvite=function(t){var n=new o({id_str:e.organization.id_str,invite_id:t.id_str});t.processing=!0;var a=n.$resendInvite();a.then(function(){e.$emit("jell.success","The invite was resent successfully."),c.event("Organization","Resend Invite")}),a["catch"](function(t){e.$emit("jell.error",t)}),a["finally"](function(){t.processing=!1})},e.deleteInvite=function(t){r.confirm({title:"Delete Invite",template:"Are you sure you want to un-invite "+t.email+"?"}).then(function(n){if(n){var a=new o({id_str:e.organization.id_str,invite_id:t.id_str});t.processing=!0;var i=a.$deleteInvite();i.then(function(){for(var n=0;n<e.organization.invites.length;n++)if(e.organization.invites[n].id_str===t.id_str){e.organization.invites.splice(n,1);break}c.event("Organization","Delete Invite")}),i["catch"](function(n){t.processing=!1,e.$emit("jell.error",n)})}})},e.inviteActions=function(t){(e.organization.is_admin||t.sender.id_str===e.currentUser.id_str)&&i.show({buttons:[{text:"Resend"}],titleText:"Select Action",destructiveText:"Delete",cancelText:"Cancel",buttonClicked:function(){return e.resendInvite(t),!0},destructiveButtonClicked:function(){return e.deleteInvite(t),!0}})},e.toggleAdmin=function(t){var n={organization_id_str:e.organization.id_str,user_id_str:t.user.id_str,admin:!t.admin};t.updating=!0;var a=new s(n).$update();a.then(function(){t.admin=!t.admin,e.$emit("jell.success",t.user.name+(t.admin?" is now an organization admin.":"is no longer an organization admin.")),c.event("Organization","Update Member")}),a["catch"](function(t){e.$emit("jell.error",t)}),a["finally"](function(){t.processing=!1})},e.removeMember=function(t){r.confirm({title:"Remove Team Member",template:"Are you sure you want to remove "+t.user.name+" from the organization?"}).then(function(n){if(n){var a={organization_id_str:e.organization.id_str,user_id_str:t.user.id_str};t.updating=!0;var i=new s(a).$delete();i.then(function(){for(var n=0;n<e.organization.members.length;n++)if(e.organization.members[n].user_id_str===t.user_id_str){e.organization.members.splice(n,1);break}c.event("Organization","Remove Member")}),i["catch"](function(t){e.$emit("jell.error",t)}),i["finally"](function(){t.processing=!1})}})},e.leaveOrganization=function(t){var i=!0;angular.forEach(e.organization.members,function(t){t.admin&&t.user.id_str!==e.currentUser.id_str&&(i=!1)}),i?r.alert({title:"Error",template:"Sorry, you can't leave the organization because you're the only admin. You'll need to delete the organization or make another user an admin."}):r.confirm({title:"Leave Organization",template:"Are you sure you want to leave the organization?"}).then(function(i){if(i){t.processing=!0;var r=new o(e.organization).$leave();r.then(function(){for(var t=0;t<e.currentUser.organizations.length;t++)if(e.currentUser.organizations[t].id_str===e.organization.id_str){e.currentUser.organizations.splice(t,1);break}a.nextViewOptions({disableBack:!0,historyRoot:!0}),n.go("app.home",{organizationId:null},{reload:!0}),c.event("Organization","Leave")}),r["catch"](function(t){e.$emit("jell.error",t)}),r["finally"](function(){t.processing=!1})}})},e.memberActions=function(t){t.user_id_str===e.currentUser.id_str?i.show({titleText:"Select Action",destructiveText:"Leave Organization",cancelText:"Cancel",destructiveButtonClicked:function(){return e.leaveOrganization(t),!0}}):i.show({buttons:[{text:"Change Permissions"}],titleText:"Select Action",destructiveText:"Remove",cancelText:"Cancel",buttonClicked:function(){return e.toggleAdmin(t),!0},destructiveButtonClicked:function(){return e.removeMember(t),!0}})}}])}(),function(){"use strict";var e=angular.module("jell.controllers.team",[]);e.controller("TeamHomeCtrl",["$rootScope","$scope","$q","$stateParams","Team","currentUser","team","teamStatuses","reportsDue",function(e,t,n,a,i,r,o,s,c){t.currentUser=r,t.team=o,t.currentDate=a.date||t.team.current_status_date,t.latestDate=t.team.current_status_date,t.init=function(e,n){t.pastHistoryLimit=e.past_history_limit,t.statuses=e.statuses,t.reportsDue=n,t.previousDate=e.previous_statuses.length?e.previous_statuses[0]:null,t.nextDate=e.next_statuses&&e.next_statuses.length?e.next_statuses[0]:null,t.needsStatus=t.team.is_member&&!t.team.has_current_status&&t.team.enable_standup&&t.currentDate===t.team.current_status_date,t.showCta=t.team.is_member&&t.currentDate===t.team.current_status_date&&t.reportsDue.length},t.init(s,c),t.refresh=function(){var e=[];e.push(i.statuses({id:t.team.id_str,date:t.currentDate,all:!0}).$promise),e.push(i.statusReports({id:t.team.id_str,is_due:!0,exclude_standups:!1}).$promise),n.all(e).then(function(e){var n,a;angular.forEach(e,function(e){e.statuses&&(n=e),e.status_reports&&(a=e.status_reports)}),t.init(n,a)})["catch"](function(e){t.$emit("jell.error",e)})["finally"](function(){t.$broadcast("scroll.refreshComplete")})},e.$on("jell.team.refresh",function(e,n){if(n.team_id_str===t.team.id_str){var a=i.get({id:t.team.id_str}).$promise;a.then(function(e){t.team=e.team,t.refresh()})}}),e.$on("jell.status.reload",function(){t.refresh()}),t.switchDate=function(e){t.loading=!0;var n=new i(t.team).$statuses({date:e,all:!0});n.then(function(n){t.currentDate=e,t.init(n)}),n["catch"](function(e){t.$emit("jell.error",e)}),n["finally"](function(){t.loading=!1})},t.showSettings=function(){t.$emit("teamSettings.show",{team:t.team})},t.postStatus=function(){if(0!==t.reportsDue.length)if(1===t.reportsDue.length)t.$emit("reportSubmit.show",{report:t.reportsDue[0]});else{var e=[];angular.forEach(t.reportsDue,function(t){var n=angular.copy(t);n.text=$filter("limitTo")(t.name,25)+(t.name.length>25?"...":""),e.push(n)});$ionicActionSheet.show({buttons:e,titleText:"Select Your Report",cancelText:"Cancel",buttonClicked:function(n){return t.$emit("reportSubmit.show",{report:e[n]}),!0}})}}}]),e.controller("TeamMembersCtrl",["$scope","$state","$ionicHistory","$ionicActionSheet","$ionicPopup","Team","TeamMember","Track","currentUser","team",function(e,t,n,a,i,r,o,s,c,u){e.currentUser=c,e.team=u,e.organizationAdmins={},angular.forEach(e.team.organization.members,function(t){e.organizationAdmins[t.user_id_str]=t.admin}),e.refresh=function(){var t=r.get({id:e.team.id_str}).$promise;t.then(function(t){var n=angular.copy(e.team.organization);e.team=t.team,e.team.organization=n,e.$apply()}),t["catch"](function(t){e.$emit("jell.error",t)}),t["finally"](function(){e.$broadcast("scroll.refreshComplete")})},e.resendInvite=function(t){var n=new r({id_str:e.team.id_str,invite_id:t.id_str});t.processing=!0;var a=n.$resendInvite();a.then(function(){e.$emit("jell.success","The invite was resent successfully."),s.event("Team","Resend Invite")}),a["catch"](function(t){e.$emit("jell.error",t)}),a["finally"](function(){t.processing=!1})},e.deleteInvite=function(t){i.confirm({title:"Delete Invite",template:"Are you sure you want to un-invite "+t.organization_invite.email+"?"}).then(function(n){if(n){var a=new r({id_str:e.team.id_str,invite_id:t.id_str});t.processing=!0;var i=a.$deleteInvite();i.then(function(){for(var n=0;n<e.team.invites.length;n++)if(e.team.invites[n].id_str===t.id_str){e.team.invites.splice(n,1);break}s.event("Team","Delete Invite")}),i["catch"](function(n){t.processing=!1,e.$emit("jell.error",n)})}})},e.inviteActions=function(t){(e.team.is_admin||t.sender.id_str===e.currentUser.id_str)&&a.show({buttons:[{text:"Resend"}],titleText:"Select Action",destructiveText:"Delete",cancelText:"Cancel",buttonClicked:function(){return e.resendInvite(t),!0},destructiveButtonClicked:function(){return e.deleteInvite(t),!0}})},e.toggleAdmin=function(t){var n={team_id_str:e.team.id_str,user_id_str:t.user.id_str,admin:!t.admin};t.processing=!0;var a=new o(n).$update();a.then(function(){t.admin=!t.admin,e.$emit("jell.success",t.user.name+(t.admin?" is now a team admin.":"is no longer a team admin.")),s.event("Team","Update Member")}),a["catch"](function(t){e.$emit("jell.error",t)}),a["finally"](function(){t.processing=!1})},e.removeMember=function(t){i.confirm({title:"Remove Team Member",template:"Are you sure you want to remove "+t.user.name+" from the team?"}).then(function(n){if(n){var a={team_id_str:e.team.id_str,user_id_str:t.user.id_str};t.processing=!0;var i=new o(a).$delete();i.then(function(){for(var n=0;n<e.team.members.length;n++)if(e.team.members[n].user_id_str===t.user_id_str){e.team.members.splice(n,1);break}e.$emit("jell.team.refresh",{team_id_str:e.team.id_str}),s.event("Team","Remove Member")}),i["catch"](function(t){e.$emit("jell.error",t)}),i["finally"](function(){t.processing=!1})}})},e.leaveTeam=function(a){i.confirm({title:"Leave Team",template:"Are you sure you want to leave the team?"}).then(function(i){if(i){a.processing=!0;var o=new r(e.team).$leave();o.then(function(){n.nextViewOptions({disableBack:!0,historyRoot:!0}),t.go("app.organization.home",{organizationId:e.team.organization_id_str}),e.$emit("jell.team.refresh",{team_id_str:e.team.id_str}),s.event("Team","Team Leave")}),o["catch"](function(t){e.$emit("jell.error",t)}),o["finally"](function(){a.processing=!1})}})},e.memberActions=function(t){t.user_id_str===e.currentUser.id_str?a.show({titleText:"Select Action",destructiveText:"Leave Team",cancelText:"Cancel",destructiveButtonClicked:function(){return e.leaveTeam(t),!0}}):e.team.is_admin&&(e.organizationAdmins[t.user_id_str]?a.show({titleText:"Select Action",destructiveText:"Remove",cancelText:"Cancel",destructiveButtonClicked:function(){return e.removeMember(t),!0}}):a.show({buttons:[{text:"Change Permissions"}],titleText:"Select Action",destructiveText:"Remove",cancelText:"Cancel",buttonClicked:function(){return e.toggleAdmin(t),!0},destructiveButtonClicked:function(){return e.removeMember(t),!0}}))},e.unsubscribe=function(a){i.confirm({title:"Unsubscribe",template:"Are you sure you want to unsubscribe from the team?"}).then(function(i){if(i){a.processing=!0;var o=new r(e.team).$unsubscribe();o.then(function(){n.nextViewOptions({disableBack:!0,historyRoot:!0}),t.go("app.organization.home",{organizationId:e.team.organization_id_str}),e.$emit("jell.team.refresh",{team_id_str:e.team.id_str}),s.event("Team","Unsubscribe")}),o["catch"](function(t){e.$emit("jell.error",t)}),o["finally"](function(){a.processing=!1})}})},e.subscriberActions=function(t){t.user_id_str===e.currentUser.id_str&&a.show({titleText:"Select Action",destructiveText:"Unsubscribe",cancelText:"Cancel",destructiveButtonClicked:function(){return e.unsubscribe(t),!0}})}}]),e.controller("TeamAddMembersCtrl",["$scope","$cordovaContacts","$ionicActionSheet","$ionicPopup","Team","Track","team","currentUser",function(e,t,n,a,i,r,o,s){e.team=o,e.currentUser=s,e.members={},angular.forEach(e.team.members,function(t){e.members[t.user.id_str]=!0}),e.users=[],angular.forEach(e.team.organization.members,function(t){e.members[t.user.id_str]||e.users.push(t.user)}),e.add=function(t){t.processing=!0;var n=new i({id_str:e.team.id_str,user_id:t.id_str}).$addMember();n.then(function(){for(var n=0;n<e.users.length;n++)if(e.users[n].id_str===t.id_str){e.users.splice(n,1);break}t.id_str===e.currentUser.id_str?e.$emit("jell.success","You were added successfully."):e.$emit("jell.success",t.first_name+" was added successfully."),e.$emit("jell.team.refresh",{team_id_str:e.team.id_str}),r.event("Team","Add Member")}),n["catch"](function(t){e.$emit("jell.error",t)}),n["finally"](function(){t.processing=!1})},e.invite=function(){if(window.cordova){n.show({buttons:[{text:"Select Contacts"},{text:"Enter Email Addresses"}],titleText:"Invite Members",cancelText:"Cancel",buttonClicked:function(t){return 0===t?e.pickContact():e.showInvite(),!0}})}else e.showInvite()},e.showInvite=function(){e.$emit("teamInvite.show",{team:e.team})},e.pickContact=function(){window.cordova?(r.view("Team Invite Contacts"),t.pickContact().then(function(t){if(t.emails&&t.emails.length&&t.emails[0].value){var n=t.emails[0].value;e.inviting=!0;var a=new i({id_str:e.team.id_str,email:n}).$invite();a.then(function(t){e.$emit("jell.success","An invite to "+n+" was sent successfully."),e.team.invites.push(t.invites[0]),r.event("Team","Invite Contact")}),a["catch"](function(t){e.$emit("jell.error",t)}),a["finally"](function(){e.inviting=!1})}else e.$emit("jell.error","Could not find an email address for the selected contact.")},function(t){e.$emit("jell.error",t)})):e.$emit("jell.error","Contacts functionality is not supported.")}}])}(),function(){"use strict";var e=angular.module("jell.controllers.member",[]);e.controller("MemberHomeCtrl",["$scope","OrganizationMember","currentUser","organization","organizationMember",function(e,t,n,a,i){e.currentUser=n,e.organization=a,e.init=function(t){e.member=t.member,e.user=t.user,e.teams=t.teams,e.statuses=t.statuses},e.init(i),e.refresh=function(){var n=t.get({organization_id:e.organization.id_str,user_id:e.user.id_str}).$promise;n.then(function(t){e.init(t),e.$apply()}),n["catch"](function(t){e.$emit("jell.error",t)}),n["finally"](function(){e.$broadcast("scroll.refreshComplete")})},e.more=function(){var n=e.statuses&&e.statuses.length?{offset:e.statuses.slice(-1)[0].id_str}:{};n.all=!0;var a=new t({user_id_str:e.user.id_str,organization_id_str:e.member.organization_id_str}).$statuses(n);a.then(function(t){t.statuses&&t.statuses.length?e.statuses=e.statuses.concat(t.statuses):(e.eof=!0,e.past_history_limit=t.past_history_limit),e.$broadcast("scroll.infiniteScrollComplete")}),a["catch"](function(t){e.$emit("jell.error",t)})}}])}(),function(){"use strict";var e=angular.module("jell.controllers.report",[]);e.controller("ReportStatusesCtrl",["$rootScope","$scope","$stateParams","StatusReport","currentUser","organization","report","reportStatuses",function(e,t,n,a,i,r,o,s){t.currentUser=i,t.organization=r,t.report=o,t.title="standup"===o.type?o.team.name+" "+o.name:o.name,t.currentDate=n.date||o.previous_status_date,t.latestDate=o.previous_status_date,t.submitters=a.submitters(o,r),t.init=function(e){if(t.pastHistoryLimit=e.past_history_limit,t.statuses=e.statuses,t.previousDate=e.previous_statuses.length?e.previous_statuses[0]:null,t.nextDate=e.next_statuses&&e.next_statuses.length?e.next_statuses[0]:null,t.report.can_submit&&t.currentDate===t.report.previous_status_date){var n=!0;angular.forEach(t.statuses,function(e){e.user.id_str===t.currentUser.id_str&&(n=!1)}),t.showCta=n}else t.showCta=!1},t.init(s),t.refresh=function(){var e=new a(t.report).$statuses({date:t.currentDate});e.then(function(e){t.init(e),t.$apply()}),e["catch"](function(e){t.$emit("jell.error",e)}),e["finally"](function(){t.$broadcast("scroll.refreshComplete")})},e.$on("jell.status.reload",function(){t.refresh()}),t.switchDate=function(e){t.loading=!0;var n=new a(t.report).$statuses({date:e});n.then(function(n){t.currentDate=e,t.init(n)}),n["catch"](function(e){t.$emit("jell.error",e)}),n["finally"](function(){t.loading=!1})}}])}(),function(){"use strict";var e=angular.module("jell.services",[]);e.factory("sessionInjector",["$window","$rootScope",function(e,t){var n={request:function(t){return t.headers["X-Session-Token"]="undefined"!==e.localStorage.token?e.localStorage.token:"",t.headers.Accept="application/vnd.flock.v2+json, "+t.headers.Accept,t}};return n}]),e.factory("authInterceptor",["$rootScope","$q",function(e,t){var n={responseError:function(n){return 401===n.status&&e.$broadcast("jell.unauthorized"),t.reject(n)}};return n}]),e.config(["$httpProvider",function(e){e.interceptors.push("sessionInjector"),e.interceptors.push("authInterceptor")}]),e.factory("Auth",["$window","$q","$http","$rootScope","Session","Self","User",function(e,t,n,a,i,r,o){var s,c,u=function(e){s=e,a.$broadcast("auth.currentUser.modified",{user:s})},l=function(e){c=e,a.$broadcast("auth.currentOrganization.modified",{organization:c})},m=function(t){e.localStorage.token=t.session.token,u(t.user)},d=function(){delete e.localStorage.token,u(null),l(null)};return{removeSession:function(){d()},isLoggedIn:function(){return"undefined"!=typeof e.localStorage.token&&null!==e.localStorage.token},saveUser:function(e){u(e)},currentUser:function(){var e=t.defer();if(this.isLoggedIn())if(s)e.resolve(s);else{var n=r.get().$promise;n.then(function(t){u(t.user),e.resolve(t.user)}),n["catch"](function(t){"undefined"!=typeof t.status&&401===t.status&&a.$broadcast("jell.unauthorized"),e.reject(t)})}else e.reject();return e.promise},signup:function(e,n,a){var i=t.defer(),r=new o({name:e,email:n,password:a}),s=r.$save();return s.then(function(e){m(e),i.resolve()}),s["catch"](function(e){i.reject(e)}),i.promise},login:function(e,n){var a=t.defer(),r=new i({email:e,password:n}),o=r.$save();return o.then(function(e){m(e),a.resolve()}),o["catch"](function(e){a.reject(e)}),a.promise},logout:function(){var e=t.defer(),n=new i,a=n.$delete();return a.then(function(){d(),e.resolve()}),a["catch"](function(t){e.reject(t)}),e.promise},currentOrganization:function(){var n=t.defer();if(this.isLoggedIn())if(c)n.resolve(c);else if(s&&s.organizations.length){var a=e.localStorage.defaultOrganizationId||s.settings.default_organization_id;if(a)for(var i=0;i<s.organizations.length;i++)if(a===s.organizations[i].id_str){c=s.organizations[i];break}c||(c=s.organizations[0]),e.localStorage.defaultOrganizationId=c.id_str,n.resolve(c)}else n.reject();else n.reject();return n.promise},setOrganization:function(t){e.localStorage.defaultOrganizationId=t.id_str,c=t},addOrganization:function(e){s.organizations.push(e),a.$broadcast("auth.currentUser.modified",{user:s})}}}]),e.factory("Info",["$resource","config",function(e,t){return e(t.API_URL+"info")}]),e.factory("Session",["$resource","config",function(e,t){return e(t.API_URL+"session/:action")}]),e.factory("Self",["$resource","config",function(e,t){return e(t.API_URL+"user/:action/:subAction",{},{get:{method:"GET",headers:{}},update:{method:"PUT",params:{}},updateSetting:{method:"PUT",params:{action:"setting",subAction:"@name"}},sendPasswordReset:{method:"POST",params:{action:"reset-password"}},changePassword:{method:"PUT",params:{action:"password"}},uploadAvatar:{method:"POST",params:{action:"avatar"}},"delete":{method:"POST",params:{action:"delete"}},deleteAvatar:{method:"DELETE",params:{action:"avatar"}},organizations:{method:"GET",params:{action:"organizations"}}})}]),e.factory("User",["$resource","config",function(e,t){return e(t.API_URL+"user/:action",{},{})}]),e.factory("Organization",["$resource","config",function(e,t){return e(t.API_URL+"organizations/:id/:action/:subId/:subAction",{id:"@id_str"},{update:{method:"PUT"},uploadLogo:{method:"POST",params:{action:"logo"}},deleteLogo:{method:"DELETE",params:{action:"logo"}},activity:{method:"GET",params:{action:"activity"}},statusReports:{method:"GET",params:{action:"status_reports"}},teams:{method:"GET",params:{action:"teams"}},members:{method:"GET",params:{action:"members"}},invite:{method:"POST",params:{action:"invites"}},deleteInvite:{method:"DELETE",params:{action:"invites",subId:"@invite_id"}},resendInvite:{method:"PUT",params:{action:"invites",subId:"@invite_id"}},acceptInvite:{method:"POST",params:{action:"accept"}},leave:{method:"DELETE",params:{action:"membership"}},updateMemberSetting:{method:"PUT",params:{action:"member",subId:"setting",subAction:"@name"}},updateMemberSettings:{method:"PUT",params:{action:"membership",subId:"settings"}},plans:{method:"GET",params:{action:"plans"}},tasks:{method:"GET",params:{action:"tasks"}},updateTasks:{method:"POST",params:{action:"tasks"}}})}]),e.factory("OrganizationMember",["$resource","config",function(e,t){return e(t.API_URL+"organizations/:organization_id/members/:user_id/:action",{organization_id:"@organization_id_str",user_id:"@user_id_str"
},{update:{method:"PUT"},activity:{method:"GET",params:{action:"activity"}},statuses:{method:"GET",params:{action:"statuses"}},statusActivity:{method:"GET",params:{action:"status_activity"}},teams:{method:"GET",params:{action:"teams"}}})}]),e.factory("Team",["$resource","config",function(e,t){return e(t.API_URL+"teams/:id/:action/:subId",{id:"@id_str"},{update:{method:"PUT"},statuses:{method:"GET",params:{action:"statuses"}},statusReports:{method:"GET",params:{action:"status_reports"}},members:{method:"GET",params:{action:"members"}},addMember:{method:"POST",params:{action:"members"}},invite:{method:"POST",params:{action:"invites"}},deleteInvite:{method:"DELETE",params:{action:"invites",subId:"@invite_id"}},resendInvite:{method:"PUT",params:{action:"invites",subId:"@invite_id"}},join:{method:"PUT",params:{action:"membership"}},leave:{method:"DELETE",params:{action:"membership"}},updateMemberSettings:{method:"PUT",params:{action:"membership",subId:"settings"}},subscribe:{method:"PUT",params:{action:"subscription"}},unsubscribe:{method:"DELETE",params:{action:"subscription"}},tasks:{method:"GET",params:{action:"tasks"}}})}]),e.factory("TeamMember",["$resource","config",function(e,t){return e(t.API_URL+"teams/:team_id/members/:user_id/:action",{team_id:"@team_id_str",user_id:"@user_id_str"},{update:{method:"PUT"},statusActivity:{method:"GET",params:{action:"status_activity"}}})}]),e.factory("Status",["$resource","config",function(e,t){return e(t.API_URL+"statuses/:id/:action/:subId",{id:"@id_str"},{update:{method:"PUT"},updateAnswer:{method:"PUT",params:{subId:"@answer_id_str",action:"answers"}},recent:{params:{action:"recent"}}})}]),e.factory("StatusReport",["$resource","config",function(e,t){var n=e(t.API_URL+"status_reports/:id/:action/:subId",{id:"@id_str"},{statuses:{params:{action:"statuses"}}});return n.submitters=function(e,t){var n,a,i={},r={};for(n=0;n<t.members.length;n++){var o=t.members[n];i[o.user_id_str]=o.user}for(n=0;n<t.teams.length;n++){var s=t.teams[n];for(r[s.id_str]=[],a=0;a<s.members.length;a++)r[s.id_str].push(s.members[a].user)}var c,u=[],l={};if("standup"===e.type)u=r[e.team_id_str];else if(e.submitters)for(n=0;n<e.submitters.length;n++){var m=e.submitters[n];if(m.team_id_str&&r[m.team_id_str])for(a=0;a<r[m.team_id_str].length;a++)c=r[m.team_id_str][a],l[c.id_str]||(u.push(c),l[c.id_str]=!0);else m.user_id_str&&!l[m.user_id_str]&&(c=i[m.user_id_str],u.push(c),l[c.id_str]=!0)}return u},n}]),e.factory("Like",["$resource","config",function(e,t){return e(t.API_URL+"likes/:id",{id:"@id_str"})}]),e.factory("Comment",["$resource","config",function(e,t){return e(t.API_URL+"comments/:id",{id:"@id_str"})}]),e.factory("Task",["$resource","config",function(e,t){return e(t.API_URL+"tasks/:id/:action",{id:"@id_str"},{update:{method:"PUT"},plan:{method:"POST",params:{action:"plan"}}})}]),e.factory("Device",["$resource","config",function(e,t){return e(t.API_URL+"devices",{},{})}]),e.factory("ImageUpload",["$q","$window","$cordovaImagePicker","$cordovaFileTransfer","config",function(e,t,n,a,i){var r=function(r,o){var s=e.defer();return window.cordova?n.getPictures({maximumImagesCount:1}).then(function(e){a.upload(i.API_URL+r,e[0],{fileKey:o,chunkedMode:!1,headers:{"X-Session-Token":"undefined"!==t.localStorage.token?t.localStorage.token:""}}).then(function(e){s.resolve(angular.fromJson(e.response))},function(e){s.reject(e)})},function(e){s.reject(e)}):s.reject("File upload not supported."),s.promise};return{userAvatar:function(){return r("user/avatar","avatar")},organizationLogo:function(e){return r("organizations/"+e.id_str+"/logo","logo")}}}]),e.factory("Track",["$window","$cordovaGoogleAnalytics",function(e,t){return{view:function(n){window.cordova&&e.analytics&&t.trackView(n)},event:function(n,a){window.cordova&&e.analytics&&t.trackEvent(n,a)}}}])}(),function(){"use strict";var e=angular.module("jell.directives",[]);e.directive("onReturn",function(){return function(e,t,n){t.bind("keydown keypress",function(t){13===t.which&&(e.$apply(function(){e.$eval(n.onReturn)}),t.preventDefault())})}}),e.directive("clickForOptions",["$ionicGesture",function(e){return{restrict:"A",link:function(t,n,a){e.on("tap",function(e){var t=n[0].querySelector(".item-content"),a=n[0].querySelector(".item-options");if(a){var i=a.offsetWidth;ionic.requestAnimationFrame(function(){t.style[ionic.CSS.TRANSITION]="all ease-out .25s",a.classList.contains("invisible")?(a.classList.remove("invisible"),t.style[ionic.CSS.TRANSFORM]="translate3d(-"+i+"px, 0, 0)"):(t.style[ionic.CSS.TRANSFORM]="",setTimeout(function(){a.classList.add("invisible")},250))})}},n)}}}]),e.directive("jellWorkspaceCta",[function(){return{restrict:"E",scope:{organization:"=",report:"=",first:"="},templateUrl:"report/cta.html",controller:["$scope",function(e){if(e.label=e.report.name,"standup"===e.report.type)for(var t=0;t<e.organization.teams.length;t++){var n=e.organization.teams[t];if(n.id_str===e.report.team_id_str){e.team=n,e.label=n.name+" Status";break}}e.post=function(){e.$emit("reportSubmit.show",{report:e.report})}}]}}]),e.directive("jellTeamCta",[function(){return{restrict:"E",scope:{team:"=",report:"=",first:"="},templateUrl:"report/cta.html",controller:["$scope",function(e){e.label=e.report.name,"standup"===e.report.type&&(e.label=e.team.name+" Status"),e.post=function(){e.$emit("reportSubmit.show",{report:e.report})}}]}}]),e.directive("jellWorkspacePlans",["$rootScope","Organization","Status","Track",function(e,t,n,a){return{restrict:"E",scope:{organization:"="},templateUrl:"workspace/plans.html",controller:["$scope",function(i){i.teams=[],i.loaded=!1,i.init=function(){var e=t.plans({id:i.organization.id_str}).$promise;e.then(function(e){i.teams=[],angular.forEach(e.teams,function(e){e.plans.length&&i.teams.push(e)}),i.loaded=!0})},i.init();var r=e.$on("jell.status.reload",function(){i.init()});i.$on("$destroy",r);var o=e.$on("jell.workspace.plan",function(e,t){angular.forEach(i.teams,function(e){e.id_str===t.team.id_str&&e.plans.push(t.update)})});i.$on("$destroy",o),i.edit=function(e){i.$emit("reportSubmit.show",{report:e.standup})},i.complete=function(e){var t={id_str:e.status_id_str,answer_id_str:e.id_str,text:e.text,completed:e.completed};n.updateAnswer(t),a.event("Status","Toggle Completed")}}]}}]),e.directive("jellWorkspaceTasks",["$rootScope","$ionicLoading","Organization","Task",function(e,t,n,a){return{restrict:"E",scope:{organization:"="},templateUrl:"workspace/tasks.html",controller:["$scope",function(i){i.taskLimit=3,i.teams=[],i.loaded=!1,i.init=function(){var e=n.tasks({id:i.organization.id_str}).$promise;e.then(function(e){i.teams=[],angular.forEach(e.teams,function(e){e.tasks.length&&i.teams.push(e)}),i.loaded=!0})},i.init();var r=e.$on("jell.tasks.reload",function(){i.init()});i.$on("$destroy",r),i.edit=function(){i.$emit("tasksEdit.show",{organization_id_str:i.organization.id_str})},i.plan=function(e,n,r){t.show({noBackdrop:!0});var o=new a(n).$plan();o.then(function(t){e.tasks.splice(r,1),i.$emit("jell.workspace.plan",{team:e,update:t.plan})}),o["catch"](function(e){i.$emit("jell.error",e)}),o["finally"](function(){t.hide()})}}]}}]),e.directive("jellTeamCard",["$rootScope","$ionicActionSheet","$ionicPopup","Team","Status","Task","Track",function(e,t,n,a,i,r,o){return{restrict:"E",scope:{team:"=",user:"=",showActions:"="},templateUrl:"team/card.html",controller:["$scope",function(e){e.join=function(t){t.processing=!0;var n=new a(t).$join();n.then(function(){t.is_member=!0,t.members.push({user_id_str:e.user.id_str,user:e.user}),e.$emit("jell.success","You're now a member of "+t.name+"."),e.$emit("jell.team.refresh",{team_id_str:t.id_str}),e.$emit("jell.organization.refresh",{organization_id_str:t.organization_id_str}),o.event("Team","Join")}),n["catch"](function(t){e.$emit("jell.error",t)}),n["finally"](function(){t.processing=!1})},e.leave=function(t){n.confirm({title:"Leave Team",template:"Are you sure you want to leave "+t.name+"?"}).then(function(n){if(n){t.processing=!0;var i=new a(t).$leave();i.then(function(){t.is_member=!1;for(var n=0;n<t.members.length;n++)if(t.members[n].user_id_str===e.user.id_str){t.members.splice(n,1);break}e.$emit("jell.team.refresh",{team_id_str:t.id_str}),e.$emit("jell.organization.refresh",{organization_id_str:t.organization_id_str}),o.event("Team","Leave")}),i["catch"](function(t){e.$emit("jell.error",t)}),i["finally"](function(){t.processing=!1})}})},e.subscribe=function(t){t.processing=!0;var n=new a(t).$subscribe();n.then(function(){t.is_subscriber=!0,e.$emit("jell.success","You're now subscribed to updates from "+t.name+"."),e.$emit("jell.team.refresh",{team_id_str:t.id_str}),e.$emit("jell.organization.refresh",{organization_id_str:t.organization_id_str}),o.event("Team","Subscribe")}),n["catch"](function(t){e.$emit("jell.error",t)}),n["finally"](function(){t.processing=!1})},e.unsubscribe=function(t){n.confirm({title:"Leave Team",template:"Are you sure you want to unsubscribe from "+t.name+"?"}).then(function(n){if(n){t.processing=!0;var i=new a(t).$unsubscribe();i.then(function(){t.is_subscriber=!1,e.$emit("jell.team.refresh",{team_id_str:t.id_str}),e.$emit("jell.organization.refresh",{organization_id_str:t.organization_id_str}),o.event("Team","Unsubscribe")}),i["catch"](function(t){e.$emit("jell.error",t)}),i["finally"](function(){t.processing=!1})}})},e.teamActions=function(n){n.is_member?t.show({titleText:"Select Action",destructiveText:"Leave Team",cancelText:"Cancel",destructiveButtonClicked:function(){return e.leave(n),!0}}):n.is_subscriber?t.show({titleText:"Select Action",destructiveText:"Unsubscribe",cancelText:"Cancel",destructiveButtonClicked:function(){return e.unsubscribe(n),!0}}):t.show({buttons:[{text:"Join Team"},{text:"Subscribe"}],titleText:"Select Action",cancelText:"Cancel",buttonClicked:function(t){return 0===t?e.join(n):e.subscribe(n),!0}})}}]}}]),e.directive("jellReportCard",["StatusReport",function(e){return{restrict:"E",scope:{organization:"=",report:"=",user:"="},templateUrl:"report/card.html",controller:["$scope",function(t){if(t.submitters=e.submitters(t.report,t.organization),t.title=t.report.name,"standup"===t.report.type)for(var n=0;n<t.organization.teams.length;n++){var a=t.organization.teams[n];if(a.id_str===t.report.team_id_str){t.title=a.name+" "+t.report.name;break}}t.post=function(){t.$emit("reportSubmit.show",{report:t.report})}}]}}]),e.directive("jellStatusCard",["$rootScope","$state","Status","Like",function(e,t,n,a){return{restrict:"E",scope:{report:"=",status:"=",user:"=",currentUser:"=",header:"@"},templateUrl:"status/card.html",controller:["$scope",function(i){var r=e.$on("jell.status.updated",function(e,t){t.status.id_str===i.status.id_str&&(i.status=t.status)});i.$on("$destroy",r),i.toggleCompleted=function(e){var t={id_str:e.status_id_str,answer_id_str:e.id_str,text:e.text,completed:e.completed};n.updateAnswer(t),Track.event("Status","Toggle Completed")},i.editStatus=function(){i.$emit("statusEdit.show",{status:i.status})},i.like=function(e){if(!e.like_processing){e.like_processing=!0;var t;if(e.liked){t=new a(e.like);var n=t.$delete();n.then(function(){for(var t=0;t<e.likes.length;t++)if(e.likes[t].id_str===e.like.id_str){e.likes.splice(t,1);break}e.liked=!1,e.like=null}),n["catch"](function(e){i.$emit("jell.error",e)}),n["finally"](function(){e.like_processing=!1})}else{t=new a({status_update_id:e.id_str});var r=t.$save();r.then(function(t){e.liked=!0,e.like=t.like,e.likes.push(t.like)}),r["catch"](function(e){i.$emit("jell.error",e)}),r["finally"](function(){e.like_processing=!1})}}},i.comment=function(e){t.go("app.comments",{statusId:i.status.id_str,answerId:e.id_str,status:i.status,answer:e})}}]}}]),e.directive("jellStatusEdit",["$rootScope","$ionicModal","$ionicScrollDelegate","$state","$timeout","Organization","StatusReport","Team","Status","Track",function(e,t,n,a,i,r,o,s,c,u){return{restrict:"E",scope:{},controller:["$scope",function(a){t.fromTemplateUrl("status/edit.html",{scope:a,animation:"slide-in-up",focusFirstInput:!0,backdropClickToClose:!1}).then(function(e){a.modal=e}),a.$on("$destroy",function(){a.modal.remove()}),a.initFromStatus=function(e){var t=o.get({id:e.status_report_id_str}).$promise;t.then(function(t){a.init(t.status_report,e)}),t["catch"](function(e){a.$emit("jell.error",e)})},a.initFromReport=function(e){var t=e.current_draft_id_str||e.current_status_id_str;if(t){var n=c.get({id:t}).$promise;n.then(function(t){a.init(e,t.status)}),n["catch"](function(e){a.$emit("jell.error",e)})}else a.init(e,null)},a.init=function(e,t){a.title=e.name,a.report=e,a.date=e.current_status_date,a.status=null,a.tasks=[],a.plannedTasks=[],a.showTasks=!1,a.typeIndexMap={},a.allowDraft=!0;var n="undefined"!=typeof t&&null!==t,i="standup"===a.report.type,r=["list","progress","plans","problems"],o=angular.copy(n?t.answers:a.report.questions),u=0;if(angular.forEach(o,function(e){a.typeIndexMap[e.type]=u,"undefined"==typeof e.answers&&(e.answers=[]),(0===e.answers.length||-1!==r.indexOf(e.type))&&e.answers.push({text:""}),"number"===e.type&&(e.answers[0].text=parseFloat(e.answers[0].text)),u++}),a.questions=o,n)a.status=angular.copy(t),a.date=a.status.created_at,a.allowDraft=a.status.draft;else if(i){var l=c.recent({team_id:a.report.team_id_str}).$promise;l.then(function(e){if("undefined"==typeof e.status)a.status=new c;else{var t=e.status;if(a.report.current_status_date===t.created_at)a.status=t;else{a.status=new c;for(var n=a.typeIndexMap.progress,i=a.typeIndexMap.plans,r=0;r<t.answers.length;r++){var o=t.answers[r];if("plans"===o.type)for(var s=o.answers.reverse(),u=0;u<s.length;u++){var l=s[u];delete l.status_id,l.completed&&"undefined"!=typeof n?a.questions[n].answers.unshift(l):"undefined"!=typeof i&&a.questions[i].answers.unshift(l)}}}}}),l["catch"](function(e){a.$emit("jell.error",e)})}else a.status=new c;if(i){var m=s.tasks({id:a.report.team_id_str}).$promise;m.then(function(e){a.tasks=e.tasks})}a.modal.show()};var l=e.$on("statusEdit.show",function(e,t){u.view("Status Edit"),a.initFromStatus(t.status)});a.$on("$destroy",l);var m=e.$on("reportSubmit.show",function(e,t){u.view("Status Edit"),a.initFromReport(t.report)});a.$on("$destroy",m),a.close=function(){a.modal.hide(),a.title=null,a.report=null,a.date=null,a.status=null,a.tasks=[],a.plannedTasks=[],a.showTasks=!1,a.typeIndexMap={},a.allowDraft=!1},a.saveAsDraft=function(){a.status.draft=!0,a.save()},a.saveAndPublish=function(){a.status.draft=!1,a.save()},a.save=function(){var e=[],t=!0;if(angular.forEach(a.questions,function(n){var a={question:n.question,type:n.type,answers:[]};angular.forEach(n.answers,function(e){if("number"===n.type&&!isNaN(e.text)||"number"!==n.type&&e.text.match(/\S/)){t=!1;var i=angular.copy(e);e.goal&&(i.goal_id_str=e.goal.id_str),delete i.goal,delete i.objective,a.answers.push(i)}}),e.push(a)}),t)return void a.$emit("jell.error","Your status cannot be empty.");a.submitting=!0;var n=new c(a.status);n.status_report_id=a.report.id_str,n.answers=e;var i=!!n.id,o=i?n.$update():n.$save();o.then(function(e){if(a.plannedTasks.length){angular.forEach(a.plannedTasks,function(e){e["delete"]=!0});var t=r.updateTasks({id_str:a.report.organization_id_str,tasks:a.plannedTasks}).$promise;t.then(function(){a.$emit("jell.status.reload")})}else a.$emit("jell.status.reload");a.close(),u.event("Status","Save")}),o["catch"](function(e){a.$emit("jell.error",e)}),o["finally"](function(){a.submitting=!1})},a.next=function(e,t,r){var o=t,s=r,c=a.questions.length===t+1,u=e.answers.length===r+1,l=!e.answers[r].text.match(/\S/);if(l&&u){if(c)return void a.save();o+=1,s=0}else u&&(e.answers.push({text:""}),n.resize()),s+=1;i(function(){var e=angular.element(document.querySelector("#answer-"+o+"-"+s));e.length>0&&e[0].focus()})},a.edit=function(e,t){e.edit=t,e.edit&&window.cordova&&window.cordova.plugins.Keyboard&&cordova.plugins.Keyboard.close()},a["delete"]=function(e,t){e.answers.splice(t,1),1===e.answers.length&&(e.edit=!1)},a.showComplete=function(e){var t=a.status&&!!a.status.id;return"plans"===e.type&&(t||"progress"in a.typeIndexMap)},a.complete=function(e,t){var n=!!a.status.id;if(n)e.answers[t].completed=!e.answers[t].completed;else{var i=e.answers[t],r=a.questions[a.typeIndexMap.progress];delete i.status_id,r.answers.splice(r.answers.length-1,0,i),a["delete"](e,t)}},a.reorder=function(e,t,n){var a=e.answers[t];e.answers.splice(t,1),e.answers.splice(n,0,a)},a.plan=function(e,t){if("plans"in a.typeIndexMap){var n=a.questions[a.typeIndexMap.plans];n.answers.splice(n.answers.length-1,0,{text:e.description}),a.plannedTasks.push(e),a.tasks.splice(t,1)}}}]}}]),e.directive("jellNumberDelta",[function(){return{restrict:"E",scope:{current:"=",previous:"="},template:'<span class="delta" data-ng-class="style"><i class="icon" data-ng-class="icon"></i> {{ delta }}%</span>',link:function(e){var t=parseFloat(e.current),n=parseFloat(e.previous),a=t-n;e.delta=Math.round(a/n*100),0===e.delta?(e.style="delta--flat",e.icon="ion-arrow-up-c"):e.delta<0?(e.style="delta--decrease",e.icon="ion-arrow-down-c"):(e.style="delta--increase",e.icon="ion-arrow-up-c")}}}]),e.directive("jellTasksEdit",["$rootScope","$ionicModal","$ionicScrollDelegate","$state","$timeout","Organization","Task","Track",function(e,t,n,a,i,r,o,s){return{restrict:"E",scope:{},controller:["$scope",function(a){t.fromTemplateUrl("task/edit.html",{scope:a,animation:"slide-in-up",focusFirstInput:!0,backdropClickToClose:!1}).then(function(e){a.modal=e}),a.$on("$destroy",function(){a.modal.remove()}),a.init=function(e){a.organization_id_str=e,a.teams=[],a.plans=[],a.deleted=[],a.loading=!0,a.modal.show();var t=r.tasks({id:a.organization_id_str}).$promise;t.then(function(e){a.teams=e.teams,a.empty=!0,angular.forEach(a.teams,function(e){0!==e.tasks.length&&(a.empty=!1),e.tasks.push({description:""})})}),t["catch"](function(e){a.$emit("jell.error",e)}),t["finally"](function(){a.loading=!1})};var o=e.$on("tasksEdit.show",function(e,t){s.view("Tasks Edit"),a.init(t.organization_id_str)});a.$on("$destroy",o),a.close=function(){a.modal.hide(),a.teams=[],a.plans=[],a.deleted=[]},a.save=function(){a.submitting=!0;var e=[],t=1;angular.forEach(a.teams,function(n){angular.forEach(n.tasks,function(a){a.description.match(/\S/)&&(a.sort=t++,a.team_id=n.id_str,e.push(a))}),t=1}),angular.forEach(a.plans,function(t){t.plan=!0,e.push(t)}),angular.forEach(a.deleted,function(t){t["delete"]=!0,e.push(t)});var n=r.updateTasks({id_str:a.organization_id_str,tasks:e}).$promise;n.then(function(e){a.plans.length?a.$emit("jell.status.reload"):a.$emit("jell.tasks.reload"),a.close(),s.event("Tasks","Save")}),n["catch"](function(e){a.$emit("jell.error",e)}),n["finally"](function(){a.submitting=!1})},a.next=function(e,t,r){var o=t,s=r,c=a.teams.length===t+1,u=e.tasks.length===r+1,l=!e.tasks[r].description.match(/\S/);if(l&&u){if(c)return void a.save();o+=1,s=0}else u&&(e.tasks.push({description:""}),n.resize()),s+=1;i(function(){var e=angular.element(document.querySelector("#task-"+o+"-"+s));e.length>0&&e[0].focus()})},a.edit=function(e,t){e.edit=t,e.edit&&window.cordova&&window.cordova.plugins.Keyboard&&cordova.plugins.Keyboard.close()},a["delete"]=function(e,t,n){n||a.deleted.push(e.tasks[t]),e.tasks.splice(t,1),1===e.tasks.length&&(e.edit=!1)},a.plan=function(e,t){a.plans.push(e.tasks[t]),a["delete"](e,t,!0)},a.reorder=function(e,t,n){var a=e.tasks[t];e.tasks.splice(t,1),e.tasks.splice(n,0,a)}}]}}]),e.directive("jellSignup",["$rootScope","$ionicModal","$ionicHistory","$state","Auth","Track",function(e,t,n,a,i,r){return{restrict:"E",scope:{},controller:["$scope",function(o){t.fromTemplateUrl("signup.html",{scope:o,animation:"slide-in-up",focusFirstInput:!0}).then(function(e){o.modal=e}),o.$on("$destroy",function(){o.modal.remove()});var s=e.$on("signup.show",function(){r.view("Signup"),o.data={},o.modal.show()});o.$on("$destroy",s),o.close=function(){o.modal.hide()},o.signup=function(){o.submitting=!0;var e=i.signup(o.data.name,o.data.email,o.data.password);e.then(function(e){n.nextViewOptions({disableBack:!0,historyRoot:!0}),a.go("app.home"),o.close(),r.event("User","Signup")}),e["catch"](function(e){o.$emit("jell.error",e)}),e["finally"](function(){o.submitting=!1})},o.next=function(e){var t=angular.element(document.querySelector("#"+e));t.length>0&&t[0].focus()}}]}}]),e.directive("jellLogin",["$rootScope","$ionicModal","$ionicHistory","$state","Auth","Track",function(e,t,n,a,i,r){return{restrict:"E",scope:{},controller:["$scope",function(o){t.fromTemplateUrl("login.html",{scope:o,animation:"slide-in-up",focusFirstInput:!0}).then(function(e){o.modal=e}),o.$on("$destroy",function(){o.modal.remove()});var s=e.$on("login.show",function(){r.view("Login"),o.data={},o.modal.show()});o.$on("$destroy",s),o.close=function(){o.modal.hide()},o.login=function(){o.submitting=!0;var e=i.login(o.data.email,o.data.password);e.then(function(e){n.nextViewOptions({disableBack:!0,historyRoot:!0}),a.go("app.home"),o.close(),r.event("User","Login")}),e["catch"](function(e){o.$emit("jell.error",e)}),e["finally"](function(){o.submitting=!1})},o.next=function(e){var t=angular.element(document.querySelector("#"+e));t.length>0&&t[0].focus()},o.resetPassword=function(){o.close(),o.$emit("resetPassword.show")}}]}}]),e.directive("jellResetPassword",["$rootScope","$ionicModal","$ionicPopup","Self","Track",function(e,t,n,a,i){return{restrict:"E",scope:{},controller:["$scope",function(n){t.fromTemplateUrl("reset-password.html",{scope:n,animation:"slide-in-up",focusFirstInput:!0}).then(function(e){n.modal=e}),n.$on("$destroy",function(){n.modal.remove()});var r=e.$on("resetPassword.show",function(){i.view("Reset Password"),n.data={},n.modal.show()});n.$on("$destroy",r),n.close=function(){n.modal.hide()},n.submit=function(){n.submitting=!0;var e=a.sendPasswordReset({email:n.data.email}).$promise;e.then(function(){n.close(),n.$emit("jell.success","Please check your email for a link to reset your password."),i.event("User","Reset Password")}),e["catch"](function(e){n.$emit("jell.error",e)}),e["finally"](function(){n.submitting=!1})}}]}}]),e.directive("jellMemberSettings",["$rootScope","$ionicModal","$ionicPopup","$state","Self","Auth","Track","ImageUpload","Timezones",function(e,t,n,a,i,r,o,s,c){return{restrict:"E",scope:{},controller:["$scope",function(a){a.timezones=c,t.fromTemplateUrl("member/settings.html",{scope:a,animation:"slide-in-up"}).then(function(e){a.modal=e}),a.$on("$destroy",function(){a.modal.remove()});var u=e.$on("memberSettings.show",function(e,t){o.view("Member Settings"),a.data=angular.copy(t.user),a.modal.show()});a.$on("$destroy",u),a.close=function(){a.modal.hide()},a.save=function(){a.submitting=!0;var e={};angular.forEach(["name","title","email","timezone"],function(t){e[t]=a.data[t]});var t=i.update(e).$promise;t.then(function(e){r.saveUser(e.user),a.close(),a.$emit("jell.success","Your account was saved successfully."),o.event("Member","Update Settings")}),t["catch"](function(e){a.$emit("jell.error",e)}),t["finally"](function(){a.submitting=!1})},a.uploadAvatar=function(){a.savingAvatar=!0;var e=s.userAvatar();e.then(function(e){a.data.avatar_180x180=e.user.avatar_180x180,r.saveUser(e.user),o.event("Member","Upload Avatar")}),e["catch"](function(e){a.$emit("jell.error",e)}),e["finally"](function(){a.savingAvatar=!1})},a.deleteAvatar=function(){n.confirm({title:"Delete Photo",template:"Are you sure you want to delete your photo?"}).then(function(e){if(e){a.savingAvatar=!0;var t=i.deleteAvatar().$promise;t.then(function(e){delete a.data.avatar_180x180,r.saveUser(e.user),o.event("Member","Delete Avatar")}),t["catch"](function(e){a.$emit("jell.error",e)}),t["finally"](function(){a.savingAvatar=!1})}})}}]}}]),e.directive("jellMemberNotifications",["$rootScope","$q","$ionicModal","$ionicPopup","$ionicHistory","$state","Organization","OrganizationMember","Team","Track","Timezones",function(e,t,n,a,i,r,o,s,c,u,l){return{restrict:"E",scope:{},controller:["$scope",function(a){n.fromTemplateUrl("member/notifications.html",{scope:a,animation:"slide-in-up"}).then(function(e){a.modal=e}),a.$on("$destroy",function(){a.modal.remove()});var i=e.$on("memberNotifications.show",function(e,t){u.view("Notification Settings"),a.organization=angular.copy(t.organization),a.user=angular.copy(t.user),a.view=null,a.options=[],a.data={},a.teams=[],a.loadingMember=!0;var n=s.get({organization_id:a.organization.id_str,user_id:a.user.id_str}).$promise;n.then(function(e){a.options.unshift({value:null,label:"Global Notifications "}),a.data.settings=e.member.settings}),n["catch"](function(e){a.$emit("jell.error",e)}),n["finally"](function(){a.loadingMember=!1}),a.loadingTeams=!0;var i=s.teams({organization_id:a.organization.id_str,user_id:a.user.id_str}).$promise;i.then(function(e){a.teams=e.teams,angular.forEach(a.teams,function(e){a.options.push({value:e.team_id_str,label:e.team.name}),a.data[e.team_id_str]=angular.copy(e.settings)})}),i["catch"](function(e){a.$emit("jell.error",e)}),i["finally"](function(){a.loadingTeams=!1}),a.modal.show()});a.$on("$destroy",i),a.close=function(){a.modal.hide()},a.save=function(){a.submitting=!0;var e=[];e.push(new o({id_str:a.organization.id_str,settings:a.data.settings}).$updateMemberSettings()),angular.forEach(a.teams,function(t){var n=a.data[t.team_id_str];e.push(new c({id_str:t.team_id_str,settings:n}).$updateMemberSettings())});var n=t.all(e);n.then(function(e){a.close(),a.$emit("jell.success","Your settings were saved successfully."),u.event("Member","Update Notifications")}),n["catch"](function(e){a.$emit("jell.error",e)}),n["finally"](function(){a.submitting=!1})}}]}}]),e.directive("jellTeamSettings",["$rootScope","$ionicModal","$ionicPopup","$ionicHistory","$state","Team","Track","Timezones",function(e,t,n,a,i,r,o,s){return{restrict:"E",scope:{},controller:["$scope",function(n){n.timezones=s,t.fromTemplateUrl("team/settings.html",{scope:n,animation:"slide-in-up",focusFirstInput:!0}).then(function(e){n.modal=e}),n.$on("$destroy",function(){n.modal.remove()});var i=e.$on("teamSettings.show",function(e,t){o.view("Team Settings"),n.data=angular.copy(t.team),n.modal.show()});n.$on("$destroy",i),n.close=function(){n.modal.hide()},n.save=function(){n.submitting=!0;var e={};angular.forEach(["id_str","name","periodicity","weekday","timezone"],function(t){e[t]=n.data[t]});var t=new r(e).$update();t.then(function(e){a.nextViewOptions({disableAnimate:!0}),n.close(),n.$emit("jell.success","The team was saved successfully."),o.event("Team","Update Settings")}),t["catch"](function(e){n.$emit("jell.error",e)}),t["finally"](function(){n.submitting=!1})}}]}}]),e.directive("jellOrganizationSettings",["$rootScope","$ionicModal","$ionicPopup","$ionicHistory","$state","Organization","Track","ImageUpload",function(e,t,n,a,i,r,o,s){return{restrict:"E",scope:{},controller:["$scope",function(i){t.fromTemplateUrl("organization/settings.html",{scope:i,animation:"slide-in-up"}).then(function(e){i.modal=e}),i.$on("$destroy",function(){i.modal.remove()});var c=e.$on("organizationSettings.show",function(e,t){o.view("Organization Settings"),i.data=angular.copy(t.organization),i.modal.show()});i.$on("$destroy",c),i.close=function(){i.modal.hide()},i.save=function(){i.submitting=!0;var e={id_str:i.data.id_str,name:i.data.name},t=new r(e).$update();t.then(function(e){a.nextViewOptions({disableAnimate:!0,disableBack:!0,historyRoot:!0}),i.close(),i.$emit("jell.success","The organization was saved successfully."),o.event("Organization","Update Settings")}),t["catch"](function(e){i.$emit("jell.error",e)}),t["finally"](function(){i.submitting=!1})},i.uploadLogo=function(){i.savingLogo=!0;var e=s.organizationLogo(i.data);e.then(function(e){i.data.logo_180x180=e.organization.logo_180x180,o.event("Organization","Upload Logo")}),e["catch"](function(e){i.$emit("jell.error",e)}),e["finally"](function(){i.savingLogo=!1})},i.deleteLogo=function(){n.confirm({title:"Delete Logo",template:"Are you sure you want to delete the organization logo?"}).then(function(e){if(e){i.savingLogo=!0;var t=new r({id_str:i.data.id_str}).$deleteLogo();t.then(function(e){delete i.data.logo_180x180,o.event("Organization","Delete Logo")}),t["catch"](function(e){i.$emit("jell.error",e)}),t["finally"](function(){i.savingLogo=!1})}})}}]}}]),e.directive("jellTeamCreate",["$rootScope","$ionicModal","$ionicPopup","$state","Team","Track",function(e,t,n,a,i,r){return{restrict:"E",scope:{},controller:["$scope",function(n){t.fromTemplateUrl("team/create.html",{scope:n,animation:"slide-in-up",focusFirstInput:!0}).then(function(e){n.modal=e}),n.$on("$destroy",function(){n.modal.remove()});var o=e.$on("teamCreate.show",function(e,t){r.view("Team Create"),n.data={},n.organization=t.organization,n.modal.show()});n.$on("$destroy",o),n.close=function(){n.modal.hide()},n.save=function(){n.submitting=!0;var e=new i({name:n.data.name,organization_id:n.organization.id_str}).$save();e.then(function(e){a.go("app.team.home",{organizationId:n.data.organization_id_str,teamId:e.team.id_str}),n.close(),n.$emit("jell.success","The team was saved successfully."),n.$emit("jell.organization.refresh",{organization_id_str:n.organization.id_str}),r.event("Team","Create")}),e["catch"](function(e){n.$emit("jell.error",e)}),e["finally"](function(){n.submitting=!1})}}]}}]),e.directive("jellOrganizationCreate",["$rootScope","$ionicModal","$ionicPopup","$ionicHistory","$state","Organization","Auth","Track",function(e,t,n,a,i,r,o,s){return{restrict:"E",scope:{},controller:["$scope",function(n){t.fromTemplateUrl("organization/create.html",{scope:n,animation:"slide-in-up",focusFirstInput:!0}).then(function(e){n.modal=e}),n.$on("$destroy",function(){n.modal.remove()});var c=e.$on("organizationCreate.show",function(){s.view("Organization Create"),n.data={},n.modal.show()});n.$on("$destroy",c),n.close=function(){n.modal.hide()},n.save=function(){n.submitting=!0;var e=new r({name:n.data.name}).$save();e.then(function(e){a.nextViewOptions({disableAnimate:!0,disableBack:!0,historyRoot:!0}),o.addOrganization(e.organization),o.setOrganization(e.organization),n.close(),i.go("app.home",{},{reload:!0}),n.$emit("jell.success","The organization was saved successfully."),s.event("Organization","Create")}),e["catch"](function(e){n.$emit("jell.error",e)}),e["finally"](function(){n.submitting=!1})}}]}}]),e.directive("jellOrganizationInvite",["$rootScope","$ionicModal","$ionicPopup","$ionicHistory","$state","Organization","Track",function(e,t,n,a,i,r,o){return{restrict:"E",scope:{},controller:["$scope",function(n){t.fromTemplateUrl("invite.html",{scope:n,animation:"slide-in-up",focusFirstInput:!0}).then(function(e){n.modal=e}),n.$on("$destroy",function(){n.modal.remove()});var a=e.$on("organizationInvite.show",function(e,t){o.view("Organization Invite"),n.data={organization:t.organization},n.modal.show()});n.$on("$destroy",a),n.close=function(){n.modal.hide()},n.send=function(){n.submitting=!0;var e=new r({id_str:n.data.organization.id_str,email:n.data.email}).$invite();e.then(function(e){n.close(),n.$emit("jell.success","The invite was sent successfully."),angular.forEach(e.invites,function(e){n.data.organization.invites.push(e)}),o.event("Organization","Send Invite")}),e["catch"](function(e){n.$emit("jell.error",e)}),e["finally"](function(){n.submitting=!1})}}]}}]),e.directive("jellTeamInvite",["$rootScope","$ionicModal","$ionicPopup","$ionicHistory","$state","Team","Track",function(e,t,n,a,i,r,o){return{restrict:"E",scope:{},controller:["$scope",function(n){t.fromTemplateUrl("invite.html",{scope:n,animation:"slide-in-up",focusFirstInput:!0}).then(function(e){n.modal=e}),n.$on("$destroy",function(){n.modal.remove()});var a=e.$on("teamInvite.show",function(e,t){o.view("Team Invite"),n.data={team:t.team},n.modal.show()});n.$on("$destroy",a),n.close=function(){n.modal.hide()},n.send=function(){n.submitting=!0;var e=new r({id_str:n.data.team.id_str,email:n.data.email}).$invite();e.then(function(e){n.close(),n.$emit("jell.success","The invite was sent successfully."),angular.forEach(e.invites,function(e){
n.data.team.invites.push(e)}),o.event("Team","Send Invite")}),e["catch"](function(e){n.$emit("jell.error",e)}),e["finally"](function(){n.submitting=!1})}}]}}]),e.directive("jellPushNotifications",["$rootScope","$window","$state","$ionicHistory","$ionicPopup","Device","Track","config",function(e,t,n,a,i,r,o,s){return{restrict:"E",scope:{},controller:["$scope",function(c){var u=ionic.Platform.platform(),l=e.$on("pushNotifications.register",function(){t.localStorage.hasRequestedPushNotifications?c.register():(o.event("Push Notifications","Request"),i.confirm({title:"Enable Push Notifications",template:"Get notified when there's activity from your team or it's time to post your status.",cancelText:"Not Now"}).then(function(e){e?(o.event("Push Notifications","Accepted"),t.localStorage.hasRequestedPushNotifications=!0,c.register()):o.event("Push Notifications","Declined")}))});c.$on("$destroy",l),c.register=function(){if(window.PushNotification){var e=window.PushNotification.init({ios:{alert:!0,badge:!0,sound:!0,clearBadge:!0,gcmSandbox:!0},android:{senderID:s.GCM_SENDER_ID,icon:"icon",forceShow:!0}});e.on("registration",function(e){o.event("Push Notifications","Registered");var t=new r({platform:u,token:e.registrationId,version:2}).$save();t["catch"](function(e){c.$emit("jell.error",e)})}),e.on("notification",function(e){if("additionalData"in e){var t=e.additionalData;"link_to"in t&&("team"===t.link_to||"status"===t.link_to)&&"organization_id"in t&&"team_id"in t&&(a.nextViewOptions({disableAnimate:!0,disableBack:!0,historyRoot:!0}),n.go("app.organization.home",{organizationId:t.organization_id}).then(function(){a.nextViewOptions({disableAnimate:!0,disableBack:!1,historyRoot:!1}),n.go("app.team.home",{organizationId:t.organization_id,teamId:t.team_id})}))}}),e.on("error",function(e){c.$emit("jell.error",e.message)})}}}]}}]),e.directive("jellDatePager",["$parse","$cordovaDatePicker","moment",function(e,t,n){return{restrict:"E",scope:{latestDate:"=",currentDate:"=",previousDate:"=",nextDate:"=",loading:"=",onChange:"&"},templateUrl:"status/date-pager.html",controller:["$scope",function(a){a.changeDate=function(t){var n=e(a.onChange);n({date:t})},a.selectDate=function(){window.cordova&&t.show({date:n(a.currentDate).toDate(),mode:"date",maxDate:new Date,allowOldDates:!0,allowFutureDates:!1}).then(function(e){e&&a.changeDate(n(e).format("YYYY-MM-DD"))})}}]}}])}(),function(){"use strict";var e=angular.module("jell.resolvers",[]);e.factory("AppResolver",["$q","Self","Organization","OrganizationMember","Team","StatusReport",function(e,t,n,a,i,r){return{organizations:function(){var n=e.defer(),a=t.organizations().$promise;return a.then(function(e){n.resolve(e.organizations)}),a["catch"](function(e){n.reject(e.error||"There was an error fetching the list of organizations.")}),n.promise},organization:function(t,a){var i=e.defer(),r=n.get({id:t}).$promise;return r.then(function(e){a&&!e.organization.is_admin?i.reject("You must be an admin of "+e.organization.name+" to edit it's settings."):i.resolve(e.organization)}),r["catch"](function(e){i.reject(e.error||"There was an error fetching the organization.")}),i.promise},organizationReports:function(t){var a=e.defer(),i=n.statusReports({id:t}).$promise;return i.then(function(e){a.resolve(e.status_reports)}),i["catch"](function(e){a.reject(e.error||"There was an error fetching the status reports.")}),a.promise},organizationReportsDue:function(t){var a=e.defer(),i=n.statusReports({id:t,is_due:!0,exclude_standups:!1}).$promise;return i.then(function(e){a.resolve(e.status_reports)}),i["catch"](function(e){a.reject(e.error||"There was an error fetching organization reports.")}),a.promise},organizationMember:function(t,n){var i=e.defer(),r=a.get({organization_id:t,user_id:n}).$promise;return r.then(function(e){i.resolve(e)}),r["catch"](function(e){i.reject(e.error||"There was an error fetching the user.")}),i.promise},team:function(t,a,r){var o=e.defer(),s=i.get({id:t}).$promise;return s.then(function(e){if(r&&!e.team.is_admin)o.reject("You must be an admin of "+e.team.name+" to edit it's settings.");else if(a){var t=e.team,i=n.get({id:e.team.organization_id_str}).$promise;i.then(function(e){t.organization=e.organization,o.resolve(t)}),i["catch"](function(e){o.reject(e.error||"There was an error fetching the organization.")})}else o.resolve(e.team)}),s["catch"](function(e){o.reject(e.error||"There was an error fetching the team.")}),o.promise},teamStatuses:function(t,n){var a=e.defer(),r=i.statuses({id:t,date:n,all:!0}).$promise;return r.then(function(e){a.resolve(e)}),r["catch"](function(e){a.reject(e.error||"There was an error fetching the statuses.")}),a.promise},teamReportsDue:function(t){var n=e.defer(),a=i.statusReports({id:t,is_due:!0,exclude_standups:!1}).$promise;return a.then(function(e){n.resolve(e.status_reports)}),a["catch"](function(e){n.reject(e.error||"There was an error fetching team reports.")}),n.promise},report:function(t){var n=e.defer(),a=r.get({id:t}).$promise;return a.then(function(e){n.resolve(e.status_report)}),a["catch"](function(e){n.reject(e.error||"There was an error fetching the report.")}),n.promise},reportStatuses:function(t,n){var a=e.defer(),i=r.statuses({id:t,date:n}).$promise;return i.then(function(e){a.resolve(e)}),i["catch"](function(e){a.reject(e.error||"There was an error fetching the report.")}),a.promise}}}])}(),function(){"use strict";var e=angular.module("jell.filters",[]);e.filter("jellAvatar",[function(){return function(e){return e&&e.avatar_180x180?e.avatar_180x180:"img/avatar_180x180.png"}}]),e.filter("jellLogo",[function(){return function(e){return e&&e.logo_180x180?e.logo_180x180:"img/logo_180x180.png"}}]),e.filter("jellFromNow",["moment",function(e){return function(t){return e.locale("en",{relativeTime:{future:"in %s",past:"%s ago",s:"%ds",m:"1m",mm:"%dm",h:"1h",hh:"%dh",d:"1d",dd:"%dd",M:"1mo",MM:"%dmo",y:"1y",yy:"%dy"}}),e(t).fromNow(!0)}}])}(),function(){"use strict";var e=angular.module("jell.constants",[]);e.constant("config",{API_URL:"https://api.jell.com/",GA_ID:"UA-55989222-4",GCM_SENDER_ID:"674618888537"}),e.constant("Timezones",["Africa/Abidjan","Africa/Accra","Africa/Addis_Ababa","Africa/Algiers","Africa/Asmara","Africa/Bamako","Africa/Bangui","Africa/Banjul","Africa/Bissau","Africa/Blantyre","Africa/Brazzaville","Africa/Bujumbura","Africa/Cairo","Africa/Casablanca","Africa/Ceuta","Africa/Conakry","Africa/Dakar","Africa/Dar_es_Salaam","Africa/Djibouti","Africa/Douala","Africa/El_Aaiun","Africa/Freetown","Africa/Gaborone","Africa/Harare","Africa/Johannesburg","Africa/Juba","Africa/Kampala","Africa/Khartoum","Africa/Kigali","Africa/Kinshasa","Africa/Lagos","Africa/Libreville","Africa/Lome","Africa/Luanda","Africa/Lubumbashi","Africa/Lusaka","Africa/Malabo","Africa/Maputo","Africa/Maseru","Africa/Mbabane","Africa/Mogadishu","Africa/Monrovia","Africa/Nairobi","Africa/Ndjamena","Africa/Niamey","Africa/Nouakchott","Africa/Ouagadougou","Africa/Porto-Novo","Africa/Sao_Tome","Africa/Tripoli","Africa/Tunis","Africa/Windhoek","America/Adak","America/Anchorage","America/Anguilla","America/Antigua","America/Araguaina","America/Argentina/Buenos_Aires","America/Argentina/Catamarca","America/Argentina/Cordoba","America/Argentina/Jujuy","America/Argentina/La_Rioja","America/Argentina/Mendoza","America/Argentina/Rio_Gallegos","America/Argentina/Salta","America/Argentina/San_Juan","America/Argentina/San_Luis","America/Argentina/Tucuman","America/Argentina/Ushuaia","America/Aruba","America/Asuncion","America/Atikokan","America/Bahia","America/Bahia_Banderas","America/Barbados","America/Belem","America/Belize","America/Blanc-Sablon","America/Boa_Vista","America/Bogota","America/Boise","America/Cambridge_Bay","America/Campo_Grande","America/Cancun","America/Caracas","America/Cayenne","America/Cayman","America/Chicago","America/Chihuahua","America/Costa_Rica","America/Creston","America/Cuiaba","America/Curacao","America/Danmarkshavn","America/Dawson","America/Dawson_Creek","America/Denver","America/Detroit","America/Dominica","America/Edmonton","America/Eirunepe","America/El_Salvador","America/Fortaleza","America/Glace_Bay","America/Godthab","America/Goose_Bay","America/Grand_Turk","America/Grenada","America/Guadeloupe","America/Guatemala","America/Guayaquil","America/Guyana","America/Halifax","America/Havana","America/Hermosillo","America/Indiana/Indianapolis","America/Indiana/Knox","America/Indiana/Marengo","America/Indiana/Petersburg","America/Indiana/Tell_City","America/Indiana/Vevay","America/Indiana/Vincennes","America/Indiana/Winamac","America/Inuvik","America/Iqaluit","America/Jamaica","America/Juneau","America/Kentucky/Louisville","America/Kentucky/Monticello","America/Kralendijk","America/La_Paz","America/Lima","America/Los_Angeles","America/Lower_Princes","America/Maceio","America/Managua","America/Manaus","America/Marigot","America/Martinique","America/Matamoros","America/Mazatlan","America/Menominee","America/Merida","America/Metlakatla","America/Mexico_City","America/Miquelon","America/Moncton","America/Monterrey","America/Montevideo","America/Montreal","America/Montserrat","America/Nassau","America/New_York","America/Nipigon","America/Nome","America/Noronha","America/North_Dakota/Beulah","America/North_Dakota/Center","America/North_Dakota/New_Salem","America/Ojinaga","America/Panama","America/Pangnirtung","America/Paramaribo","America/Phoenix","America/Port-au-Prince","America/Port_of_Spain","America/Porto_Velho","America/Puerto_Rico","America/Rainy_River","America/Rankin_Inlet","America/Recife","America/Regina","America/Resolute","America/Rio_Branco","America/Santa_Isabel","America/Santarem","America/Santiago","America/Santo_Domingo","America/Sao_Paulo","America/Scoresbysund","America/Sitka","America/St_Barthelemy","America/St_Johns","America/St_Kitts","America/St_Lucia","America/St_Thomas","America/St_Vincent","America/Swift_Current","America/Tegucigalpa","America/Thule","America/Thunder_Bay","America/Tijuana","America/Toronto","America/Tortola","America/Vancouver","America/Whitehorse","America/Winnipeg","America/Yakutat","America/Yellowknife","Antarctica/Casey","Antarctica/Davis","Antarctica/DumontDUrville","Antarctica/Macquarie","Antarctica/Mawson","Antarctica/McMurdo","Antarctica/Palmer","Antarctica/Rothera","Antarctica/Syowa","Antarctica/Troll","Antarctica/Vostok","Arctic/Longyearbyen","Asia/Aden","Asia/Almaty","Asia/Amman","Asia/Anadyr","Asia/Aqtau","Asia/Aqtobe","Asia/Ashgabat","Asia/Baghdad","Asia/Bahrain","Asia/Baku","Asia/Bangkok","Asia/Beirut","Asia/Bishkek","Asia/Brunei","Asia/Choibalsan","Asia/Chongqing","Asia/Colombo","Asia/Damascus","Asia/Dhaka","Asia/Dili","Asia/Dubai","Asia/Dushanbe","Asia/Gaza","Asia/Harbin","Asia/Hebron","Asia/Ho_Chi_Minh","Asia/Hong_Kong","Asia/Hovd","Asia/Irkutsk","Asia/Jakarta","Asia/Jayapura","Asia/Jerusalem","Asia/Kabul","Asia/Kamchatka","Asia/Karachi","Asia/Kashgar","Asia/Kathmandu","Asia/Khandyga","Asia/Kolkata","Asia/Krasnoyarsk","Asia/Kuala_Lumpur","Asia/Kuching","Asia/Kuwait","Asia/Macau","Asia/Magadan","Asia/Makassar","Asia/Manila","Asia/Muscat","Asia/Nicosia","Asia/Novokuznetsk","Asia/Novosibirsk","Asia/Omsk","Asia/Oral","Asia/Phnom_Penh","Asia/Pontianak","Asia/Pyongyang","Asia/Qatar","Asia/Qyzylorda","Asia/Rangoon","Asia/Riyadh","Asia/Sakhalin","Asia/Samarkand","Asia/Seoul","Asia/Shanghai","Asia/Singapore","Asia/Taipei","Asia/Tashkent","Asia/Tbilisi","Asia/Tehran","Asia/Thimphu","Asia/Tokyo","Asia/Ulaanbaatar","Asia/Urumqi","Asia/Ust-Nera","Asia/Vientiane","Asia/Vladivostok","Asia/Yakutsk","Asia/Yekaterinburg","Asia/Yerevan","Atlantic/Azores","Atlantic/Bermuda","Atlantic/Canary","Atlantic/Cape_Verde","Atlantic/Faroe","Atlantic/Madeira","Atlantic/Reykjavik","Atlantic/South_Georgia","Atlantic/St_Helena","Atlantic/Stanley","Australia/Adelaide","Australia/Brisbane","Australia/Broken_Hill","Australia/Currie","Australia/Darwin","Australia/Eucla","Australia/Hobart","Australia/Lindeman","Australia/Lord_Howe","Australia/Melbourne","Australia/Perth","Australia/Sydney","Canada/Atlantic","Canada/Central","Canada/Eastern","Canada/Mountain","Canada/Newfoundland","Canada/Pacific","Europe/Amsterdam","Europe/Andorra","Europe/Athens","Europe/Belgrade","Europe/Berlin","Europe/Bratislava","Europe/Brussels","Europe/Bucharest","Europe/Budapest","Europe/Busingen","Europe/Chisinau","Europe/Copenhagen","Europe/Dublin","Europe/Gibraltar","Europe/Guernsey","Europe/Helsinki","Europe/Isle_of_Man","Europe/Istanbul","Europe/Jersey","Europe/Kaliningrad","Europe/Kiev","Europe/Lisbon","Europe/Ljubljana","Europe/London","Europe/Luxembourg","Europe/Madrid","Europe/Malta","Europe/Mariehamn","Europe/Minsk","Europe/Monaco","Europe/Moscow","Europe/Oslo","Europe/Paris","Europe/Podgorica","Europe/Prague","Europe/Riga","Europe/Rome","Europe/Samara","Europe/San_Marino","Europe/Sarajevo","Europe/Simferopol","Europe/Skopje","Europe/Sofia","Europe/Stockholm","Europe/Tallinn","Europe/Tirane","Europe/Uzhgorod","Europe/Vaduz","Europe/Vatican","Europe/Vienna","Europe/Vilnius","Europe/Volgograd","Europe/Warsaw","Europe/Zagreb","Europe/Zaporozhye","Europe/Zurich","GMT","Indian/Antananarivo","Indian/Chagos","Indian/Christmas","Indian/Cocos","Indian/Comoro","Indian/Kerguelen","Indian/Mahe","Indian/Maldives","Indian/Mauritius","Indian/Mayotte","Indian/Reunion","Pacific/Apia","Pacific/Auckland","Pacific/Chatham","Pacific/Chuuk","Pacific/Easter","Pacific/Efate","Pacific/Enderbury","Pacific/Fakaofo","Pacific/Fiji","Pacific/Funafuti","Pacific/Galapagos","Pacific/Gambier","Pacific/Guadalcanal","Pacific/Guam","Pacific/Honolulu","Pacific/Johnston","Pacific/Kiritimati","Pacific/Kosrae","Pacific/Kwajalein","Pacific/Majuro","Pacific/Marquesas","Pacific/Midway","Pacific/Nauru","Pacific/Niue","Pacific/Norfolk","Pacific/Noumea","Pacific/Pago_Pago","Pacific/Palau","Pacific/Pitcairn","Pacific/Pohnpei","Pacific/Port_Moresby","Pacific/Rarotonga","Pacific/Saipan","Pacific/Tahiti","Pacific/Tarawa","Pacific/Tongatapu","Pacific/Wake","Pacific/Wallis","US/Alaska","US/Arizona","US/Central","US/Eastern","US/Hawaii","US/Mountain","US/Pacific","UTC"])}();