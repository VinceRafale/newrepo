// Generated by CoffeeScript 1.7.1
(function() {
  var app;

  app = angular.module('ratings', []);

  app.directive("angularRatings", function() {
    return {
      restrict: 'E',
      scope: {
        model: '=ngModel',
        notifyId: '=notifyId'
      },
      replace: true,
      transclude: true,
//      template:
//        '<div><ol class="angular-ratings">' +
//          '<li data-value="1" ng-class="{active:model>0,over:over>0}"><i class="fa fa-star"></i></li>' +
//          '<li data-value="2" ng-class="{active:model>1,over:over>1}"><i class="fa fa-star"></i></li>' +
//          '<li data-value="3" ng-class="{active:model>2,over:over>2}"><i class="fa fa-star"></i></li>' +
//          '<li data-value="4" ng-class="{active:model>3,over:over>3}"><i class="fa fa-star"></i></li>' +
//          '<li data-value="5" ng-class="{active:model>4,over:over>4}"><i class="fa fa-star"></i></li>' +
//        '</ol></div>',
      template:
        '<div class="angular-ratings">' +
          '<span data-value="1" class="star" ng-class="{half:model>0&&model<=0.5, full:model>=0.5, over:over>0}">&#xf24e;</span>' +
          '<span data-value="2" class="star" ng-class="{half:model>1&&model<=1.5, full:model>1.5, over:over>1}">&#xf24e;</span>' +
          '<span data-value="3" class="star" ng-class="{half:model>2&&model<=2.5, full:model>2.5, over:over>2}">&#xf24e;</span>' +
          '<span data-value="4" class="star" ng-class="{half:model>3&&model<=3.5, full:model>3.5, over:over>3}">&#xf24e;</span>' +
          '<span data-value="5" class="star" ng-class="{half:model>4&&model<=4.5, full:model>4.5, over:over>4}">&#xf24e;</span>' +
        '</div>',
      controller: [
        '$scope', '$attrs', '$http', function($scope, $attrs, $http) {
          $scope.over = 0;
          $scope.setRating = function(rating) {
            $scope.$apply(function() {
              $scope.model = rating;
            });
//            $scope.model = rating;
//            $scope.$apply();
//            if ($attrs.notifyUrl !== void 0 && $scope.notifyId) {
//              return $http.post($attrs.notifyUrl, {
//                id: $scope.notifyId,
//                rating: rating
//              }).error(function(data) {
//                if (typeof data === 'string') {
//                  alert(data);
//                }
//                return $scope.model = 0;
//              });
//            }
          };
          return $scope.setOver = function(n) {
//            $scope.over = n;
//            return $scope.$apply();
            $scope.$apply(function() {
              $scope.over = n;
            });
          };
        }
      ],
      link: function(scope, iElem, iAttrs) {
        if (iAttrs.readonly === undefined) {
//          debugger;
          return angular.forEach(iElem.children(), function(star) {
            star.addEventListener('mouseover', function() {
              return scope.setOver(parseInt(angular.element(star).attr('data-value')));
            });
            star.addEventListener('mouseout', function() {
              return scope.setOver(0);
            });
            return star.addEventListener('click', function() {
              return scope.setRating(parseInt(angular.element(star).attr('data-value')));
            });
          });
        }
      }
    };
  });

}).call(this);
