<ion-view title="{{ 'MESSAGES' | translate }}" cache-view="false"> <ion-nav-buttons side="left"> <button ng-click="backButton()" class="button back-button buttons button-clear header-item"> <i class="icon ion-chevron-left"></i> </button> </ion-nav-buttons> <div class="bar bar-subheader mellon-subheader" translate="CHAT WITH friendName" translate-value-friend-name="{{friendName}}"> </div> <ion-content has-bouncing="false" overflow-scroll="false" delegate-handle="mainMessageScroll" class="messages-content has-subheader" ng-class="{'has-subfooter' : userPaypalAccount !== null && friendPrivate === false && myProducts !== null}"> <button class="button horizontal-button load-chat-messages-button dark-blue" ng-if="moreDataCanBeLoaded" ng-click="loadMore()">{{ 'Load previous Messages' | translate }}</button> <div ng-if="apiTotalCount !== null && messageThreads.length>pageSize && !moreDataCanBeLoaded" class="wall-no-product-found">{{ 'No more chats to show.' | translate }}</div> <div ng-if="apiTotalCount !== null && moreDataCanBeLoaded== false && moreDataCanBeLoaded != null && messageList.length>pageSize" class="wall-no-product-found">{{ 'Chat beginning.' | translate }}</div> <div class="message-wrapper" ng-repeat="message in messageList | orderBy:'created_at' | limitTo:-listLimit track by message.id" ng-class="{ 'right': userLoggedId === message.sender_id, 'left': userLoggedId !== message.sender_id }"> <div> <div ng-if="message.display_message_day" class="message-day"> {{ message.created_at | amDateFormat:'DD MMMM' }} </div> <div class="chat-bubble clearfix"> <img class="chat-image" ng-if="message.sender.imageUrl==null" src="img/avatar-placeholder.svg"> <cl-image class="chat-image" ng-if="message.sender.imageUrl!=null" public-id="{{message.sender.facebook_id ? message.sender.facebook_id : message.sender.imageUrl}}" format="jpg" secure="secure" type="{{message.sender.facebook_id ? 'facebook' : 'upload'}}"> <cl-transformation height="110" width="110" crop="fill"> </cl-image> <div class="message-detail"> <div class="message-time"> {{ message.created_at | amUtc | amLocal | amDateFormat:'HH:mm' }} </div> <div class="message-title" ng-if="message.title !== null && message.title !== ''"> <span class="title-label" ng-if="message.payment_request_id != null || (message.product_id !== null && message.product_id !== undefined)">DEAL:</span> <span class="title-label" ng-if="message.friend_information_id !== null && message.friend_information_id !== undefined">ABOUT:</span> {{ message.title }} </div> <div class="message-text allowSelection" ng-bind-html="message.text.toString() | emailAutoLink | phoneAutoLink | emojioneToImage | nl2br"> </div> </div> </div> <div ng-if="message.payment_request_id != null" class="payment-request"> <div class="payment-request-thumb-container"> <img ng-src="{{message.paymentRequest.product_default_image}}" ng-if="message.paymentRequest.product_default_image!=null" class="payment-request-thumb default-image"> <cl-image ng-if="!message.paymentRequest.product_default_image" public-id="{{message.paymentRequest.product_media[0].path}}" class="thumbnail inline payment-request-thumb" format="jpg" secure="secure" resource-type="{{message.paymentRequest.product_media[0].type}}"> <cl-transformation height="150" width="150" crop="fill"></cl-transformation> </cl-image> </div> <div class="payment-request-title" ng-if="message.paymentRequest.product_status == 1 || message.paymentRequest.product_status == 2"> {{ message.paymentRequest.product_title }} </div> <div class="payment-request-title" ng-if="message.paymentRequest.product_status == 0 || message.paymentRequest.product_status == 3"> {{ 'Deleted Deal' | translate }} </div> <div class="payment-request-price"> <span class="payment-request-currency">{{message.paymentRequest.currency_symbol}}</span> {{ message.paymentRequest.price}} </div> <button ng-if="message.sender_id!=user.id && message.paymentRequest.product_status == 1" mln-paypal-payment ng-click="confirmMakePaypalPaymentByRequest(message.payment_request_id)" class="button button-small button-clear payment-request-button"> <img src="img/logo-paypal.svg"> </button> </div> </div> </div> </ion-content> <form name="sendMessageForm" ng-submit="sendMessage(sendMessageForm)" novalidate class="send-message-form"> <ion-footer-bar class="bar-stable item-input-inset message-footer" ng-class="{'bar-subfooter' : userPaypalAccount !== null && friendPrivate === false && myProducts.length}" keyboard-attach> <div class="label" ng-if="!friendPrivate"> <textarea class="grey-border msd-elastic" ng-model="input.message" value="" required minlength="1" maxlength="1500" id="message-textarea" data-tap-disabled="true"></textarea> </div> <div ng-if="!friendPrivate" class="footer-btn-wrap send-button"> <button class="button button-icon icon footer-btn" type="submit" ng-class="{'ion-android-send': platform.isAndroid()}" ng-disabled="!input.message || input.message === ''"> <span ng-if="platform.isIOS()">{{ 'Send' | translate }}</span> </button> </div> <div ng-if="friendPrivate"> {{ 'Private Profile: can\'t chat' | translate }} </div> </ion-footer-bar> </form> <div ng-if="userPaypalAccount !== null && !friendPrivate && myProducts.length"> <div class="tabs bar-footer"> <button class="button horizontal-button buy-button dark-blue" ng-click="openModal()"> {{ 'SEND PAYMENT REQUEST' | translate }} </button> </div> </div> </ion-view>