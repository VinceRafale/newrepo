angular.module("app.directives",[]).directive("wfValidationMsg",["$timeout",function(t){return{restrict:"A",replace:!0,scope:{msg:"@",type:"@",show:"=",hidein:"@"},template:'<div ng-click="hideIt()" ng-show="show" class="alert ng-hide {{type}}"><span>&times;</span> {{ msg }}</div>',link:function(e,a,n){e.type=n.type||"alert-danger",e.hidein&&e.$watch("show",function(a,n){angular.equals(a,n)||a&&t(function(){e.hideIt()},e.hidein)}),e.hideIt=function(){e.show=!1}}}}]).directive("wfActivityChart",["$timeout",function(t){return{restrict:"EA",scope:{data:"=",height:"=",ctx:"="},link:function(e,a,n){function i(a,n){l&&l.destroy(),r.labels=a.labels,r.datasets[0].data=a.values,t(function(){l=new Chart(e.ctx).Line(r,s)},30)}if(e.height=e.height||260,e.data=e.data||{},!window.Chart)throw new Error("Chart.js is required");e.ctx=a[0].getContext("2d");var o=e.ctx.createLinearGradient(0,0,0,400);o.addColorStop(0,"rgba(243, 103, 101,0.5)"),o.addColorStop(1,"rgba(0, 89, 179,0.5)");var r={labels:e.data.labels,datasets:[{fillColor:o,pointColor:"rgba(255,255,255,1)",pointStrokeColor:"#fff",pointHighlightFill:"#fff",pointHighlightStroke:"rgba(151,187,205,1)",data:e.data.values}]},s={scaleBeginAtZero:!0,scaleShowLabels:!1,responsive:!0,tooltipFontSize:12,showTooltips:!0,tooltipFillColor:"rgba(0,0,0,0.2)",scaleGridLineColor:"rgba(255,255,255,.04)",tooltipEvents:[],tooltipTitleFontFamily:"'Fjalla One', 'Helvetica Neue', 'Helvetica', 'Arial', sans-serif",tooltipTemplate:"<%= value %> kcal",onAnimationComplete:function(){this.showTooltip(this.datasets[0].points,!0)}},l=new Chart(e.ctx).Line(r,s);e.$watch("data",i,!0),e.$on("$destroy",function(){l&&l.destroy()})}}}]).directive("wfIntroDots",["$filter","$rootScope",function(t,e){return{restrict:"EA",replace:!0,scope:{max:"=",active:"="},template:'<div class="into-pager" ng-class="{incrWidth : refer == true }"><span class="pipe"></span><a ng-class="{active : active == $index}" ng-repeat="dot in dots" href="#"></a></div>',link:function(a,n,i){a.max=a.max||4,a.dots=[],a.dots=t("range")(a.dots,0,a.max),a.refer=e.isRefer,e.localData.referData&&e.localData.referData.entity_id&&(a.entityId=e.localData.referData.entity_id)}}}]).directive("wfBack",["$ionicConfig","$ionicHistory","$state","$ionicViewSwitcher",function(t,e,a,n){return{restrict:"E",scope:{to:"@"},template:'<button ng-click="$ionicGoBack()" class="button back-button buttons button-clear header-item"><i class="icon {{icon}}"></i> </button>',link:function(i,o,r){i.$ionicGoBack=function(){if(n.nextDirection("back"),e.backView()&&"app.create-group"==e.backView().stateName)a.go("app.entities.all");else if(i.to)a.go(i.to);else if(e.backView())if($backView=e.backView(),$currentView=e.currentView(),$backView.stateId!=$currentView.stateId)e.goBack();else{var t=e.viewHistory().views[e.viewHistory().backView.backViewId];t.go()}else a.go("app.dashboard")};var s=t.backButton.icon();s&&"none"!==s&&(i.icon=s)}}}]).directive("wfTabs",function(){return{restrict:"E",transclude:!0,scope:{style:"@"},controller:["$scope","$element","$ionicSlideBoxDelegate",function(t,e,a){function n(t){angular.forEach(i,function(t){t.selected=!1}),t.selected=!0}var i=t.panes=[];t.select=function(t){t.callback({title:t.title}),n(t),"app.connectIt"!=t.$root.currentState&&"intro.connectIt"!=t.$root.currentState||"Description"!=t.title||a.update()},this.addPane=function(e){0===i.length&&t.select(e),e.current&&t.select(e),i.push(e)}}],template:'<div class="tabbable"><ul class="nav nav-tabs {{ style }}"><li ng-repeat="pane in panes" ng-class="{active:pane.selected}"><a ng-click="select(pane)">{{pane.title}}</a></li></ul><div class="tab-content" ng-transclude></div></div>',replace:!0}}).directive("wfPane",function(){return{require:"^wfTabs",restrict:"E",transclude:!0,scope:{title:"@",callback:"&",current:"="},link:function(t,e,a,n){n.addPane(t)},template:'<div class="tab-pane" ng-class="{active: selected}" ng-transclude></div>',replace:!0}}).directive("wfInputClear",["$compile","$timeout",function(t,e){return{restrict:"A",link:function(a,n,i){var o=n.find("input");a.input={len:0},a.clearInput=function(t){t.preventDefault(),o[0].value="",e(function(){o[0].focus()}),a.input.len=0},o.bind("keyup",function(){a.input.len=o[0].value.length,a.$apply()});var r=angular.element('<a class="clear-text button-clear" ng-show="input.len > 1" ng-click="clearInput($event)"><i class="ion-ios-close-outline"></i></a>');t(r)(a),n.append(r)}}}]).directive("wfBadge",["$ionicPopup","$filter","Share","$location","$timeout",function(t,e,a,n,i){return{restrict:"E",scope:{icon:"@",img:"=",active:"=",title:"@",locked:"=",data:"=",type:"@",hideShare:"="},link:function(o,r,s){o.shareIt=a.shareIt;var l=n.search();l.show&&l.show==o.data.id&&(o.data.locked="0",i(function(){angular.element(r.find("div")[0]).triggerHandler("click")},1e3)),o.showInfo=function(a){var n=o.data.points?o.data.points:0,i=angular.element(r.find("div")[0]).clone();i.find("h4").text(o.data.name);var s=i.html();o.data.desc="1"==o.data.locked?o.data.instructions:o.data.description;var l=[{text:e("translate")("ACHIEVEMENTS.ALL_RIGHT"),type:"button-positive big-button"}];"0"!=o.data.locked||o.hideShare||l.push({text:e("translate")("ACTION.SHARE"),type:"button-assertive big-button",onTap:function(t){!o.data.share&&o.data.description&&(o.data.share=o.data.description),o.shareIt(o.data.share,o.data.share+" https://www.wefitter.com?utm_source=app","https://wefitter.s3.amazonaws.com/wefitter_achievement_share.jpg","https://www.wefitter.com?utm_source=app","badge",o.data.id),c.close()}});var c=t.show({title:s,subTitle:'<i class="wf wf-coins"></i> +'+n,template:'<div class="text-center" ng-bind-html="data.desc"></div>',scope:o,buttons:l})}},template:'<div id="bdg-{{ data.id }}" ng-click="showInfo($event, data)" class="badge-wf"><span class="icon-wf-box" ng-class="{active: active, \'in-active\' : !active}"><span class="wf-stack wf-lg"><i ng-show="locked" class="ion-locked locked"></i><un-svg ng-if="img && type != \'challenge\'" svg-src="{{ data.image_url }}"></un-svg><un-svg ng-if="img && type === \'challenge\'" svg-src="img/challenge.svg"></un-svg><i class="wf wf-stack-2x" ng-class="{ \'wf-badge\' : active, positive : active, \'wf-badge-o\' : !active }"></i><i ng-if="!img" class="wf {{ icon }} wf-stack-1x light"></i></span><h4>{{title | excerpt:false:18}}</h4></span></div>'}}]).directive("wfMeter",["$timeout",function(t){return{restrict:"E",scope:{color:"@",value:"=",limit:"="},link:function(e,a,n){e.limit=e.limit||100,t(function(t){e.percent=Math.min(100,parseInt(e.value,10)/parseInt(e.limit,10)*100)},500)},template:'<div class="meter"><span class="{{ color }}" style="width: {{percent}}%"></span></div>',replace:!0}}]).directive("wfActivityList",function(){return{restrict:"EA",scope:{data:"=",emptyMsg:"@",manualLog:"=",showDetail:"="},templateUrl:"templates/dir/activity-item.html",replace:!0,controller:["$scope","$ionicModal","dataService","$filter","$ionicPopup","$state","$rootScope",function(t,e,a,n,i,o,r){t.descriptionText=n("translate")("WORKOUTS.DESCRIPTION_TEXT"),e.fromTemplateUrl("templates/dir/manual-activity.html",{scope:t,animation:"slide-in-up"}).then(function(e){t.activityModal=e}),t.openActivityModal=function(){t.activityModal.show(),t.appConneted=!0,t.disable=!0,a.get("connections").then(function(e){connections=e.data.content,angular.forEach(connections,function(e,a){0==e.disabled&&(t.appConneted=!1)}),t.disable=!1}),a.get("bonus/sport_codes").then(function(e){t.workouts=e.data.content})},t.closeActivityModal=function(){t.activityModal.hide()},t.openConnection=function(){t.closeActivityModal(),o.go("app.connect")},t.addActivity=function(e){var r={code:e.code};a.post("workouts",r).then(function(e){a.flushCacheByEndpoint("/workouts?"),t.closeActivityModal(),o.go("app.activity",{id:e.data.content.id})})["catch"](function(t){i.alert({title:n("translate")("ACTION.ERROR"),okType:"button-positive big-button",content:t.data?t.data.summary.message:n("translate")("WORKOUTS.ADD_ACTIVITY_FAILED_EXIST")})})["finally"](function(){})},t.showAlertPopup=function(){var t="";t=r.localData.deviceConnected?n("translate")("WORKOUTS.CONNECTION_EXISTS_MANUAL_TEXT"):n("translate")("WORKOUTS.ALREADY_LOGGED_MANUAL_TEXT"),i.alert({title:n("translate")("ACTION.WARNING"),okText:n("translate")("ACTION.GOT_IT"),okType:"button-positive big-button",content:t})},t.goActivity=function(t){o.go("app.activity",{id:t})}}]}}).directive("wfWeeklyStat",function(){return{restrict:"EA",scope:{stat:"=",title:"@"},templateUrl:"templates/dir/weekly-stat.html",replace:!0}}).directive("wfDashStats",function(){return{restrict:"EA",scope:{result:"=",title:"@"},templateUrl:"templates/dir/dash-stats.html",replace:!0,link:function(t,e){t.next_level_point_left=t.result.next_level_points-t.result.current_activity_level_points,t.current_level_progress=Math.round(t.result.current_activity_level_points/t.result.next_level_points*100)}}}).directive("wfChallengeCard",["$filter",function(t){return{restrict:"EA",scope:{data:"="},link:function(e,a,n){"kcal"==e.data.goal_unit?e.unit=t("translate")("UNIT.KCAL"):"distance"==e.data.goal_unit?e.unit=t("translate")("UNIT.KM"):"points"==e.data.goal_unit?e.unit=t("translate")("UNIT.POINTS"):"duration"==e.data.goal_unit&&(e.unit=t("translate")("UNIT.HOURS"))},templateUrl:"templates/dir/challenge.html",replace:!0}}]).directive("wfIcon",function(){return{restrict:"E",scope:{icon:"@",caption:"@",img:"@",title:"@"},template:'<div class="icon-wf"><span class="icon"><i ng-show="icon" class="wf {{icon}}"></i><svg-image ng-if="img" src="{{ img }}" class="assertive"></svg-image><p ng-show="caption">{{ caption }}</p></span><h4>{{title}}</h4></div>',replace:!0}}).directive("wfIconToggleGroup",function(){return{restrict:"AE",transclude:!0,template:"<div ng-transclude></div>",scope:{ngModel:"="},controller:["$scope","$element",function(t,e){function a(e){angular.forEach(n,function(t){t.selected=!1}),e.selected=!0,t.ngModel=e.key.toLowerCase()}var n=t.icons=[];this.select=function(t){t.callback({title:t.title}),a(t)},this.addIcon=function(t){0===n.length&&this.select(t),n.push(t)}}]}}).directive("wfIconToggle",function(){return{restrict:"E",replace:!0,scope:{icon:"@",title:"@",callback:"&",key:"@"},require:"^wfIconToggleGroup",link:function(t,e,a,n){n.addIcon(t),t.select=function(e){n.select(t)}},template:'<div class="icon-toggle-wf" ng-click="select(title)" ng-class="{\'checked\': selected}"><span class="icon"><i class="wf {{icon}}"></i></span><h3>{{title}}</h3></div>'}}).directive("wfLeaderboard",["$window","$ionicScrollDelegate","$filter","$timeout","dataService","$rootScope","$state",function(t,e,a,n,i,o,r){return{restrict:"EA",scope:{result:"=",params:"=",topRank:"=",meta:"=",perPage:"=",emptyMsg:"@",url:"=",imIn:"=",hasFooter:"@",refresh:"="},templateUrl:"templates/dir/leaderboard.html",link:function(t,n,o){function s(){"kcal"==t.icon?t.unit=a("translate")("UNIT.KCAL"):"distance"==t.icon?t.unit=a("translate")("UNIT.KM"):"points"==t.icon?t.unit=a("translate")("UNIT.POINTS"):"duration"==t.icon&&(t.unit=a("translate")("UNIT.HOURS"))}t.isTopRankShow=!0,t.noData=!1,t.imIn=t.imIn||null;var l=0;t.$watch("refresh",function(e,a){l>0&&t.loadMore(!1,!0),l++}),t.$watch("result",function(e,a){t.result=e,t.topRank=e.top_users}),t.topRank=t.topRank||t.result.top_users,t.meta=t.meta||t.result,t.max=t.result.top_users[0].value,t.icon=t.meta.rank_unit,s();var c=!0;t.isDataAvailable=!0,t.isUpSideDataAvailable=!0;var d=0;t.errorMsg=null,t.perPage=t.perPage||5,t.offset=t.meta.offset+t.perPage,t.upOffset=t.meta.offset-t.perPage;var u=t.limitKey||"limit",p=t.offsetKey||"offset";if(t.params=t.params||null,!t.url)throw new Error("I need a url to fetch the data!");var f=0;t.$watch(o.params,function(e,a){f>0&&(t.noData=!1,t.params&&"group"==t.params.mode?(t.isTopRankShow=!1,t.perPage=10,t.result.rank_users=[]):t.params&&"user"==t.params.mode?(t.result.rank_users=[],t.isTopRankShow=!0,t.perPage=5):(t.isTopRankShow=!0,t.perPage=5),t.loadMore(!0)),f++},!0),t.loadMore=function(n,o){if(n===!0&&(t.isDataAvailable=!0,t.isUpSideDataAvailable=!0),o===!0&&t.upOffset<0)return t.$broadcast("scroll.refreshComplete"),!1;if(c&&o===!0&&t.isUpSideDataAvailable||c&&t.isDataAvailable){c=!1;var r={};r[u]=t.perPage,n||(r[p]=t.offset),o===!0&&(r[p]=t.upOffset),t.params&&angular.extend(r,t.params),i.get(t.url,{neverCache:!0,params:r}).then(function(l){if(t.errorMsg=null,r.offset>l.data.params.offset)return t.errorMsg=t.emptyMsg||a("translate")("ACTION.NO_RESULT"),t.isDataAvailable=!1,void(t.isUpSideDataAvailable=!1);var c=l.data;if(c.content&&c.content.rank_groups&&(c.content.top_users=c.content.top_groups,c.content.rank_users=c.content.rank_groups,c.content["user-stats"]=c.content["user-group"],t.result["user-stats"]=c.content["user-stats"]),c.content.top_users.length>0&&(t.max=c.content.top_users[0].value,t.topRank=c.content.top_users,t.result["user-stats"]=c.content["user-stats"]),n===!0&&(t.offset=c.params.offset,t.upOffset=t.offset-t.perPage,t.result.rank_users=[],e.$getByHandle("leaderboardScroll").scrollTop()),c&&c.content&&c.content.goal_unit?t.icon=c.content.goal_unit:t.icon=c.params.rank_unit||"kcal",s(),c&&c.content.rank_users.length>0){var d=c.content.rank_users.length;if(o===!0)for(var u=d-1;u>=0;u--)t.result.rank_users.unshift(c.content.rank_users[u]);else for(var u=0;d>u;u++)t.result.rank_users.push(c.content.rank_users[u]);o===!0?t.upOffset=t.upOffset-t.perPage:t.offset=t.perPage+t.offset,c.content.rank_users.length<t.perPage&&(t.isDataAvailable=!1),o===!0&&t.upOffset<0&&(t.isUpSideDataAvailable=!1)}else t.errorMsg=t.emptyMsg||a("translate")("ACTION.NO_RESULT"),t.isDataAvailable=!1,t.isUpSideDataAvailable=!1,t.noData=!0;window.mixpanel&&i.get("profile",{cache:!1}).then(function(t){var e=t.data.content[0];window.mixpanel.track("Leaderboard scroll",{userId:e.user_id,email:e.email})})})["catch"](function(e){t.$broadcast("scroll.infiniteScrollComplete"),d>=3&&(t.isDataAvailable=!1,t.isUpSideDataAvailable=!1,t.errorMsg=a("translate")("ACTION.NO_DATA_FROM_API")),d++})["finally"](function(){c=!0,t.$broadcast("scroll.infiniteScrollComplete"),t.$broadcast("scroll.refreshComplete")})}else t.$broadcast("scroll.infiniteScrollComplete"),t.$broadcast("scroll.refreshComplete"),c=!0},t.getProfile=function(e,a){a==t.result["user-stats"].ranking?r.go("app.userProfile",{id:e}):r.go("app.publicProfile",{id:e})}}}}]).directive("hires",["$compile","$timeout",function(t,e){return{restrict:"AE",scope:{hires:"@",spinnerStyle:"@",width:"@",height:"@"},link:function(t,a,n){function i(){a.attr("src",t.hires)}if(""!==t.hires){t.loading=!0;var o=a.parent("div")[0];i(),a.one("load",function(){e(function(){t.loading=!1}),t.height&&(o.style.backgroundImage="url("+t.hires+")",o.style.backgroundSize="cover",o.style.height=t.height+"px",o.style.overflow="hidden")}),a.one("error",function(e,n){a.attr("src","img/placeholder-broken.svg"),t.height&&(o.style.backgroundImage="url(img/placeholder-broken.svg)",o.style.backgroundSize="cover",o.style.height=t.height+"px",o.style.overflow="hidden"),t.loading=!1})}else a.attr("src","img/placeholder-broken.svg")}}}]).directive("wfJoinBtn",["dataService","$ionicHistory","$rootScope","$ionicPopup","$localStorage","$filter",function(t,e,a,n,i,o){return{restrict:"EA",scope:{data:"=",update:"=",joinKey:"@",joinPostKey:"@",title:"@",answers:"=",url:"@",type:"@",callback:"&"},templateUrl:"templates/dir/join-btn.html",link:function(i,r,s){function l(t,e){for(var a=i.data.subcribe_survey.length-1;a>=0;a--)if(i.data.subcribe_survey[a].question_id==t)return"<p><strong>"+i.data.subcribe_survey[a].question+"</strong><br><em class=error> <span class=assertive>&#10007;</span> "+e+"</em></p>"}if(!i.url)throw new Error("Need URL to make the join request.");i.terms=o("translate")("GROUPS.TERMS");var c=i.joinKey||"joined",d=i.joinPostKey||"join";i.answers=i.data.subcribe_survey.length>0?i.answers:null;var u=i.title?i.title.split("|"):[o("translate")("ACTION.JOIN"),o("translate")("ACTION.LEAVE")];i.text=u[parseInt(i.data[c])];var p=i.url+"/"+i.data.id,f=0===parseInt(i.data[c])?1:0;i.update&&(f=!f),i.btnClass=1===f||i.update?"button-positive":"button-assertive",i.joinToggle=function(){f=0===parseInt(i.data[c])?1:0,i.update&&(f=!f);var r={};r[d]=f,i.answers&&angular.extend(r,i.answers),i.loading=!0,t.post(p,r).then(function(r){if(i.data[c]=f,i.text=u[f],i.btnClass="button-assertive"===i.btnClass?"button-positive":"button-assertive",1===f){window.mixpanel&&t.get("profile",{cache:!1}).then(function(t){var e=t.data.content[0];window.mixpanel.track("Group joined",{userId:e.user_id,email:e.email,groupId:i.data.id})}),0==i.data.latest_challenges.length&&0==i.data.latest_rewards.length?($title=o("translate")("GROUPS.ADD_GROUP_TITLE"),$okType="button-positive big-button",$okContent="<span translate='GROUPS.ADD_EMPTY_GROUP'></span>"):($title=o("translate")("GROUPS.ADD_GROUP_TITLE"),$okType="button-positive big-button",$okContent="<span translate='GROUPS.ADD_GROUP'></span>"),i.callback();var s=n.alert({title:$title,okType:$okType,content:$okContent});s.then(function(t){"app.entity"!=a.currentState&&"intro.entity"!=a.currentState&&e.goBack()}),window.fbq&&fbq("trackCustom","GroupJoined",{content_name:"app",value:.5,currency:"USD"})}else i.callback(),"app.entity"!=a.currentState&&"intro.entity"!=a.currentState&&e.goBack()})["catch"](function(t){var e=t.data.summary.message;if(angular.isObject(e)){errorString="";for(var a in e)e.hasOwnProperty(a)&&errorString!=e[a]&&(errorString+=l(a,e[a]));e=errorString}n.alert({title:o("translate")("ACTION.ERROR"),content:e})})["finally"](function(){i.loading=!1})}}}}]).directive("wfPager",["dataService","$filter",function(t,e){return{restrict:"EA",scope:{perPage:"=",dataset:"=",distance:"@",resultRoot:"@",params:"=",url:"=",offset:"=",emptyMsg:"@",limitKey:"@",offsetKey:"@",onComplete:"&"},template:'<div class="txt-center" ng-show="showError"><wf-no-results></wf-no-results>{{errorMsg}}</div><ion-infinite-scroll ng-if="!noMoreItemsAvailable" on-infinite="loadMore()" icon="none" distance="{{distance}}%"></ion-infinite-scroll>',link:function(a,n,i){var o=!0,r=!0,s=0;a.showError=!1,a.errorMsg=a.errorMsg||null;var l=a.resultRoot||null;a.perPage=a.perPage||10,a.offset=a.offset||0;var c=a.limitKey||"limit",d=a.offsetKey||"offset";if(a.params=a.params||null,a.dataRoot=a.dataRoot||"rewards",!a.url)throw new Error("I need a url to fetch the data!");var u=0;a.$watch(i.params,function(t,e){u>0&&a.loadMore(!0),u++},!0),a.loadMore=function(n){if(n||!n&&0!=a.offset)if(n&&(a.offset=0,r=!0),o&&r){o=!1;var i={};i[c]=a.perPage,i[d]=a.offset,a.params&&angular.extend(i,a.params),t.get(a.url,{params:i}).then(function(t){var n=t.data;if(n&&n.summary.results>0){a.showError=!1;var i=1;if(l){i=n.content[l].length;for(var o=0;i>o;o++)a.dataset[l].push(n.content[l][o])}else{i=n.content.length;for(var o=0;i>o;o++)a.dataset.push(n.content[o])}a.offset=a.perPage+a.offset,n.summary.results<a.perPage&&(r=!1)}else{a.showError=!0;var s;switch(a.url){case"challenges":s="ACTION.NO_MORE_RESULT_CHALLENGE";break;case"achievements":s="ACTION.NO_MORE_RESULT_ACHIEVEMENT";break;case"purchases":s="ACTION.NO_MORE_RESULT_PURCHASE";break;default:s="ACTION.NO_MORE_RESULT"}a.errorMsg=a.emptyMsg||a.dataset&&a.dataset.length>0?e("translate")("ACTION.NO_MORE_RESULT"):e("translate")(s),r=!1}})["catch"](function(t){a.$broadcast("scroll.infiniteScrollComplete"),s>=3&&(r=!1,a.errorMsg=e("translate")("ACTION.NO_DATA_FROM_API")),s++})["finally"](function(){a.onComplete&&a.onComplete(),o=!0,a.$broadcast("scroll.infiniteScrollComplete")})}else o=!0,a.$broadcast("scroll.infiniteScrollComplete")}}}}]).directive("wfThumbBar",function(){return{restrict:"E",scope:{type:"@",img:"@",unit:"@",goal:"=",current:"=",caption:"@",title:"@",done:"=",soon:"@",joined:"@",start:"@",end:"@",global:"@"},link:function(t,e,a){},template:'<div class="row thumb-bar-wf {{ type }}"><div class="col col-40 thumb-wrap"><div class="thumb"><div ng-if="soon === \'1\'" class="overlay-wf"><div class="cont" ng-bind-html="title"></div></div><div ng-if="done" class="overlay-wf"><div class="cont" ng-bind-html="title"></div></div><img class="img-responsive" ng-src="{{ img }}" alt="" /></div><div class="row meter-row row-no-padding"><div class="col col-center col-50"><wf-meter value="current" limit="goal"></wf-meter></div><div class="col col-center val col-50"><i class="wf" ng-class="{\'wf-coins\' : unit == \'points\', \'wf-calorie\' : unit == \'kcal\', \'wf-distance\' : unit == \'distance\', \'wf-time\' : unit == \'duration\'}"></i> {{ goal | shortNumber }}</div></div></div><div class="col col-60 thumb-caption"><h4>{{ caption }}</h4><i class="wf wf-check" ng-show="false"></i><p><div ng-if="soon == \'1\'" class="c-level ng-binding"><i class="icon ion-calendar"></i> <span am-time-ago="start"></span></div><div ng-if="soon == \'0\'" class="c-level ng-binding"><i class="icon ion-calendar"></i> {{ \'ACTION.ENDS\' | translate }} <span am-time-ago="end"></span></div></p><div ng-show="global === \'1\'" class="c-level ng-binding"><i class="wf wf-globe"></i> {{ \'CHALLENGE.GLOBAL\' | translate }}</div></div></div>',replace:!0}}).directive("showDuringResolve",["$rootScope",function(t){return{link:function(e,a){a.addClass("ng-hide");var n=t.$on("$stateChangeStart",function(){a.removeClass("ng-hide")});n=t.$on("$httpCall",function(){a.removeClass("ng-hide")}),n=t.$on("$httpCallDone",function(){a.addClass("ng-hide")}),n=t.$on("$stateChangeSuccess",function(){a.addClass("ng-hide")}),n=t.$on("$stateChangeError",function(){a.addClass("ng-hide")}),e.$on("$destroy",n)}}}]).directive("wfStickyWrapper",["$window",function(t){var e=[],a=function(){angular.forEach(e,function(a,n){var i=a[0],o=a.data("pos");if(o<=t.pageYOffset){var r=e[n+1],s=r?r[0]:null,l=r.data("pos");a.addClass("fixed"),s&&s.offsetTop>=l-s.clientHeight&&a.addClass("absolute").css("top",l-i.clientHeight+"px")}else{var c=e[n-1],d=c?c[0]:null;a.removeClass("fixed"),d&&t.pageYOffset<=o-d.clientHeight&&c.removeClass("absolute").removeAttr("style")}})},n=function(t,a,n){var i=a.children()[0],o=angular.element(i);a.css("height",i.clientHeight+"px"),o.data("pos",i.offsetTop),e.push(o)};return angular.element(t).off("scroll",a).on("scroll",a),{restrict:"E",transclude:!0,template:"<wf-sticky ng-transclude></wf-sticky>",link:n}}]).directive("extLinks",["$timeout",function(t){return{restrict:"A",link:function(e,a){t(function(){var t=a.find("a");t.length>0&&angular.forEach(t,function(t){t.href.match(/http/)&&(t.setAttribute("target","_blank"),t.setAttribute("onclick","window.open('"+t.href+"', '_system', 'location=yes'); return false;"))})})}}}]).directive("svgImage",["$http",function(t){return{restrict:"E",scope:{src:"@"},link:function(e,a){var n=e.src,i=t.get(n,{"Content-Type":"application/xml"});e.manipulateImgNode=function(t,e){var a=angular.element(t)[0],n=e.attr("class");if("undefined"!=typeof n)for(var i=n.split(" "),o=0;o<i.length;++o)a.classList.add(i[o]);return a.removeAttribute("xmlns:a"),a},i.success(function(t){a.replaceWith(e.manipulateImgNode(t,a))})}}}]).directive("wfNoResults",function(){return{restrict:"E",replace:!0,template:'<div class="bottom-spacer-20"><i class="ion-sad-outline wf-2x"></i></div>'}}).directive("setBottom",["$ionicScrollDelegate","$timeout",function(t,e){return function(a,n){ionic.Platform.isIOS()&&(window.addEventListener("native.keyboardshow",function(a){n.css("bottom",a.keyboardHeight+"px"),t.$getByHandle("bottomScroll").scrollBottom(!0),e(function(){t.$getByHandle("bottomScroll").scrollBy(0,-130,!1)},10)}),window.addEventListener("native.keyboardhide",function(e){n.css("bottom","0px"),t.$getByHandle("bottomScroll").scrollBottom(!0)}))}}]).directive("wfDisableSpace",function(){return function(t,e,a){e.bind("keydown keypress",function(t){return 32==t.which?!1:void(this.value=this.value.replace(/\s/g,""))})}}).directive("wfFeeds",["$window","$ionicScrollDelegate","$ionicPopup","$filter","$timeout","dataService","$rootScope","$state",function(t,e,a,n,i,o,r,s){return{restrict:"EA",scope:{params:"=",perPage:"=",emptyMsg:"@",url:"=",refreshfeed:"="},templateUrl:"templates/dir/feeds.html",link:function(r,l,c){function d(t){r.keyboard_height=t.keyboardHeight,g-=r.keyboard_height,r.wHeight=g-l[0].children[1].lastElementChild.offsetHeight,p()}function u(t){g+=r.keyboard_height,r.wHeight=g-l[0].children[1].lastElementChild.offsetHeight,r.setHeight()}function p(){var t=e.$getByHandle("comments-scroll").getScrollPosition().top,a=e.$getByHandle("comments-scroll").getScrollView().__maxScrollTop;t==a&&i(function(){e.$getByHandle("comments-scroll").scrollBottom()},10)}var f=0;r.$watch("refreshfeed",function(t,e){if(f>0){r.isDataAvailable=!0,r.errorMessage=!1,r.offset=0,r.comments=[],r.data={comment:""},r.loadMore(!1)}f++});var g=t.innerHeight-95;"ios"==ionic.Platform.platform()&&(g-=28),r.wHeight=g-51;var m=0;r.isDataAvailable=!0,r.errorMessage=!1,r.perPage=r.perPage||10,r.offset=0,r.comments=[],r.data={comment:""};var h=r.limitKey||"limit",v=r.offsetKey||"offset";if(r.params=r.params||null,!r.url)throw new Error("I need a url to fetch the data!");r.loadMore=function(t){var a={};a[h]=r.perPage,a[v]=r.offset,r.params&&angular.extend(a,r.params),r.isDataAvailable?o.get(r.url,{neverCache:!0,params:a}).then(function(n){if(a.offset>n.data.params.offset)return void(r.isDataAvailable=!1);var i=n.data;if(i&&i.content.comments.length>0){for(var o=i.content.comments.length,s=o-1;s>=0;s--)r.comments.unshift(i.content.comments[s]);t||e.$getByHandle("comments-scroll").scrollBottom(),i.content.comments.length<r.perPage&&(r.isDataAvailable=!1),r.offset=r.perPage+r.offset}else r.isDataAvailable=!1})["catch"](function(t){r.$broadcast("scroll.refreshComplete"),m>=3&&(r.isDataAvailable=!1,r.isUpSideDataAvailable=!1),m++})["finally"](function(){r.$broadcast("scroll.refreshComplete")}):r.$broadcast("scroll.refreshComplete")},r.setHeight=function(){var t=l[0].children[1].lastElementChild.offsetHeight;t>=51&&(r.wHeight=g-t,p())},window.addEventListener("native.keyboardshow",d),window.addEventListener("native.keyboardhide",u),r.sendComment=function(){if(""!=r.data.comment){var t={content:r.data.comment,is_mine:1,created:new Date,comment_id:Date.now()};r.comments.push(t),e.$getByHandle("comments-scroll").scrollBottom(),r.data.comment="",i(function(){r.setHeight()},100),r.send(t)}},r.send=function(t){var e={comment:t.content},a={headers:{"Content-Type":"application/x-www-form-urlencoded"},transformRequest:[function(t){for(var e="",a=Object.keys(t),n=0;n<a.length;n++){var i=angular.isObject(t[a[n]])?JSON.stringify(t[a[n]]):t[a[n]];e=e+a[n]+"="+i,n!=a.length-1&&(e+="&")}return e}]};r.errorMessage=!1;var n=_.findLastIndex(r.comments,{comment_id:t.comment_id});o.put(r.url,e,a).then(function(t){r.errorMessage=!1,r.comments[n].comment_id=t.data.content.comments[0].comment_id,r.comments[n].isSend=1})["catch"](function(t){r.errorMessage=!0,r.comments[n].isSend=0})["finally"](function(){})},r.checkTimeDiff=function(t){return t>0?r.comments[t].is_mine!=r.comments[t-1].is_mine||r.comments[t].user_id!=r.comments[t-1].user_id:!0},r.isPadding=function(t){if(t>0){if(r.comments[t].is_mine==r.comments[t-1].is_mine)return"pad-top-0"}else;},r.resend=function(t){0==t.isSend&&a.confirm({title:n("translate")("ACTION.RETRY"),template:"{{ 'ACTION.RETRY_MESSAGE' | translate }}",cancelType:"big-button button-stable",cancelText:n("translate")("ACTION.CANCEL"),okType:"big-button button-positive",okText:n("translate")("ACTION.RETRY")}).then(function(e){e&&r.send(t)})},r.getUserProfile=function(t){s.go("app.publicProfile",{id:t})}}}}]).directive("wfActivityBarChart",["$timeout",function(t){return{restrict:"EA",scope:{data:"=",height:"=",ctx:"=",level:"="},link:function(e,a,n){function i(a,n){l&&l.destroy(),r.labels=a.labels,r.datasets[0].data=a.values,t(function(){l=new Chart(e.ctx).BarWithYLine(r,s)},30)}if(e.height=e.height||260,e.data=e.data||{},!window.Chart)throw new Error("Chart.js is required");e.ctx=a[0].getContext("2d");var o=e.ctx.createLinearGradient(0,0,0,400);o.addColorStop(0,"rgba(243, 103, 101,0.5)"),o.addColorStop(1,"rgba(0, 89, 179,0.5)"),Chart.types.Bar.extend({name:"BarWithYLine",draw:function(){Chart.types.Bar.prototype.draw.apply(this,arguments);var t=this.scale,a=this.chart.ctx;a.save(),a.strokeStyle="rgba(33,168,223,0.8)",a.beginPath();for(var n=0;n<e.level.length;n++){var i=t.calculateY(e.level[n].goal);a.moveTo(0,i),a.lineTo(this.chart.width,i),a.textAlign="center",a.fillStyle="rgba(255,255,255,0.6)",a.fillText(e.level[n].name,Math.round(t.width)-50,i-15)}a.stroke(),a.restore()}});var r={labels:e.data.labels,datasets:[{fillColor:o,data:e.data.values}]},s={scaleBeginAtZero:!0,scaleShowLabels:!1,scaleFontColor:"rgba(255,255,255,0.4)",scaleFontSize:12,scaleFontFamily:"'Lato', 'Roboto', 'Segoe UI', 'sans-serif'",responsive:!0,tooltipFontSize:9,tooltipFontColor:"rgba(255,255,255,0.6)",showTooltips:!0,tooltipYPadding:0,tooltipYOffset:0,tooltiptitleSpacing:0,tooltipFillColor:"rgba(0,0,0,0)",scaleShowVerticalLines:!1,scaleShowHorizontalLines:!1,scaleGridLineColor:"rgba(255,0,0,1)",tooltipEvents:[],tooltipTitleFontFamily:"'Fjalla One', 'Helvetica Neue', 'Helvetica', 'Arial', sans-serif",tooltipTemplate:"<%= value %> pts",onAnimationComplete:function(){this.showTooltip(this.datasets[0].bars,!0)}},l=new Chart(e.ctx).BarWithYLine(r,s);e.$watch("data",i,!0),e.$on("$destroy",function(){l&&l.destroy()})}}}]);