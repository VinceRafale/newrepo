angular.module("app.services",[]).factory("dataService",["$http","wfConfig","$localStorage","$q","$httpParamSerializer",function(t,e,n,o,r){function a(e,n){var r=T(e,n);if(w(r)&&n&&!n.neverCache){var a=S(r);if(a)return o.when({data:a})}return t.get(e,n).then(function(t){return S(r,t.data),t})}function i(t,e){return t=t||"",a(A+t,e)}function u(e,n){return t.get(e,n)}function c(e,n,o){return t.post(e,n,o)}function s(e,n){return e=e||"",t.head(A+e,n)}function l(e,n,o){return e=e||"",t.post(A+e,n,o).then(y)}function f(e,n,o){return e=e||"",t.put(A+e,n,o).then(y)}function d(e,n,o){return e=e||"",t.patch(A+e,n,o)}function h(e,n){return e=e||"",t.jsonp(A+e,n)}function p(e,n){return e=e||"",t["delete"](A+e,n)}function g(t){return A=t,this}function v(){var t=o.defer();return n.boot?t.resolve(n.boot):L.get("boot").then(function(t){n.boot=t.data.content},function(t){})}function m(){return n.boot}function b(){delete n.boot}function w(t){return t.match(/wefitter.com\/api/)}function T(t,e){var n=e&&e.params?"?"+r(e.params):"";return t+n}function $(t,e){return e=e||!1,e?delete n[t]:angular.forEach(n,function(e,o){w(o)&&o.match(t)&&delete n[o]}),this}function y(t){var e=t.config.url;return e.match(/challenges/)&&($("/challenges?"),$(e,!0),$("/dashboard")),e.match(/purchases/)&&($("/purchases"),$("/rewards?"),$("/rewards/"+t.data.content.reward_id),$(e,!0),$("/dashboard")),e.match(/entities/)&&($("/rewards?"),$("/entities?"),$("/challenges?"),$("/leaderboard?"),$(e,!0),$("/dashboard")),e.match(/connections/)&&($("/workouts?"),$("/connections"),$(e,!0),$("/dashboard")),e.match(/dashboard/)&&($("/rewards?"),$("/challenges?")),e.match(/profile/)&&($("/rewards?"),$("/challenges?"),$("/dashboard")),t}function S(t,o){if(o)return n[t]={},n[t].updated=new Date,n[t].value=o,o;var r=n[t];if(!r)return null;var a=new Date,i=new Date(r.updated),u=a.getTime()-i.getTime();return u>D&&e.ONLINE?null:n[t]?n[t].value:null}var A=e.API_URL,D=216e5,L={get:i,head:s,post:l,put:f,"delete":p,jsonp:h,patch:d,boot:v,bootData:m,getAbsolute:u,postAbsolute:c,removeBootData:b,setBaseUrl:g,flushRelatedCache:y,flushCacheByEndpoint:$};return L}]).factory("auth",["$auth","dataService","$q","$location",function(t,e,n,o){function r(t,n){return e.post("user/forgot",{email:t},n)}function a(t){return e.post("auth/resend-activation",{email:t})}function i(t){return e.post("auth/resend-reset",{email:t})}function u(){return e.removeBootData(),t.logout()}function c(){var e=n.defer();return t.isAuthenticated()?e.resolve():o.path("/auth/login"),e.promise}var s={login:t.login,signup:t.signup,logout:u,setToken:t.setToken,getToken:t.getToken,authenticate:t.authenticate,isAuthenticated:t.isAuthenticated,loginRequired:c,recover:r,resendActivation:a,resendReset:i};return s}]).factory("Upload",["$q","$cordovaCamera","$jrCrop","dataService",function(t,e,n,o){return{fileTo:function(r,a){var i=t.defer();if(ionic.Platform.isWebView()){var u={quality:80,destinationType:Camera.DestinationType.DATA_URL,sourceType:Camera.PictureSourceType.PHOTOLIBRARY,encodingType:Camera.EncodingType.JPEG,allowEdit:!1,correctOrientation:!0,saveToPhotoAlbum:!1,targetWidth:600,targetHeight:600};e.getPicture(u).then(function(t){n.crop({url:"data:image/jpeg;base64,"+t,width:a&&a.width?a.width:320,height:a&&a.height?a.height:320}).then(function(t){o.post(r,{imgData:t.toDataURL()}).then(function(t){i.resolve(t)})["catch"](function(t){i.reject(t)})},function(){i.reject({cancel:!0})})},function(t){i.reject(t)})}else i.reject("Uploading not supported in browser");return i.promise}}}]).factory("ConnectivityMonitor",["$rootScope","$cordovaNetwork",function(t,e){return{isOnline:function(){return ionic.Platform.isWebView()?e.isOnline():navigator.onLine},isOffline:function(){return ionic.Platform.isWebView()?!e.isOnline():!navigator.onLine},startWatching:function(e,n){ionic.Platform.isWebView()?(t.$on("$cordovaNetwork:online",n||function(t,e){}),t.$on("$cordovaNetwork:offline",e||function(t,e){})):(window.addEventListener("online",n||function(t){},!1),window.addEventListener("offline",e||function(t){},!1))}}}]).factory("Share",["$state",function(t){return{shareIt:function(e,n,o,r,a,i){return e?angular.isObject(e)?t.go("app.share",e):(o=o||0,r=r||0,n=n||0,t.go("app.share",{text:e,subject:n,img:o,link:r,element:a,id:i})):void 0}}}]).factory("storeLocalData",["$cordovaSQLite",function(t){return{set:function(e,n){var o="INSERT INTO localStorage (key, value) VALUES (?,?)";t.execute(db,o,[e,JSON.stringify(n)]).then(function(t){},function(t){})}}}]).factory("getDays",["$q","$filter","$translate",function(t,e,n){return{get:function(){var o=t.defer(),r=new Date,a=n.proposedLanguage()||n.use();if("en"==a)var i=["Mon","Tue","Wed","Thu","Fri","Sat","Sun"];else var i=["Lun","Mar","Mie","Jue","Vie","Sab","Dom"];var u=r.getDay();0==u&&(u=7),i[u-1]=e("translate")("ACTION.TODAY");var c=i.splice(u,i.length-u);return i=c.concat(i),o.resolve(i),o.promise}}}]).factory("popup",["$filter","$ionicPopup","$interpolate",function(t,e,n){return{imagePopup:function(o,r,a,i){var u={image:o,title_text:r||t("translate")("UNIT.POINTS"),sub_title:i||"",content:a||""},c=n("<div><div class='popup-image-wrap'><i class='wf {{image}}'></i></div><div><h4>{{title_text}}</h4></div></div>")(u),s=n("<div>{{content}}</div>")(u),l=[];l.push({text:t("translate")("ACHIEVEMENTS.ALL_RIGHT"),type:"button-positive big-button",onTap:function(t){f.close()}});var f=e.show({title:c,subTitle:u.sub_title,template:s,buttons:l})}}}]);