function SimplePubSub(){var events={};return{on:function(names,handler){return names.split(" ").forEach(function(name){events[name]||(events[name]=[]),events[name].push(handler)}),this},trigger:function(name,args){return angular.forEach(events[name],function(handler){handler.call(null,args)}),this}}}function selectContactEvent(index,mIndex,evt){var currentElem=event.currentTarget.getElementsByClassName("checkbox")[0],elementScope=angular.element(contactListElem).scope();currentElem&&currentElem.classList.contains("selected")?currentElem.classList.remove("selected"):currentElem.classList.add("selected"),elementScope.selectContact(index,mIndex)}function GroupsCtrl($scope,AppView,Utility,ViewManagement,Loader,Store,$location,$stateParams,GroupService,Toast){function nextButtonCallback(){Store.setObject("selectedContacts",handleHashContacts($scope.selectedGroup.contacts)),$location.path("/reminder")}function initGetGroupReminders(groupId){GroupService.getGroupReminders(groupId).then(function(reminders){$scope.selectedGroupReminders=reminders},function(err){toast.text="Couldn't load reminders",toast.type="error",Toast.setToast(toast)})}function handleHashContacts(contacts){return JSON.parse(angular.toJson(contacts))}var toast={text:"",type:"normal",show:!0,duration:5e3,isCloseBtn:!0,callback:null};AppView.setBodyClass("view-send-reminder"),Utility.setHeader(!0,{title:"Group",showBackButton:!0,showRightButton:!0,backButtonCallback:!1,rightButtonCallback:nextButtonCallback,rightButtonText:"Send",showMenuIcon:!1}),Utility.setFooter(!0),ViewManagement.pushView("/groups/"+$stateParams.groupId);var selectedGroupId=$stateParams.groupId;initGetGroupReminders(selectedGroupId),GroupService.getGroup(selectedGroupId).then(function(group){$scope.selectedGroup=group}),$scope.$on("$viewContentLoaded",function(){}),$scope.moveToRecipientView=function(){Store.setObject("selectedGroupData",{contacts:handleHashContacts($scope.selectedGroup.contacts)}),$location.path("/group-recipient-detail-list")}}function GroupRecipientListCtrl($scope,AppView,Utility,ViewManagement,Loader,Store,$location,State){function rightButtonCallBack(){$scope.selectedGroupContacts.filter(function(selectedContact){return selectedContact.isUnTick});$location.path("/groups/"+Store.getObject("selectedGroupId"))}AppView.setBodyClass("view-recipient-contact"),Utility.setHeader(!0,{title:"Recipients",showBackButton:!0,backButtonCallback:!1,showMenuIcon:!1,rightButtonCallback:rightButtonCallBack,rightButtonText:"Done",showRightButton:!0}),Utility.setFooter(!0),ViewManagement.pushView("/group-recipient-detail-list"),$scope.$on("$routeChangeSuccess",function(event,current,oldRoute){Loader.hideLoading(),oldRoute&&"/contacts"==oldRoute.$$route.originalPath?$scope.selectedGroupContacts=State.getStateVar("selectedGroupContacts"):$scope.selectedGroupContacts=Store.getObject("selectedGroupData").contacts}),$scope.$on("$viewContentLoaded",function(){Loader.showLoading()}),$scope.moveToSelectMoreContacts=function(){var selectedContacts=$scope.selectedGroupContacts.filter(function(selectedContact){return!selectedContact.isUnTick});State.setStateVar("selectedGroupContacts",selectedContacts),$location.path("/contacts")}}function GroupsCtrl($scope,AppView,Utility,ViewManagement,Loader,Store,$location,GroupService){function initGetGroups(){GroupService.getGroups().then(function(groups){$scope.groups=groups||[],GroupService.isGroupUpdateRequired=!1,Loader.hideLoading()},function(err){toast.text="Couldn't load groups",toast.type="error",Toast.setToast(toast),GroupService.isGroupUpdateRequired=!0,Loader.hideLoading()})}var toast={text:"a toast to life",type:"normal",show:!0,duration:5e3,isCloseBtn:!0,callback:null};AppView.setBodyClass("view-group"),Utility.setHeader(!0,{title:"Groups",showBackButton:!1,backButtonCallback:!1,showMenuIcon:!0}),Utility.setFooter(!0),ViewManagement.pushView("/groups"),$scope.groups=[],initGetGroups(),$scope.$on("$viewContentLoaded",function(){Loader.showLoading()}),$scope.selectGroup=function(index){var group=$scope.groups[index];$location.path("/groups/"+group._id)}}angular.module("SocialAlarmsApp",["ionic","ui.router","ngRoute","ngTouch","SocialAlarmsApp.login","SocialAlarmsApp.signUp","SocialAlarmsApp.general","SocialAlarmsApp.contacts","services.socialAlarms","SocialAlarmsApp.reminderStats","SocialAlarmsApp.groups","SocialAlarmsApp.reminders","ngTagsInput","angular-datepicker","tabSlideBox","ionic-datepicker","ionic-timepicker"]).config(["$httpProvider",function($httpProvider){$httpProvider.interceptors.push("CustomHttpInterceptor")}]).run(["$location","$timeout","$rootScope","ViewManagement","DeviceReady","Keyboard","Utility","Context","CustomHttpInterceptor","Loader","PushNotification","FBIntegration","Store",function($location,$timeout,$rootScope,ViewManagement,DeviceReady,Keyboard,Utility,Context,CustomHttpInterceptor,Loader,PushNotification,FBIntegration,Store){function addRemoveHeaderClass(show){Utility.isIOS()&&(header||(header=document.getElementById("headerBar")),header&&(show?header.classList.add("fixedHeaderHack"):header.classList.remove("fixedHeaderHack")))}function addRemoveSearchClass(show){if(Utility.isIOS()){var contactSearch=document.getElementById("contactSearch");contactSearch&&(show?contactSearch.classList.add("fixedSearchHack"):contactSearch.classList.remove("fixedSearchHack"))}}$rootScope.$on("$stateChangeStart",function(event,next,current){Loader.hideLoading(),Utility.isApp()&&next&&next.$$route&&current&&current.$$route&&("/dashboard"===next.$$route.originalPath&&"/login"===current.$$route.originalPath?Utility.fadeinAnimation():"/signUp"===next.$$route.originalPath&&"/login"===current.$$route.originalPath?Utility.fadeinAnimation():"/reminder"!==next.$$route.originalPath||"/dashboard"!==current.$$route.originalPath&&"/reminders/:viewname"!==current.$$route.originalPath||Utility.slideAnimation())}),$rootScope.$on("$stateChangeSuccess",function(){angular.element(document).ready(function(){Waves.attach(".button-default",["waves-button"]),Waves.attach(".waves",["waves-button"]),Waves.init(),Utility.isApp()&&$timeout(function(){window.scrollTo(0,window.scrollY)},100)})}),CustomHttpInterceptor.add("/login","POST",function(){Loader.showLoading()},function(){Loader.hideLoading()}),document.addEventListener("backbutton",function(e){if(Utility.getMenu().showMenu)$timeout(function(){Utility.toggleMenu()},0);else if("/dashboard"===$location.path()||"/login"===$location.path())navigator.app.exitApp();else{var prevPath=ViewManagement.popView();$timeout(function(){$location.path(prevPath)},0)}},!1),hello.init({facebook:"879682825417073"},{scope:"email",redirect_uri:"http://www.web.remindzapp.com"}),FlurryAgent.startSession("VF7R3CR4H3NH439K834F"),DeviceReady.registerReadyEvents(function(){if(DeviceReady.isReady()){if(Context.hasAccessToken()){var user=Store.getObject("user");user&&user.fb_id&&(FBIntegration.isFBInit()?FBIntegration.checkLoginState():Utility.isApp()?FBIntegration.appFBLogin():FBIntegration.fb_init(document,"script","facebook-jssdk"))}Utility.isApp()&&Context.hasAccessToken()&&PushNotification.register();var showFooter=function(){Context.hasAccessToken()&&$timeout(function(){window.scrollTo(0,window.scrollY)},300),addRemoveHeaderClass(!1),addRemoveSearchClass(!1),Utility.viewAdjustIos()},hideFooter=function(){addRemoveHeaderClass(!0),addRemoveSearchClass(!0)};Keyboard.addEventListenerOnHide(showFooter),Keyboard.addEventListenerOnShow(hideFooter)}});var header=document.getElementById("headerBar")}]),angular.module("ui.bootstrap.datetimepicker",["ui.bootstrap"]).directive("datetimepicker",[function(){return angular.version.full<"1.1.4"?{restrict:"EA",template:'<div class="alert alert-danger">Angular 1.1.4 or above is required for datetimepicker to work correctly</div>'}:{restrict:"EA",require:"ngModel",scope:{ngModel:"=",dayFormat:"=",monthFormat:"=",yearFormat:"=",dayHeaderFormat:"=",dayTitleFormat:"=",monthTitleFormat:"=",showWeeks:"=",startingDay:"=",yearRange:"=",dateFormat:"=",minDate:"=",maxDate:"=",dateOptions:"=",dateDisabled:"&",hourStep:"=",minuteStep:"=",showMeridian:"=",meredians:"=",mousewheel:"=",readonlyTime:"@"},template:function(elem,attrs){function dashCase(name,separator){return name.replace(/[A-Z]/g,function(letter,pos){return(pos?"-":"")+letter.toLowerCase()})}function createAttr(innerAttr,dateTimeAttrOpt){var dateTimeAttr=angular.isDefined(dateTimeAttrOpt)?dateTimeAttrOpt:innerAttr;return attrs[dateTimeAttr]?dashCase(innerAttr)+'="'+dateTimeAttr+'" ':""}function createFuncAttr(innerAttr,funcArgs,dateTimeAttrOpt){var dateTimeAttr=angular.isDefined(dateTimeAttrOpt)?dateTimeAttrOpt:innerAttr;return attrs[dateTimeAttr]?dashCase(innerAttr)+'="'+dateTimeAttr+"({"+funcArgs+'})" ':""}function createEvalAttr(innerAttr,dateTimeAttrOpt){var dateTimeAttr=angular.isDefined(dateTimeAttrOpt)?dateTimeAttrOpt:innerAttr;return attrs[dateTimeAttr]?dashCase(innerAttr)+'="'+attrs[dateTimeAttr]+'" ':dashCase(innerAttr)}function createAttrConcat(previousAttrs,attr){return previousAttrs+createAttr.apply(null,attr)}var tmpl='<div class="datetimepicker-wrapper"><input class="form-control" type="text" ng-click="open($event)" is-open="opened" ng-model="ngModel" '+[["minDate"],["maxDate"],["dayFormat"],["monthFormat"],["yearFormat"],["dayHeaderFormat"],["dayTitleFormat"],["monthTitleFormat"],["startingDay"],["yearRange"],["datepickerOptions","dateOptions"]].reduce(createAttrConcat,"")+createFuncAttr("dateDisabled","date: date, mode: mode")+createEvalAttr("datepickerPopup","dateFormat")+'/>\n</div>\n<div class="datetimepicker-wrapper" ng-model="time" ng-change="time_change()" style="display:inline-block">\n<timepicker '+[["hourStep"],["minuteStep"],["showMeridian"],["meredians"],["mousewheel"]].reduce(createAttrConcat,"")+createEvalAttr("readonlyInput","readonlyTime")+"></timepicker>\n</div>";return tmpl},controller:["$scope",function($scope){$scope.time_change=function(){angular.isDefined($scope.ngModel)&&angular.isDefined($scope.time)&&$scope.ngModel.setHours($scope.time.getHours(),$scope.time.getMinutes())},$scope.open=function($event){$event.preventDefault(),$event.stopPropagation(),$scope.opened=!0}}],link:function(scope){scope.$watch(function(){return scope.ngModel},function(ngModel){scope.time=ngModel})}}}]),angular.module("SocialAlarmsApp").directive("subHeaderIos",["Utility",function(Utility){return function($scope,element,attrs){Utility.isIOS()&&element[0].classList.add("sub-header-ios")}}]).directive("contentIos",["Utility",function(Utility){return function($scope,element,attrs){Utility.isIOS()&&element[0].classList.add("content-ios")}}]).directive("contentIosDashboard",["Utility",function(Utility){return function($scope,element,attrs){Utility.isIOS()&&element[0].classList.add("content-ios-dashboard")}}]).directive("contentIos2",["Utility",function(Utility){return function($scope,element,attrs){Utility.isIOS()&&element[0].classList.add("content-ios-2")}}]).directive("loader",function(){var loaderDirective={restrict:"AE",replace:!1,controller:"LoaderCtrl",scope:!0,templateUrl:"views/General/Loader.html"};return loaderDirective}).directive("myMaxlength",function(){return{require:"ngModel",link:function(scope,element,attrs,ngModelCtrl){function fromUser(text){if(text.length>maxlength){var transformedInput=text.substring(0,maxlength);return ngModelCtrl.$setViewValue(transformedInput),ngModelCtrl.$render(),transformedInput}return text}var maxlength=Number(attrs.myMaxlength);ngModelCtrl.$parsers.push(fromUser)}}}).directive("limitTags",function(){return{require:"ngModel",link:function(scope,elem,attrs,ngModel){var maxTags=parseInt(attrs.maxTags,10);ngModel.$parsers.unshift(function(value){return value&&value.length>maxTags&&(scope.handleSingleTagRemoved(value[value.length-1]),value.splice(value.length-1,1)),value})}}}).directive("autoFocus",["$timeout",function($timeout){return function($scope,element,attrs){$timeout(function(){element[0].focus()},100)}}]).directive("whenScrollEnds",["$window",function($window){return{restrict:"A",link:function(scope,element,attrs){var raw=element[0];element.bind("scroll",function(){raw.scrollTop+raw.offsetHeight>raw.scrollHeight&&scope.$apply(attrs.whenScrollEnds)})}}}]).directive("standardTimeMeridian",function(){return{restrict:"AE",replace:!0,scope:{etime:"=etime"},template:"<span>{{stime}}</span>",link:function(scope,elem,attrs){function prependZero(param){return String(param).length<2?"0"+String(param):param}function epochParser(val,opType){if(null===val)return"00:00";var meridian=["AM","PM"];if("time"===opType){var hours=parseInt(val/3600),minutes=val/60%60,hoursRes=hours>12?hours-12:hours,currentMeridian=meridian[parseInt(hours/12)];return prependZero(hoursRes)+":"+prependZero(minutes)+" "+currentMeridian}}scope.stime=epochParser(scope.etime,"time"),scope.$watch("etime",function(newValue,oldValue){scope.stime=epochParser(scope.etime,"time")})}}}),angular.module("SocialAlarmsApp").filter("ordinal",function(){var ordinal=function(input){if(isNaN(input)||null===input)return input;var s=["th","st","nd","rd"],v=input%100;return input+(s[(v-20)%10]||s[v]||s[0])};return ordinal}).filter("referenceTimeSpan",function(){return function(input){return moment.locale("en",{calendar:{lastDay:"[Yesterday]",sameDay:"LT",nextDay:"[Tomorrow]",lastWeek:"dddd",nextWeek:"dddd [at] LT",sameElse:"L"}}),moment(input).calendar()}}).filter("dashboardDateTime",function(){return function(input){var dateTimeformat="h:mma | Do, MMMM, YYYY";return moment(input).format(dateTimeformat)}}).filter("md5Hash",function(){return function(input){if(input){var hash=CryptoJS.MD5(input);return hash=hash.toString(CryptoJS.enc.Base64)}return""}}).filter("avatarLink",function(){return function(input,type){if(input&&!type){var hash=CryptoJS.MD5(input);return hash=hash.toString(CryptoJS.enc.Base64),"http://www.gravatar.com/avatar/"+hash+"?d=monsterid&s=200"}return input&&"fb"===type?"http://graph.facebook.com/"+input+"/picture?height=200&width=200&type=large":"images/common/z-icon.png"}}),function(e){var t=function(){"use strict";var e="s",n=function(e){var t=-e.getTimezoneOffset();return null!==t?t:0},r=function(e,t,n){var r=new Date;return void 0!==e&&r.setFullYear(e),r.setDate(n),r.setMonth(t),r},i=function(e){return n(r(e,0,2))},s=function(e){return n(r(e,5,2))},o=function(e){var t=e.getMonth()>7?s(e.getFullYear()):i(e.getFullYear()),r=n(e);return t-r!==0},u=function(){var t=i(),n=s(),r=i()-s();return 0>r?t+",1":r>0?n+",1,"+e:t+",0"},a=function(){var e=u();return new t.TimeZone(t.olson.timezones[e])};return{determine:a,date_is_dst:o}}();t.TimeZone=function(e){"use strict";var n=null,r=function(){return n},i=function(){for(var e=t.olson.ambiguity_list[n],r=e.length,i=0,s=e[0];r>i;i+=1)if(s=e[i],t.date_is_dst(t.olson.dst_start_dates[s]))return void(n=s)},s=function(){return"undefined"!=typeof t.olson.ambiguity_list[n]};return n=e,s()&&i(),{name:r}},t.olson={},t.olson.timezones={"-720,0":"Etc/GMT+12","-660,0":"Pacific/Pago_Pago","-600,1":"America/Adak","-600,0":"Pacific/Honolulu","-570,0":"Pacific/Marquesas","-540,0":"Pacific/Gambier","-540,1":"America/Anchorage","-480,1":"America/Los_Angeles","-480,0":"Pacific/Pitcairn","-420,0":"America/Phoenix","-420,1":"America/Denver","-360,0":"America/Guatemala","-360,1":"America/Chicago","-360,1,s":"Pacific/Easter","-300,0":"America/Bogota","-300,1":"America/New_York","-270,0":"America/Caracas","-240,1":"America/Halifax","-240,0":"America/Santo_Domingo","-240,1,s":"America/Santiago","-210,1":"America/St_Johns","-180,1":"America/Godthab","-180,0":"America/Argentina/Buenos_Aires","-180,1,s":"America/Montevideo","-120,0":"Etc/GMT+2","-120,1":"Etc/GMT+2","-60,1":"Atlantic/Azores","-60,0":"Atlantic/Cape_Verde","0,0":"Etc/UTC","0,1":"Europe/London","60,1":"Europe/Berlin","60,0":"Africa/Lagos","60,1,s":"Africa/Windhoek","120,1":"Asia/Beirut","120,0":"Africa/Johannesburg","180,0":"Asia/Baghdad","180,1":"Europe/Moscow","210,1":"Asia/Tehran","240,0":"Asia/Dubai","240,1":"Asia/Baku","270,0":"Asia/Kabul","300,1":"Asia/Yekaterinburg","300,0":"Asia/Karachi","330,0":"Asia/Kolkata","345,0":"Asia/Kathmandu","360,0":"Asia/Dhaka","360,1":"Asia/Omsk","390,0":"Asia/Rangoon","420,1":"Asia/Krasnoyarsk","420,0":"Asia/Jakarta","480,0":"Asia/Shanghai","480,1":"Asia/Irkutsk","525,0":"Australia/Eucla","525,1,s":"Australia/Eucla","540,1":"Asia/Yakutsk","540,0":"Asia/Tokyo","570,0":"Australia/Darwin","570,1,s":"Australia/Adelaide","600,0":"Australia/Brisbane","600,1":"Asia/Vladivostok","600,1,s":"Australia/Sydney","630,1,s":"Australia/Lord_Howe","660,1":"Asia/Kamchatka","660,0":"Pacific/Noumea","690,0":"Pacific/Norfolk","720,1,s":"Pacific/Auckland","720,0":"Pacific/Tarawa","765,1,s":"Pacific/Chatham","780,0":"Pacific/Tongatapu","780,1,s":"Pacific/Apia","840,0":"Pacific/Kiritimati"},t.olson.dst_start_dates=function(){"use strict";var e=new Date(2010,6,15,1,0,0,0);return{"America/Denver":new Date(2011,2,13,3,0,0,0),"America/Mazatlan":new Date(2011,3,3,3,0,0,0),"America/Chicago":new Date(2011,2,13,3,0,0,0),"America/Mexico_City":new Date(2011,3,3,3,0,0,0),"America/Asuncion":new Date(2012,9,7,3,0,0,0),"America/Santiago":new Date(2012,9,3,3,0,0,0),"America/Campo_Grande":new Date(2012,9,21,5,0,0,0),"America/Montevideo":new Date(2011,9,2,3,0,0,0),"America/Sao_Paulo":new Date(2011,9,16,5,0,0,0),"America/Los_Angeles":new Date(2011,2,13,8,0,0,0),"America/Santa_Isabel":new Date(2011,3,5,8,0,0,0),"America/Havana":new Date(2012,2,10,2,0,0,0),"America/New_York":new Date(2012,2,10,7,0,0,0),"Asia/Beirut":new Date(2011,2,27,1,0,0,0),"Europe/Helsinki":new Date(2011,2,27,4,0,0,0),"Europe/Istanbul":new Date(2011,2,28,5,0,0,0),"Asia/Damascus":new Date(2011,3,1,2,0,0,0),"Asia/Jerusalem":new Date(2011,3,1,6,0,0,0),"Asia/Gaza":new Date(2009,2,28,0,30,0,0),"Africa/Cairo":new Date(2009,3,25,0,30,0,0),"Pacific/Auckland":new Date(2011,8,26,7,0,0,0),"Pacific/Fiji":new Date(2010,11,29,23,0,0,0),"America/Halifax":new Date(2011,2,13,6,0,0,0),"America/Goose_Bay":new Date(2011,2,13,2,1,0,0),"America/Miquelon":new Date(2011,2,13,5,0,0,0),"America/Godthab":new Date(2011,2,27,1,0,0,0),"Europe/Moscow":e,"Asia/Yekaterinburg":e,"Asia/Omsk":e,"Asia/Krasnoyarsk":e,"Asia/Irkutsk":e,"Asia/Yakutsk":e,"Asia/Vladivostok":e,"Asia/Kamchatka":e,"Europe/Minsk":e,"Australia/Perth":new Date(2008,10,1,1,0,0,0)}}(),t.olson.ambiguity_list={"America/Denver":["America/Denver","America/Mazatlan"],"America/Chicago":["America/Chicago","America/Mexico_City"],"America/Santiago":["America/Santiago","America/Asuncion","America/Campo_Grande"],"America/Montevideo":["America/Montevideo","America/Sao_Paulo"],"Asia/Beirut":["Asia/Beirut","Europe/Helsinki","Europe/Istanbul","Asia/Damascus","Asia/Jerusalem","Asia/Gaza"],"Pacific/Auckland":["Pacific/Auckland","Pacific/Fiji"],"America/Los_Angeles":["America/Los_Angeles","America/Santa_Isabel"],"America/New_York":["America/Havana","America/New_York"],"America/Halifax":["America/Goose_Bay","America/Halifax"],"America/Godthab":["America/Miquelon","America/Godthab"],"Asia/Dubai":["Europe/Moscow"],"Asia/Dhaka":["Asia/Yekaterinburg"],"Asia/Jakarta":["Asia/Omsk"],"Asia/Shanghai":["Asia/Krasnoyarsk","Australia/Perth"],"Asia/Tokyo":["Asia/Irkutsk"],"Australia/Brisbane":["Asia/Yakutsk"],"Pacific/Noumea":["Asia/Vladivostok"],"Pacific/Tarawa":["Asia/Kamchatka"],"Africa/Johannesburg":["Asia/Gaza","Africa/Cairo"],"Asia/Baghdad":["Europe/Minsk"]},"undefined"!=typeof exports?exports.jstz=t:e.jstz=t}(this),function(){"use strict";function SimplePubSub(){var events={};return{on:function(names,handler){return names.split(" ").forEach(function(name){events[name]||(events[name]=[]),events[name].push(handler)}),this},trigger:function(name,args){return angular.forEach(events[name],function(handler){handler.call(null,args)}),this}}}function makeObjectArray(array,key){return array=array||[],array.length>0&&!angular.isObject(array[0])&&array.forEach(function(item,index){array[index]={},array[index][key]=item}),array}function findInObjectArray(array,obj,key){for(var item=null,i=0;i<array.length;i++)if(safeToString(array[i][key]).toLowerCase()===safeToString(obj[key]).toLowerCase()){item=array[i];break}return item}function replaceAll(str,substr,newSubstr){if(!substr)return str;var expression=substr.replace(/([.?*+^$[\]\\(){}|-])/g,"\\$1");return str.replace(new RegExp(expression,"gi"),newSubstr)}function safeToString(value){return angular.isUndefined(value)||null==value?"":value.toString().trim()}function encodeHTML(value){return value.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}var KEYS={backspace:8,tab:9,enter:13,escape:27,space:32,up:38,down:40,semicolon:186,comma:188},MAX_SAFE_INTEGER=9007199254740991,SUPPORTED_INPUT_TYPES=["text","email","url"],tagsInput=angular.module("ngTagsInput",[]);tagsInput.directive("tagsInput",["$timeout","$document","tagsInputConfig",function($timeout,$document,tagsInputConfig){function TagList(options,events){var getTagText,setTagText,tagIsValid,self={};return getTagText=function(tag){return safeToString(tag[options.displayProperty])},setTagText=function(tag,text){tag[options.displayProperty]=text},tagIsValid=function(tag){var tagText=getTagText(tag);return tagText&&tagText.length>=options.minLength&&tagText.length<=options.maxLength&&options.allowedTagsPattern.test(tagText)&&!findInObjectArray(self.items,tag,options.displayProperty)},self.items=[],self.addText=function(text){var tag={};return setTagText(tag,text),self.add(tag)},self.add=function(tag){var tagText=getTagText(tag);return options.replaceSpacesWithDashes&&(tagText=tagText.replace(/\s/g,"-")),setTagText(tag,tagText),tagIsValid(tag)?(self.items.push(tag),events.trigger("tag-added",{$tag:tag})):tagText&&events.trigger("invalid-tag",{$tag:tag}),tag},self.remove=function(index){var tag=self.items.splice(index,1)[0];return events.trigger("tag-removed",{$tag:tag}),tag},self.removeLast=function(){var tag,lastTagIndex=self.items.length-1;return options.enableEditingLastTag||self.selected?(self.selected=null,tag=self.remove(lastTagIndex)):self.selected||(self.selected=self.items[lastTagIndex]),tag},self}function validateType(type){return-1!==SUPPORTED_INPUT_TYPES.indexOf(type)}return{restrict:"E",require:"ngModel",scope:{tags:"=ngModel",onTagAdded:"&",onTagRemoved:"&"},replace:!1,transclude:!0,templateUrl:"ngTagsInput/tags-input.html",controller:["$scope","$attrs","$element",function($scope,$attrs,$element){$scope.events=new SimplePubSub,tagsInputConfig.load("tagsInput",$scope,$attrs,{type:[String,"text",validateType],placeholder:[String,"Add a tag"],tabindex:[Number,null],removeTagSymbol:[String,String.fromCharCode(215)],replaceSpacesWithDashes:[Boolean,!0],minLength:[Number,3],maxLength:[Number,MAX_SAFE_INTEGER],addOnEnter:[Boolean,!0],addOnSpace:[Boolean,!0],addOnComma:[Boolean,!0],addOnSemiColon:[Boolean,!0],addOnBlur:[Boolean,!0],addOnPaste:[Boolean,!1],pasteSplitPattern:[RegExp,/[ ?,?;?\n?\r?]+/g],allowedTagsPattern:[RegExp,/.+/],enableEditingLastTag:[Boolean,!1],minTags:[Number,0],maxTags:[Number,MAX_SAFE_INTEGER],displayProperty:[String,"text"],allowLeftoverText:[Boolean,!1],addFromAutocompleteOnly:[Boolean,!1]}),$scope.tagList=new TagList($scope.options,$scope.events),this.registerAutocomplete=function(){var input=$element.find("input");return input.on("keydown",function(e){$scope.events.trigger("input-keydown",e)}),{addTag:function(tag){return $scope.tagList.add(tag)},focusInput:function(){input[0].focus()},getTags:function(){return $scope.tags},getCurrentTagText:function(){return $scope.newTag.text},getOptions:function(){return $scope.options},on:function(name,handler){return $scope.events.on(name,handler),this}}}}],link:function(scope,element,attrs,ngModelCtrl){var setElementValidity,hotkeys=[KEYS.enter,KEYS.comma,KEYS.space,KEYS.backspace,KEYS.semicolon],tagList=scope.tagList,events=scope.events,options=scope.options,input=element.find("input"),validationOptions=["minTags","maxTags","allowLeftoverText"];setElementValidity=function(){ngModelCtrl.$setValidity("maxTags",scope.tags.length<=options.maxTags),ngModelCtrl.$setValidity("minTags",scope.tags.length>=options.minTags),ngModelCtrl.$setValidity("leftoverText",options.allowLeftoverText?!0:!scope.newTag.text)},events.on("tag-added",scope.onTagAdded).on("tag-removed",scope.onTagRemoved).on("tag-added",function(){scope.newTag.text=""}).on("tag-added tag-removed",function(){ngModelCtrl.$setViewValue(scope.tags)}).on("invalid-tag",function(){scope.newTag.invalid=!0}).on("input-change",function(){tagList.selected=null,scope.newTag.invalid=null}).on("input-focus",function(){ngModelCtrl.$setValidity("leftoverText",!0)}).on("input-blur",function(){options.addFromAutocompleteOnly||(options.addOnBlur&&tagList.addText(scope.newTag.text),setElementValidity())}).on("option-change",function(e){-1!==validationOptions.indexOf(e.name)&&setElementValidity()}).on("input-paste",function(event){if(options.addOnPaste){var data=event.clipboardData.getData("text/plain"),tags=data.split(options.pasteSplitPattern);tags.length>1&&(tags.forEach(function(tag){tagList.addText(tag)}),event.preventDefault())}}),scope.newTag={text:"",invalid:null},scope.getDisplayText=function(tag){return safeToString(tag[options.displayProperty])},scope.track=function(tag){return tag[options.displayProperty]},scope.newTagChange=function(){events.trigger("input-change",scope.newTag.text)},scope.inputPasted=function($event){events.trigger("input-paste",$event)},scope.$watch("tags",function(value){scope.tags=makeObjectArray(value,options.displayProperty),tagList.items=scope.tags}),scope.$watch("tags.length",function(){setElementValidity()}),input.on("keydown",function(e){if(!e.isImmediatePropagationStopped||!e.isImmediatePropagationStopped()){var shouldAdd,shouldRemove,key=e.keyCode,isModifier=e.shiftKey||e.altKey||e.ctrlKey||e.metaKey,addKeys={};if(!isModifier&&-1!==hotkeys.indexOf(key))if(addKeys[KEYS.enter]=options.addOnEnter,addKeys[KEYS.comma]=options.addOnComma,addKeys[KEYS.space]=options.addOnSpace,addKeys[KEYS.semicolon]=options.addOnSemiColon,shouldAdd=!options.addFromAutocompleteOnly&&addKeys[key],shouldRemove=!shouldAdd&&key===KEYS.backspace&&0===scope.newTag.text.length,shouldAdd)tagList.addText(scope.newTag.text),scope.$apply(),e.preventDefault();else if(shouldRemove){var tag=tagList.removeLast();tag&&options.enableEditingLastTag&&(scope.newTag.text=tag[options.displayProperty]),scope.$apply(),e.preventDefault()}}}).on("focus",function(){scope.hasFocus||(scope.hasFocus=!0,events.trigger("input-focus"),scope.$apply())}).on("blur",function(){$timeout(function(){var activeElement=$document.prop("activeElement"),lostFocusToBrowserWindow=activeElement===input[0],lostFocusToChildElement=element[0].contains(activeElement);(lostFocusToBrowserWindow||!lostFocusToChildElement)&&(scope.hasFocus=!1,events.trigger("input-blur"))})}).on("paste",function($event){scope.inputPasted($event),scope.$apply()}),element.find("div").on("click",function(){input[0].focus()})}}}]),tagsInput.directive("autoComplete",["$document","$timeout","$sce","tagsInputConfig",function($document,$timeout,$sce,tagsInputConfig){function SuggestionList(loadFn,options){var debouncedLoadId,getDifference,lastPromise,self={};return getDifference=function(array1,array2){return array1.filter(function(item){return!findInObjectArray(array2,item,options.tagsInput.displayProperty)})},self.reset=function(){lastPromise=null,self.items=[],self.visible=!1,self.index=-1,self.selected=null,self.query=null,$timeout.cancel(debouncedLoadId)},self.show=function(){self.selected=null,self.visible=!0},self.load=function(query,tags){$timeout.cancel(debouncedLoadId),debouncedLoadId=$timeout(function(){self.query=query;var promise=loadFn({$query:query});lastPromise=promise,promise.then(function(items){promise===lastPromise&&(items=makeObjectArray(items.data||items,options.tagsInput.displayProperty),items=getDifference(items,tags),self.items=items.slice(0,options.maxResultsToShow),self.items.length>0?self.show():self.reset())})},options.debounceDelay,!1)},self.selectNext=function(){self.select(++self.index)},self.selectPrior=function(){self.select(--self.index)},self.select=function(index){0>index?index=self.items.length-1:index>=self.items.length&&(index=0),self.index=index,self.selected=self.items[index]},self.reset(),self}return{restrict:"E",require:"^tagsInput",scope:{source:"&"},templateUrl:"ngTagsInput/auto-complete.html",link:function(scope,element,attrs,tagsInputCtrl){var suggestionList,tagsInput,options,getItem,getDisplayText,shouldLoadSuggestions,hotkeys=[KEYS.enter,KEYS.tab,KEYS.escape,KEYS.up,KEYS.down];tagsInputConfig.load("autoComplete",scope,attrs,{debounceDelay:[Number,100],minLength:[Number,3],highlightMatchedText:[Boolean,!0],maxResultsToShow:[Number,10],loadOnDownArrow:[Boolean,!1],loadOnEmpty:[Boolean,!1],loadOnFocus:[Boolean,!1]}),options=scope.options,tagsInput=tagsInputCtrl.registerAutocomplete(),options.tagsInput=tagsInput.getOptions(),suggestionList=new SuggestionList(scope.source,options),getItem=function(item){return item[options.tagsInput.displayProperty]},getDisplayText=function(item){return safeToString(getItem(item))},shouldLoadSuggestions=function(value){return value&&value.length>=options.minLength||!value&&options.loadOnEmpty},scope.suggestionList=suggestionList,scope.addSuggestionByIndex=function(index){suggestionList.select(index),scope.addSuggestion()},scope.addSuggestion=function(){var added=!1;return suggestionList.selected&&(tagsInput.addTag(suggestionList.selected),suggestionList.reset(),tagsInput.focusInput(),added=!0),added},scope.highlight=function(item){var text=getDisplayText(item);return text=encodeHTML(text),options.highlightMatchedText&&(text=replaceAll(text,encodeHTML(suggestionList.query),"<em>$&</em>")),$sce.trustAsHtml(text)},scope.track=function(item){return getItem(item)},tagsInput.on("tag-added tag-removed invalid-tag input-blur",function(){suggestionList.reset()}).on("input-change",function(value){shouldLoadSuggestions(value)?suggestionList.load(value,tagsInput.getTags()):suggestionList.reset()}).on("input-focus",function(){var value=tagsInput.getCurrentTagText();options.loadOnFocus&&shouldLoadSuggestions(value)&&suggestionList.load(value,tagsInput.getTags())}).on("input-keydown",function(e){var immediatePropagationStopped=!1;e.stopImmediatePropagation=function(){immediatePropagationStopped=!0,e.stopPropagation()},e.isImmediatePropagationStopped=function(){return immediatePropagationStopped};var key=e.keyCode,handled=!1;-1!==hotkeys.indexOf(key)&&(suggestionList.visible?key===KEYS.down?(suggestionList.selectNext(),handled=!0):key===KEYS.up?(suggestionList.selectPrior(),handled=!0):key===KEYS.escape?(suggestionList.reset(),handled=!0):(key===KEYS.enter||key===KEYS.tab)&&(handled=scope.addSuggestion()):key===KEYS.down&&scope.options.loadOnDownArrow&&(suggestionList.load(tagsInput.getCurrentTagText(),tagsInput.getTags()),handled=!0),handled&&(e.preventDefault(),e.stopImmediatePropagation(),scope.$apply()))})}}}]),tagsInput.directive("tiTranscludeAppend",function(){return function(scope,element,attrs,ctrl,transcludeFn){transcludeFn(function(clone){element.append(clone)})}}),tagsInput.directive("tiAutosize",["tagsInputConfig",function(tagsInputConfig){return{restrict:"A",require:"ngModel",link:function(scope,element,attrs,ctrl){var span,resize,threshold=tagsInputConfig.getTextAutosizeThreshold();span=angular.element('<span class="input"></span>'),span.css("display","none").css("visibility","hidden").css("width","auto").css("white-space","pre"),element.parent().append(span),resize=function(originalValue){var width,value=originalValue;return angular.isString(value)&&0===value.length&&(value=attrs.placeholder),value&&(span.text(value),span.css("display",""),width=span.prop("offsetWidth"),span.css("display","none")),element.css("width",width?width+threshold+"px":""),originalValue},ctrl.$parsers.unshift(resize),ctrl.$formatters.unshift(resize),attrs.$observe("placeholder",function(value){ctrl.$modelValue||resize(value)})}}}]),tagsInput.directive("tiBindAttrs",function(){
return function(scope,element,attrs){scope.$watch(attrs.tiBindAttrs,function(value){angular.forEach(value,function(value,key){attrs.$set(key,value)})},!0)}}),tagsInput.provider("tagsInputConfig",function(){var globalDefaults={},interpolationStatus={},autosizeThreshold=3;this.setDefaults=function(directive,defaults){return globalDefaults[directive]=defaults,this},this.setActiveInterpolation=function(directive,options){return interpolationStatus[directive]=options,this},this.setTextAutosizeThreshold=function(threshold){return autosizeThreshold=threshold,this},this.$get=["$interpolate",function($interpolate){var converters={};return converters[String]=function(value){return value},converters[Number]=function(value){return parseInt(value,10)},converters[Boolean]=function(value){return"true"===value.toLowerCase()},converters[RegExp]=function(value){return new RegExp(value)},{load:function(directive,scope,attrs,options){var defaultValidator=function(){return!0};scope.options={},angular.forEach(options,function(value,key){var type,localDefault,validator,converter,getDefault,updateValue;type=value[0],localDefault=value[1],validator=value[2]||defaultValidator,converter=converters[type],getDefault=function(){var globalValue=globalDefaults[directive]&&globalDefaults[directive][key];return angular.isDefined(globalValue)?globalValue:localDefault},updateValue=function(value){scope.options[key]=value&&validator(value)?converter(value):getDefault()},interpolationStatus[directive]&&interpolationStatus[directive][key]?attrs.$observe(key,function(value){updateValue(value),scope.events.trigger("option-change",{name:key,newValue:value})}):updateValue(attrs[key]&&$interpolate(attrs[key])(scope.$parent))})},getTextAutosizeThreshold:function(){return autosizeThreshold}}}]}),tagsInput.run(["$templateCache",function($templateCache){$templateCache.put("ngTagsInput/tags-input.html",'<div class="host" tabindex="-1" ti-transclude-append=""><div class="tags" ng-class="{focused: hasFocus}"><ul class="tag-list"><li class="tag-item" ng-repeat="tag in tagList.items track by track(tag)" ng-class="{ selected: tag == tagList.selected }"><span ng-bind="getDisplayText(tag)"></span> <a class="remove-button" ng-click="tagList.remove($index)" ng-bind="options.removeTagSymbol"></a></li></ul><input class="input" ng-model="newTag.text" ng-change="newTagChange()" ng-trim="false" ng-class="{\'invalid-tag\': newTag.invalid}" ti-bind-attrs="{type: options.type, placeholder: options.placeholder, tabindex: options.tabindex}" ti-autosize=""></div></div>'),$templateCache.put("ngTagsInput/auto-complete.html",'<div class="autocomplete" ng-show="suggestionList.visible"><ul class="suggestion-list"><li class="suggestion-item" ng-repeat="item in suggestionList.items track by track(item)" ng-class="{selected: item == suggestionList.selected}" ng-click="addSuggestionByIndex($index)" ng-mouseenter="suggestionList.select($index)" ng-bind-html="highlight(item)"></li></ul></div>')}])}(),function(){function g(a){throw a}function D(a,f){function d(){this.constructor=a}for(var b in f)B.call(f,b)&&(a[b]=f[b]);d.prototype=f.prototype,a.prototype=new d,a.wa=f.prototype}var o,p,q,Event,t,v,w,x,y,z,A,h=!0,i=null,n=!1,B={}.hasOwnProperty;o=function(a,f,d,b,c){c==i&&(c=A),c.n(a),c.l(a),c.N(a),c.o(f),c.z(f),c.p(f.length,255),c.n(b),c.l(b),this.ce=a,this.bp=f,this.bq=b,d?(c.Ua(d),this.bs=d):this.bs={}},p=function(){function a(){}return a.ia=function(a){var d,b,c,e,j,k,l,m,r,a=this.Ob(a);for(l="",c=m=0,r=a.length;r>m;c=m+=3)d=a.charCodeAt(c),b=a.charCodeAt(c+1),c=a.charCodeAt(c+2),e=d>>2,d=(3&d)<<4|b>>4,j=(15&b)<<2|c>>6,k=63&c,isNaN(b)?j=k=64:isNaN(c)&&(k=64),l+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(e)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(d)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(j)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(k);return l},a.lb=function(a){var d,b,c,e,j,k,l,m,a=a.replace(/[^A-Za-z0-9\+\/\=]/g,"");for(k="",j=l=0,m=a.length;m>l;j=l+=4)d="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(a.charAt(j)),b="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(a.charAt(j+1)),e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(a.charAt(j+2)),j="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(a.charAt(j+3)),d=d<<2|b>>4,b=(15&b)<<4|e>>2,c=(3&e)<<6|j,k+=String.fromCharCode(d),64!==e&&(k+=String.fromCharCode(b)),64!==j&&(k+=String.fromCharCode(c));return k=this.Nb(k)},a.Ob=function(a){var d,b,c,e,a=a.replace(/\r\n/g,"\n");for(b="",d=c=0,e=a.length;e>=0?e>c:c>e;d=e>=0?++c:--c)d=a.charCodeAt(d),128>d?b+=String.fromCharCode(d):(d>127&&2048>d?b+=String.fromCharCode(d>>6|192):(b+=String.fromCharCode(d>>12|224),b+=String.fromCharCode(d>>6&63|128)),b+=String.fromCharCode(63&d|128));return b},a.Nb=function(a){var d,b,c,e,j;for(j="",e=0;e<a.length;)d=a.charCodeAt(e),128>d?(j+=String.fromCharCode(d),e++):d>191&&224>d?(b=a.charCodeAt(e+1),j+=String.fromCharCode((31&d)<<6|63&b),e+=2):(b=a.charCodeAt(e+1),c=a.charCodeAt(e+2),j+=String.fromCharCode((15&d)<<12|(63&b)<<6|63&c),e+=3);return j},a}(),q=function(){function a(){}return a.bb=function(a){var d,b,c,e,j;for(d=1,b=0,c=e=0,j=a.length;j>=0?j>e:e>j;c=j>=0?++e:--e)c=a.charCodeAt(c),d+=c,b+=d;return d%=65521,b%=65521,65536*b+d},a}(),Event=function(a){function f(d,a,c,e,j,k){k==i&&(k=A),k.M(e),f.wa.constructor.call(this,d,a,c,j),this.timed=e,this.br=0}return D(f,a),f}(o),t=function(){function a(){}var f;return f=function(a){var b,c;c={};try{b=p.lb(a),c=JSON.parse(b)}catch(e){console.log(e)}return c},a.ga=function(a,b){return(b?this.Da:"")+{install:"fit",session:"fs",lastPoll:"flp",firstPartyCookie:"fid"}[a]},a.i=h,a.appVersion="",a.O="",a.Ha=0,a.ka=Date.now(),a.Da=i,a.F=i,a.Ka=h,a.Bb=h,a.Qa=n,a.Ea=n,a.localStorage=n,a.fa=i,a.Ja="",a.referrer="",a.J=0,a.e=i,a.$=[],a.w=i,a.Y=5e3,a.ea=i,a.I=n,a.Z=i,a.h=function(a){return this.Qa?"string"==typeof a?this.g(""+a):this.g(""+a.name+"=>"+a.message):void 0},a.g=function(a){return this.Ea?console.log("Flurry "+new Date+": "+a):void 0},a.Ub=function(){},a.ub=function(){return this.g("getFlurryAgentVersion() called"),9},a.da=function(a){this.g("setAppVersion("+a+") called");try{return A.o(a),A.z(a),A.p(a.length,255),this.appVersion=a,this.e&&this.e.da(a),this.i=h}catch(b){return this.h(b)}},a.ua=function(a){this.g("setUserId("+a+") called");try{return A.j(this.e),A.o(a),A.z(a),A.p(a.length,"userId"),this.e.ua(a),this.i=h}catch(b){return this.h(b)}},a.ra=function(a){this.g("setGender("+a+") called");try{return A.j(this.e),A.o(a),A.Ta(a,{m:1,f:0}),this.e.ra(a),this.i=h}catch(b){return this.h(b)}},a.qa=function(a){this.g("setAge("+a+") called");try{return A.j(this.e),A.n(a),A.l(a),A.N(a),A.va(a),this.e.qa(a),this.i=h}catch(b){return this.h(b)}},a.sa=function(a,b,c){c==i&&(c=0),this.g("setLocation("+a+","+b+","+c+") called");try{return A.j(this.e),A.n(a),A.l(a),A.n(b),A.l(b),A.n(c),A.l(c),this.e.sa(a,b,c),this.i=h}catch(e){return this.h(e)}},a.mb=function(){this.Ja=navigator.platform},a.nb=function(){this.referrer=document.referrer},a.ib=function(){this.mb(),this.nb()},a.L=function(a){this.g("setSessionContinueSeconds("+a+") called");try{if(A.n(a),A.l(a),A.N(a),A.va(a),this.J=a,this.e)return this.e.L(a)}catch(b){return this.h(b)}},a.Jb=function(a){this.g("setShowErrorInLogEnabled("+a+") called");try{return A.M(a),this.Qa=a}catch(b){return this.h(b)}},a.Gb=function(a){this.g("setDebugLogEnabled("+a+") called");try{return A.M(a),this.Ea=a}catch(b){return this.h(b)}},a.Ib=function(a){this.g("setLocalStorageEnabled("+a+") called");try{A.M(a),this.localStorage=a}catch(b){this.h(b)}},a.kb=function(){var a,b,c=this;b=window.onfocus,window.onfocus=function(){return c.g("ACTIVE"),b!=i&&b(),c.e?c.e.Ma()?c.ta():(c.A(),c.Ra(c.O)):void 0},a=window.onblur,window.onblur=function(){var b;return c.g("PAUSE"),a!=i&&a(),c.e&&(b=Date.now(),c.e.Pa(b),c.Q(),c.Bb)?c.q():void 0}},a.jb=function(){var a;(a=parseInt(this.G("install")))?this.ka=a:this.K("install",this.ka)},a.Ca=function(){var a;(a=this.G("firstPartyCookie",n))?this.F=a:this.F!==i&&this.K("firstPartyCookie",this.F,n)},a.Fb=function(){this.Da=p.ia(this.O).replace("=","")+"_"},a.G=function(a,b){var c,e,f,k,l,m,r;for(b==i&&(b=h),l=this.ga(a,b),e=document.cookie.split(";"),m=0,r=e.length;r>m;m++)if(c=e[m],k=c.indexOf("="),f=c.slice(0,k).trim(),f===l)return c.slice(k+1);return i},a.eb=function(){return this.G("install")!=i},a.ha=function(a){var b;return b==i&&(b=h),document.cookie=""+this.ga(a,b)+"=; expires='Thu, 01 Jan 1970 00:00:00 GMT'; path=/"},a.K=function(a,b,c){var e;c==i&&(c=h),e=new Date,e.setTime(Date.now()+31536e7),document.cookie=this.ga(a,c)+"="+b+"; expires="+e.toGMTString()+"; path=/"},a.ta=function(a){var b=this;try{a&&A.va(1e3*a-5e3),A.j(this.e)}catch(c){return void this.h(c)}return this.Q(),a&&(this.Y=1e3*a),this.fa=window.setInterval(function(){return b.ea=Date.now(),b.K("lastPoll",b.ea),b.q()},this.Y),this.ea&&Date.now()-this.ea>this.Y&&this.q(),this.Y/1e3},a.Q=function(){this.fa&&window.clearInterval(this.fa),this.fa=i},a.$a=function(){var a,b,c;return b=this.G("session"),a=this.G("lastPoll"),this.ha("session"),this.ha("lastPoll"),b!=i&&a!=i&&(this.g("found paused session"),b=f(b),b[z.c.r]=a,a=new z(b),this.J&&a.L(this.J),a.Ma()&&(this.g("paused session resumed"),c=a)),c||(this.g("creating new session"),c=new z,this.J&&c.L(this.J)),this.appVersion&&c.da(this.appVersion),c},a.Ra=function(a){this.g("startSession("+a+") called");try{if(!this.e)return A.o(a),A.z(a),A.p(a,255),this.O=a,this.Fb(),this.i=h,this.e=this.$a(),this.jb(),this.Ca(),this.eb()||(this.Ka=n,this.A(),g("CookieError=>session ending since cookies not enabled!")),this.Ha||(this.ib(),this.kb()),this.ta(),this.q(),this.Ha++}catch(b){return this.h(b)}},a.A=function(){this.g("endSession() called");try{if(this.Q(),this.e)return this.e.A(),this.i=h,this.Ka?this.q():this.$.push(this.e),this.e=i,this.ha("session")}catch(a){return this.h(a)}},a.yb=function(){this.g("pauseSession() called");try{return this.Q(),this.Na(),this.e?(this.q(),this.e=i):this.g("no session to pause!")}catch(a){return this.h(a)}},a.Na=function(){var a;try{A.j(this.e),a=Date.now(),this.e.Pa(a),this.Tb=a,this.K("session",this.e.Ya()),this.K("lastPoll",a)}catch(b){this.h(b)}},a.t=function(a,b,c){b==i&&(b={}),c==i&&(c=n),this.g("logEvent("+a+","+b+","+c+") called");try{return A.j(this.e),this.e.Wa(a,b,c),this.i=h}catch(e){return this.h(e)}},a.qb=function(a,b){b==i&&(b=i),this.g("endTimedEvent("+a+","+b+") called");try{return A.j(this.e),this.e.pb(a,b),this.i=h}catch(c){return this.h(c)}},a.k=function(){var a,b,c,e,f;b=[];try{for(A.j(this.e),f=this.e[z.c.k],c=0,e=f.length;e>c;c++)a=f[c],b.push(a.bp)}catch(k){this.h(k)}return b},a.Hb=function(a){this.g("setEventLogging("+a+") called");try{return A.j(this.e),A.M(a),this.e.ja=a}catch(b){return this.h(b)}},a.U=function(a,b,c,e){b==i&&(b=0),c==i&&(c="USD"),e==i&&(e={}),this.g("logPurchase("+a+","+b+","+c+","+e+") called");try{return A.j(this.e),this.e.Xa(a,b,c,e),this.i=h}catch(f){return this.h(f)}},a.wb=function(a,b,c){c==i&&(c=0),this.g("logError("+a+","+b+","+c+") called");try{return A.j(this.e),this.e.Va(a,b,c),this.i=h}catch(e){return this.h(e)}},a.q=function(){var a;this.g("REQUEST INITIATED");try{if(!this.I&&(this.w?this.w.Kb():this.i&&(a=new y,a.Za(this.appVersion,this.O,this.ka,this.Ja,this.Rb,this.referrer,this.e,this.$,this.F),this.w=a.request,this.fb(a)),this.w))return this.Na(),this.rb(JSON.stringify(this.w))}catch(b){return this.h(b)}},a.fb=function(a){this.e.gb(a.sessionIncluded.events,a.sessionIncluded.purchases,a.sessionIncluded.errors),this.$=this.$.slice(a.sessionsIncluded),0===a.level&&(this.i=n)},a.rb=function(a){var b,c=this;return this.g("REQUEST EXECUTED"),this.I=h,this.Z=window.setInterval(function(){return c.P(n)},1e4),b=document.createElement("script"),b.type="text/javascript",b.async=h,b.src=encodeURI(x.Fa+"?d="+p.ia(a)+"&c="+q.bb(a)),a=document.getElementsByTagName("script"),a[0].parentNode.insertBefore(b,a[0])},a.Cb=function(a){this.g("RESPONSE RECEIVED");try{if(this.I||g("ResponseError=>request considered timed out!"),"object"!=typeof a&&(this.P(n),g("ResponseError=>input is not a valid object!")),a.a!=i&&a.a>0?this.P(h):this.P(n),a.b!=i&&this.Ib(a.b),a.d!=i&&(this.F=a.d,this.Ca(),this.i=h),this.i)return this.q()}catch(b){return this.h(b)}},a.P=function(a){return this.g("CLEAR REQUEST with "+a),this.I?(this.Z&&window.clearInterval(this.Z),a&&(this.w=i),this.I=n,this.Z=i):void 0},a}(),window.FlurryAgent=t,t.setAppVersion=t.da,t.getFlurryAgentVersion=t.ub,t.setShowErrorInLogEnabled=t.Jb,t.setDebugLogEnabled=t.Gb,t.setSessionContinueSeconds=t.L,t.setRequestInterval=t.ta,t.startSession=t.Ra,t.endSession=t.A,t.pauseSession=t.yb,t.logEvent=t.t,t.endTimedEvent=t.qb,t.timedEvents=t.k,t.logError=t.wb,t.logPurchase=t.U,t.setUserId=t.ua,t.setAge=t.qa,t.setGender=t.ra,t.setLocation=t.sa,t.setEventLogging=t.Hb,t.requestCallback=t.Cb,v=function(a,f,d,b,c){c==i&&(c=A),c.n(a),c.l(a),c.N(a),c.o(f),c.z(f),c.p(f.length,255),c.o(d),c.z(d),c.p(d.length,255),c.n(b),c.l(b),c.N(b),this.cf=a,this.bz=f,this.ca=d,this.cb=b.toString(),this.cc=Date.now()},w=function(a){function f(a,c,e,j,k,l,m){m==i&&(m=A),m.n(e),m.l(e),m.Qb(e),m.o(j),m.Ta(j,d),f.wa.constructor.call(this,a,c,k,l),this.bw=100*e,this.bx=d[j]}var d;return D(f,a),d={USD:0,EUR:1,GBP:2,CHF:3},f}(o),x=function(){function a(b,c,e,j,k,l,m,r,s,C,u){for(this.a={},this.a.af=Date.now(),this.a.aa=f,this.a.ab=b,this.a.ac=c,this.a.ae=e,this.a.ad=j,this.a.ag=k,this.a.ah=s[z.c.timestamp],a.g("about to check if firstPartyCookieUID "+u+" should be assigned to global map in the report request"),u!==i&&(this.a.cg=u,a.g("firstPartyCookieUID "+u+" was assigned to global map")),0===s.requestsMade&&(this.a.ai=l,this.a.aj=r,s.Db()),this.a.ak=d,this.b=[],s&&(s.Oa(),e=a.za(s),this.b.push(e)),b=0,c=C.length;c>b;b++)e=C[b],e=a.za(e),this.b.push(e)}var f,d;return d=f=1,a.Ab={timedEvents:"timedEvents",eventLogging:"eventLogging",sessionContinue:"sessionContinue",pauseTimestamp:"pauseTimestamp",age:"age",numEventNames:"numEventNames",numPurchaseNames:"numPurchaseNames",requestsMade:"requestsMade",totalEventNames:"totalEventNames",totalPurchaseNames:"totalPurchaseNames",numEventsLogged:"numEventsLogged",numPurchasesLogged:"numPurchasesLogged",numErrorsLogged:"numErrorsLogged",eventCounter:"eventCounter",purchaseCounter:"purchaseCounter",errorCounter:"errorCounter"},a.zb={timed:"timed"},a.Fa="https://data.flurry.com/aah.do",a.g=function(){},a.Sb=function(){return this.Fa},a.hb=function(a){var c,d,f;d={};for(c in a)f=a[c],this.zb.hasOwnProperty(c)||(d[c]=f);return d},a.za=function(a){var c,d,f,k,l,m;f={};for(d in a)if(k=a[d],d===z.c.location)k.bg!=i&&(f[d]=k);else if(d===z.c.D)for(f[d]=[],l=0,m=k.length;m>l;l++)c=k[l],f[d].push(this.hb(c));else this.Ab.hasOwnProperty(d)||(f[d]=k);return f},a.prototype.Kb=function(){this.a.af=Date.now()},a}(),y=function(){function a(){this.sessionsIncluded=0,this.sessionIncluded={},this.request={},this.level=0}return a.g=function(){},a.prototype.Za=function(a,d,b,c,e,j,k,l,m){for(this.request=new x(10,9,a,d,b,c,e,j,k,l,m),d=[];;){if(4===this.level&&g("RequestError=>request length is set too short!"),a=JSON.stringify(this.request),4*a.length/3<=3e3){this.sessionsIncluded=this.request.b.length-1,this.sessionIncluded.events=this.request.b[0].bo.length,this.sessionIncluded.purchases=this.request.b[0].bv.length,this.sessionIncluded.errors=this.request.b[0].by.length;break}d.push(this.request=this.xb(this.request))}},a.prototype.xb=function(a){switch(this.level){case 0:1===a.b.length?this.level=1:a.b=this.R(a.b);break;case 1:0===a.b[0].by.length?this.level=2:a.b[0].by=this.R(a.b[0].by);break;case 2:0===a.b[0].bv.length?this.level=3:a.b[0].bv=this.R(a.b[0].bv);break;case 3:0===a.b[0].bo.length?this.level=4:a.b[0].bo=this.R(a.b[0].bo)}return a},a.prototype.R=function(a){var d;return a.length>=1&&(d=parseInt(a.length/2),a=a.slice(0,d)),a},a}(),z=function(){function a(d){d==i&&(d={}),this[a.c.appVersion]="",this[a.c.Sa]="",this[a.c.Ga]=-1,this[a.c.xa]=0,this[a.c.ya]=0,this[a.c.location]={},this[a.c.vb]=a.sb(),this[a.c.k]=d[a.c.k]||[],this[a.c.C]=d[a.c.C]||0,this[a.c.D]=[],this[a.c.V]=0,this[a.c.Aa]=n,this[a.c.T]={},this[a.c.s]={},this[a.c.ma]=0,this[a.c.H]=d[a.c.H]||0,this[a.c.X]=[],this[a.c.W]=0,this[a.c.Ba]=n,this[a.c.oa]={},this[a.c.v]={},this[a.c.na]=0,this[a.c.B]=d[a.c.B]||0,this[a.c.S]=[],this[a.c.la]=0,this[a.c.Ia]=0,this.ba=d[a.c.timestamp]||Date.now(),this[a.c.duration]=0,this[a.c.ja]=h,this[a.c.pa]=f,this[a.c.r]=d[a.c.r]||0,this[a.c.u]=d[a.c.u]||-1,this[a.c.La]=0,this[a.c.Lb]=a.tb()}var f;return a.c={appVersion:"bd",Sa:"be",Ga:"bk",xa:"age",ya:"bl",location:"bf",vb:"bj",k:"timedEvents",C:"eventCounter",D:"bo",V:"numEventsLogged",Aa:"bm",T:"totalEventNames",s:"bn",ma:"numEventNames",H:"purchaseCounter",X:"bv",W:"numPurchasesLogged",Ba:"bt",oa:"totalPurchaseNames",v:"bu",na:"numPurchaseNames",B:"errorCounter",S:"by",la:"numErrorsLogged",Ia:"cd",timestamp:"ba",duration:"bb",ja:"eventLogging",pa:"sessionContinue",r:"pauseTimestamp",u:"bc",La:"requestsMade",Lb:"ch"},f=3e5,a.sb=function(){var a;return a="",navigator.language!=i?a=navigator.language:navigator.Mb!=i&&(a=navigator.Mb),a},a.tb=function(){var a;return a=(new Date).getTimezoneOffset()/60,"Etc/GMT"+(a>0?"+":"-")+Math.abs(a)},a.prototype.Db=function(){this[a.c.La]++},a.prototype.da=function(d){return this[a.c.appVersion]=d},a.prototype.ua=function(d){return this[a.c.Sa]=d},a.prototype.ra=function(d){return this[a.c.Ga]="f"===d?0:1},a.prototype.qa=function(d){return this.Eb(d),this[a.c.xa]=d},a.prototype.Eb=function(d){var b;b=new Date,this[a.c.ya]=new Date(b.getFullYear()-d,b.getMonth(),1).getTime()},a.prototype.sa=function(d,b,c){return this[a.c.location]={bg:d,bh:b,bi:c}},a.prototype.L=function(d){return this[a.c.pa]=1e3*d},a.prototype.Oa=function(){this[a.c.duration]=Date.now()-this[a.c.timestamp]},a.prototype.gb=function(d,b,c){this[a.c.D]=this[a.c.D].slice(d),this[a.c.s]={},this[a.c.X]=this[a.c.X].slice(b),this[a.c.v]={},this[a.c.S]=this[a.c.S].slice(c)},a.prototype.A=function(){return this.ob(),this.Oa(),this[a.c.V]<1e3&&(this[a.c.Aa]=n),this[a.c.W]<100?this[a.c.Ba]=n:void 0},a.prototype.Pa=function(d){this[a.c.r]=d},a.prototype.Ma=function(){var d;return d=this[a.c.r]>0?Date.now()-this[a.c.r]:0,d>0&&(-1===this[a.c.u]&&(this[a.c.u]=0),this[a.c.u]+=d,this[a.c.r]=0),d<this[a.c.pa]},a.prototype.Ya=function(){var d,b,c,e,f;for(d={},c=[a.c.timestamp,a.c.u,a.c.C,a.c.H,a.c.B,a.c.k],e=0,f=c.length;f>e;e++)b=c[e],d[b]=this[b];return p.ia(JSON.stringify(d))},a.prototype.t=function(d){return this[a.c.ja]&&this[a.c.V]<1e3?d.timed&&!d.br?this[a.c.k].push(d):(this[a.c.D].push(d),this[a.c.V]++):void 0},a.prototype.Wa=function(d,b,c){this[a.c.C]++,b=new Event(this[a.c.C],d,b,c,Date.now()-this[a.c.timestamp]),d in this[a.c.T]?(this[a.c.T][d]++,d in this[a.c.s]?this[a.c.s][d]++:this[a.c.s][d]=1,this.t(b)):this[a.c.ma]<100?(this[a.c.T][d]=this[a.c.s][d]=1,this[a.c.ma]++,this.t(b)):g("LogError=>unique name limit reached!")},a.prototype.pb=function(d,b){var c,f,j,k,l;for(f=0,l=this[a.c.k],j=0,k=l.length;k>j;j++){if(c=l[j],c.bp===d){c.br=Date.now()-(this[a.c.timestamp]+c.bq),b&&A.Ua(b)&&(c.bs=b),this.t(c);break}f++}this[a.c.k].splice(f,1)},a.prototype.ob=function(){var d,b,c,f;for(f=this[a.c.k],b=0,c=f.length;c>b;b++)d=f[b],d.br=Date.now()-(this[a.c.timestamp]+d.bq),this.t(d);this[a.c.k]=[]},a.prototype.U=function(d){return this[a.c.W]<100?(this[a.c.X].push(d),this[a.c.W]++):void 0},a.prototype.Xa=function(d,b,c,f){this[a.c.H]++,b=new w(this[a.c.H],d,b,c,f,Date.now()-this[a.c.timestamp]),d in this[a.c.oa]?(this.totalPurchaseNames[d]++,d in this[a.c.v]?this[a.c.v][d]++:this[a.c.v][d]=1,this.U(b)):this[a.c.na]<10?(this[a.c.oa][d]=this[a.c.v][d]=1,this[a.c.na]++,this.U(b)):g("PurchaseError=>unique name limit reached!")},a.prototype.Va=function(d,b,c){this[a.c.B]++,d=new v(this[a.c.B],d,b,c),this[a.c.la]<10&&(this[a.c.S].push(d),this[a.c.la]++),this[a.c.Ia]++},a}(),String.prototype.trim||(String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")}),A=function(){function a(){}return a.M=function(a){"boolean"!=typeof a&&g("ValidationError=>input is not valid!")},a.n=function(a){"number"!=typeof a&&g("ValidationError=>input is not valid!")},a.o=function(a){"string"!=typeof a&&g("ValidationError=>input is not valid!")},a.Pb=function(a){"object"!=typeof a&&g("ValidationError=>input is not valid!")},a.N=function(a){a!==parseInt(a)&&g("ValidationError=>input is not valid!")},a.z=function(a){a.trim()||g("ValidationError=>input is not valid!")},a.p=function(a,d){a>d&&g("ValidationError=>input is not valid!")},a.l=function(a){isNaN(a)&&g("ValidationError=>input is not valid!")},a.Qb=function(a){a===parseInt(a)||a.toFixed(2)===a.toString()||a.toFixed(1)===a.toString()||g("ValidationError=>input is not valid!")},a.Ta=function(a,d){d.hasOwnProperty(a)||g("ValidationError=>input is not valid!")},a.va=function(a){0>a&&g("ValidationError=>input is not valid!")},a.j=function(a){a||g("ValidationError=>input does not exist!")},a.Ua=function(a){var d,b,c;this.Pb(a),b=1;for(d in a)c=a[d],this.o(d),this.p(d.length,255),this.o(c),this.p(c.length,255),this.p(b,10),b++;return h},a}()}(),!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var f;"undefined"!=typeof window?f=window:"undefined"!=typeof global?f=global:"undefined"!=typeof self&&(f=self),f.io=e()}}(function(){var define;return function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a="function"==typeof require&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);throw new Error("Cannot find module '"+o+"'")}var f=n[o]={exports:{}};t[o][0].call(f.exports,function(e){var n=t[o][1][e];return s(n?n:e)},f,f.exports,e,t,n,r)}return n[o].exports}for(var i="function"==typeof require&&require,o=0;o<r.length;o++)s(r[o]);return s}({1:[function(_dereq_,module,exports){module.exports=_dereq_("./lib/")},{"./lib/":2}],2:[function(_dereq_,module,exports){function lookup(uri,opts){"object"==typeof uri&&(opts=uri,uri=void 0),opts=opts||{};var io,parsed=url(uri),source=parsed.source,id=parsed.id;return opts.forceNew||opts["force new connection"]||!1===opts.multiplex?(debug("ignoring socket cache for %s",source),io=Manager(source,opts)):(cache[id]||(debug("new io instance for %s",source),cache[id]=Manager(source,opts)),io=cache[id]),io.socket(parsed.path)}var url=_dereq_("./url"),parser=_dereq_("socket.io-parser"),Manager=_dereq_("./manager"),debug=_dereq_("debug")("socket.io-client");module.exports=exports=lookup;var cache=exports.managers={};exports.protocol=parser.protocol,exports.connect=lookup,exports.Manager=_dereq_("./manager"),exports.Socket=_dereq_("./socket")},{"./manager":3,"./socket":5,"./url":6,debug:10,"socket.io-parser":46}],3:[function(_dereq_,module,exports){function Manager(uri,opts){return this instanceof Manager?(uri&&"object"==typeof uri&&(opts=uri,uri=void 0),opts=opts||{},opts.path=opts.path||"/socket.io",this.nsps={},this.subs=[],this.opts=opts,this.reconnection(opts.reconnection!==!1),this.reconnectionAttempts(opts.reconnectionAttempts||1/0),this.reconnectionDelay(opts.reconnectionDelay||1e3),this.reconnectionDelayMax(opts.reconnectionDelayMax||5e3),this.randomizationFactor(opts.randomizationFactor||.5),this.backoff=new Backoff({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()}),this.timeout(null==opts.timeout?2e4:opts.timeout),this.readyState="closed",this.uri=uri,this.connected=[],this.encoding=!1,this.packetBuffer=[],this.encoder=new parser.Encoder,this.decoder=new parser.Decoder,this.autoConnect=opts.autoConnect!==!1,void(this.autoConnect&&this.open())):new Manager(uri,opts)}var eio=(_dereq_("./url"),_dereq_("engine.io-client")),Socket=_dereq_("./socket"),Emitter=_dereq_("component-emitter"),parser=_dereq_("socket.io-parser"),on=_dereq_("./on"),bind=_dereq_("component-bind"),debug=(_dereq_("object-component"),_dereq_("debug")("socket.io-client:manager")),indexOf=_dereq_("indexof"),Backoff=_dereq_("backo2");module.exports=Manager,Manager.prototype.emitAll=function(){this.emit.apply(this,arguments);for(var nsp in this.nsps)this.nsps[nsp].emit.apply(this.nsps[nsp],arguments)},Manager.prototype.updateSocketIds=function(){for(var nsp in this.nsps)this.nsps[nsp].id=this.engine.id},Emitter(Manager.prototype),Manager.prototype.reconnection=function(v){return arguments.length?(this._reconnection=!!v,this):this._reconnection},Manager.prototype.reconnectionAttempts=function(v){return arguments.length?(this._reconnectionAttempts=v,this):this._reconnectionAttempts},Manager.prototype.reconnectionDelay=function(v){return arguments.length?(this._reconnectionDelay=v,this.backoff&&this.backoff.setMin(v),this):this._reconnectionDelay},Manager.prototype.randomizationFactor=function(v){return arguments.length?(this._randomizationFactor=v,this.backoff&&this.backoff.setJitter(v),this):this._randomizationFactor},Manager.prototype.reconnectionDelayMax=function(v){return arguments.length?(this._reconnectionDelayMax=v,this.backoff&&this.backoff.setMax(v),this):this._reconnectionDelayMax},Manager.prototype.timeout=function(v){return arguments.length?(this._timeout=v,this):this._timeout},Manager.prototype.maybeReconnectOnOpen=function(){!this.reconnecting&&this._reconnection&&0===this.backoff.attempts&&this.reconnect()},Manager.prototype.open=Manager.prototype.connect=function(fn){if(debug("readyState %s",this.readyState),~this.readyState.indexOf("open"))return this;debug("opening %s",this.uri),this.engine=eio(this.uri,this.opts);var socket=this.engine,self=this;this.readyState="opening",this.skipReconnect=!1;var openSub=on(socket,"open",function(){self.onopen(),fn&&fn()}),errorSub=on(socket,"error",function(data){if(debug("connect_error"),self.cleanup(),self.readyState="closed",self.emitAll("connect_error",data),fn){var err=new Error("Connection error");err.data=data,fn(err)}else self.maybeReconnectOnOpen()});if(!1!==this._timeout){var timeout=this._timeout;debug("connect attempt will timeout after %d",timeout);var timer=setTimeout(function(){debug("connect attempt timed out after %d",timeout),openSub.destroy(),socket.close(),socket.emit("error","timeout"),self.emitAll("connect_timeout",timeout)},timeout);this.subs.push({destroy:function(){clearTimeout(timer)}})}return this.subs.push(openSub),this.subs.push(errorSub),this},Manager.prototype.onopen=function(){debug("open"),this.cleanup(),this.readyState="open",this.emit("open");var socket=this.engine;this.subs.push(on(socket,"data",bind(this,"ondata"))),this.subs.push(on(this.decoder,"decoded",bind(this,"ondecoded"))),this.subs.push(on(socket,"error",bind(this,"onerror"))),this.subs.push(on(socket,"close",bind(this,"onclose")))},Manager.prototype.ondata=function(data){this.decoder.add(data)},Manager.prototype.ondecoded=function(packet){this.emit("packet",packet)},Manager.prototype.onerror=function(err){debug("error",err),this.emitAll("error",err)},Manager.prototype.socket=function(nsp){var socket=this.nsps[nsp];if(!socket){socket=new Socket(this,nsp),this.nsps[nsp]=socket;var self=this;socket.on("connect",function(){socket.id=self.engine.id,~indexOf(self.connected,socket)||self.connected.push(socket)})}return socket},Manager.prototype.destroy=function(socket){var index=indexOf(this.connected,socket);~index&&this.connected.splice(index,1),this.connected.length||this.close()},Manager.prototype.packet=function(packet){debug("writing packet %j",packet);var self=this;self.encoding?self.packetBuffer.push(packet):(self.encoding=!0,this.encoder.encode(packet,function(encodedPackets){for(var i=0;i<encodedPackets.length;i++)self.engine.write(encodedPackets[i]);self.encoding=!1,self.processPacketQueue()}))},Manager.prototype.processPacketQueue=function(){if(this.packetBuffer.length>0&&!this.encoding){var pack=this.packetBuffer.shift();this.packet(pack)}},Manager.prototype.cleanup=function(){for(var sub;sub=this.subs.shift();)sub.destroy();this.packetBuffer=[],this.encoding=!1,this.decoder.destroy()},Manager.prototype.close=Manager.prototype.disconnect=function(){this.skipReconnect=!0,this.backoff.reset(),this.readyState="closed",this.engine&&this.engine.close()},Manager.prototype.onclose=function(reason){debug("close"),this.cleanup(),this.backoff.reset(),this.readyState="closed",this.emit("close",reason),this._reconnection&&!this.skipReconnect&&this.reconnect()},Manager.prototype.reconnect=function(){if(this.reconnecting||this.skipReconnect)return this;var self=this;if(this.backoff.attempts>=this._reconnectionAttempts)debug("reconnect failed"),this.backoff.reset(),this.emitAll("reconnect_failed"),this.reconnecting=!1;else{var delay=this.backoff.duration();debug("will wait %dms before reconnect attempt",delay),this.reconnecting=!0;var timer=setTimeout(function(){self.skipReconnect||(debug("attempting reconnect"),self.emitAll("reconnect_attempt",self.backoff.attempts),self.emitAll("reconnecting",self.backoff.attempts),self.skipReconnect||self.open(function(err){err?(debug("reconnect attempt error"),self.reconnecting=!1,self.reconnect(),self.emitAll("reconnect_error",err.data)):(debug("reconnect success"),self.onreconnect())}))},delay);this.subs.push({destroy:function(){clearTimeout(timer)}})}},Manager.prototype.onreconnect=function(){var attempt=this.backoff.attempts;this.reconnecting=!1,this.backoff.reset(),this.updateSocketIds(),this.emitAll("reconnect",attempt)}},{"./on":4,"./socket":5,"./url":6,backo2:7,"component-bind":8,"component-emitter":9,debug:10,"engine.io-client":11,indexof:42,"object-component":43,"socket.io-parser":46}],4:[function(_dereq_,module,exports){function on(obj,ev,fn){return obj.on(ev,fn),{destroy:function(){obj.removeListener(ev,fn)}}}module.exports=on},{}],5:[function(_dereq_,module,exports){function Socket(io,nsp){this.io=io,this.nsp=nsp,this.json=this,this.ids=0,this.acks={},this.io.autoConnect&&this.open(),this.receiveBuffer=[],this.sendBuffer=[],this.connected=!1,this.disconnected=!0}var parser=_dereq_("socket.io-parser"),Emitter=_dereq_("component-emitter"),toArray=_dereq_("to-array"),on=_dereq_("./on"),bind=_dereq_("component-bind"),debug=_dereq_("debug")("socket.io-client:socket"),hasBin=_dereq_("has-binary");module.exports=exports=Socket;var events={connect:1,connect_error:1,connect_timeout:1,disconnect:1,error:1,reconnect:1,reconnect_attempt:1,reconnect_failed:1,reconnect_error:1,reconnecting:1},emit=Emitter.prototype.emit;Emitter(Socket.prototype),Socket.prototype.subEvents=function(){if(!this.subs){var io=this.io;this.subs=[on(io,"open",bind(this,"onopen")),on(io,"packet",bind(this,"onpacket")),on(io,"close",bind(this,"onclose"))]}},Socket.prototype.open=Socket.prototype.connect=function(){return this.connected?this:(this.subEvents(),this.io.open(),"open"==this.io.readyState&&this.onopen(),this)},Socket.prototype.send=function(){var args=toArray(arguments);return args.unshift("message"),this.emit.apply(this,args),this},Socket.prototype.emit=function(ev){if(events.hasOwnProperty(ev))return emit.apply(this,arguments),this;var args=toArray(arguments),parserType=parser.EVENT;hasBin(args)&&(parserType=parser.BINARY_EVENT);var packet={type:parserType,data:args};return"function"==typeof args[args.length-1]&&(debug("emitting packet with ack id %d",this.ids),this.acks[this.ids]=args.pop(),packet.id=this.ids++),this.connected?this.packet(packet):this.sendBuffer.push(packet),this},Socket.prototype.packet=function(packet){packet.nsp=this.nsp,this.io.packet(packet)},Socket.prototype.onopen=function(){debug("transport is open - connecting"),"/"!=this.nsp&&this.packet({type:parser.CONNECT})},Socket.prototype.onclose=function(reason){debug("close (%s)",reason),this.connected=!1,this.disconnected=!0,delete this.id,this.emit("disconnect",reason)},Socket.prototype.onpacket=function(packet){if(packet.nsp==this.nsp)switch(packet.type){
case parser.CONNECT:this.onconnect();break;case parser.EVENT:this.onevent(packet);break;case parser.BINARY_EVENT:this.onevent(packet);break;case parser.ACK:this.onack(packet);break;case parser.BINARY_ACK:this.onack(packet);break;case parser.DISCONNECT:this.ondisconnect();break;case parser.ERROR:this.emit("error",packet.data)}},Socket.prototype.onevent=function(packet){var args=packet.data||[];debug("emitting event %j",args),null!=packet.id&&(debug("attaching ack callback to event"),args.push(this.ack(packet.id))),this.connected?emit.apply(this,args):this.receiveBuffer.push(args)},Socket.prototype.ack=function(id){var self=this,sent=!1;return function(){if(!sent){sent=!0;var args=toArray(arguments);debug("sending ack %j",args);var type=hasBin(args)?parser.BINARY_ACK:parser.ACK;self.packet({type:type,id:id,data:args})}}},Socket.prototype.onack=function(packet){debug("calling ack %s with %j",packet.id,packet.data);var fn=this.acks[packet.id];fn.apply(this,packet.data),delete this.acks[packet.id]},Socket.prototype.onconnect=function(){this.connected=!0,this.disconnected=!1,this.emit("connect"),this.emitBuffered()},Socket.prototype.emitBuffered=function(){var i;for(i=0;i<this.receiveBuffer.length;i++)emit.apply(this,this.receiveBuffer[i]);for(this.receiveBuffer=[],i=0;i<this.sendBuffer.length;i++)this.packet(this.sendBuffer[i]);this.sendBuffer=[]},Socket.prototype.ondisconnect=function(){debug("server disconnect (%s)",this.nsp),this.destroy(),this.onclose("io server disconnect")},Socket.prototype.destroy=function(){if(this.subs){for(var i=0;i<this.subs.length;i++)this.subs[i].destroy();this.subs=null}this.io.destroy(this)},Socket.prototype.close=Socket.prototype.disconnect=function(){return this.connected&&(debug("performing disconnect (%s)",this.nsp),this.packet({type:parser.DISCONNECT})),this.destroy(),this.connected&&this.onclose("io client disconnect"),this}},{"./on":4,"component-bind":8,"component-emitter":9,debug:10,"has-binary":38,"socket.io-parser":46,"to-array":50}],6:[function(_dereq_,module,exports){(function(global){function url(uri,loc){var obj=uri,loc=loc||global.location;return null==uri&&(uri=loc.protocol+"//"+loc.host),"string"==typeof uri&&("/"==uri.charAt(0)&&(uri="/"==uri.charAt(1)?loc.protocol+uri:loc.hostname+uri),/^(https?|wss?):\/\//.test(uri)||(debug("protocol-less url %s",uri),uri="undefined"!=typeof loc?loc.protocol+"//"+uri:"https://"+uri),debug("parse %s",uri),obj=parseuri(uri)),obj.port||(/^(http|ws)$/.test(obj.protocol)?obj.port="80":/^(http|ws)s$/.test(obj.protocol)&&(obj.port="443")),obj.path=obj.path||"/",obj.id=obj.protocol+"://"+obj.host+":"+obj.port,obj.href=obj.protocol+"://"+obj.host+(loc&&loc.port==obj.port?"":":"+obj.port),obj}var parseuri=_dereq_("parseuri"),debug=_dereq_("debug")("socket.io-client:url");module.exports=url}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{debug:10,parseuri:44}],7:[function(_dereq_,module,exports){function Backoff(opts){opts=opts||{},this.ms=opts.min||100,this.max=opts.max||1e4,this.factor=opts.factor||2,this.jitter=opts.jitter>0&&opts.jitter<=1?opts.jitter:0,this.attempts=0}module.exports=Backoff,Backoff.prototype.duration=function(){var ms=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var rand=Math.random(),deviation=Math.floor(rand*this.jitter*ms);ms=0==(1&Math.floor(10*rand))?ms-deviation:ms+deviation}return 0|Math.min(ms,this.max)},Backoff.prototype.reset=function(){this.attempts=0},Backoff.prototype.setMin=function(min){this.ms=min},Backoff.prototype.setMax=function(max){this.max=max},Backoff.prototype.setJitter=function(jitter){this.jitter=jitter}},{}],8:[function(_dereq_,module,exports){var slice=[].slice;module.exports=function(obj,fn){if("string"==typeof fn&&(fn=obj[fn]),"function"!=typeof fn)throw new Error("bind() requires a function");var args=slice.call(arguments,2);return function(){return fn.apply(obj,args.concat(slice.call(arguments)))}}},{}],9:[function(_dereq_,module,exports){function Emitter(obj){return obj?mixin(obj):void 0}function mixin(obj){for(var key in Emitter.prototype)obj[key]=Emitter.prototype[key];return obj}module.exports=Emitter,Emitter.prototype.on=Emitter.prototype.addEventListener=function(event,fn){return this._callbacks=this._callbacks||{},(this._callbacks[event]=this._callbacks[event]||[]).push(fn),this},Emitter.prototype.once=function(event,fn){function on(){self.off(event,on),fn.apply(this,arguments)}var self=this;return this._callbacks=this._callbacks||{},on.fn=fn,this.on(event,on),this},Emitter.prototype.off=Emitter.prototype.removeListener=Emitter.prototype.removeAllListeners=Emitter.prototype.removeEventListener=function(event,fn){if(this._callbacks=this._callbacks||{},0==arguments.length)return this._callbacks={},this;var callbacks=this._callbacks[event];if(!callbacks)return this;if(1==arguments.length)return delete this._callbacks[event],this;for(var cb,i=0;i<callbacks.length;i++)if(cb=callbacks[i],cb===fn||cb.fn===fn){callbacks.splice(i,1);break}return this},Emitter.prototype.emit=function(event){this._callbacks=this._callbacks||{};var args=[].slice.call(arguments,1),callbacks=this._callbacks[event];if(callbacks){callbacks=callbacks.slice(0);for(var i=0,len=callbacks.length;len>i;++i)callbacks[i].apply(this,args)}return this},Emitter.prototype.listeners=function(event){return this._callbacks=this._callbacks||{},this._callbacks[event]||[]},Emitter.prototype.hasListeners=function(event){return!!this.listeners(event).length}},{}],10:[function(_dereq_,module,exports){function debug(name){return debug.enabled(name)?function(fmt){fmt=coerce(fmt);var curr=new Date,ms=curr-(debug[name]||curr);debug[name]=curr,fmt=name+" "+fmt+" +"+debug.humanize(ms),window.console&&console.log&&Function.prototype.apply.call(console.log,console,arguments)}:function(){}}function coerce(val){return val instanceof Error?val.stack||val.message:val}module.exports=debug,debug.names=[],debug.skips=[],debug.enable=function(name){try{localStorage.debug=name}catch(e){}for(var split=(name||"").split(/[\s,]+/),len=split.length,i=0;len>i;i++)name=split[i].replace("*",".*?"),"-"===name[0]?debug.skips.push(new RegExp("^"+name.substr(1)+"$")):debug.names.push(new RegExp("^"+name+"$"))},debug.disable=function(){debug.enable("")},debug.humanize=function(ms){var sec=1e3,min=6e4,hour=60*min;return ms>=hour?(ms/hour).toFixed(1)+"h":ms>=min?(ms/min).toFixed(1)+"m":ms>=sec?(ms/sec|0)+"s":ms+"ms"},debug.enabled=function(name){for(var i=0,len=debug.skips.length;len>i;i++)if(debug.skips[i].test(name))return!1;for(var i=0,len=debug.names.length;len>i;i++)if(debug.names[i].test(name))return!0;return!1};try{window.localStorage&&debug.enable(localStorage.debug)}catch(e){}},{}],11:[function(_dereq_,module,exports){module.exports=_dereq_("./lib/")},{"./lib/":12}],12:[function(_dereq_,module,exports){module.exports=_dereq_("./socket"),module.exports.parser=_dereq_("engine.io-parser")},{"./socket":13,"engine.io-parser":25}],13:[function(_dereq_,module,exports){(function(global){function Socket(uri,opts){if(!(this instanceof Socket))return new Socket(uri,opts);if(opts=opts||{},uri&&"object"==typeof uri&&(opts=uri,uri=null),uri&&(uri=parseuri(uri),opts.host=uri.host,opts.secure="https"==uri.protocol||"wss"==uri.protocol,opts.port=uri.port,uri.query&&(opts.query=uri.query)),this.secure=null!=opts.secure?opts.secure:global.location&&"https:"==location.protocol,opts.host){var pieces=opts.host.split(":");opts.hostname=pieces.shift(),pieces.length?opts.port=pieces.pop():opts.port||(opts.port=this.secure?"443":"80")}this.agent=opts.agent||!1,this.hostname=opts.hostname||(global.location?location.hostname:"localhost"),this.port=opts.port||(global.location&&location.port?location.port:this.secure?443:80),this.query=opts.query||{},"string"==typeof this.query&&(this.query=parseqs.decode(this.query)),this.upgrade=!1!==opts.upgrade,this.path=(opts.path||"/engine.io").replace(/\/$/,"")+"/",this.forceJSONP=!!opts.forceJSONP,this.jsonp=!1!==opts.jsonp,this.forceBase64=!!opts.forceBase64,this.enablesXDR=!!opts.enablesXDR,this.timestampParam=opts.timestampParam||"t",this.timestampRequests=opts.timestampRequests,this.transports=opts.transports||["polling","websocket"],this.readyState="",this.writeBuffer=[],this.callbackBuffer=[],this.policyPort=opts.policyPort||843,this.rememberUpgrade=opts.rememberUpgrade||!1,this.binaryType=null,this.onlyBinaryUpgrades=opts.onlyBinaryUpgrades,this.perMessageDeflate=!1!==opts.perMessageDeflate?opts.perMessageDeflate||!0:!1,this.pfx=opts.pfx||null,this.key=opts.key||null,this.passphrase=opts.passphrase||null,this.cert=opts.cert||null,this.ca=opts.ca||null,this.ciphers=opts.ciphers||null,this.rejectUnauthorized=opts.rejectUnauthorized||null,this.open()}function clone(obj){var o={};for(var i in obj)obj.hasOwnProperty(i)&&(o[i]=obj[i]);return o}var transports=_dereq_("./transports"),Emitter=_dereq_("component-emitter"),debug=_dereq_("debug")("engine.io-client:socket"),index=_dereq_("indexof"),parser=_dereq_("engine.io-parser"),parseuri=_dereq_("parseuri"),parsejson=_dereq_("parsejson"),parseqs=_dereq_("parseqs");module.exports=Socket,Socket.priorWebsocketSuccess=!1,Emitter(Socket.prototype),Socket.protocol=parser.protocol,Socket.Socket=Socket,Socket.Transport=_dereq_("./transport"),Socket.transports=_dereq_("./transports"),Socket.parser=_dereq_("engine.io-parser"),Socket.prototype.createTransport=function(name){debug('creating transport "%s"',name);var query=clone(this.query);query.EIO=parser.protocol,query.transport=name,this.id&&(query.sid=this.id);var transport=new transports[name]({agent:this.agent,hostname:this.hostname,port:this.port,secure:this.secure,path:this.path,query:query,forceJSONP:this.forceJSONP,jsonp:this.jsonp,forceBase64:this.forceBase64,enablesXDR:this.enablesXDR,timestampRequests:this.timestampRequests,timestampParam:this.timestampParam,policyPort:this.policyPort,socket:this,pfx:this.pfx,key:this.key,passphrase:this.passphrase,cert:this.cert,ca:this.ca,ciphers:this.ciphers,rejectUnauthorized:this.rejectUnauthorized,perMessageDeflate:this.perMessageDeflate});return transport},Socket.prototype.open=function(){var transport;if(this.rememberUpgrade&&Socket.priorWebsocketSuccess&&-1!=this.transports.indexOf("websocket"))transport="websocket";else{if(0==this.transports.length){var self=this;return void setTimeout(function(){self.emit("error","No transports available")},0)}transport=this.transports[0]}this.readyState="opening";var transport;try{transport=this.createTransport(transport)}catch(e){return this.transports.shift(),void this.open()}transport.open(),this.setTransport(transport)},Socket.prototype.setTransport=function(transport){debug("setting transport %s",transport.name);var self=this;this.transport&&(debug("clearing existing transport %s",this.transport.name),this.transport.removeAllListeners()),this.transport=transport,transport.on("drain",function(){self.onDrain()}).on("packet",function(packet){self.onPacket(packet)}).on("error",function(e){self.onError(e)}).on("close",function(){self.onClose("transport close")})},Socket.prototype.probe=function(name){function onTransportOpen(){if(self.onlyBinaryUpgrades){var upgradeLosesBinary=!this.supportsBinary&&self.transport.supportsBinary;failed=failed||upgradeLosesBinary}failed||(debug('probe transport "%s" opened',name),transport.send([{type:"ping",data:"probe",options:{compress:!0}}]),transport.once("packet",function(msg){if(!failed)if("pong"==msg.type&&"probe"==msg.data){if(debug('probe transport "%s" pong',name),self.upgrading=!0,self.emit("upgrading",transport),!transport)return;Socket.priorWebsocketSuccess="websocket"==transport.name,debug('pausing current transport "%s"',self.transport.name),self.transport.pause(function(){failed||"closed"!=self.readyState&&(debug("changing transport and sending upgrade packet"),cleanup(),self.setTransport(transport),transport.send([{type:"upgrade",options:{compress:!0}}]),self.emit("upgrade",transport),transport=null,self.upgrading=!1,self.flush())})}else{debug('probe transport "%s" failed',name);var err=new Error("probe error");err.transport=transport.name,self.emit("upgradeError",err)}}))}function freezeTransport(){failed||(failed=!0,cleanup(),transport.close(),transport=null)}function onerror(err){var error=new Error("probe error: "+err);error.transport=transport.name,freezeTransport(),debug('probe transport "%s" failed because of error: %s',name,err),self.emit("upgradeError",error)}function onTransportClose(){onerror("transport closed")}function onclose(){onerror("socket closed")}function onupgrade(to){transport&&to.name!=transport.name&&(debug('"%s" works - aborting "%s"',to.name,transport.name),freezeTransport())}function cleanup(){transport.removeListener("open",onTransportOpen),transport.removeListener("error",onerror),transport.removeListener("close",onTransportClose),self.removeListener("close",onclose),self.removeListener("upgrading",onupgrade)}debug('probing transport "%s"',name);var transport=this.createTransport(name,{probe:1}),failed=!1,self=this;Socket.priorWebsocketSuccess=!1,transport.once("open",onTransportOpen),transport.once("error",onerror),transport.once("close",onTransportClose),this.once("close",onclose),this.once("upgrading",onupgrade),transport.open()},Socket.prototype.onOpen=function(){if(debug("socket open"),this.readyState="open",Socket.priorWebsocketSuccess="websocket"==this.transport.name,this.emit("open"),this.flush(),"open"==this.readyState&&this.upgrade&&this.transport.pause){debug("starting upgrade probes");for(var i=0,l=this.upgrades.length;l>i;i++)this.probe(this.upgrades[i])}},Socket.prototype.onPacket=function(packet){if("opening"==this.readyState||"open"==this.readyState)switch(debug('socket receive: type "%s", data "%s"',packet.type,packet.data),this.emit("packet",packet),this.emit("heartbeat"),packet.type){case"open":this.onHandshake(parsejson(packet.data));break;case"pong":this.setPing();break;case"error":var err=new Error("server error");err.code=packet.data,this.emit("error",err);break;case"message":this.emit("data",packet.data),this.emit("message",packet.data)}else debug('packet received with socket readyState "%s"',this.readyState)},Socket.prototype.onHandshake=function(data){this.emit("handshake",data),this.id=data.sid,this.transport.query.sid=data.sid,this.upgrades=this.filterUpgrades(data.upgrades),this.pingInterval=data.pingInterval,this.pingTimeout=data.pingTimeout,this.onOpen(),"closed"!=this.readyState&&(this.setPing(),this.removeListener("heartbeat",this.onHeartbeat),this.on("heartbeat",this.onHeartbeat))},Socket.prototype.onHeartbeat=function(timeout){clearTimeout(this.pingTimeoutTimer);var self=this;self.pingTimeoutTimer=setTimeout(function(){"closed"!=self.readyState&&self.onClose("ping timeout")},timeout||self.pingInterval+self.pingTimeout)},Socket.prototype.setPing=function(){var self=this;clearTimeout(self.pingIntervalTimer),self.pingIntervalTimer=setTimeout(function(){debug("writing ping packet - expecting pong within %sms",self.pingTimeout),self.ping(),self.onHeartbeat(self.pingTimeout)},self.pingInterval)},Socket.prototype.ping=function(){this.sendPacket("ping")},Socket.prototype.onDrain=function(){for(var i=0;i<this.prevBufferLen;i++)this.callbackBuffer[i]&&this.callbackBuffer[i]();this.writeBuffer.splice(0,this.prevBufferLen),this.callbackBuffer.splice(0,this.prevBufferLen),this.prevBufferLen=0,0==this.writeBuffer.length?this.emit("drain"):this.flush()},Socket.prototype.flush=function(){"closed"!=this.readyState&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length&&(debug("flushing %d packets in socket",this.writeBuffer.length),this.transport.send(this.writeBuffer),this.prevBufferLen=this.writeBuffer.length,this.emit("flush"))},Socket.prototype.write=Socket.prototype.send=function(msg,options,fn){return this.sendPacket("message",msg,options,fn),this},Socket.prototype.sendPacket=function(type,data,options,fn){if("function"==typeof options&&(fn=options,options=null),"closing"!=this.readyState&&"closed"!=this.readyState){options=options||{},options.compress=!1!==options.compress;var packet={type:type,data:data,options:options};this.emit("packetCreate",packet),this.writeBuffer.push(packet),this.callbackBuffer.push(fn),this.flush()}},Socket.prototype.close=function(){function close(){self.onClose("forced close"),debug("socket closing - telling transport to close"),self.transport.close()}function cleanupAndClose(){self.removeListener("upgrade",cleanupAndClose),self.removeListener("upgradeError",cleanupAndClose),close()}function waitForUpgrade(){self.once("upgrade",cleanupAndClose),self.once("upgradeError",cleanupAndClose)}if("opening"==this.readyState||"open"==this.readyState){this.readyState="closing";var self=this;this.writeBuffer.length?this.once("drain",function(){this.upgrading?waitForUpgrade():close()}):this.upgrading?waitForUpgrade():close()}return this},Socket.prototype.onError=function(err){debug("socket error %j",err),Socket.priorWebsocketSuccess=!1,this.emit("error",err),this.onClose("transport error",err)},Socket.prototype.onClose=function(reason,desc){if("opening"==this.readyState||"open"==this.readyState||"closing"==this.readyState){debug('socket close with reason: "%s"',reason);var self=this;clearTimeout(this.pingIntervalTimer),clearTimeout(this.pingTimeoutTimer),setTimeout(function(){self.writeBuffer=[],self.callbackBuffer=[],self.prevBufferLen=0},0),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),this.readyState="closed",this.id=null,this.emit("close",reason,desc)}},Socket.prototype.filterUpgrades=function(upgrades){for(var filteredUpgrades=[],i=0,j=upgrades.length;j>i;i++)~index(this.transports,upgrades[i])&&filteredUpgrades.push(upgrades[i]);return filteredUpgrades}}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./transport":14,"./transports":15,"component-emitter":9,debug:22,"engine.io-parser":25,indexof:42,parsejson:34,parseqs:35,parseuri:36}],14:[function(_dereq_,module,exports){function Transport(opts){this.path=opts.path,this.hostname=opts.hostname,this.port=opts.port,this.secure=opts.secure,this.query=opts.query,this.timestampParam=opts.timestampParam,this.timestampRequests=opts.timestampRequests,this.readyState="",this.agent=opts.agent||!1,this.socket=opts.socket,this.enablesXDR=opts.enablesXDR,this.pfx=opts.pfx,this.key=opts.key,this.passphrase=opts.passphrase,this.cert=opts.cert,this.ca=opts.ca,this.ciphers=opts.ciphers,this.rejectUnauthorized=opts.rejectUnauthorized}var parser=_dereq_("engine.io-parser"),Emitter=_dereq_("component-emitter");module.exports=Transport,Emitter(Transport.prototype),Transport.timestamps=0,Transport.prototype.onError=function(msg,desc){var err=new Error(msg);return err.type="TransportError",err.description=desc,this.emit("error",err),this},Transport.prototype.open=function(){return("closed"==this.readyState||""==this.readyState)&&(this.readyState="opening",this.doOpen()),this},Transport.prototype.close=function(){return("opening"==this.readyState||"open"==this.readyState)&&(this.doClose(),this.onClose()),this},Transport.prototype.send=function(packets){if("open"!=this.readyState)throw new Error("Transport not open");this.write(packets)},Transport.prototype.onOpen=function(){this.readyState="open",this.writable=!0,this.emit("open")},Transport.prototype.onData=function(data){var packet=parser.decodePacket(data,this.socket.binaryType);this.onPacket(packet)},Transport.prototype.onPacket=function(packet){this.emit("packet",packet)},Transport.prototype.onClose=function(){this.readyState="closed",this.emit("close")}},{"component-emitter":9,"engine.io-parser":25}],15:[function(_dereq_,module,exports){(function(global){function polling(opts){var xhr,xd=!1,xs=!1,jsonp=!1!==opts.jsonp;if(global.location){var isSSL="https:"==location.protocol,port=location.port;port||(port=isSSL?443:80),xd=opts.hostname!=location.hostname||port!=opts.port,xs=opts.secure!=isSSL}if(opts.xdomain=xd,opts.xscheme=xs,xhr=new XMLHttpRequest(opts),"open"in xhr&&!opts.forceJSONP)return new XHR(opts);if(!jsonp)throw new Error("JSONP disabled");return new JSONP(opts)}var XMLHttpRequest=_dereq_("xmlhttprequest"),XHR=_dereq_("./polling-xhr"),JSONP=_dereq_("./polling-jsonp"),websocket=_dereq_("./websocket");exports.polling=polling,exports.websocket=websocket}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./polling-jsonp":16,"./polling-xhr":17,"./websocket":19,xmlhttprequest:20}],16:[function(_dereq_,module,exports){(function(global){function empty(){}function JSONPPolling(opts){Polling.call(this,opts),this.query=this.query||{},callbacks||(global.___eio||(global.___eio=[]),callbacks=global.___eio),this.index=callbacks.length;var self=this;callbacks.push(function(msg){self.onData(msg)}),this.query.j=this.index,global.document&&global.addEventListener&&global.addEventListener("beforeunload",function(){self.script&&(self.script.onerror=empty)},!1)}var Polling=_dereq_("./polling"),inherit=_dereq_("component-inherit");module.exports=JSONPPolling;var callbacks,rNewline=/\n/g,rEscapedNewline=/\\n/g;inherit(JSONPPolling,Polling),JSONPPolling.prototype.supportsBinary=!1,JSONPPolling.prototype.doClose=function(){this.script&&(this.script.parentNode.removeChild(this.script),this.script=null),this.form&&(this.form.parentNode.removeChild(this.form),this.form=null,this.iframe=null),Polling.prototype.doClose.call(this)},JSONPPolling.prototype.doPoll=function(){var self=this,script=document.createElement("script");this.script&&(this.script.parentNode.removeChild(this.script),this.script=null),script.async=!0,script.src=this.uri(),script.onerror=function(e){self.onError("jsonp poll error",e)};var insertAt=document.getElementsByTagName("script")[0];insertAt.parentNode.insertBefore(script,insertAt),this.script=script;var isUAgecko="undefined"!=typeof navigator&&/gecko/i.test(navigator.userAgent);isUAgecko&&setTimeout(function(){var iframe=document.createElement("iframe");document.body.appendChild(iframe),document.body.removeChild(iframe)},100)},JSONPPolling.prototype.doWrite=function(data,fn){function complete(){initIframe(),fn()}function initIframe(){if(self.iframe)try{self.form.removeChild(self.iframe)}catch(e){self.onError("jsonp polling iframe removal error",e)}try{var html='<iframe src="javascript:0" name="'+self.iframeId+'">';iframe=document.createElement(html)}catch(e){iframe=document.createElement("iframe"),iframe.name=self.iframeId,iframe.src="javascript:0"}iframe.id=self.iframeId,self.form.appendChild(iframe),self.iframe=iframe}var self=this;if(!this.form){var iframe,form=document.createElement("form"),area=document.createElement("textarea"),id=this.iframeId="eio_iframe_"+this.index;form.className="socketio",form.style.position="absolute",form.style.top="-1000px",form.style.left="-1000px",form.target=id,form.method="POST",form.setAttribute("accept-charset","utf-8"),area.name="d",form.appendChild(area),document.body.appendChild(form),this.form=form,this.area=area}this.form.action=this.uri(),initIframe(),data=data.replace(rEscapedNewline,"\\\n"),this.area.value=data.replace(rNewline,"\\n");try{this.form.submit()}catch(e){}this.iframe.attachEvent?this.iframe.onreadystatechange=function(){"complete"==self.iframe.readyState&&complete()}:this.iframe.onload=complete}}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./polling":18,"component-inherit":21}],17:[function(_dereq_,module,exports){(function(global){function empty(){}function XHR(opts){if(Polling.call(this,opts),global.location){var isSSL="https:"==location.protocol,port=location.port;port||(port=isSSL?443:80),this.xd=opts.hostname!=global.location.hostname||port!=opts.port,this.xs=opts.secure!=isSSL}}function Request(opts){this.method=opts.method||"GET",this.uri=opts.uri,this.xd=!!opts.xd,this.xs=!!opts.xs,this.async=!1!==opts.async,this.data=void 0!=opts.data?opts.data:null,this.agent=opts.agent,this.isBinary=opts.isBinary,this.supportsBinary=opts.supportsBinary,this.enablesXDR=opts.enablesXDR,this.pfx=opts.pfx,this.key=opts.key,this.passphrase=opts.passphrase,this.cert=opts.cert,this.ca=opts.ca,this.ciphers=opts.ciphers,this.rejectUnauthorized=opts.rejectUnauthorized,this.create()}function unloadHandler(){for(var i in Request.requests)Request.requests.hasOwnProperty(i)&&Request.requests[i].abort()}var XMLHttpRequest=_dereq_("xmlhttprequest"),Polling=_dereq_("./polling"),Emitter=_dereq_("component-emitter"),inherit=_dereq_("component-inherit"),debug=_dereq_("debug")("engine.io-client:polling-xhr");module.exports=XHR,module.exports.Request=Request,inherit(XHR,Polling),XHR.prototype.supportsBinary=!0,XHR.prototype.request=function(opts){return opts=opts||{},opts.uri=this.uri(),opts.xd=this.xd,opts.xs=this.xs,opts.agent=this.agent||!1,opts.supportsBinary=this.supportsBinary,opts.enablesXDR=this.enablesXDR,opts.pfx=this.pfx,opts.key=this.key,opts.passphrase=this.passphrase,opts.cert=this.cert,opts.ca=this.ca,opts.ciphers=this.ciphers,opts.rejectUnauthorized=this.rejectUnauthorized,new Request(opts)},XHR.prototype.doWrite=function(data,fn){var isBinary="string"!=typeof data&&void 0!==data,req=this.request({method:"POST",data:data,isBinary:isBinary}),self=this;req.on("success",fn),req.on("error",function(err){self.onError("xhr post error",err)}),this.sendXhr=req},XHR.prototype.doPoll=function(){debug("xhr poll");var req=this.request(),self=this;req.on("data",function(data){self.onData(data)}),req.on("error",function(err){self.onError("xhr poll error",err)}),this.pollXhr=req},Emitter(Request.prototype),Request.prototype.create=function(){var opts={agent:this.agent,xdomain:this.xd,xscheme:this.xs,enablesXDR:this.enablesXDR};opts.pfx=this.pfx,opts.key=this.key,opts.passphrase=this.passphrase,opts.cert=this.cert,opts.ca=this.ca,opts.ciphers=this.ciphers,opts.rejectUnauthorized=this.rejectUnauthorized;var xhr=this.xhr=new XMLHttpRequest(opts),self=this;try{if(debug("xhr open %s: %s",this.method,this.uri),xhr.open(this.method,this.uri,this.async),this.supportsBinary&&(xhr.responseType="arraybuffer"),"POST"==this.method)try{this.isBinary?xhr.setRequestHeader("Content-type","application/octet-stream"):xhr.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch(e){}"withCredentials"in xhr&&(xhr.withCredentials=!0),this.hasXDR()?(xhr.onload=function(){self.onLoad()},xhr.onerror=function(){self.onError(xhr.responseText)}):xhr.onreadystatechange=function(){4==xhr.readyState&&(200==xhr.status||1223==xhr.status?self.onLoad():setTimeout(function(){self.onError(xhr.status)},0))},debug("xhr data %s",this.data),xhr.send(this.data)}catch(e){return void setTimeout(function(){self.onError(e)},0)}global.document&&(this.index=Request.requestsCount++,Request.requests[this.index]=this)},Request.prototype.onSuccess=function(){this.emit("success"),this.cleanup()},Request.prototype.onData=function(data){this.emit("data",data),this.onSuccess()},Request.prototype.onError=function(err){this.emit("error",err),this.cleanup(!0)},Request.prototype.cleanup=function(fromError){if("undefined"!=typeof this.xhr&&null!==this.xhr){if(this.hasXDR()?this.xhr.onload=this.xhr.onerror=empty:this.xhr.onreadystatechange=empty,fromError)try{this.xhr.abort()}catch(e){}global.document&&delete Request.requests[this.index],this.xhr=null}},Request.prototype.onLoad=function(){var data;try{var contentType;try{contentType=this.xhr.getResponseHeader("Content-Type").split(";")[0]}catch(e){}data="application/octet-stream"===contentType?this.xhr.response:this.supportsBinary?"ok":this.xhr.responseText}catch(e){this.onError(e)}null!=data&&this.onData(data)},Request.prototype.hasXDR=function(){return"undefined"!=typeof global.XDomainRequest&&!this.xs&&this.enablesXDR},Request.prototype.abort=function(){this.cleanup()},global.document&&(Request.requestsCount=0,Request.requests={},global.attachEvent?global.attachEvent("onunload",unloadHandler):global.addEventListener&&global.addEventListener("beforeunload",unloadHandler,!1))}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./polling":18,"component-emitter":9,"component-inherit":21,debug:22,xmlhttprequest:20}],18:[function(_dereq_,module,exports){function Polling(opts){var forceBase64=opts&&opts.forceBase64;(!hasXHR2||forceBase64)&&(this.supportsBinary=!1),Transport.call(this,opts)}var Transport=_dereq_("../transport"),parseqs=_dereq_("parseqs"),parser=_dereq_("engine.io-parser"),inherit=_dereq_("component-inherit"),debug=_dereq_("debug")("engine.io-client:polling");module.exports=Polling;var hasXHR2=function(){var XMLHttpRequest=_dereq_("xmlhttprequest"),xhr=new XMLHttpRequest({xdomain:!1});return null!=xhr.responseType}();inherit(Polling,Transport),Polling.prototype.name="polling",Polling.prototype.doOpen=function(){this.poll()},Polling.prototype.pause=function(onPause){function pause(){debug("paused"),self.readyState="paused",onPause()}var self=this;if(this.readyState="pausing",this.polling||!this.writable){var total=0;this.polling&&(debug("we are currently polling - waiting to pause"),total++,this.once("pollComplete",function(){debug("pre-pause polling complete"),--total||pause()})),this.writable||(debug("we are currently writing - waiting to pause"),total++,this.once("drain",function(){debug("pre-pause writing complete"),--total||pause()}))}else pause()},Polling.prototype.poll=function(){debug("polling"),this.polling=!0,this.doPoll(),this.emit("poll")},Polling.prototype.onData=function(data){var self=this;debug("polling got data %s",data);var callback=function(packet,index,total){return"opening"==self.readyState&&self.onOpen(),"close"==packet.type?(self.onClose(),!1):void self.onPacket(packet)};parser.decodePayload(data,this.socket.binaryType,callback),"closed"!=this.readyState&&(this.polling=!1,this.emit("pollComplete"),"open"==this.readyState?this.poll():debug('ignoring poll - transport state "%s"',this.readyState))},Polling.prototype.doClose=function(){function close(){debug("writing close packet"),self.write([{type:"close"}])}var self=this;"open"==this.readyState?(debug("transport open - closing"),close()):(debug("transport not open - deferring close"),this.once("open",close))},Polling.prototype.write=function(packets){var self=this;this.writable=!1;var callbackfn=function(){self.writable=!0,self.emit("drain")},self=this;parser.encodePayload(packets,this.supportsBinary,function(data){self.doWrite(data,callbackfn)})},Polling.prototype.uri=function(){var query=this.query||{},schema=this.secure?"https":"http",port="";return!1!==this.timestampRequests&&(query[this.timestampParam]=+new Date+"-"+Transport.timestamps++),this.supportsBinary||query.sid||(query.b64=1),query=parseqs.encode(query),this.port&&("https"==schema&&443!=this.port||"http"==schema&&80!=this.port)&&(port=":"+this.port),query.length&&(query="?"+query),schema+"://"+this.hostname+port+this.path+query}},{"../transport":14,"component-inherit":21,debug:22,"engine.io-parser":25,parseqs:35,xmlhttprequest:20}],19:[function(_dereq_,module,exports){function WS(opts){var forceBase64=opts&&opts.forceBase64;forceBase64&&(this.supportsBinary=!1),this.perMessageDeflate=opts.perMessageDeflate,Transport.call(this,opts)}var Transport=_dereq_("../transport"),parser=_dereq_("engine.io-parser"),parseqs=_dereq_("parseqs"),inherit=_dereq_("component-inherit"),debug=_dereq_("debug")("engine.io-client:websocket"),WebSocket=_dereq_("ws");module.exports=WS,inherit(WS,Transport),WS.prototype.name="websocket",WS.prototype.supportsBinary=!0,WS.prototype.doOpen=function(){if(this.check()){var uri=this.uri(),protocols=void 0,opts={agent:this.agent,perMessageDeflate:this.perMessageDeflate};opts.pfx=this.pfx,opts.key=this.key,opts.passphrase=this.passphrase,opts.cert=this.cert,opts.ca=this.ca,opts.ciphers=this.ciphers,opts.rejectUnauthorized=this.rejectUnauthorized,this.ws=new WebSocket(uri,protocols,opts),void 0===this.ws.binaryType&&(this.supportsBinary=!1),this.ws.binaryType="arraybuffer",this.addEventListeners();
}},WS.prototype.addEventListeners=function(){var self=this;this.ws.onopen=function(){self.onOpen()},this.ws.onclose=function(){self.onClose()},this.ws.onmessage=function(ev){self.onData(ev.data)},this.ws.onerror=function(e){self.onError("websocket error",e)}},"undefined"!=typeof navigator&&/iPad|iPhone|iPod/i.test(navigator.userAgent)&&(WS.prototype.onData=function(data){var self=this;setTimeout(function(){Transport.prototype.onData.call(self,data)},0)}),WS.prototype.write=function(packets){function ondrain(){self.writable=!0,self.emit("drain")}var self=this;this.writable=!1;for(var i=0,l=packets.length;l>i;i++){var packet=packets[i];parser.encodePacket(packet,this.supportsBinary,function(data){try{self.ws.send(data,packet.options)}catch(e){debug("websocket closed before onclose event")}})}setTimeout(ondrain,0)},WS.prototype.onClose=function(){Transport.prototype.onClose.call(this)},WS.prototype.doClose=function(){"undefined"!=typeof this.ws&&this.ws.close()},WS.prototype.uri=function(){var query=this.query||{},schema=this.secure?"wss":"ws",port="";return this.port&&("wss"==schema&&443!=this.port||"ws"==schema&&80!=this.port)&&(port=":"+this.port),this.timestampRequests&&(query[this.timestampParam]=+new Date),this.supportsBinary||(query.b64=1),query=parseqs.encode(query),query.length&&(query="?"+query),schema+"://"+this.hostname+port+this.path+query},WS.prototype.check=function(){return!(!WebSocket||"__initialize"in WebSocket&&this.name===WS.prototype.name)}},{"../transport":14,"component-inherit":21,debug:22,"engine.io-parser":25,parseqs:35,ws:37}],20:[function(_dereq_,module,exports){var hasCORS=_dereq_("has-cors");module.exports=function(opts){var xdomain=opts.xdomain,xscheme=opts.xscheme,enablesXDR=opts.enablesXDR;try{if("undefined"!=typeof XMLHttpRequest&&(!xdomain||hasCORS))return new XMLHttpRequest}catch(e){}try{if("undefined"!=typeof XDomainRequest&&!xscheme&&enablesXDR)return new XDomainRequest}catch(e){}if(!xdomain)try{return new ActiveXObject("Microsoft.XMLHTTP")}catch(e){}}},{"has-cors":40}],21:[function(_dereq_,module,exports){module.exports=function(a,b){var fn=function(){};fn.prototype=b.prototype,a.prototype=new fn,a.prototype.constructor=a}},{}],22:[function(_dereq_,module,exports){function useColors(){return"WebkitAppearance"in document.documentElement.style||window.console&&(console.firebug||console.exception&&console.table)||navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31}function formatArgs(){var args=arguments,useColors=this.useColors;if(args[0]=(useColors?"%c":"")+this.namespace+(useColors?" %c":" ")+args[0]+(useColors?"%c ":" ")+"+"+exports.humanize(this.diff),!useColors)return args;var c="color: "+this.color;args=[args[0],c,"color: inherit"].concat(Array.prototype.slice.call(args,1));var index=0,lastC=0;return args[0].replace(/%[a-z%]/g,function(match){"%"!==match&&(index++,"%c"===match&&(lastC=index))}),args.splice(lastC,0,c),args}function log(){return"object"==typeof console&&"function"==typeof console.log&&Function.prototype.apply.call(console.log,console,arguments)}function save(namespaces){try{null==namespaces?localStorage.removeItem("debug"):localStorage.debug=namespaces}catch(e){}}function load(){var r;try{r=localStorage.debug}catch(e){}return r}exports=module.exports=_dereq_("./debug"),exports.log=log,exports.formatArgs=formatArgs,exports.save=save,exports.load=load,exports.useColors=useColors,exports.colors=["lightseagreen","forestgreen","goldenrod","dodgerblue","darkorchid","crimson"],exports.formatters.j=function(v){return JSON.stringify(v)},exports.enable(load())},{"./debug":23}],23:[function(_dereq_,module,exports){function selectColor(){return exports.colors[prevColor++%exports.colors.length]}function debug(namespace){function disabled(){}function enabled(){var self=enabled,curr=+new Date,ms=curr-(prevTime||curr);self.diff=ms,self.prev=prevTime,self.curr=curr,prevTime=curr,null==self.useColors&&(self.useColors=exports.useColors()),null==self.color&&self.useColors&&(self.color=selectColor());var args=Array.prototype.slice.call(arguments);args[0]=exports.coerce(args[0]),"string"!=typeof args[0]&&(args=["%o"].concat(args));var index=0;args[0]=args[0].replace(/%([a-z%])/g,function(match,format){if("%"===match)return match;index++;var formatter=exports.formatters[format];if("function"==typeof formatter){var val=args[index];match=formatter.call(self,val),args.splice(index,1),index--}return match}),"function"==typeof exports.formatArgs&&(args=exports.formatArgs.apply(self,args));var logFn=enabled.log||exports.log||console.log.bind(console);logFn.apply(self,args)}disabled.enabled=!1,enabled.enabled=!0;var fn=exports.enabled(namespace)?enabled:disabled;return fn.namespace=namespace,fn}function enable(namespaces){exports.save(namespaces);for(var split=(namespaces||"").split(/[\s,]+/),len=split.length,i=0;len>i;i++)split[i]&&(namespaces=split[i].replace(/\*/g,".*?"),"-"===namespaces[0]?exports.skips.push(new RegExp("^"+namespaces.substr(1)+"$")):exports.names.push(new RegExp("^"+namespaces+"$")))}function disable(){exports.enable("")}function enabled(name){var i,len;for(i=0,len=exports.skips.length;len>i;i++)if(exports.skips[i].test(name))return!1;for(i=0,len=exports.names.length;len>i;i++)if(exports.names[i].test(name))return!0;return!1}function coerce(val){return val instanceof Error?val.stack||val.message:val}exports=module.exports=debug,exports.coerce=coerce,exports.disable=disable,exports.enable=enable,exports.enabled=enabled,exports.humanize=_dereq_("ms"),exports.names=[],exports.skips=[],exports.formatters={};var prevTime,prevColor=0},{ms:24}],24:[function(_dereq_,module,exports){function parse(str){var match=/^((?:\d+)?\.?\d+) *(ms|seconds?|s|minutes?|m|hours?|h|days?|d|years?|y)?$/i.exec(str);if(match){var n=parseFloat(match[1]),type=(match[2]||"ms").toLowerCase();switch(type){case"years":case"year":case"y":return n*y;case"days":case"day":case"d":return n*d;case"hours":case"hour":case"h":return n*h;case"minutes":case"minute":case"m":return n*m;case"seconds":case"second":case"s":return n*s;case"ms":return n}}}function short(ms){return ms>=d?Math.round(ms/d)+"d":ms>=h?Math.round(ms/h)+"h":ms>=m?Math.round(ms/m)+"m":ms>=s?Math.round(ms/s)+"s":ms+"ms"}function long(ms){return plural(ms,d,"day")||plural(ms,h,"hour")||plural(ms,m,"minute")||plural(ms,s,"second")||ms+" ms"}function plural(ms,n,name){return n>ms?void 0:1.5*n>ms?Math.floor(ms/n)+" "+name:Math.ceil(ms/n)+" "+name+"s"}var s=1e3,m=60*s,h=60*m,d=24*h,y=365.25*d;module.exports=function(val,options){return options=options||{},"string"==typeof val?parse(val):options["long"]?long(val):short(val)}},{}],25:[function(_dereq_,module,exports){(function(global){function encodeBase64Object(packet,callback){var message="b"+exports.packets[packet.type]+packet.data.data;return callback(message)}function encodeArrayBuffer(packet,supportsBinary,callback){if(!supportsBinary)return exports.encodeBase64Packet(packet,callback);var data=packet.data,contentArray=new Uint8Array(data),resultBuffer=new Uint8Array(1+data.byteLength);resultBuffer[0]=packets[packet.type];for(var i=0;i<contentArray.length;i++)resultBuffer[i+1]=contentArray[i];return callback(resultBuffer.buffer)}function encodeBlobAsArrayBuffer(packet,supportsBinary,callback){if(!supportsBinary)return exports.encodeBase64Packet(packet,callback);var fr=new FileReader;return fr.onload=function(){packet.data=fr.result,exports.encodePacket(packet,supportsBinary,!0,callback)},fr.readAsArrayBuffer(packet.data)}function encodeBlob(packet,supportsBinary,callback){if(!supportsBinary)return exports.encodeBase64Packet(packet,callback);if(dontSendBlobs)return encodeBlobAsArrayBuffer(packet,supportsBinary,callback);var length=new Uint8Array(1);length[0]=packets[packet.type];var blob=new Blob([length.buffer,packet.data]);return callback(blob)}function map(ary,each,done){for(var result=new Array(ary.length),next=after(ary.length,done),eachWithIndex=function(i,el,cb){each(el,function(error,msg){result[i]=msg,cb(error,result)})},i=0;i<ary.length;i++)eachWithIndex(i,ary[i],next)}var keys=_dereq_("./keys"),hasBinary=_dereq_("has-binary"),sliceBuffer=_dereq_("arraybuffer.slice"),base64encoder=_dereq_("base64-arraybuffer"),after=_dereq_("after"),utf8=_dereq_("utf8"),isAndroid=navigator.userAgent.match(/Android/i),isPhantomJS=/PhantomJS/i.test(navigator.userAgent),dontSendBlobs=isAndroid||isPhantomJS;exports.protocol=3;var packets=exports.packets={open:0,close:1,ping:2,pong:3,message:4,upgrade:5,noop:6},packetslist=keys(packets),err={type:"error",data:"parser error"},Blob=_dereq_("blob");exports.encodePacket=function(packet,supportsBinary,utf8encode,callback){"function"==typeof supportsBinary&&(callback=supportsBinary,supportsBinary=!1),"function"==typeof utf8encode&&(callback=utf8encode,utf8encode=null);var data=void 0===packet.data?void 0:packet.data.buffer||packet.data;if(global.ArrayBuffer&&data instanceof ArrayBuffer)return encodeArrayBuffer(packet,supportsBinary,callback);if(Blob&&data instanceof global.Blob)return encodeBlob(packet,supportsBinary,callback);if(data&&data.base64)return encodeBase64Object(packet,callback);var encoded=packets[packet.type];return void 0!==packet.data&&(encoded+=utf8encode?utf8.encode(String(packet.data)):String(packet.data)),callback(""+encoded)},exports.encodeBase64Packet=function(packet,callback){var message="b"+exports.packets[packet.type];if(Blob&&packet.data instanceof Blob){var fr=new FileReader;return fr.onload=function(){var b64=fr.result.split(",")[1];callback(message+b64)},fr.readAsDataURL(packet.data)}var b64data;try{b64data=String.fromCharCode.apply(null,new Uint8Array(packet.data))}catch(e){for(var typed=new Uint8Array(packet.data),basic=new Array(typed.length),i=0;i<typed.length;i++)basic[i]=typed[i];b64data=String.fromCharCode.apply(null,basic)}return message+=global.btoa(b64data),callback(message)},exports.decodePacket=function(data,binaryType,utf8decode){if("string"==typeof data||void 0===data){if("b"==data.charAt(0))return exports.decodeBase64Packet(data.substr(1),binaryType);if(utf8decode)try{data=utf8.decode(data)}catch(e){return err}var type=data.charAt(0);return Number(type)==type&&packetslist[type]?data.length>1?{type:packetslist[type],data:data.substring(1)}:{type:packetslist[type]}:err}var asArray=new Uint8Array(data),type=asArray[0],rest=sliceBuffer(data,1);return Blob&&"blob"===binaryType&&(rest=new Blob([rest])),{type:packetslist[type],data:rest}},exports.decodeBase64Packet=function(msg,binaryType){var type=packetslist[msg.charAt(0)];if(!global.ArrayBuffer)return{type:type,data:{base64:!0,data:msg.substr(1)}};var data=base64encoder.decode(msg.substr(1));return"blob"===binaryType&&Blob&&(data=new Blob([data])),{type:type,data:data}},exports.encodePayload=function(packets,supportsBinary,callback){function setLengthHeader(message){return message.length+":"+message}function encodeOne(packet,doneCallback){exports.encodePacket(packet,isBinary?supportsBinary:!1,!0,function(message){doneCallback(null,setLengthHeader(message))})}"function"==typeof supportsBinary&&(callback=supportsBinary,supportsBinary=null);var isBinary=hasBinary(packets);return supportsBinary&&isBinary?Blob&&!dontSendBlobs?exports.encodePayloadAsBlob(packets,callback):exports.encodePayloadAsArrayBuffer(packets,callback):packets.length?void map(packets,encodeOne,function(err,results){return callback(results.join(""))}):callback("0:")},exports.decodePayload=function(data,binaryType,callback){if("string"!=typeof data)return exports.decodePayloadAsBinary(data,binaryType,callback);"function"==typeof binaryType&&(callback=binaryType,binaryType=null);var packet;if(""==data)return callback(err,0,1);for(var n,msg,length="",i=0,l=data.length;l>i;i++){var chr=data.charAt(i);if(":"!=chr)length+=chr;else{if(""==length||length!=(n=Number(length)))return callback(err,0,1);if(msg=data.substr(i+1,n),length!=msg.length)return callback(err,0,1);if(msg.length){if(packet=exports.decodePacket(msg,binaryType,!0),err.type==packet.type&&err.data==packet.data)return callback(err,0,1);var ret=callback(packet,i+n,l);if(!1===ret)return}i+=n,length=""}}return""!=length?callback(err,0,1):void 0},exports.encodePayloadAsArrayBuffer=function(packets,callback){function encodeOne(packet,doneCallback){exports.encodePacket(packet,!0,!0,function(data){return doneCallback(null,data)})}return packets.length?void map(packets,encodeOne,function(err,encodedPackets){var totalLength=encodedPackets.reduce(function(acc,p){var len;return len="string"==typeof p?p.length:p.byteLength,acc+len.toString().length+len+2},0),resultArray=new Uint8Array(totalLength),bufferIndex=0;return encodedPackets.forEach(function(p){var isString="string"==typeof p,ab=p;if(isString){for(var view=new Uint8Array(p.length),i=0;i<p.length;i++)view[i]=p.charCodeAt(i);ab=view.buffer}isString?resultArray[bufferIndex++]=0:resultArray[bufferIndex++]=1;for(var lenStr=ab.byteLength.toString(),i=0;i<lenStr.length;i++)resultArray[bufferIndex++]=parseInt(lenStr[i]);resultArray[bufferIndex++]=255;for(var view=new Uint8Array(ab),i=0;i<view.length;i++)resultArray[bufferIndex++]=view[i]}),callback(resultArray.buffer)}):callback(new ArrayBuffer(0))},exports.encodePayloadAsBlob=function(packets,callback){function encodeOne(packet,doneCallback){exports.encodePacket(packet,!0,!0,function(encoded){var binaryIdentifier=new Uint8Array(1);if(binaryIdentifier[0]=1,"string"==typeof encoded){for(var view=new Uint8Array(encoded.length),i=0;i<encoded.length;i++)view[i]=encoded.charCodeAt(i);encoded=view.buffer,binaryIdentifier[0]=0}for(var len=encoded instanceof ArrayBuffer?encoded.byteLength:encoded.size,lenStr=len.toString(),lengthAry=new Uint8Array(lenStr.length+1),i=0;i<lenStr.length;i++)lengthAry[i]=parseInt(lenStr[i]);if(lengthAry[lenStr.length]=255,Blob){var blob=new Blob([binaryIdentifier.buffer,lengthAry.buffer,encoded]);doneCallback(null,blob)}})}map(packets,encodeOne,function(err,results){return callback(new Blob(results))})},exports.decodePayloadAsBinary=function(data,binaryType,callback){"function"==typeof binaryType&&(callback=binaryType,binaryType=null);for(var bufferTail=data,buffers=[],numberTooLong=!1;bufferTail.byteLength>0;){for(var tailArray=new Uint8Array(bufferTail),isString=0===tailArray[0],msgLength="",i=1;255!=tailArray[i];i++){if(msgLength.length>310){numberTooLong=!0;break}msgLength+=tailArray[i]}if(numberTooLong)return callback(err,0,1);bufferTail=sliceBuffer(bufferTail,2+msgLength.length),msgLength=parseInt(msgLength);var msg=sliceBuffer(bufferTail,0,msgLength);if(isString)try{msg=String.fromCharCode.apply(null,new Uint8Array(msg))}catch(e){var typed=new Uint8Array(msg);msg="";for(var i=0;i<typed.length;i++)msg+=String.fromCharCode(typed[i])}buffers.push(msg),bufferTail=sliceBuffer(bufferTail,msgLength)}var total=buffers.length;buffers.forEach(function(buffer,i){callback(exports.decodePacket(buffer,binaryType,!0),i,total)})}}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./keys":26,after:27,"arraybuffer.slice":28,"base64-arraybuffer":29,blob:30,"has-binary":31,utf8:33}],26:[function(_dereq_,module,exports){module.exports=Object.keys||function(obj){var arr=[],has=Object.prototype.hasOwnProperty;for(var i in obj)has.call(obj,i)&&arr.push(i);return arr}},{}],27:[function(_dereq_,module,exports){function after(count,callback,err_cb){function proxy(err,result){if(proxy.count<=0)throw new Error("after called too many times");--proxy.count,err?(bail=!0,callback(err),callback=err_cb):0!==proxy.count||bail||callback(null,result)}var bail=!1;return err_cb=err_cb||noop,proxy.count=count,0===count?callback():proxy}function noop(){}module.exports=after},{}],28:[function(_dereq_,module,exports){module.exports=function(arraybuffer,start,end){var bytes=arraybuffer.byteLength;if(start=start||0,end=end||bytes,arraybuffer.slice)return arraybuffer.slice(start,end);if(0>start&&(start+=bytes),0>end&&(end+=bytes),end>bytes&&(end=bytes),start>=bytes||start>=end||0===bytes)return new ArrayBuffer(0);for(var abv=new Uint8Array(arraybuffer),result=new Uint8Array(end-start),i=start,ii=0;end>i;i++,ii++)result[ii]=abv[i];return result.buffer}},{}],29:[function(_dereq_,module,exports){!function(chars){"use strict";exports.encode=function(arraybuffer){var i,bytes=new Uint8Array(arraybuffer),len=bytes.length,base64="";for(i=0;len>i;i+=3)base64+=chars[bytes[i]>>2],base64+=chars[(3&bytes[i])<<4|bytes[i+1]>>4],base64+=chars[(15&bytes[i+1])<<2|bytes[i+2]>>6],base64+=chars[63&bytes[i+2]];return len%3===2?base64=base64.substring(0,base64.length-1)+"=":len%3===1&&(base64=base64.substring(0,base64.length-2)+"=="),base64},exports.decode=function(base64){var i,encoded1,encoded2,encoded3,encoded4,bufferLength=.75*base64.length,len=base64.length,p=0;"="===base64[base64.length-1]&&(bufferLength--,"="===base64[base64.length-2]&&bufferLength--);var arraybuffer=new ArrayBuffer(bufferLength),bytes=new Uint8Array(arraybuffer);for(i=0;len>i;i+=4)encoded1=chars.indexOf(base64[i]),encoded2=chars.indexOf(base64[i+1]),encoded3=chars.indexOf(base64[i+2]),encoded4=chars.indexOf(base64[i+3]),bytes[p++]=encoded1<<2|encoded2>>4,bytes[p++]=(15&encoded2)<<4|encoded3>>2,bytes[p++]=(3&encoded3)<<6|63&encoded4;return arraybuffer}}("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/")},{}],30:[function(_dereq_,module,exports){(function(global){function BlobBuilderConstructor(ary,options){options=options||{};for(var bb=new BlobBuilder,i=0;i<ary.length;i++)bb.append(ary[i]);return options.type?bb.getBlob(options.type):bb.getBlob()}var BlobBuilder=global.BlobBuilder||global.WebKitBlobBuilder||global.MSBlobBuilder||global.MozBlobBuilder,blobSupported=function(){try{var b=new Blob(["hi"]);return 2==b.size}catch(e){return!1}}(),blobBuilderSupported=BlobBuilder&&BlobBuilder.prototype.append&&BlobBuilder.prototype.getBlob;module.exports=function(){return blobSupported?global.Blob:blobBuilderSupported?BlobBuilderConstructor:void 0}()}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],31:[function(_dereq_,module,exports){(function(global){function hasBinary(data){function _hasBinary(obj){if(!obj)return!1;if(global.Buffer&&global.Buffer.isBuffer(obj)||global.ArrayBuffer&&obj instanceof ArrayBuffer||global.Blob&&obj instanceof Blob||global.File&&obj instanceof File)return!0;if(isArray(obj)){for(var i=0;i<obj.length;i++)if(_hasBinary(obj[i]))return!0}else if(obj&&"object"==typeof obj){obj.toJSON&&(obj=obj.toJSON());for(var key in obj)if(obj.hasOwnProperty(key)&&_hasBinary(obj[key]))return!0}return!1}return _hasBinary(data)}var isArray=_dereq_("isarray");module.exports=hasBinary}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{isarray:32}],32:[function(_dereq_,module,exports){module.exports=Array.isArray||function(arr){return"[object Array]"==Object.prototype.toString.call(arr)}},{}],33:[function(_dereq_,module,exports){(function(global){!function(root){function ucs2decode(string){for(var value,extra,output=[],counter=0,length=string.length;length>counter;)value=string.charCodeAt(counter++),value>=55296&&56319>=value&&length>counter?(extra=string.charCodeAt(counter++),56320==(64512&extra)?output.push(((1023&value)<<10)+(1023&extra)+65536):(output.push(value),counter--)):output.push(value);return output}function ucs2encode(array){for(var value,length=array.length,index=-1,output="";++index<length;)value=array[index],value>65535&&(value-=65536,output+=stringFromCharCode(value>>>10&1023|55296),value=56320|1023&value),output+=stringFromCharCode(value);return output}function createByte(codePoint,shift){return stringFromCharCode(codePoint>>shift&63|128)}function encodeCodePoint(codePoint){if(0==(4294967168&codePoint))return stringFromCharCode(codePoint);var symbol="";return 0==(4294965248&codePoint)?symbol=stringFromCharCode(codePoint>>6&31|192):0==(4294901760&codePoint)?(symbol=stringFromCharCode(codePoint>>12&15|224),symbol+=createByte(codePoint,6)):0==(4292870144&codePoint)&&(symbol=stringFromCharCode(codePoint>>18&7|240),symbol+=createByte(codePoint,12),symbol+=createByte(codePoint,6)),symbol+=stringFromCharCode(63&codePoint|128)}function utf8encode(string){for(var codePoint,codePoints=ucs2decode(string),length=codePoints.length,index=-1,byteString="";++index<length;)codePoint=codePoints[index],byteString+=encodeCodePoint(codePoint);return byteString}function readContinuationByte(){if(byteIndex>=byteCount)throw Error("Invalid byte index");var continuationByte=255&byteArray[byteIndex];if(byteIndex++,128==(192&continuationByte))return 63&continuationByte;throw Error("Invalid continuation byte")}function decodeSymbol(){var byte1,byte2,byte3,byte4,codePoint;if(byteIndex>byteCount)throw Error("Invalid byte index");if(byteIndex==byteCount)return!1;if(byte1=255&byteArray[byteIndex],byteIndex++,0==(128&byte1))return byte1;if(192==(224&byte1)){var byte2=readContinuationByte();if(codePoint=(31&byte1)<<6|byte2,codePoint>=128)return codePoint;throw Error("Invalid continuation byte")}if(224==(240&byte1)){if(byte2=readContinuationByte(),byte3=readContinuationByte(),codePoint=(15&byte1)<<12|byte2<<6|byte3,codePoint>=2048)return codePoint;throw Error("Invalid continuation byte")}if(240==(248&byte1)&&(byte2=readContinuationByte(),byte3=readContinuationByte(),byte4=readContinuationByte(),codePoint=(15&byte1)<<18|byte2<<12|byte3<<6|byte4,codePoint>=65536&&1114111>=codePoint))return codePoint;throw Error("Invalid UTF-8 detected")}function utf8decode(byteString){byteArray=ucs2decode(byteString),byteCount=byteArray.length,byteIndex=0;for(var tmp,codePoints=[];(tmp=decodeSymbol())!==!1;)codePoints.push(tmp);return ucs2encode(codePoints)}var freeExports="object"==typeof exports&&exports,freeModule="object"==typeof module&&module&&module.exports==freeExports&&module,freeGlobal="object"==typeof global&&global;(freeGlobal.global===freeGlobal||freeGlobal.window===freeGlobal)&&(root=freeGlobal);var byteArray,byteCount,byteIndex,stringFromCharCode=String.fromCharCode,utf8={version:"2.0.0",encode:utf8encode,decode:utf8decode};if("function"==typeof define&&"object"==typeof define.amd&&define.amd)define(function(){return utf8});else if(freeExports&&!freeExports.nodeType)if(freeModule)freeModule.exports=utf8;else{var object={},hasOwnProperty=object.hasOwnProperty;for(var key in utf8)hasOwnProperty.call(utf8,key)&&(freeExports[key]=utf8[key])}else root.utf8=utf8}(this)}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],34:[function(_dereq_,module,exports){(function(global){var rvalidchars=/^[\],:{}\s]*$/,rvalidescape=/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,rvalidtokens=/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,rvalidbraces=/(?:^|:|,)(?:\s*\[)+/g,rtrimLeft=/^\s+/,rtrimRight=/\s+$/;module.exports=function(data){return"string"==typeof data&&data?(data=data.replace(rtrimLeft,"").replace(rtrimRight,""),global.JSON&&JSON.parse?JSON.parse(data):rvalidchars.test(data.replace(rvalidescape,"@").replace(rvalidtokens,"]").replace(rvalidbraces,""))?new Function("return "+data)():void 0):null}}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],35:[function(_dereq_,module,exports){exports.encode=function(obj){var str="";for(var i in obj)obj.hasOwnProperty(i)&&(str.length&&(str+="&"),str+=encodeURIComponent(i)+"="+encodeURIComponent(obj[i]));return str},exports.decode=function(qs){for(var qry={},pairs=qs.split("&"),i=0,l=pairs.length;l>i;i++){var pair=pairs[i].split("=");qry[decodeURIComponent(pair[0])]=decodeURIComponent(pair[1])}return qry}},{}],36:[function(_dereq_,module,exports){var re=/^(?:(?![^:@]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,parts=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];module.exports=function(str){var src=str,b=str.indexOf("["),e=str.indexOf("]");-1!=b&&-1!=e&&(str=str.substring(0,b)+str.substring(b,e).replace(/:/g,";")+str.substring(e,str.length));for(var m=re.exec(str||""),uri={},i=14;i--;)uri[parts[i]]=m[i]||"";return-1!=b&&-1!=e&&(uri.source=src,uri.host=uri.host.substring(1,uri.host.length-1).replace(/;/g,":"),uri.authority=uri.authority.replace("[","").replace("]","").replace(/;/g,":"),uri.ipv6uri=!0),uri}},{}],37:[function(_dereq_,module,exports){function ws(uri,protocols,opts){var instance;return instance=protocols?new WebSocket(uri,protocols):new WebSocket(uri)}var global=function(){return this}(),WebSocket=global.WebSocket||global.MozWebSocket;module.exports=WebSocket?ws:null,WebSocket&&(ws.prototype=WebSocket.prototype)},{}],38:[function(_dereq_,module,exports){(function(global){function hasBinary(data){function _hasBinary(obj){if(!obj)return!1;if(global.Buffer&&global.Buffer.isBuffer(obj)||global.ArrayBuffer&&obj instanceof ArrayBuffer||global.Blob&&obj instanceof Blob||global.File&&obj instanceof File)return!0;if(isArray(obj)){for(var i=0;i<obj.length;i++)if(_hasBinary(obj[i]))return!0}else if(obj&&"object"==typeof obj){obj.toJSON&&(obj=obj.toJSON());for(var key in obj)if(Object.prototype.hasOwnProperty.call(obj,key)&&_hasBinary(obj[key]))return!0}return!1}return _hasBinary(data)}var isArray=_dereq_("isarray");module.exports=hasBinary}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{isarray:39}],39:[function(_dereq_,module,exports){module.exports=_dereq_(32)},{}],40:[function(_dereq_,module,exports){var global=_dereq_("global");try{module.exports="XMLHttpRequest"in global&&"withCredentials"in new global.XMLHttpRequest}catch(err){module.exports=!1}},{global:41}],41:[function(_dereq_,module,exports){module.exports=function(){return this}()},{}],42:[function(_dereq_,module,exports){var indexOf=[].indexOf;module.exports=function(arr,obj){if(indexOf)return arr.indexOf(obj);for(var i=0;i<arr.length;++i)if(arr[i]===obj)return i;return-1}},{}],43:[function(_dereq_,module,exports){var has=Object.prototype.hasOwnProperty;exports.keys=Object.keys||function(obj){var keys=[];for(var key in obj)has.call(obj,key)&&keys.push(key);return keys},exports.values=function(obj){var vals=[];for(var key in obj)has.call(obj,key)&&vals.push(obj[key]);return vals},exports.merge=function(a,b){for(var key in b)has.call(b,key)&&(a[key]=b[key]);return a},exports.length=function(obj){return exports.keys(obj).length},exports.isEmpty=function(obj){return 0==exports.length(obj)}},{}],44:[function(_dereq_,module,exports){var re=/^(?:(?![^:@]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,parts=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];module.exports=function(str){for(var m=re.exec(str||""),uri={},i=14;i--;)uri[parts[i]]=m[i]||"";return uri}},{}],45:[function(_dereq_,module,exports){(function(global){var isArray=_dereq_("isarray"),isBuf=_dereq_("./is-buffer");exports.deconstructPacket=function(packet){function _deconstructPacket(data){if(!data)return data;if(isBuf(data)){var placeholder={_placeholder:!0,num:buffers.length};return buffers.push(data),placeholder}if(isArray(data)){for(var newData=new Array(data.length),i=0;i<data.length;i++)newData[i]=_deconstructPacket(data[i]);return newData}if("object"==typeof data&&!(data instanceof Date)){var newData={};for(var key in data)newData[key]=_deconstructPacket(data[key]);return newData}return data}var buffers=[],packetData=packet.data,pack=packet;return pack.data=_deconstructPacket(packetData),pack.attachments=buffers.length,{packet:pack,buffers:buffers}},exports.reconstructPacket=function(packet,buffers){function _reconstructPacket(data){if(data&&data._placeholder){var buf=buffers[data.num];return buf}if(isArray(data)){for(var i=0;i<data.length;i++)data[i]=_reconstructPacket(data[i]);return data}if(data&&"object"==typeof data){for(var key in data)data[key]=_reconstructPacket(data[key]);return data}return data}return packet.data=_reconstructPacket(packet.data),packet.attachments=void 0,packet},exports.removeBlobs=function(data,callback){function _removeBlobs(obj,curKey,containingObject){if(!obj)return obj;if(global.Blob&&obj instanceof Blob||global.File&&obj instanceof File){pendingBlobs++;var fileReader=new FileReader;fileReader.onload=function(){containingObject?containingObject[curKey]=this.result:bloblessData=this.result,--pendingBlobs||callback(bloblessData)},fileReader.readAsArrayBuffer(obj)}else if(isArray(obj))for(var i=0;i<obj.length;i++)_removeBlobs(obj[i],i,obj);else if(obj&&"object"==typeof obj&&!isBuf(obj))for(var key in obj)_removeBlobs(obj[key],key,obj)}var pendingBlobs=0,bloblessData=data;_removeBlobs(bloblessData),pendingBlobs||callback(bloblessData)}}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./is-buffer":47,isarray:48}],46:[function(_dereq_,module,exports){function Encoder(){}function encodeAsString(obj){var str="",nsp=!1;return str+=obj.type,(exports.BINARY_EVENT==obj.type||exports.BINARY_ACK==obj.type)&&(str+=obj.attachments,str+="-"),obj.nsp&&"/"!=obj.nsp&&(nsp=!0,str+=obj.nsp),null!=obj.id&&(nsp&&(str+=",",nsp=!1),str+=obj.id),null!=obj.data&&(nsp&&(str+=","),str+=json.stringify(obj.data)),debug("encoded %j as %s",obj,str),str}function encodeAsBinary(obj,callback){function writeEncoding(bloblessData){var deconstruction=binary.deconstructPacket(bloblessData),pack=encodeAsString(deconstruction.packet),buffers=deconstruction.buffers;buffers.unshift(pack),callback(buffers)}binary.removeBlobs(obj,writeEncoding)}function Decoder(){this.reconstructor=null}function decodeString(str){var p={},i=0;if(p.type=Number(str.charAt(0)),null==exports.types[p.type])return error();if(exports.BINARY_EVENT==p.type||exports.BINARY_ACK==p.type){for(var buf="";"-"!=str.charAt(++i)&&(buf+=str.charAt(i),i+1!=str.length););if(buf!=Number(buf)||"-"!=str.charAt(i))throw new Error("Illegal attachments");p.attachments=Number(buf)}if("/"==str.charAt(i+1))for(p.nsp="";++i;){var c=str.charAt(i);if(","==c)break;if(p.nsp+=c,i+1==str.length)break}else p.nsp="/";var next=str.charAt(i+1);if(""!==next&&Number(next)==next){for(p.id="";++i;){var c=str.charAt(i);if(null==c||Number(c)!=c){--i;break}if(p.id+=str.charAt(i),i+1==str.length)break}p.id=Number(p.id)}if(str.charAt(++i))try{p.data=json.parse(str.substr(i))}catch(e){return error()}return debug("decoded %s as %j",str,p),p}function BinaryReconstructor(packet){this.reconPack=packet,this.buffers=[]}function error(data){return{type:exports.ERROR,data:"parser error"}}var debug=_dereq_("debug")("socket.io-parser"),json=_dereq_("json3"),Emitter=(_dereq_("isarray"),_dereq_("component-emitter")),binary=_dereq_("./binary"),isBuf=_dereq_("./is-buffer");exports.protocol=4,exports.types=["CONNECT","DISCONNECT","EVENT","BINARY_EVENT","ACK","BINARY_ACK","ERROR"],exports.CONNECT=0,exports.DISCONNECT=1,exports.EVENT=2,exports.ACK=3,exports.ERROR=4,exports.BINARY_EVENT=5,exports.BINARY_ACK=6,exports.Encoder=Encoder,exports.Decoder=Decoder,Encoder.prototype.encode=function(obj,callback){if(debug("encoding packet %j",obj),exports.BINARY_EVENT==obj.type||exports.BINARY_ACK==obj.type)encodeAsBinary(obj,callback);else{var encoding=encodeAsString(obj);callback([encoding])}},Emitter(Decoder.prototype),Decoder.prototype.add=function(obj){var packet;if("string"==typeof obj)packet=decodeString(obj),exports.BINARY_EVENT==packet.type||exports.BINARY_ACK==packet.type?(this.reconstructor=new BinaryReconstructor(packet),0===this.reconstructor.reconPack.attachments&&this.emit("decoded",packet)):this.emit("decoded",packet);else{if(!isBuf(obj)&&!obj.base64)throw new Error("Unknown type: "+obj);if(!this.reconstructor)throw new Error("got binary data when not reconstructing a packet");
packet=this.reconstructor.takeBinaryData(obj),packet&&(this.reconstructor=null,this.emit("decoded",packet))}},Decoder.prototype.destroy=function(){this.reconstructor&&this.reconstructor.finishedReconstruction()},BinaryReconstructor.prototype.takeBinaryData=function(binData){if(this.buffers.push(binData),this.buffers.length==this.reconPack.attachments){var packet=binary.reconstructPacket(this.reconPack,this.buffers);return this.finishedReconstruction(),packet}return null},BinaryReconstructor.prototype.finishedReconstruction=function(){this.reconPack=null,this.buffers=[]}},{"./binary":45,"./is-buffer":47,"component-emitter":9,debug:10,isarray:48,json3:49}],47:[function(_dereq_,module,exports){(function(global){function isBuf(obj){return global.Buffer&&global.Buffer.isBuffer(obj)||global.ArrayBuffer&&obj instanceof ArrayBuffer}module.exports=isBuf}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],48:[function(_dereq_,module,exports){module.exports=_dereq_(32)},{}],49:[function(_dereq_,module,exports){!function(window){function has(name){if(has[name]!==undef)return has[name];var isSupported;if("bug-string-char-index"==name)isSupported="a"!="a"[0];else if("json"==name)isSupported=has("json-stringify")&&has("json-parse");else{var value,serialized='{"a":[1,true,false,null,"\\u0000\\b\\n\\f\\r\\t"]}';if("json-stringify"==name){var stringify=JSON3.stringify,stringifySupported="function"==typeof stringify&&isExtended;if(stringifySupported){(value=function(){return 1}).toJSON=value;try{stringifySupported="0"===stringify(0)&&"0"===stringify(new Number)&&'""'==stringify(new String)&&stringify(getClass)===undef&&stringify(undef)===undef&&stringify()===undef&&"1"===stringify(value)&&"[1]"==stringify([value])&&"[null]"==stringify([undef])&&"null"==stringify(null)&&"[null,null,null]"==stringify([undef,getClass,null])&&stringify({a:[value,!0,!1,null,"\x00\b\n\f\r	"]})==serialized&&"1"===stringify(null,value)&&"[\n 1,\n 2\n]"==stringify([1,2],null,1)&&'"-271821-04-20T00:00:00.000Z"'==stringify(new Date(-864e13))&&'"+275760-09-13T00:00:00.000Z"'==stringify(new Date(864e13))&&'"-000001-01-01T00:00:00.000Z"'==stringify(new Date(-621987552e5))&&'"1969-12-31T23:59:59.999Z"'==stringify(new Date(-1))}catch(exception){stringifySupported=!1}}isSupported=stringifySupported}if("json-parse"==name){var parse=JSON3.parse;if("function"==typeof parse)try{if(0===parse("0")&&!parse(!1)){value=parse(serialized);var parseSupported=5==value.a.length&&1===value.a[0];if(parseSupported){try{parseSupported=!parse('"	"')}catch(exception){}if(parseSupported)try{parseSupported=1!==parse("01")}catch(exception){}if(parseSupported)try{parseSupported=1!==parse("1.")}catch(exception){}}}}catch(exception){parseSupported=!1}isSupported=parseSupported}}return has[name]=!!isSupported}var isProperty,forEach,undef,getClass={}.toString,isLoader="function"==typeof define&&define.amd,nativeJSON="object"==typeof JSON&&JSON,JSON3="object"==typeof exports&&exports&&!exports.nodeType&&exports;JSON3&&nativeJSON?(JSON3.stringify=nativeJSON.stringify,JSON3.parse=nativeJSON.parse):JSON3=window.JSON=nativeJSON||{};var isExtended=new Date(-0xc782b5b800cec);try{isExtended=-109252==isExtended.getUTCFullYear()&&0===isExtended.getUTCMonth()&&1===isExtended.getUTCDate()&&10==isExtended.getUTCHours()&&37==isExtended.getUTCMinutes()&&6==isExtended.getUTCSeconds()&&708==isExtended.getUTCMilliseconds()}catch(exception){}if(!has("json")){var functionClass="[object Function]",dateClass="[object Date]",numberClass="[object Number]",stringClass="[object String]",arrayClass="[object Array]",booleanClass="[object Boolean]",charIndexBuggy=has("bug-string-char-index");if(!isExtended)var floor=Math.floor,Months=[0,31,59,90,120,151,181,212,243,273,304,334],getDay=function(year,month){return Months[month]+365*(year-1970)+floor((year-1969+(month=+(month>1)))/4)-floor((year-1901+month)/100)+floor((year-1601+month)/400)};(isProperty={}.hasOwnProperty)||(isProperty=function(property){var constructor,members={};return(members.__proto__=null,members.__proto__={toString:1},members).toString!=getClass?isProperty=function(property){var original=this.__proto__,result=property in(this.__proto__=null,this);return this.__proto__=original,result}:(constructor=members.constructor,isProperty=function(property){var parent=(this.constructor||constructor).prototype;return property in this&&!(property in parent&&this[property]===parent[property])}),members=null,isProperty.call(this,property)});var PrimitiveTypes={"boolean":1,number:1,string:1,undefined:1},isHostType=function(object,property){var type=typeof object[property];return"object"==type?!!object[property]:!PrimitiveTypes[type]};if(forEach=function(object,callback){var Properties,members,property,size=0;(Properties=function(){this.valueOf=0}).prototype.valueOf=0,members=new Properties;for(property in members)isProperty.call(members,property)&&size++;return Properties=members=null,size?forEach=2==size?function(object,callback){var property,members={},isFunction=getClass.call(object)==functionClass;for(property in object)isFunction&&"prototype"==property||isProperty.call(members,property)||!(members[property]=1)||!isProperty.call(object,property)||callback(property)}:function(object,callback){var property,isConstructor,isFunction=getClass.call(object)==functionClass;for(property in object)isFunction&&"prototype"==property||!isProperty.call(object,property)||(isConstructor="constructor"===property)||callback(property);(isConstructor||isProperty.call(object,property="constructor"))&&callback(property)}:(members=["valueOf","toString","toLocaleString","propertyIsEnumerable","isPrototypeOf","hasOwnProperty","constructor"],forEach=function(object,callback){var property,length,isFunction=getClass.call(object)==functionClass,hasProperty=!isFunction&&"function"!=typeof object.constructor&&isHostType(object,"hasOwnProperty")?object.hasOwnProperty:isProperty;for(property in object)isFunction&&"prototype"==property||!hasProperty.call(object,property)||callback(property);for(length=members.length;property=members[--length];hasProperty.call(object,property)&&callback(property));}),forEach(object,callback)},!has("json-stringify")){var Escapes={92:"\\\\",34:'\\"',8:"\\b",12:"\\f",10:"\\n",13:"\\r",9:"\\t"},leadingZeroes="000000",toPaddedString=function(width,value){return(leadingZeroes+(value||0)).slice(-width)},unicodePrefix="\\u00",quote=function(value){var symbols,result='"',index=0,length=value.length,isLarge=length>10&&charIndexBuggy;for(isLarge&&(symbols=value.split(""));length>index;index++){var charCode=value.charCodeAt(index);switch(charCode){case 8:case 9:case 10:case 12:case 13:case 34:case 92:result+=Escapes[charCode];break;default:if(32>charCode){result+=unicodePrefix+toPaddedString(2,charCode.toString(16));break}result+=isLarge?symbols[index]:charIndexBuggy?value.charAt(index):value[index]}}return result+'"'},serialize=function(property,object,callback,properties,whitespace,indentation,stack){var value,className,year,month,date,time,hours,minutes,seconds,milliseconds,results,element,index,length,prefix,result;try{value=object[property]}catch(exception){}if("object"==typeof value&&value)if(className=getClass.call(value),className!=dateClass||isProperty.call(value,"toJSON"))"function"==typeof value.toJSON&&(className!=numberClass&&className!=stringClass&&className!=arrayClass||isProperty.call(value,"toJSON"))&&(value=value.toJSON(property));else if(value>-1/0&&1/0>value){if(getDay){for(date=floor(value/864e5),year=floor(date/365.2425)+1970-1;getDay(year+1,0)<=date;year++);for(month=floor((date-getDay(year,0))/30.42);getDay(year,month+1)<=date;month++);date=1+date-getDay(year,month),time=(value%864e5+864e5)%864e5,hours=floor(time/36e5)%24,minutes=floor(time/6e4)%60,seconds=floor(time/1e3)%60,milliseconds=time%1e3}else year=value.getUTCFullYear(),month=value.getUTCMonth(),date=value.getUTCDate(),hours=value.getUTCHours(),minutes=value.getUTCMinutes(),seconds=value.getUTCSeconds(),milliseconds=value.getUTCMilliseconds();value=(0>=year||year>=1e4?(0>year?"-":"+")+toPaddedString(6,0>year?-year:year):toPaddedString(4,year))+"-"+toPaddedString(2,month+1)+"-"+toPaddedString(2,date)+"T"+toPaddedString(2,hours)+":"+toPaddedString(2,minutes)+":"+toPaddedString(2,seconds)+"."+toPaddedString(3,milliseconds)+"Z"}else value=null;if(callback&&(value=callback.call(object,property,value)),null===value)return"null";if(className=getClass.call(value),className==booleanClass)return""+value;if(className==numberClass)return value>-1/0&&1/0>value?""+value:"null";if(className==stringClass)return quote(""+value);if("object"==typeof value){for(length=stack.length;length--;)if(stack[length]===value)throw TypeError();if(stack.push(value),results=[],prefix=indentation,indentation+=whitespace,className==arrayClass){for(index=0,length=value.length;length>index;index++)element=serialize(index,value,callback,properties,whitespace,indentation,stack),results.push(element===undef?"null":element);result=results.length?whitespace?"[\n"+indentation+results.join(",\n"+indentation)+"\n"+prefix+"]":"["+results.join(",")+"]":"[]"}else forEach(properties||value,function(property){var element=serialize(property,value,callback,properties,whitespace,indentation,stack);element!==undef&&results.push(quote(property)+":"+(whitespace?" ":"")+element)}),result=results.length?whitespace?"{\n"+indentation+results.join(",\n"+indentation)+"\n"+prefix+"}":"{"+results.join(",")+"}":"{}";return stack.pop(),result}};JSON3.stringify=function(source,filter,width){var whitespace,callback,properties,className;if("function"==typeof filter||"object"==typeof filter&&filter)if((className=getClass.call(filter))==functionClass)callback=filter;else if(className==arrayClass){properties={};for(var value,index=0,length=filter.length;length>index;value=filter[index++],className=getClass.call(value),(className==stringClass||className==numberClass)&&(properties[value]=1));}if(width)if((className=getClass.call(width))==numberClass){if((width-=width%1)>0)for(whitespace="",width>10&&(width=10);whitespace.length<width;whitespace+=" ");}else className==stringClass&&(whitespace=width.length<=10?width:width.slice(0,10));return serialize("",(value={},value[""]=source,value),callback,properties,whitespace,"",[])}}if(!has("json-parse")){var Index,Source,fromCharCode=String.fromCharCode,Unescapes={92:"\\",34:'"',47:"/",98:"\b",116:"	",110:"\n",102:"\f",114:"\r"},abort=function(){throw Index=Source=null,SyntaxError()},lex=function(){for(var value,begin,position,isSigned,charCode,source=Source,length=source.length;length>Index;)switch(charCode=source.charCodeAt(Index)){case 9:case 10:case 13:case 32:Index++;break;case 123:case 125:case 91:case 93:case 58:case 44:return value=charIndexBuggy?source.charAt(Index):source[Index],Index++,value;case 34:for(value="@",Index++;length>Index;)if(charCode=source.charCodeAt(Index),32>charCode)abort();else if(92==charCode)switch(charCode=source.charCodeAt(++Index)){case 92:case 34:case 47:case 98:case 116:case 110:case 102:case 114:value+=Unescapes[charCode],Index++;break;case 117:for(begin=++Index,position=Index+4;position>Index;Index++)charCode=source.charCodeAt(Index),charCode>=48&&57>=charCode||charCode>=97&&102>=charCode||charCode>=65&&70>=charCode||abort();value+=fromCharCode("0x"+source.slice(begin,Index));break;default:abort()}else{if(34==charCode)break;for(charCode=source.charCodeAt(Index),begin=Index;charCode>=32&&92!=charCode&&34!=charCode;)charCode=source.charCodeAt(++Index);value+=source.slice(begin,Index)}if(34==source.charCodeAt(Index))return Index++,value;abort();default:if(begin=Index,45==charCode&&(isSigned=!0,charCode=source.charCodeAt(++Index)),charCode>=48&&57>=charCode){for(48==charCode&&(charCode=source.charCodeAt(Index+1),charCode>=48&&57>=charCode)&&abort(),isSigned=!1;length>Index&&(charCode=source.charCodeAt(Index),charCode>=48&&57>=charCode);Index++);if(46==source.charCodeAt(Index)){for(position=++Index;length>position&&(charCode=source.charCodeAt(position),charCode>=48&&57>=charCode);position++);position==Index&&abort(),Index=position}if(charCode=source.charCodeAt(Index),101==charCode||69==charCode){for(charCode=source.charCodeAt(++Index),(43==charCode||45==charCode)&&Index++,position=Index;length>position&&(charCode=source.charCodeAt(position),charCode>=48&&57>=charCode);position++);position==Index&&abort(),Index=position}return+source.slice(begin,Index)}if(isSigned&&abort(),"true"==source.slice(Index,Index+4))return Index+=4,!0;if("false"==source.slice(Index,Index+5))return Index+=5,!1;if("null"==source.slice(Index,Index+4))return Index+=4,null;abort()}return"$"},get=function(value){var results,hasMembers;if("$"==value&&abort(),"string"==typeof value){if("@"==(charIndexBuggy?value.charAt(0):value[0]))return value.slice(1);if("["==value){for(results=[];value=lex(),"]"!=value;hasMembers||(hasMembers=!0))hasMembers&&(","==value?(value=lex(),"]"==value&&abort()):abort()),","==value&&abort(),results.push(get(value));return results}if("{"==value){for(results={};value=lex(),"}"!=value;hasMembers||(hasMembers=!0))hasMembers&&(","==value?(value=lex(),"}"==value&&abort()):abort()),(","==value||"string"!=typeof value||"@"!=(charIndexBuggy?value.charAt(0):value[0])||":"!=lex())&&abort(),results[value.slice(1)]=get(lex());return results}abort()}return value},update=function(source,property,callback){var element=walk(source,property,callback);element===undef?delete source[property]:source[property]=element},walk=function(source,property,callback){var length,value=source[property];if("object"==typeof value&&value)if(getClass.call(value)==arrayClass)for(length=value.length;length--;)update(value,length,callback);else forEach(value,function(property){update(value,property,callback)});return callback.call(source,property,value)};JSON3.parse=function(source,callback){var result,value;return Index=0,Source=""+source,result=get(lex()),"$"!=lex()&&abort(),Index=Source=null,callback&&getClass.call(callback)==functionClass?walk((value={},value[""]=result,value),"",callback):result}}}isLoader&&define(function(){return JSON3})}(this)},{}],50:[function(_dereq_,module,exports){function toArray(list,index){var array=[];index=index||0;for(var i=index||0;i<list.length;i++)array[i-index]=list[i];return array}module.exports=toArray},{}]},{},[1])(1)}),angular.module("common-service",[]),angular.module("services.cordova",["ngRoute","services.utility"]),angular.module("services.cordova").service("Calendar",function(){this.createCalendarEvent=function(title,message,startDate,onSuccess,onError){window.plugins.calendar.createEvent(title,null,message,new Date(startDate.getTime()),new Date(startDate.getTime()+6e4),onSuccess,onError)},this.deleteEvent=function(message,startDate,endDate,onSuccess,onError){window.plugins.calendar.deleteEvent(title,null,message,startDate,endDate,onSuccess,onError)},this.findAllEvents=function(onSuccess,onError){this.findEventWithTime(null,null,onSuccess,onError)},this.findEventWithTime=function(startDate,endDate,onSuccess,onError){window.plugins.calendar.findEvent(null,null,null,startDate,endDate,onSuccess,onError)},this.findEventWithFilter=function(title,message,startDate,endDate,onSuccess,onError){window.plugins.calendar.findEvent(title,message,startDate,endDate,onSuccess,onError)}}),angular.module("services.cordova").factory("Contacts",["$q","$rootScope","Utility","Store","Context","Device","SA","Loader",function($q,$rootScope,Utility,Store,Context,Device,SA,Loader){function addContactsToStorage(success,err){var time=Date.now();if(Context.getAccessToken()){var contact=Store.getObject("ContactsDataCache"),threshold=24,redo=!1;if(contact&&((new Date).getTime()-contact.timestamp)/1e3/60/60>threshold&&(redo=!0),!contact||redo){var contacts={timestamp:"",contacts:"",inProcess:1,update:0},options=new ContactFindOptions;options.multiple=!0;var fields=["id","displayName","name","phoneNumbers","emails","ims"];navigator.contacts.find(fields,function(contacts1){console.log("Contacts : "+contacts1.length),contacts.contacts=contacts1,console.log("Saving in LocalStorage"),contacts.timestamp=(new Date).getTime(),contacts.inProcess=0,contacts.update=1,Store.setObject("ContactsDataCache",contacts);var v=Date.now(),diff=new Date(v-time);console.log("Contacts Fetched in "+diff.getSeconds()+" seconds"),success&&success(),synchronizeContacts(contacts)},function(){err&&err()},options)}}}function filterExtraAttribs(contacts){var keys;return contacts.forEach(function(contact){keys=Object.keys(contact),keys.forEach(function(key){"id"!==key&&"displayName"!==key&&"name"!==key&&"phoneNumbers"!==key&&"emails"!==key&&"ims"!==key&&delete contact[key]})}),contacts}function getDeviceContacts(success,err){Store.getObject("ContactsDataCache")?success(Store.getObject("ContactsDataCache")):getAllDeviceContacts(function(contacts){Store.setObject("ContactsDataCache",contacts),success(contacts)},function(errorCode){err&&err(errorCode),Loader.hideLoading()})}function getSyncContacts(success,err){Store.getObject("ContactsDataCache")?success(Store.getObject("ContactsDataCache")):sendAllContactsToServer(success)}function sendAllContactsToServer(callback){Context.getAccessToken()&&getDeviceContacts(function(contacts){contacts=filterExtraAttribs(contacts),callback(contacts),synchronizeContacts(contacts,callback)},function(err){console.log(err),Loader.hideLoading()})}function asyncSendContactChunk(deviceId,contacts,progress){var obj={contacts:JSON.stringify(contacts)};return function(){return SA.contactResource.syncContacts(obj).$promise.then(function(data){data&&(modifiedContacts=0==modifiedContacts.length?data:modifiedContacts.concat(data))},function(data){alert("Syncing was interrupted")})}}function synchronizeContacts(contacts,callback){Device.getDeviceId().then(function(udid){if(!udid)throw callback([]),new Error("cannot sync contacts without a device id");for(var prms=null,progress=0,chunks=Utility.chunk(contacts,100),i=0;i<chunks.length;i++){progress+=chunks[i].length;var p=asyncSendContactChunk(udid,chunks[i],progress);prms=prms?prms.then(p):p()}prms.then(function(){modifiedContacts.length&&(callback(modifiedContacts),Store.setObject("ContactsDataCache",modifiedContacts),modifiedContacts=[])})})}function getAllDeviceContacts(success,failure){var options=new ContactFindOptions;options.multiple=!0;var fields=["id","displayName","name","phoneNumbers","emails","ims","groupMembership","account"];navigator.contacts.find(fields,function(mycontacts){mycontacts=processContacts(mycontacts),deviceContacts=mycontacts,success(mycontacts)},failure,options)}function processContacts(contactsArray){/Android/i.test(navigator.userAgent)?contactsArray.sort(cSortFirstName):contactsArray.sort(cSort);for(var deleteContacts=[],i=0;i<contactsArray.length;i++){var contact=contactsArray[i];try{contactsArray[i]=processName(contact)}catch(ex){console.log("Error in processing contact name"+ex)}/Android/i.test(navigator.userAgent)?contact.inGroup=contact.groupMembership&&-1!=contact.groupMembership?!0:!1:contact.inGroup=!0,isEmpty(contact)&&deleteContacts.push(i)}for(var k=deleteContacts.length-1;k>=0;k--)contactsArray.splice(deleteContacts[k],1);for(var i=0;i<contactsArray.length;i++)contactsArray[i].mainIndex=i;return contactsArray}function isEmpty(contact){return contact.phoneNumbers&&contact.phoneNumbers.length||contact.emails&&contact.emails.length?!1:!0}function processName(contact){return contact.name||(contact.name={}),contact.name.fullName=getFullName(contact),contact.name.fullName?(/Android/i.test(navigator.userAgent)?contact.name.firstLetter=getFirstLetterFirstName(contact):contact.name.firstLetter=getFirstLetterLastName(contact),contact.displayedName=contact.name.fullName.toLowerCase()):(contact.name.firstLetter="#",contact.phoneNumbers&&contact.phoneNumbers.length?fullName=contact.phoneNumbers[0].value:contact.emails&&contact.emails.length&&(fullName=contact.emails[0].value,alphabetRegex.test(fullName.substr(0,1))&&(contact.name.firstLetter=fullName.substr(0,1).toUpperCase()||"#")),contact.displayName=fullName,contact.displayedName=fullName.toLowerCase()),contact}function getFirstLetterLastName(contact){return contact.name.familyName?alphabetRegex.test(contact.name.familyName.substr(0,1))?contact.name.familyName.substr(0,1).toUpperCase()||"#":"#":alphabetRegex.test(contact.name.givenName.substr(0,1))?contact.name.givenName.substr(0,1).toUpperCase()||"#":"#"}function getFirstLetterFirstName(contact){return contact.name.givenName?alphabetRegex.test(contact.name.givenName.substr(0,1))?contact.name.givenName.substr(0,1).toUpperCase()||"#":"#":alphabetRegex.test(contact.name.familyName.substr(0,1))?contact.name.familyName.substr(0,1).toUpperCase()||"#":"#"}function getFullName(contact){var firstname="",lastname="";return contact.name?(firstname=contact.name.givenName?contact.name.givenName.trim():null,lastname=contact.name.familyName?contact.name.familyName.trim():null,firstname&&lastname?firstname+" "+lastname:firstname?firstname:lastname):""}function cSort(a,b){var result=returnName(a).localeCompare(returnName(b));return a&&b&&a.name&&b.name&&a.name.familyName&&b.name.familyName&&a.name.familyName.toLowerCase()==b.name.familyName.toLowerCase()&&a.name.givenName&&b.name.givenName&&(result=a.name.givenName.toLowerCase().localeCompare(b.name.givenName.toLowerCase())),result}function cSortFirstName(a,b){return returnNameCombined(a).localeCompare(returnNameCombined(b))}function returnNameCombined(contact){var name="";return contact&&(contact.name?(contact.name.givenName&&(name=contact.name.givenName.toLowerCase()),contact.name.familyName&&(name=name?name+" "+contact.name.familyName.toLowerCase():contact.name.familyName.toLowerCase())):contact.phoneNumbers&&contact.phoneNumbers[0]&&contact.phoneNumbers[0].value?name=contact.phoneNumbers[0].value:contact.name&&contact.name.firstLetter&&(name=contact.name.firstLetter)),name}function returnName(contact){try{var name="";return contact&&(contact.name?contact.name.familyName?name=contact.name.familyName.toLowerCase():contact.name.givenName&&(name=contact.name.givenName.toLowerCase()):contact.phoneNumbers&&contact.phoneNumbers[0]&&contact.phoneNumbers[0].value?name=contact.phoneNumbers[0].value:contact.name&&contact.name.firstLetter&&(name=contact.name.firstLetter)),name}catch(ex){return console.log("Exception: "+ex.message),""}}function hasPermission(success){getDeviceContacts(function(){success(1)},function(error){success(20===error.code?2:3)})}var deviceContacts,obj={synced:!1,Contacts:{synced:!1,updateContacts:function(success,error){}},addContactsToStorage:addContactsToStorage,Device:{getDeviceId:function(){return Device.getDeviceId()}},hasPermission:hasPermission,sendAllContactsToServer:sendAllContactsToServer,getDeviceContacts:getDeviceContacts,getSyncContacts:getSyncContacts,processContacts:processContacts},modifiedContacts=[],alphabetRegex=/[a-zA-Z]/;return obj}]),angular.module("services.cordova").factory("Device",["$rootScope","DeviceReady","Store","$q",function($rootScope,DeviceReady,Store,$q){var methods={getDeviceId:function(){var defer=$q.defer();return DeviceReady.isReady()?"iOS"==device.platform?Store.getItem("DeviceUUID")?defer.resolve(Store.getItem("DeviceUUID")):wizUniqueIdentifier.get(function(uuid){console.log("uuid "+uuid),Store.setItem("DeviceUUID",uuid),defer.resolve(uuid)},function(err){console.log("error"),defer.resolve(null)}):defer.resolve(device.uuid):defer.resolve(null),defer.promise},getModelName:function(){if(DeviceReady.isReady()){var modelName=device.model||"";return modelName}return null}};return methods}]),angular.module("services.cordova").factory("DeviceReady",["$rootScope","$location","Store",function($rootScope,$location,Store){function registerOtherEvents(){}var deviceReady=!1,allReadyEvents=[],allResumeEvents=[];/Android|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)&&document.addEventListener("deviceready",function(){console.log("device ready"),deviceReady=!0,document.addEventListener("resume",function(){console.log("resume"),allResumeEvents.length&&allResumeEvents.forEach(function(func){setTimeout(function(){func(),$rootScope.$digest()},0)})},!1),allReadyEvents.length&&allReadyEvents.forEach(function(func){setTimeout(function(){func(),$rootScope.$digest()},0)}),registerOtherEvents()},!1);var methods={isReady:function(){return deviceReady},registerReadyEvents:function(func){"function"==typeof func&&allReadyEvents.push(func)},registerResumeEvents:function(func){"function"==typeof func&&allResumeEvents.push(func)}};return methods}]),angular.module("services.cordova").service("dialog",["$timeout",function($timeout){var dialog=navigator.notification,alert=function(message,cb,btnName){dialog.alert(message,cb,"RemindZapp",btnName||"OK")},confirm=function(message,cbFunctionsArray,btns,onCancel){var cb=function(btn){$timeout(function(){var run=cbFunctionsArray[btn-1]||onCancel;run&&run()},0)};navigator.notification.confirm(message,cb,"RemindZapp",btns)};this.alert=alert,this.confirm=confirm}]),angular.module("services.cordova").factory("Keyboard",function(){var removeEventListener=function(from,func){window.removeEventListener(from,func)},keyboard={isVisible:function(){return void 0!==cordova.plugins?cordova.plugins.Keyboard.isVisible:!1},hideAccessory:function(hide,callback){cordova.plugins.Keyboard.hideKeyboardAccessoryBar(hide),callback&&callback()},close:function(callback){cordova.plugins.Keyboard.close(),callback&&callback()},disableScroll:function(disable,callback){cordova.plugins.Keyboard.disableScroll(disable),callback&&callback()},show:function(callback){cordova.plugins.Keyboard.show(),callback&&callback()},addEventListenerOnShow:function(func){window.addEventListener("native.keyboardshow",func)},addEventListenerOnHide:function(func){window.addEventListener("native.keyboardhide",func)},removeEventListenerOnShow:function(func){removeEventListener("native.keyboardshow",func)},removeEventListenerOnHide:function(func){removeEventListener("native.keyboardhide",func)}};return keyboard}),angular.module("services.cordova").service("PushNotification",["$rootScope","$location","Store","SA","$timeout","Device",function($rootScope,$location,Store,SA,$timeout,Device){function setDeviceToken(data){Device.getDeviceId().then(function(udid){udid&&(data.deviceToken.deviceId=udid,data.deviceToken.deviceName=Device.getModelName()||"",data.deviceToken=JSON.stringify(data.deviceToken),SA.loginResource.registerPush(JSON.stringify(data)).$promise.then(function(e){console.log("push register success: "+e)},function(e){console.log("push register error: "+e)}))})}this.pushNotification={};var tokenHandler=function(result){var data={value:result,type:"APN"};setDeviceToken({deviceToken:data})},successHandler=function(e){};window.onNotificationGCM=function(e){switch(e.event){case"registered":if(e.regid.length>0){var data={value:e.regid,type:"GCM"};setDeviceToken({deviceToken:data})}break;case"message":console.log("A message is received via push"),console.log(e),console.log(e.payload);var payload=e.payload;payload&&payload.data&&payload.data.reminderStatusId&&0==e.foreground&&$timeout(function(){var type="ACK"===payload.data.type?"Requested":"My";$location.path("/reminderDetail/"+type+"/"+payload.data.reminderStatusId)});break;case"error":console.log("There is an error occured with the push")}};var errorHandler=function(error){alert("error = "+error)};this.register=function(){"android"==device.platform||"Android"==device.platform?window.plugins.pushNotification.register(successHandler,errorHandler,{senderID:"719432972976",ecb:"onNotificationGCM"}):window.plugins.pushNotification.register(tokenHandler,errorHandler,{badge:"true",sound:"true",alert:"true",ecb:"onNotificationAPN"})},this.unregister=function(){window.plugins.pushNotification.unregister(successHandler,errorHandler)},window.onNotificationAPN=function(event){event.alert,"0"===event.foreground&&event.reminderStatusId&&$timeout(function(){var type="ACK"===event.type?"Requested":"My";$location.path("/reminderDetail/"+type+"/"+event.reminderStatusId)}),event.badge&&pushNotification.setApplicationIconBadgeNumber(successHandler,errorHandler,event.badge)}}]),angular.module("DataResource",["ngResource"]).run(["$http",function($http){}]),angular.module("DataResource").factory("ContactsRsrc",["$resource","ResourceInitializer",function($resource,ResourceInitializer){var contactRsrcObj={resource:function(){return $resource(this.url+"/user/synchronizeContacts",{},{syncContacts:{method:"POST",url:this.url+"/user/synchronizeContacts",headers:this.header,isArray:!0}})}};return contactRsrcObj.init=ResourceInitializer.init(contactRsrcObj),contactRsrcObj}]),angular.module("DataResource").factory("GroupRsrc",["$resource","ResourceInitializer",function($resource,ResourceInitializer){var groupRsrcObj={resource:function(){return $resource(this.url+"/user/synchronizeContacts",{},{getAllGroups:{method:"GET",url:this.url+"/group",headers:this.header},getGroup:{method:"GET",url:this.url+"/group/",headers:this.header,params:{groupId:"@groupId"}},getGroupReminders:{method:"GET",url:this.url+"/group/reminders",headers:this.header,params:{groupId:"@groupId"}}})}};return groupRsrcObj.init=ResourceInitializer.init(groupRsrcObj),groupRsrcObj}]),angular.module("DataResource").factory("LoginRsrc",["$resource","ResourceInitializer",function($resource,ResourceInitializer){var loginRsrcObj={resource:function(){return $resource(this.url+"/login",{},{login:{method:"POST"},forgotPass:{method:"POST",url:this.url+"/user/forgot"},registerPush:{method:"POST",url:this.url+"/pushMethod",headers:this.header},getFeedbacks:{method:"GET",url:this.url+"/feedback",headers:this.header,isArray:!0},countFeedbacks:{method:"GET",url:this.url+"/feedback/count",headers:this.header},voteFeedback:{method:"POST",url:this.url+"/feedback/vote/:id",headers:this.header,params:{id:"@id"}},sendFeedback:{method:"POST",url:this.url+"/user/feedback",headers:this.header},logout:{method:"POST",url:this.url+"/logout",headers:this.header}})}};return loginRsrcObj.init=ResourceInitializer.init(loginRsrcObj),loginRsrcObj}]),angular.module("DataResource").factory("ReminderRsrc",["$resource","ResourceInitializer",function($resource,ResourceInitializer){var reminderObj={resource:function(){return $resource(this.url+"/reminder",{},{sendReminder:{method:"POST",url:this.url+"/reminder",headers:this.header},reminderResponse:{method:"POST",url:this.url+"/reminder/request",headers:this.header},getReminder:{method:"GET",url:this.url+"/reminder",headers:this.header,params:{filter:"@filter"},isArray:!0},getAllReminders:{method:"GET",url:this.url+"/reminder",headers:this.header,params:{limit:"@limit"},isArray:!0},getUsersReminderDetail:{method:"GET",url:this.url+"/reminder/users",headers:this.header,params:{reminderId:"@reminderId"}},getSingleReceivedReminder:{method:"GET",url:this.url+"/reminder?filter=IN",headers:this.header,params:{reminderStatusId:"@reminderStatusId",type:"@type"}},getNewReminderDetail:{method:"GET",url:this.url+"/reminder",headers:this.header,params:{reminderId:"@reminderId"}},seenReminder:{method:"POST",url:this.url+"/reminder/ack",headers:this.header}})}};return reminderObj.init=ResourceInitializer.init(reminderObj),reminderObj}]),angular.module("DataResource").service("ResourceInitializer",["Context",function(Context){var baseURL="https://social-alarms.herokuapp.com";this.init=function(x){return function(callbacks){return x.url=baseURL,x.accessToken=Context.getAccessToken(),x.header={Authorization:x.accessToken?x.accessToken:""},x.callbacks=callbacks,x}}}]),angular.module("DataResource").factory("SignUpRsrc",["$resource","ResourceInitializer",function($resource,ResourceInitializer){var signUpRsrcObj={resource:function(){return $resource(this.url+"/signup",{},{signup:{method:"POST"},verify:{method:"POST",url:this.url+"/user/verify",headers:this.header},resedVerifyCode:{method:"POST",url:this.url+"/user/resendVerificationToken"
}})}};return signUpRsrcObj.init=ResourceInitializer.init(signUpRsrcObj),signUpRsrcObj}]),angular.module("DataResource").factory("UserRsrc",["$resource","ResourceInitializer",function($resource,ResourceInitializer){var signUpRsrcObj={resource:function(){return $resource(this.url+"/user",{},{changeName:{method:"POST",url:this.url+"/user/profile",headers:this.header},updateEmail:{method:"POST",url:this.url+"/user/updateEmail",headers:this.header}})}};return signUpRsrcObj.init=ResourceInitializer.init(signUpRsrcObj),signUpRsrcObj}]),angular.module("DataResource").service("FBRsrc",["$q","$http","Utility","Store",function($q,$http,Utility,Store){this.getMyInfo=function(){var deferred=$q.defer();return Utility.isApp()?facebookConnectPlugin.api("/me?fields=name,email,id,gender,cover,picture,link",["email"],function(data){deferred.resolve(data)},function(data){deferred.reject(data)}):FB.api("/me?fields=name,email,id,gender,cover,picture,link",function(data){data?deferred.resolve(data):deferred.reject(data)}),deferred.promise},this.getMyProfilePic=function(params){var deferred=$q.defer();return Utility.isApp()?facebookConnectPlugin.api("/me/picture?redirect=0&height="+params.height+"&width="+params.width+"&type=large",["email"],function(data){deferred.resolve(data)},function(data){deferred.reject(data)}):FB.api("/me/picture?height="+params.height+"&width="+params.width,function(data){data?deferred.resolve(data):deferred.reject(data)}),deferred.promise},this.getMyGroups=function(){var deferred=$q.defer();return Utility.isApp()?facebookConnectPlugin.api("/me/groups?category=membership&fields=cover,name,icon",["user_groups"],function(data){deferred.resolve(data)},function(data){deferred.reject(data)}):FB.api("/me/groups?category=membership&fields=cover,name,icon",function(data){data?deferred.resolve(data):deferred.reject(data)}),deferred.promise},this.getMoreMyGroups=function(options){var deferred=$q.defer();return Utility.isApp()?facebookConnectPlugin.api("/me/groups?category=membership&fields=cover,name,icon&after="+options.after,["user_groups"],function(data){deferred.resolve(data)},function(data){deferred.reject(data)}):FB.api("/me/groups?category=membership&fields=cover,name,icon&after="+options.after,function(data){data?deferred.resolve(data):deferred.reject(data)}),deferred.promise},this.getGroupMembers=function(id){var deferred=$q.defer();return FB.api("/"+id+"/members",function(data){data?deferred.resolve(data):deferred.reject(data)}),deferred.promise},this.getGroupDetail=function(id){var deferred=$q.defer();return FB.api("/"+id,function(data){data?deferred.resolve(data):deferred.reject(data)}),deferred.promise},this.groupPost=function(id,message){var deferred=$q.defer();return FB.api("/"+id+"/feed","post",{message:message},function(data){data?deferred.resolve(data):deferred.reject(data)}),deferred.promise}}]),angular.module("DataResource").factory("MediaRsrc",["$q","ResourceInitializer",function($q,ResourceInitializer){var mediaRsrcObj={resource:function(){var that=this;return{audioUpload:function(file){var deferred=$q.defer(),options=new FileUploadOptions;options.fileKey="file",options.fileName=file.name,options.mimeType="audio/wav",options.httpMethod="POST",options.headers=that.header;var params={type:"audio"};options.params=params;var ft=new FileTransfer;return ft.upload(file.nativeURL,encodeURI(that.url+"/user/uploadMedia"),function(data){console.log(data),deferred.resolve(data)},function(err){console.log(err),deferred.reject(err)},options),deferred.promise},audioDownload:function(url,directory){var deferred=$q.defer(),fileTransfer=new FileTransfer,uri=encodeURI(url);return fileTransfer.download(uri,directory,function(entry){console.log("download complete: "+entry.toURL()),deferred.resolve(entry)},function(error){console.log("download error source "+error.source),console.log("download error target "+error.target),console.log("upload error code"+error.code),deferred.reject(error)},!1),deferred.promise}}}};return mediaRsrcObj.init=ResourceInitializer.init(mediaRsrcObj),mediaRsrcObj}]),angular.module("ServerPush",[]),angular.module("ServerPush").factory("Socket",["$rootScope",function($rootScope){return{on:function(eventName,callback){socket.on(eventName,function(){var args=arguments;$rootScope.$apply(function(){callback.apply(socket,args)})})},emit:function(eventName,data,callback){socket.emit(eventName,data,function(){var args=arguments;$rootScope.$apply(function(){callback&&callback.apply(socket,args)})})}}}]),angular.module("services.socialAlarms",["DataResource","services.utility","services.cordova","ServerPush"]),angular.module("services.socialAlarms").service("Context",function(){var accessTokenKey="accessToken",self=this;self.getAccessToken=function(){return localStorage.getItem(accessTokenKey)},self.hasAccessToken=function(){var token=self.getAccessToken();return""!=token&&null!=token},self.clearAccessToken=function(){localStorage.removeItem(accessTokenKey)},self.setAccessToken=function(accessToken){localStorage.setItem(accessTokenKey,accessToken)}}),angular.module("services.socialAlarms").service("CustomHttpInterceptor",["$q","$timeout",function($q,$timeout){var interceptors=[],filteredForUrl=function(url,method){return interceptors.filter(function(interceptor,index,all){return url==interceptor.url&&method==interceptor.method})},runAllFunctions=function(key,filteredInt){filteredInt&&filteredInt.length&&$timeout(function(){filteredInt.forEach(function(item){item[key]&&item[key]()})},0)};this.add=function(url,method,beforeRequest,afterResponse){var tempObj={url:"https://social-alarms.herokuapp.com"+url,method:method,beforeReq:beforeRequest,afterRes:afterResponse};url.length&&interceptors.push(tempObj)},this.request=function(config){return runAllFunctions("beforeReq",filteredForUrl(config.url,config.method)),config||$q.when(config)},this.requestError=function(rejection){return $q.reject(rejection)},this.response=function(response){return runAllFunctions("afterRes",filteredForUrl(response.config.url,response.config.method)),response||$q.when(response)},this.responseError=function(rejection){return runAllFunctions("afterRes",filteredForUrl(rejection.config.url)),$q.reject(rejection)}}]),angular.module("services.socialAlarms").service("GroupService",["SA","$q","CommonFunction",function(SA,$q,CommonFunction){var groups=[];this.isGroupUpdateRequired=!0,this.getGroups=function(){var defer=$q.defer();return this.isGroupUpdateRequired?SA.groupResource.getAllGroups().$promise.then(function(resp){defer.resolve(resp.groups),groups=resp.groups},function(err){defer.reject(err)}):defer.resolve(groups),defer.promise},this.getGroup=function(groupId){var defer=$q.defer(),group=CommonFunction.getObjByValue(groupId,"_id",groups);return group&&Object.keys(group).length?defer.resolve(group):SA.groupResource.getGroup({groupId:groupId}).$promise.then(function(resp){defer.resolve(resp.group)},function(err){defer.reject(err)}),defer.promise},this.getGroupReminders=function(groupId){var defer=$q.defer();return SA.groupResource.getGroupReminders({groupId:groupId}).$promise.then(function(resp){defer.resolve(resp.reminders)},function(err){defer.reject(err)}),defer.promise}}]),angular.module("services.socialAlarms").service("Loader",["Publisher",function(Publisher){this.notifier=new Publisher,this.showLoading=function(){this.notifier.deliver(!0)},this.hideLoading=function(){this.notifier.deliver(!1)},this.getLoaderObject=function(){return this}}]),angular.module("services.socialAlarms").factory("Publisher",function(){var Publisher=function(){this.subscribers=[]};return Publisher.prototype.addSubscriber=function(observer){return this.subscribers.push(observer),this.subscribers.lastIndexOf(observer)},Publisher.prototype.remove=function(observer){for(var i=0;i<this.subscribers.length&&i>=0;){if(this.subscribers[i]==observer){this.subscribers.splice(i,1);break}i++}return i},Publisher.prototype.deliver=function(data){return this.subscribers.forEach(function(fn){fn(data)}),this},Publisher}),angular.module("services.socialAlarms").service("Reminder",["Calendar",function(Calendar){var title="RemindZapp";this.createReminder=function(message,startDate,onSuccess,onError){Calendar.createCalendarEvent(title,message,startDate,onSuccess,onError)},this.deleteReminder=function(message,startDate,onSuccess,onError){Calendar.deleteEvent(message,startDate,endDate,onSuccess,onError)},this.findAllAppEvents=function(message,startDate,onSuccess,onError){Calendar.findEventWithFilter(title,message,startDate,onSuccess,onError)}}]),angular.module("services.socialAlarms").service("SA",["LoginRsrc","SignUpRsrc","ContactsRsrc","ReminderRsrc","GroupRsrc","UserRsrc","FBRsrc","MediaRsrc",function(LoginRsrc,SignUpRsrc,ContactsRsrc,ReminderRsrc,GroupRsrc,UserRsrc,FBRsrc,MediaRsrc){var self=this;self.init=function(){self.loginResource=LoginRsrc.init().resource(),self.signupResource=SignUpRsrc.init().resource(),self.contactResource=ContactsRsrc.init().resource(),self.remindResource=ReminderRsrc.init().resource(),self.groupResource=GroupRsrc.init().resource(),self.userResource=UserRsrc.init().resource(),self.mediaResource=MediaRsrc.init().resource(),self.fbResource=FBRsrc},self.init()}]),angular.module("services.socialAlarms").service("Toast",["Publisher",function(Publisher){var defaultToast={text:"",type:"message",show:!0,duration:5e3,isCloseBtn:!0,callback:null},that=this;this.text="a toast message",this.type="message",this.show=!1,this.duration=5e3,this.isCloseBtn=!0,this.callback=null,this.notifier=new Publisher,this.setToast=function(toastOpt){for(var key in toastOpt)that[key]=toastOpt[key];this.notifier.deliver(toastOpt),that.setToDefault()},this.setToDefault=function(){for(var i in defaultToast)that[i]=defaultToast[i]},this.getToastObject=function(){return this}}]),angular.module("services.socialAlarms").service("ToastMessage",["Toast","$timeout",function(Toast,$timeout){var toast={text:"",type:"normal",show:!0,duration:5e3,isCloseBtn:!0,callback:null},set=function(message,type){$timeout(function(){toast.type=type||toast.type,toast.text=message,Toast.setToast(toast)},0)};this.commonToast={downloadApp:function(){set("Uh oh! You need to download the app to use this feature.","normal")}},this.reminderToast={noteEmpty:function(){set("Please dont leave reminder note empty","warn")},reminderAccepted:function(){set("Reminder has been accepted","normal")},networkError:function(){set("couldn't acknowledge to server, may be network failure.","error")},cantSetReminder:function(){set("Sorry, couldn't set reminder","error")},cantSendReminder:function(message){set(message||"Sorry, couldn't send reminder","error")},gotRidOfReminder:function(){set("successfully got rid of that reminder","normal")},cantSetInPast:function(){set("You can't set alarm in past","warn")},setOnCalendar:function(){set("Reminder set on calendar","normal")},serverError:function(mesasge){set(message||"Sorry, Can't send reminder","normal")},reminderSent:function(name){set("Reminder sent to "+name||"(No Name)","normal")},noContacts:function(){set("Please add contact","warn")},seenSuccess:function(){set("Now they know that you remember!","normal")},seenError:function(){set("Server error.","error")}},this.home={loadFailed:function(){set("Couldn't load reminders","error")}},this.feedback={showSuccess:function(){set("Thanks, your feedback is waiting for moderation.","normal")},showEmptyFeedback:function(){set("Feedback cannot be empty","error")},showServerError:function(){set("There was some error in sending feedback","error")},getServerError:function(){set("There was some error in fetching feedbacks","error")},voteServerSuccess:function(){set("Thanks, let us look into this.","normal")},voteServerError:function(){set("There was some error in Voting, Vote Failed","error")},alreadyVoted:function(){set("Ops! You already voted.","warn")}},this.forgotPass={linkSent:function(){set("link sent to your email","normal")},failed:function(message){set(message||"couldn't send password reset link","error")},emailEmpty:function(){set("Please write email address","warn")}},this.signup={poorConnectivity:function(){set("Poor connectivity","warn")},failed:function(message){set(message||"couldn't signup","warn")}},this.verify={resentSuccessfull:function(){set("Verification code resent","normal")},resentFailed:function(){set("Failed to resent code","error")}},this.userToast={nameChangeSuccess:function(){set("Name changed successfully.","normal")},failed:function(message){set(message||"Error","error")}}}]),angular.module("services.socialAlarms").service("ViewManagement",["Store","Context","$location",function(Store,Context,$location){var views="PrevViews";this.pushView=function(view){var tempViewArray=Store.getObject(views);tempViewArray=tempViewArray?tempViewArray:[],0!=tempViewArray.length&&tempViewArray.length>0&&tempViewArray[tempViewArray.length-1]===view||tempViewArray.push(view),Store.setObject(views,tempViewArray)},this.popView=function(){var prevViews=Store.getObject(views),prevView=prevViews&&prevViews.length?prevViews.pop():"/login";$location.path()===prevView&&(prevView=prevViews&&prevViews.length?prevViews.pop():"/login");Context.getAccessToken();return Store.setObject(views,prevViews),prevView},this.clearView=function(){Store.setObject(views,[])},this.lastView=function(){var prevViews=Store.getObject(views)||[];return prevViews&&prevViews.length?prevViews[prevViews.length-1]:""}}]),angular.module("services.utility",[]),angular.module("services.utility").factory("AppView",function(){function getBodyClass(){return bodyClass}function setBodyClass(val){bodyClass=val}var bodyClass="",appViewObj={};return appViewObj.getBodyClass=getBodyClass,appViewObj.setBodyClass=setBodyClass,appViewObj}),angular.module("services.utility").service("State",function(){var that=this;that.reminderState=null,that.setStateVar=function(key,value){key&&(that[key]=value)},that.getStateVar=function(key){return key&&that[key]}}),angular.module("services.utility").factory("CommonFunction",["$location","FBIntegration","Utility","SA","Device",function($location,FBIntegration,Utility,SA,Device){function logout(){FBIntegration.isFBConnected()&&FBIntegration.logout();var logoutObj={};Utility.isApp()?Device.getDeviceId().then(function(udid){udid&&(logoutObj.deviceId=udid,SA.loginResource.logout(logoutObj).$promise.then(function(data){},function(err){}),clearStorage(),$location.path("/login"))}):(SA.loginResource.logout(logoutObj).$promise.then(function(data){},function(err){}),clearStorage(),$location.path("/login"))}function clearStorage(){localStorage.removeItem(accessTokenKey),localStorage.removeItem(views),localStorage.removeItem("user"),localStorage.removeItem("userId"),localStorage.removeItem("hello")}function extendObjects(obj,extension){for(var key in extension)obj[key]=extension[key]}function getObjByValue(value,prop,array){if(!array||!array.length)return{};var obj={};return array.some(function(singleObj){return singleObj[prop]==value?(obj=singleObj,!0):void 0}),obj}var accessTokenKey="accessToken",views="PrevViews",commonFunctionObj={};return commonFunctionObj.logout=logout,commonFunctionObj.extend=extendObjects,commonFunctionObj.getObjByValue=getObjByValue,commonFunctionObj}]),angular.module("services.utility").service("FBIntegration",["$window","$location","$timeout","SA","Store","Utility","Context","PushNotification","Loader",function($window,$location,$timeout,SA,Store,Utility,Context,PushNotification,Loader){function fb_init(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];d.getElementById(id)||(js=d.createElement(s),js.id=id,js.src="//connect.facebook.net/en_US/sdk.js",fjs.parentNode.insertBefore(js,fjs))}function checkLoginState(){FB.getLoginStatus(function(response){statusChangeCallback(response)})}function appFBLogin(){facebookConnectPlugin.login(["user_friends","email","user_groups"],function(response){console.log(response),onLogin(response)},function(err){console.log(err)})}function onLogin(response){if("connected"==response.status){console.log(response),fbConnected=!0;var loginObj={socialId:response.authResponse.userID,socialType:"FB",accessToken:response.authResponse.accessToken,type:"SOCIAL"};Loader.showLoading(),SA.loginResource.login(loginObj).$promise.then(function(data){function btnCallback(email,successFunc,errorFunc){SA.userResource.updateEmail({email:email}).$promise.then(function(data){successFunc();var user=Store.getObject("user");user.email=email,Store.setObject("user",user),$location.path("/confirmation")},function(err){errorFunc(err)})}if(data&&1===data.status){var prevUserId=Store.getItem("userId");prevUserId!=data.user._id&&Store.removeAll(),Store.setItem("userId",data.user._id),Store.setObject("user",{_id:data.user._id,fb_id:data.user.fb_id,gender:data.user.gender,name:data.user.name,email:data.user.reg_email,picture:"http://graph.facebook.com/"+data.user.fb_id+"/picture?height=200&width=200&type=large",fb_token:response.authResponse.access_token}),Context.setAccessToken(data.token),SA.init(),Utility.isApp()&&PushNotification.register(),data.user.reg_email?data.isVerified===!1?$location.path("/confirmation"):("/login"===$location.path()||"/signUp"===$location.path())&&$location.path("/dashboard"):$timeout(function(){Utility.setPopupBox(!0,{headerTitle:"Uh Oh!",bodyText:"Your email address will help your friends contact you.",btnText:"Send",btnCallback:btnCallback,showCloseBtn:!1,closeBtnCallback:""})},0)}Loader.hideLoading()},function(err){Loader.hideLoading()})}}function statusChangeCallback(response){"connected"==response.status?onLogin(response):FB.login(function(response){onLogin(response)},{scope:"user_friends, email, user_groups, publish_actions"})}var fbConnected=!1,fbInit=!1;this.isFBInit=function(){return fbInit},this.isFBConnected=function(){return fbConnected},this.login=function(){fbInit?checkLoginState():Utility.isApp()?appFBLogin():fb_init(document,"script","facebook-jssdk")},this.logout=function(){Utility.isApp()?facebookConnectPlugin.logout(function(response){},function(err){}):FB.logout(function(response){})},$window.fbAsyncInit=function(){FB.init({appId:"879682825417073",xfbml:!0,version:"v2.3"}),FB.getLoginStatus(function(response){statusChangeCallback(response),fbInit=!0})}}]),angular.module("services.utility").factory("Store",function(){var Storage=function(){};Storage.prototype.setObject=function(key,value){this.setItem(key,JSON.stringify(value))},Storage.prototype.getObject=function(key){var value=this.getItem(key);return value&&JSON.parse(value)},Storage.prototype.removeObject=function(key){localStorage.removeItem(key)},Storage.prototype.removeAll=function(){for(var key in localStorage)"hello"!==key&&localStorage.removeItem(key)},Storage.prototype.setItem=function(key,value){localStorage.setItem(key,value)},Storage.prototype.getItem=function(key){return localStorage.getItem(key)};localStorage;return new Storage}),angular.module("services.utility").service("Utility",["$timeout","Store",function($timeout,Store){var headerObj={showHeader:!0,options:{title:"Social Alarms",showBackButton:!1,showRightButton:!1,backButtonCallback:!1,rightButtonCallback:!1,rightButtonText:"",transparent:!1}},footerObj={showFooter:!1},menuObj={showMenu:!1},popupBoxObj={showPopup:!1,options:{headerTitle:"Popup Box",bodyText:"",btnText:"",btnCallback:"",showCloseBtn:!1,closeBtnCallback:""}};this.setHeader=function(showHeader,headerOptions){headerObj={showHeader:showHeader,options:{title:"Social Alarms",showBackButton:!0,showRightButton:!1,showRightButton2:!1,backButtonCallback:!1,rightButtonCallback:!1,rightButtonText:"",rightButtonCallback2:!1,rightButtonText2:"",showMenuIcon:!1,transparent:!1}},headerOptions&&(headerObj.options.title=headerOptions.title,headerObj.options.showBackButton=headerOptions.showBackButton,headerObj.options.showRightButton=headerOptions.showRightButton,headerObj.options.showRightButton2=headerOptions.showRightButton2,headerObj.options.backButtonCallback=headerOptions.backButtonCallback?headerOptions.backButtonCallback:!1,headerObj.options.rightButtonCallback=headerOptions.rightButtonCallback?headerOptions.rightButtonCallback:!1,headerObj.options.rightButtonText=headerOptions.rightButtonText?headerOptions.rightButtonText:"",headerObj.options.rightButtonCallback2=headerOptions.rightButtonCallback2?headerOptions.rightButtonCallback2:!1,headerObj.options.rightButtonText2=headerOptions.rightButtonText2?headerOptions.rightButtonText2:"",headerObj.options.showMenuIcon=headerOptions.showMenuIcon?headerOptions.showMenuIcon:!1,headerObj.options.transparent=headerOptions.transparent?headerOptions.transparent:!1)},this.isShowBackButton=function(showBackButton){headerObj.options.showBackButton=showBackButton},this.isShowNextButton=function(showRightButton){headerObj.options.showRightButton=showRightButton},this.setShowRightButton2=function(value){headerObj.options.showRightButton2=value},this.setHeaderTitle=function(title){headerObj.options.title=title},this.getHeader=function(){return headerObj},this.setFooter=function(showFooter){footerObj={showFooter:showFooter}},this.getFooter=function(){return footerObj},this.toggleMenu=function(){return menuObj=menuObj.showMenu?{showMenu:!1}:{showMenu:!0}},this.getMenu=function(){return menuObj},this.setMenu=function(val){menuObj={showMenu:val||!1}},this.setPopupBox=function(showPopup,Options){popupBoxObj={showPopup:showPopup,options:{headerTitle:"Popup Box",bodyText:"",btnText:"",btnCallback:"",showCloseBtn:!1,closeBtnCallback:""}},showPopup&&Options&&(popupBoxObj.showPopup=showPopup,popupBoxObj.options.headerTitle=Options.headerTitle||"Popup Box",popupBoxObj.options.bodyText=Options.bodyText||"",popupBoxObj.options.btnText=Options.btnText||"Send",popupBoxObj.options.btnCallback=Options.btnCallback||"",popupBoxObj.options.showCloseBtn=Options.showCloseBtn||!1,popupBoxObj.options.closeBtnCallback=Options.closeBtnCallback||"")},this.getPopupBox=function(){return popupBoxObj},this.isApp=function(){return-1===document.URL.indexOf("http://")&&-1===document.URL.indexOf("https://")},this.isMobileDevice=function(){var mobile=/Android|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);return mobile},this.isIOS=function(){var iOS=/(iPad|iPhone|iPod)/g.test(navigator.userAgent);return iOS},this.isAndroid=function(){var android=/(android)/g.test(navigator.userAgent.toLowerCase());return android},this.chunk=function(array,chunkSize){if(0>=chunkSize)throw new Error("invalid chunk size");var i,j,chunks=[];for(i=0,j=array.length;j>i;i+=chunkSize)chunks.push(array.slice(i,i+chunkSize));return chunks},this.viewAdjustIos=function(){this.isIOS()&&$timeout(function(){window.scrollTo(0,window.scrollY)},0)},this.clearSelectedPeople=function(){Store.removeObject("selectedContacts"),Store.removeObject("selectedBulkContacts"),Store.removeObject("selectedFbGroups"),Store.removeObject("record")},this.countInterval=function(start,end,method,callback1,callback2){var tempStart=start,tempEnd=end,durInterval=setInterval(function(){tempStart===tempEnd&&(clearInterval(durInterval),callback2&&callback2()),"forward"==method&&tempStart!==tempEnd?callback1&&callback1(tempStart++):"reverse"==method&&tempStart!==tempEnd&&callback1&&callback1(tempEnd--)},1e3);return durInterval},this.fadeinAnimation=function(){var options={duration:600,iosdelay:50,androiddelay:100};window.plugins&&window.plugins.nativepagetransitions&&window.plugins.nativepagetransitions.fade&&window.plugins.nativepagetransitions.fade(options,function(msg){console.log("success: "+msg)},function(msg){alert("error: "+msg)})},this.flipAnimation=function(){var options={direction:"left",duration:600,iosdelay:50,androiddelay:100,winphonedelay:150};window.plugins&&window.plugins.nativepagetransitions&&window.plugins.nativepagetransitions.flip&&window.plugins.nativepagetransitions.flip(options,function(msg){console.log("success: "+msg)},function(msg){alert("error: "+msg)})},this.drawarAnimation=function(){var options={origin:"left",action:"open",duration:300,iosdelay:50};window.plugins&&window.plugins.nativepagetransitions&&window.plugins.nativepagetransitions.drawer&&window.plugins.nativepagetransitions.drawer(options,function(msg){console.log("success: "+msg)},function(msg){alert("error: "+msg)})},this.slideAnimation=function(){var options={direction:"left",duration:500,slowdownfactor:1,iosdelay:100,androiddelay:70,winphonedelay:250,fixedPixelsTop:0,fixedPixelsBottom:0};window.plugins&&window.plugins.nativepagetransitions&&window.plugins.nativepagetransitions.slide&&window.plugins.nativepagetransitions.slide(options,function(msg){console.log("success: "+msg)},function(msg){alert("error: "+msg)})},this.canRequest500MS=function(callback,timer,value){timer&&clearTimeout(timer);var timer=setTimeout(function(){callback()},value);return timer}}]),angular.module("services.utility").factory("FileFolder",function(){function createFolderAndFile(filename,callback){window.requestFileSystem(LocalFileSystem.PERSISTENT,0,function(fileSystem){fileSystem.root.getDirectory("RemindZapp",{create:!0},function(directory){directory.getDirectory("media",{create:!0},function(directory){directory.getDirectory("audio",{create:!0},function(directory){directory.getFile(filename,{create:!0},function(file){callback(file)})})})})},null)}function createSentFolderAndFile(filename,callback){window.requestFileSystem(LocalFileSystem.PERSISTENT,0,function(fileSystem){fileSystem.root.getDirectory("RemindZapp",{create:!0},function(directory){directory.getDirectory("media",{create:!0},function(directory){directory.getDirectory("audio",{create:!0},function(directory){directory.getDirectory("sent",{create:!0},function(directory){directory.getFile(filename,{create:!0},function(file){callback(file)})})})})})},null)}function getFileResource(path,success,fail){window.requestFileSystem(LocalFileSystem.PERSISTENT,0,function(fileSystem){fileSystem.root.getFile(path,{create:!1},function(file){success(file)},function(err){fail(err)})},null)}function getDirectoryResource(path,success,fail){window.requestFileSystem(LocalFileSystem.PERSISTENT,0,function(fileSystem){fileSystem.root.getDirectory(path,{create:!1},function(file){success(file)},function(err){fail(err)})},null)}var fileFolderObj={};return fileFolderObj.createFolderAndFile=createFolderAndFile,fileFolderObj.createSentFolderAndFile=createSentFolderAndFile,fileFolderObj.getFileResource=getFileResource,fileFolderObj.getDirectoryResource=getDirectoryResource,fileFolderObj}),angular.module("tabSlideBox",[]).directive("onFinishRender",["$timeout",function($timeout){return{restrict:"A",link:function(scope,element,attr){scope.$last===!0&&$timeout(function(){scope.$emit("ngRepeatFinished")})}}}]).directive("tabSlideBox",["$timeout","$window","$ionicSlideBoxDelegate","$ionicScrollDelegate",function($timeout,$window,$ionicSlideBoxDelegate,$ionicScrollDelegate){"use strict";return{restrict:"A, E, C",link:function(scope,element,attrs,ngModel){function renderScrollableTabs(){var iconsDiv=angular.element(ta.querySelector(".tsb-icons")),icons=iconsDiv.find("a"),wrap=iconsDiv[0].querySelector(".tsb-ic-wrp"),totalTabs=icons.length;wrap.querySelector(".scroll");angular.forEach(icons,function(value,key){var a=angular.element(value);a.on("click",function(){ionicSlideBoxDelegate.slide(key)}),a.attr("icon-off")&&a.attr("class",a.attr("icon-off"))});var initialIndex=attrs.tab;("undefined"==typeof attrs.tab||initialIndex>=totalTabs||0>initialIndex)&&(initialIndex=Math.floor((icons.length-1)/2)),0==initialIndex&&setPosition(0),$timeout(function(){ionicSlideBoxDelegate.slide(initialIndex)},0)}function setPosition(index){var iconsDiv=angular.element(ta.querySelector(".tsb-icons")),icons=iconsDiv.find("a"),wrap=iconsDiv[0].querySelector(".tsb-ic-wrp"),scrollDiv=(icons.length,wrap.querySelector(".scroll")),middle=iconsDiv[0].offsetWidth/2,curEl=angular.element(icons[index]),prvEl=angular.element(iconsDiv[0].querySelector(".active"));if(curEl&&curEl.length){var curElWidth=curEl[0].offsetWidth,curElLeft=curEl[0].offsetLeft;prvEl.attr("icon-off")?prvEl.attr("class",prvEl.attr("icon-off")):prvEl.removeClass("active"),curEl.attr("icon-on")&&curEl.attr("class",curEl.attr("icon-on")),curEl.addClass("active");var leftStr=middle-curElLeft-curElWidth/2+5;if(scrollDiv){var wrapWidth=wrap.offsetWidth,currentX=Math.abs(getX(scrollDiv.style.webkitTransform)),leftOffset=100,elementOffset=40;(curElLeft+curElWidth+elementOffset>currentX+wrapWidth||currentX>curElLeft-leftOffset)&&(leftStr>0&&(leftStr=0),ionicScrollDelegate.scrollTo(Math.abs(leftStr),0,!0))}else{var leftStr=middle-curElLeft-curElWidth/2+5+"px";wrap.style.webkitTransform="translate3d("+leftStr+",0,0)"}}}function getX(matrix){return matrix=matrix.replace("translate3d(",""),matrix=matrix.replace("translate(",""),parseInt(matrix)}var ta=element[0],$ta=element;$ta.addClass("tabbed-slidebox"),"bottom"===attrs.tabsPosition&&$ta.addClass("btm");var handle=ta.querySelector(".slider").getAttribute("delegate-handle"),ionicSlideBoxDelegate=$ionicSlideBoxDelegate;handle&&(ionicSlideBoxDelegate=ionicSlideBoxDelegate.$getByHandle(handle));var ionicScrollDelegate=$ionicScrollDelegate;handle&&(ionicScrollDelegate=ionicScrollDelegate.$getByHandle(handle));var events=scope.events;events.on("slideChange",function(data){setPosition(data.index)}),events.on("ngRepeatFinished",function(ngRepeatFinishedEvent){renderScrollableTabs()}),renderScrollableTabs()},controller:["$scope","$attrs","$element",function($scope,$attrs,$element){$scope.events=new SimplePubSub,$scope.slideHasChanged=function(index){$scope.events.trigger("slideChange",{index:index}),$timeout(function(){$scope.onSlideMove&&$scope.onSlideMove({index:eval(index)})},100)},$scope.$on("ngRepeatFinished",function(ngRepeatFinishedEvent){$scope.events.trigger("ngRepeatFinished",{event:ngRepeatFinishedEvent})})}]}}]),angular.module("SocialAlarmsApp").controller("BodyCtrl",["$scope","AppView",function($scope,AppView){$scope.bodyClass="",$scope.$watch(AppView.getBodyClass,function(){$scope.bodyClass=AppView.getBodyClass()})}]),angular.module("SocialAlarmsApp").controller("FooterCtrl",["$scope","$location","$rootScope","Utility",function($scope,$location,$rootScope,Utility){$scope.showFooter=!1,$scope.$watch(Utility.getFooter,function(){var footerObj=Utility.getFooter();$scope.showFooter=footerObj.showFooter}),$scope.goToView=function(view){$location.path(view)}}]),angular.module("SocialAlarmsApp").controller("HeaderCtrl",["$scope","Utility","$location","ViewManagement",function($scope,Utility,$location,ViewManagement){$scope.showHeader=!0,$scope.headerTitle="Social Alarams",$scope.options={},$scope.isIos=!1,$scope.showMenu=!1,Utility.isIOS()&&($scope.isIos=!0),$scope.gotoSettings=function(){$location.path("/settings")},$scope.toggleMenu=function(){$scope.showMenu=Utility.toggleMenu().showMenu},$scope.$watch(Utility.getMenu,function(){var menuObj=Utility.getMenu();$scope.showMenu=menuObj.showMenu}),$scope.$watch(Utility.getHeader,function(){var headerObj=Utility.getHeader();$scope.options.showHeader=headerObj.showHeader,$scope.options.headerTitle=headerObj.options.title,$scope.options.showBackButton=headerObj.options.showBackButton,$scope.options.showRightButton=headerObj.options.showRightButton,$scope.options.showRightButton2=headerObj.options.showRightButton2,$scope.options.backButtonCallback=headerObj.options.backButtonCallback,$scope.options.rightButtonCallback=headerObj.options.rightButtonCallback,$scope.options.rightButtonText=headerObj.options.rightButtonText,$scope.options.rightButtonCallback2=headerObj.options.rightButtonCallback2,$scope.options.rightButtonText2=headerObj.options.rightButtonText2,$scope.options.transparent=headerObj.options.transparent||!1,headerObj.options.showMenuIcon?$scope.showMenuIcon=!0:$scope.showMenuIcon=!1},!0),$scope.onBack=function(){if($scope.options.backButtonCallback)$scope.options.backButtonCallback();else{var prevPath=ViewManagement.popView();$location.path(prevPath)}},$scope.rightButton=function(){Utility.getMenu().showMenu&&Utility.toggleMenu(),
$scope.options.rightButtonCallback()},$scope.rightButton2=function(e){Utility.getMenu().showMenu&&Utility.toggleMenu(),$scope.options.rightButtonCallback2(e)}}]),angular.module("SocialAlarmsApp").controller("LoaderCtrl",["$scope","Loader",function($scope,Loader){$scope.isloading=!1;var showLoading=function(val){$scope.isloading=val};Loader.notifier.addSubscriber(showLoading)}]),angular.module("SocialAlarmsApp").controller("MenuCtrl",["$scope","$location","$timeout","Utility","Store","dialog","CommonFunction","Keyboard","ViewManagement",function($scope,$location,$timeout,Utility,Store,dialog,CommonFunction,Keyboard,ViewManagement){$scope.showMenu=!1,$scope.user={},$scope.isApp=Utility.isApp(),$scope.$watch(Utility.getMenu,function(){var menuObj=Utility.getMenu();Utility.isApp()&&Keyboard.isVisible()?$timeout(function(){$scope.showMenu=menuObj.showMenu,window.scrollTo(0,window.scrollY)},500):$scope.showMenu=menuObj.showMenu}),$scope.toggleMenu=function(){Utility.toggleMenu()},$scope.goToView=function(view,e){e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation(),$scope.toggleMenu(),ViewManagement.clearView(),$location.path(view)},$scope.logout=function(e){e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation(),Utility.isApp()?dialog.confirm("Do you want to logout?",[function(){$timeout(function(){$scope.toggleMenu(),CommonFunction.logout(),$scope.user={}},0)},function(){}],["Yes","No"]):($scope.toggleMenu(),CommonFunction.logout(),$scope.user={})},$scope.getUser=function(){return $scope.user=Store.getObject("user"),$scope.user},$scope.hideMenu=function(){Utility.setMenu(!1)}}]),angular.module("SocialAlarmsApp").controller("ToastCtrl",["$scope","Toast","$timeout",function($scope,Toast,$timeout){$scope.showToast=!1,$scope.onClose=function(){$scope.showToast=!1};var popToast=function(data){$scope.showToast=data.show,$scope.text=data.text||"",$scope.type="toast ",$scope.type+=data.type||"",$scope.isCloseBtn=data.isCloseBtn||null,$timeout(function(){$scope.showToast=!1},data.duration||6e4)};Toast.notifier.addSubscriber(popToast)}]),angular.module("SocialAlarmsApp").controller("PopupBoxCtrl",["$scope","$timeout","Utility","CommonFunction",function($scope,$timeout,Utility,CommonFunction){function validateEmail(){var emailReg=/^[\+_a-zA-Z0-9-]+(\.[\+_a-zA-Z0-9-]+)*@[a-zA-Z0-9-]+(\.[a-zA-Z0-9-]+)*(\.[a-zA-Z]{2,4})$/;return""!==$scope.scopeObj.email&&emailReg.test($scope.scopeObj.email)?!0:($scope.isError=!0,$scope.errorText="Enter a valid email",!1)}function successFunc(){$timeout(function(){$scope.scopeObj.email="",$scope.showPopup=!1},0)}function errorFunc(err){$timeout(function(){$scope.isError=!0,$scope.errorText=err&&(err.errorMsg||err.infoMsg)||"Error"},0)}$scope.popupBoxObj={headerTitle:"Popup Box",bodyText:"",btnText:"Send",btnCallback:"",showCloseBtn:!1,closeBtnCallback:""},$scope.showPopup=!1,$scope.scopeObj={email:""},$scope.isError=!1,$scope.errorText="",$scope.closeBtn=function(e){$scope.showPopup=!1,$scope.popupBoxObj.closeBtnCallback&&$scope.popupBoxObj.closeBtnCallback()},$scope.sendBtn=function(e){$scope.scopeObj.email&&validateEmail()&&$scope.popupBoxObj.btnCallback&&$scope.popupBoxObj.btnCallback($scope.scopeObj.email,successFunc,errorFunc)},$scope.onChange=function(){$scope.isError=!validateEmail()},$scope.logout=function(){$scope.showPopup=!1,CommonFunction.logout()},$scope.$watch(Utility.getPopupBox,function(){var popupObj=Utility.getPopupBox();$scope.showPopup=popupObj.showPopup,$scope.popupBoxObj.headerTitle=popupObj.options.headerTitle||"Popup Box",$scope.popupBoxObj.bodyText=popupObj.options.bodyText||"",$scope.popupBoxObj.btnText=popupObj.options.btnText||"Send",$scope.popupBoxObj.btnCallback=popupObj.options.btnCallback||"",$scope.popupBoxObj.showCloseBtn=popupObj.options.showCloseBtn||!1,$scope.popupBoxObj.closeBtnCallback=popupObj.options.closeBtnCallback||""})}]),angular.module("SocialAlarmsApp.contacts",["ngRoute","services.socialAlarms"]).config(["$stateProvider","$urlRouterProvider",function($stateProvider,$urlRouterProvider){$stateProvider.state("contacts",{url:"/contacts",templateUrl:"views/Contacts/Contacts.html",controller:"ContactsCtrl"}).state("contacts/:view",{url:"/contacts/:view",templateUrl:"views/Contacts/Contacts.html",controller:"ContactsCtrl"}).state("reminder",{url:"/reminder",templateUrl:"views/Contacts/SendReminder.html",controller:"ReminderCtrl"}).state("bulk-invite",{url:"/bulk-invite",templateUrl:"views/Contacts/BulkInvite.html",controller:"BulkInviteCtrl"}).state("recipient-details",{url:"/recipient-details",templateUrl:"views/Contacts/RecipientContactView.html",controller:"RecipientDetailCtrl"})}]),angular.module("SocialAlarmsApp.contacts").controller("BulkInviteCtrl",["$scope","AppView","Utility","ViewManagement","SA","$location","Store","$timeout","ToastMessage","Loader",function($scope,AppView,Utility,ViewManagement,SA,$location,Store,$timeout,ToastMessage,Loader){function extractGuestContactData(contactData){var extractedContactData={};return extractedContactData=-1!=contactData.text.indexOf("@")?{name:contactData.text,email:contactData.text.toLowerCase(),phoneNumber:""}:null}function getTagIndex(tag){for(var index=-1,i=0;i<$scope.selectedContacts.length;i++){var contact=$scope.selectedContacts[i];if(contact.name==tag.text){index=i;break}}return index}function addingExistingData(contacts){$scope.tagItems=convertIntoTags(contacts)}function convertIntoTags(contacts){var tags=[];return contacts.forEach(function(val,i){tags.push({text:val.email})}),tags}AppView.setBodyClass("view-others-invite"),Utility.setHeader(!0,{title:"Invite Others",showBackButton:!0,backButtonCallback:!1}),Utility.setFooter(!0),ViewManagement.pushView("/bulk-invite"),$scope.selectedContacts=Store.getObject("selectedBulkContacts")||[],$scope.selectedContacts&&$scope.selectedContacts.length&&addingExistingData($scope.selectedContacts),$scope.$on("$routeChangeSuccess",function(event,current){}),$scope.$on("$viewContentLoaded",function(){}),$scope.handleRecipient=function(){$scope.selectedContacts&&$scope.selectedContacts.length?Store.setObject("selectedBulkContacts",$scope.selectedContacts):Store.removeObject("selectedBulkContacts"),$location.path(ViewManagement.popView())},$scope.handleSingleTagAdd=function(tag){var extractedData=extractGuestContactData(tag);extractedData&&$scope.selectedContacts.push(extractedData)},$scope.handleSingleTagRemoved=function(tag){var removedTagIndex=getTagIndex(tag);$scope.selectedContacts.splice(removedTagIndex,1)}}]),angular.module("SocialAlarmsApp.contacts").controller("ContactsCtrl",["$scope","$location","$stateParams","$timeout","$window","$ionicScrollDelegate","AppView","Utility","ViewManagement","Contacts","Loader","Store","State",function($scope,$location,$stateParams,$timeout,$window,$ionicScrollDelegate,AppView,Utility,ViewManagement,Contacts,Loader,Store,State){function getSearchedContact(contact,searchText){if(contact.displayName)return contact.displayName.toLowerCase().search(searchText.toLowerCase())>-1;var formattedName="";return contact.name&&contact.name.formatted?formattedName=contact.name.formatted:contact.phoneNumbers?formattedName=contact.phoneNumbers[0].value:contact.emails&&(formattedName=contact.emails[0].value),formattedName.toLowerCase().search(searchText.toLowerCase())>-1}function stopPropagationEvents(e){e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation()}function getContacts(){Utility.isApp()&&(finalContacts&&finalContacts.length?getTabContacts():($scope.syncProcessing=!0,Contacts.getSyncContacts(getSyncContactsCallBack)))}function getSyncContactsCallBack(contacts){finalContacts=contacts,syncSelectedContacts(),$scope.syncProcessing=!1,getTabContacts(),Loader.hideLoading()}function getTabContacts(){showAppContacts?$scope.contacts=finalContacts.filter(function(contact,index){return contact.mainIndex=index,contact.hasAccount&&!contact.loggedInUser}):$scope.contacts=finalContacts.filter(function(contact,index){return contact.mainIndex=index,!contact.loggedInUser}),addHtml()}function addHtml(){resetCounts(),resetHtml(),createContactHtml(getLimitedContacts($scope.contacts,contactsLoadedCount,contactsLimit)),changingCounts()}function syncSelectedContacts(){selectedContacts&&finalContacts&&selectedContacts.length&&finalContacts.length&&selectedContacts.forEach(function(contact,index){finalContacts[contact.mainIndex].isTick=!0})}function nextButtonCallback(){if(isContactSelected)if(fromGroupRecipientView){var uniqueContacts=uniqueSelectedContact(State.getStateVar("selectedGroupContacts"));State.setStateVar("selectedGroupContacts",uniqueContacts),$location.path("/group-recipient-detail-list")}else Store.setObject("selectedContacts",selectedContacts),"/reminder"===prevView||"/recipient-details"===prevView||"/remindPeople"===prevView?$location.path(ViewManagement.popView()):$location.path("/reminder")}function rightButtonCallback2(e){$timeout(function(){$scope.searchContacts(e)},0)}function uniqueSelectedContact(prevContacts){var prevContacts=prevContacts||[];if(selectedContacts&&selectedContacts.length){var finalSelectedContacts=prevContacts&&prevContacts.length?angular.copy(prevContacts):[];return selectedContacts.forEach(function(contact,cIndex){var tempContacts=[];prevContacts.forEach(function(prevContact,pIndex){var pContact=angular.copy(prevContact);pContact.isTick&&delete pContact.isTick,angular.toJson(pContact)===angular.toJson(contact)&&tempContacts.push(contact)}),0==tempContacts.length&&finalSelectedContacts.push(contact)}),finalSelectedContacts}return[]}function toggleNextButton(){isContactSelected=selectedContacts&&selectedContacts.length?!0:!1,$timeout(function(){isContactSelected?Utility.isShowNextButton(isContactSelected):Utility.isShowNextButton(isContactSelected)},0)}function getContactIndexInSelectedContacts(contact){var contactIndex=-1;if(!contact)return contactIndex;for(var i=0;i<selectedContacts.length;i++){var singleSelectedContact=selectedContacts[i];contact.displayName||contact.name&&contact.name.formatted||contact.comMethods[0].value;if(contact.displayName==singleSelectedContact.name||contact.name&&contact.name.formatted==singleSelectedContact.name||contact.name==singleSelectedContact.name){contactIndex=i;break}}return contactIndex}function extractContactData(contact){if(!contact||contact&&contact.emails&&!contact.emails.length||contact&&contact.phoneNumbers&&!contact.phoneNumbers.length)return{};var comMethods=[];return contact.emails&&contact.emails.forEach(function(email){email.value&&comMethods.push({type:"email",value:email.value})}),{id:contact.id,mainIndex:contact.mainIndex,name:contact.displayName||contact.name&&contact.name.formatted||comMethods[0].value,email:comMethods[0].value,phoneNumber:""}}function getLimitedContacts(contacts,initial,limit){return contacts.length>limit+initial?$scope.hasMoreContacts=!0:$scope.hasMoreContacts=!1,contacts.slice(initial,limit+initial)}function changingCounts(){contactsLoadedCount+=contactsLimit}function resetCounts(){contactsLoadedCount=0}function resetHtml(){contactListElem&&(contactListElem.innerHTML="")}function createContactHtml(contacts){var html="";contacts.forEach(function(contact,index){if(contact.emails||!contact.phoneNumbers){if(html+="<li>",html+='<a href="javascript:;" onclick="selectContactEvent('+(index+contactsLoadedCount)+", "+contact.mainIndex+', event)" class="contact-anchor">',html+='<div class="initials">',contact.name&&null!=contact.name.firstLetter&&void 0!=contact.name.firstLetter&&(html+="<p>"+contact.name.firstLetter+"</p>"),html+="</div>",html+='<span class="checkbox',html+=contact.isTick?' selected">':'">',html+="<span></span>",html+="</span>",html+="<div>",html+='<h2 class="name contacts contact-name strip-long-name">',contact.displayName)html+="<span>"+contact.displayName+"</span>";else{var formattedName="";contact.name&&contact.name.formatted?formattedName=contact.name.formatted:contact.phoneNumbers?formattedName=contact.phoneNumbers[0].value:contact.emails&&(formattedName=contact.emails[0].value),html+="<span>"+formattedName+"</span>"}html+="</h2>",html+="</div>",html+='<span class="inner-border"></span>',html+="</a>",html+="</li>"}}),contactListElem.innerHTML=contactListElem.innerHTML+html}var prevViews=Store.getObject("PrevViews"),prevView=prevViews&&prevViews.length?prevViews[prevViews.length-1]:"",fromMenuView=$stateParams.view&&"menu"===$stateParams.view?!0:!1,rightBtnName="Next";"/reminder"===prevView||"/recipient-details"===prevView||"/remindPeople"===prevView?rightBtnName="Done":Store.removeObject("selectedContacts"),AppView.setBodyClass("view-contacts"),Utility.setHeader(!0,{title:"Contacts",showBackButton:!fromMenuView,showRightButton:!1,showRightButton2:!0,rightButtonCallback:nextButtonCallback,rightButtonText:rightBtnName,rightButtonCallback2:rightButtonCallback2,rightButtonText2:"Search",showMenuIcon:fromMenuView}),Utility.setFooter(!0),ViewManagement.pushView("/contacts"+(fromMenuView?"/menu":""));var fromGroupRecipientView,isContactSelected=!1,showAppContacts=!1,selectedContacts=Store.getObject("selectedContacts")||[],contactsLoadedCount=0,contactsLimit=200,timer=null,finalContacts=[];$scope.contacts=[],$scope.syncProcessing=!1,$scope.isOnAllContactsTab=!0,$scope.hasMoreContacts=!1,$scope.isSearch=!1,$window.addEventListener("native.keyboardshow",function(e){$timeout(function(){$ionicScrollDelegate.scrollTop(!0)})}),$scope.search={text:""},$scope.currentTab="all",$scope.$on("$viewContentLoaded",function(event){contactListElem=document.getElementById("contactList"),Loader.showLoading(),getContacts()}),$scope.getContacts=function(val){$scope.currentTab=val?"app":"all",showAppContacts=val,getContacts(),$scope.isOnAllContactsTab=!val},"/group-recipient-detail-list"==prevView&&(fromGroupRecipientView=!0),$scope.selectContact=function(index,mIndex){finalContacts[mIndex].isTick=!finalContacts[mIndex].isTick,$scope.contacts[index].isTick=finalContacts[mIndex].isTick;var contact=finalContacts[mIndex];if(contact.isTick){var contactData=extractContactData(contact);Object.keys(contactData).length&&selectedContacts.push(contactData)}else{var selectedContactIndex=getContactIndexInSelectedContacts(contact);selectedContactIndex>-1&&selectedContacts.splice(selectedContactIndex,1)}toggleNextButton()},$scope.loadMoreContacts=function(){$scope.contacts.length>contactsLoadedCount&&(createContactHtml(getLimitedContacts($scope.contacts,contactsLoadedCount,contactsLimit)),changingCounts())},$scope.searchContacts=function(e){stopPropagationEvents(e),$scope.currentTab="search",$scope.isSearch=!0,Utility.setShowRightButton2(!1)},$scope.serachDone=function(e){$timeout(function(){stopPropagationEvents(e),$scope.isSearch=!1,$scope.search.text="",$scope.getContacts(!1),window.scrollTo(0,0),Utility.setShowRightButton2(!0)},0)},$scope.searchClear=function(e){stopPropagationEvents(e),$scope.search.text="",$scope.getContacts(!1)},$scope.contactSearch=function(){timer&&clearTimeout(timer),timer=Utility.canRequest500MS(function(){$scope.search.text&&finalContacts&&finalContacts.length?($scope.contacts=finalContacts.filter(function(contact,index){return contact.mainIndex=index,getSearchedContact(contact,$scope.search.text)}),addHtml()):""===$scope.search.text&&$scope.getContacts(!1)},timer,500)},$scope.seacrhClick=function(e){$timeout(function(){stopPropagationEvents(e)},0)}}]);var contactListElem=null;angular.module("SocialAlarmsApp.contacts").controller("RecipientDetailCtrl",["$scope","$location","AppView","Utility","ViewManagement","Contacts","Loader","Store",function($scope,$location,AppView,Utility,ViewManagement,Contacts,Loader,Store){function takeBackToSendReminderView(){Store.setObject("selectedContacts",selectedContacts);var lastView=ViewManagement.popView();$location.path(lastView)}function getContactIndexInSelectedContacts(contact){var contactIndex=-1;if(!contact)return contactIndex;for(var i=0;i<selectedContacts.length;i++){var singleSelectedContact=selectedContacts[i];contact.name||contact.name&&contact.name.formatted||"(No Name)";if(contact.name==singleSelectedContact.name){contactIndex=i;break}}return contactIndex}var selectedContacts=Store.getObject("selectedContacts")||[];selectedContacts.map(function(contact){contact.isTick=!0}),AppView.setBodyClass("view-recipient-contact"),Utility.setHeader(!0,{title:"Recipient Details",showBackButton:!0,showRightButton:!0,rightButtonCallback:takeBackToSendReminderView,rightButtonText:"Done"}),Utility.setFooter(!0),ViewManagement.pushView("/recipient-details"),$scope.contacts=angular.copy(selectedContacts),$scope.selectedContactsCount=selectedContacts.length,$scope.moveToContact=function(){$location.path("/contacts")},$scope.selectContact=function(index){$scope.contacts[index].isTick=!$scope.contacts[index].isTick;var contact=$scope.contacts[index];if(contact.isTick)selectedContacts.push(contact);else{var selectedContactIndex=getContactIndexInSelectedContacts(contact);selectedContactIndex>-1&&selectedContacts.splice(selectedContactIndex,1)}$scope.selectedContactsCount=selectedContacts.length},$scope.$on("$viewContentLoaded",function(evt){})}]),angular.module("SocialAlarmsApp.contacts").controller("ReminderCtrl",["$scope","$stateParams","AppView","Utility","ViewManagement","SA","$filter","$location","Store","Calendar","$timeout","ToastMessage","Loader","FileFolder",function($scope,$stateParams,AppView,Utility,ViewManagement,SA,$filter,$location,Store,Calendar,$timeout,ToastMessage,Loader,FileFolder){function backBtnAudioCallback(e){$scope.doneRecording(e)}function extractDateTime(dateObj,timeObj){return new Date(dateObj.getFullYear(),dateObj.getMonth(),dateObj.getDate(),timeObj.getHours(),timeObj.getMinutes(),timeObj.getSeconds())}function saveState(){$scope.global.remNote&&$scope.global.remNote.length&&!isReminderSent?Store.setObject("reminderState",{remNote:$scope.global.remNote,dateTime:extractDateTime($scope.dateField,$scope.timeField)}):isReminderSent&&Store.removeObject("reminderState")}function restoreState(){var state=Store.getObject("reminderState");state&&$timeout(function(){$scope.global.remNote=state.remNote,$scope.datepickerObject.inputDate=new Date(state.dateTime),$scope.timePickerObject.inputEpochTime=60*new Date(state.dateTime).getHours()*60,$scope.dateValue=new Date(state.dateTime),$scope.dateField=angular.copy($scope.dateValue),$scope.timeField=new Date(state.dateTime)},0)}function reminderViewHandler(reminderData){$scope.global.remNote=reminderData.remindMessageText,$scope.readOnlyText=!0,$scope.dateField=new Date(reminderData.remindMessageDateTime),$scope.timeField=new Date(reminderData.remindMessageDateTime),$timeout(function(){Utility.setHeader(!0,{title:reminderData.senderName,showBackButton:!0,backButtonCallback:!1})},100)}function sendReminderToServer(){sendBtnTrigger=!1;var utcConvertedDateTime=moment(extractDateTime($scope.dateField,$scope.timeField)).utc().format(),zone=jstz&&jstz.determine().name()?jstz.determine().name():"",remindObj={reminderText:$scope.global.remNote,dateTime:utcConvertedDateTime,timeZone:zone,contacts:angular.toJson($scope.selectedContacts),preferredMethods:angular.toJson(["email"])};$scope.record.id&&(remindObj.mediaId=$scope.record.id),isSubmit=!0,SA.remindResource.sendReminder(remindObj).$promise.then(function(data){isSubmit=!1,Loader.hideLoading(),1==data.status?(isReminderSent=!0,Store.removeObject("selectedContacts"),Store.removeObject("selectedBulkContacts"),$timeout(function(){ToastMessage.reminderToast.reminderSent(selectedContactName);var v=ViewManagement.popView();$location.path(v)},0)):$timeout(function(){ToastMessage.reminderToast.cantSendReminder()},0)},function(err){isSubmit=!1,Loader.hideLoading(),$timeout(function(){ToastMessage.reminderToast.cantSendReminder(err.data)},0)})}AppView.setBodyClass("view-dashboard-send-reminder"),$scope.phoneContacts=Store.getObject("selectedContacts")||[],$scope.bulkContacts=Store.getObject("selectedBulkContacts")||[],$scope.selectedContacts=$scope.phoneContacts.concat($scope.bulkContacts);var selectedContactName;selectedContactName=$scope.selectedContacts&&$scope.selectedContacts.length?$scope.selectedContacts.length>1?"Multiple contacts":$scope.selectedContacts[0].name||"(No Name)":"",Utility.setHeader(!0,{title:"Remind "+selectedContactName,showBackButton:!0,backButtonCallback:!1}),Utility.setFooter(!0);var isReminderSent=!1,mediaRec=null,timeDurInterval=null,totalDur=0,maxRecDur=30,sendBtnTrigger=!1,isSubmit=!1;$scope.global={remNote:""},$scope.reminder={},$scope.readOnlyText=!1,$scope.dateValue=new Date,$scope.dateField=new Date,$scope.timeField=new Date,$scope.isMobile=Utility.isMobileDevice(),$scope.isApp=Utility.isApp(),$scope.durationCounter=0,$scope.datepickerObject={titleLabel:"Date Picker",todayLabel:"Today",closeLabel:"Close",setLabel:"Set",setButtonType:"button-assertive",todayButtonType:"button-assertive",closeButtonType:"button-assertive",inputDate:new Date,mondayFirst:!0,templateType:"popup",modalHeaderColor:"bar-positive",modalFooterColor:"bar-positive",from:new Date(2012,8,2),to:new Date(2018,8,25),callback:function(val){val&&($scope.dateField=angular.copy(val),$scope.datepickerObject.inputDate=angular.copy(val))}};var timePickerDate=new Date;if(timePickerDate.setMinutes(0),timePickerDate.setHours(timePickerDate.getHours()+1),$scope.timePickerObject={inputEpochTime:60*timePickerDate.getHours()*60,step:15,format:12,titleLabel:"Time Picker",setLabel:"Set",closeLabel:"Close",setButtonType:"button-positive",closeButtonType:"button-stable",callback:function(val){if(val){var date=moment().startOf("day").seconds(val);$scope.timeField=new Date(date.toISOString()),$scope.timePickerObject.inputEpochTime=val}}},$scope.gotoRecipientDetails=function(){$scope.phoneContacts.length&&$location.path("/recipient-details")},$scope.$on("$stateChangeSuccess",function(event,current){Loader.hideLoading()}),$scope.$on("$stateChangeStart",function(event,current){isReminderSent?Store.removeObject("reminderState"):saveState()}),$scope.$on("$viewContentLoaded",function(){var path=$location.path();if(Store.getObject("reminderId")){$scope.isViewMode=!0,ViewManagement.pushView("/reminder");var reminderId=Store.getObject("reminderId");Store.removeObject("reminderId"),SA.remindResource.getNewReminderDetail(reminderId).$promise.then(function(reminderData){$scope.reminder=reminderData,reminderViewHandler(reminderData)},function(err){ToastMessage.reminderToast.serverError(err.errorMsg||err.infoMsg)})}else"/respond/reminders"==path?($scope.isViewMode=!0,$scope.reminder=Store.getObject("reminder"),Store.removeObject("reminder"),reminderViewHandler($scope.reminder)):(restoreState(),$scope.isViewMode=!1,ViewManagement.pushView("/reminder"))}),$scope.sendReminder=function(){var utcConvertedDateTime=moment(extractDateTime($scope.dateField,$scope.timeField)).utc().format();$scope.global.remNote?moment(utcConvertedDateTime)<moment()?ToastMessage.reminderToast.cantSetInPast():$scope.selectedContacts.length?(Loader.showLoading(),sendBtnTrigger=!0,($scope.record.hasRecord&&$scope.record.isUploaded||!$scope.record.hasRecord)&&(isSubmit||sendReminderToServer())):ToastMessage.reminderToast.noContacts():$timeout(function(){ToastMessage.reminderToast.noteEmpty()},0)},$scope.moveToRemindPeople=function(){$location.path("/remindPeople")},$scope.datePicker=function(){if(!$scope.readOnlyText){var options={date:$scope.dateField||new Date,mode:"date"};datePicker.show(options,function(date){$scope.dateField=date?date:$scope.dateField,$scope.$apply()})}},$scope.timePicker=function(){if(!$scope.readOnlyText){var options={date:$scope.timeField||new Date,mode:"time"};datePicker.show(options,function(time){$scope.timeField=time?time:$scope.timeField,$scope.$apply()})}},$scope.record={showRecordView:!1,isRecording:!1,isPlaying:!1,hasRecord:!1,path:"",nativeURL:"",name:"",id:"",blobURL:"",duration:0,isUploaded:!1},Store.getObject("record")){$scope.record=Store.getObject("record");var path=$scope.record.nativeURL;Utility.isIOS()&&(path="documents://"+$scope.record.path),mediaRec=new Media(path,function(data){$timeout(function(){mediaRec.release(),$scope.record.isRecording=!1,$scope.record.hasRecord=!0,$scope.record.isPlaying=!1,$scope.durationCounter=$scope.record.duration},0)},function(err){$timeout(function(){$scope.record.isRecording=!1,$scope.record.hasRecord=$scope.record.hasRecord||!1,$scope.record.isPlaying=!1},0)})}$scope.selectAudio=function(event){Utility.isApp()?(Utility.setHeader(!1,{}),$scope.record.showRecordView=!0,$scope.record.hasRecord||$scope.startRecording(event)):ToastMessage.commonToast.downloadApp()},$scope.startRecording=function(event){var filename="myrecording2.wav";FileFolder.createSentFolderAndFile(filename,function(file){var path=file.nativeURL;Utility.isIOS()&&(path="documents://"+file.fullPath),mediaRec=new Media(path,function(data){$timeout(function(){mediaRec.release(),$scope.record.path=file.fullPath,$scope.record.nativeURL=file.nativeURL,$scope.record.name=file.name,$scope.record.isRecording=!1,$scope.record.hasRecord=!0,$scope.record.isPlaying=!1},0)},function(err){$timeout(function(){$scope.record.isRecording=!1,$scope.record.hasRecord=$scope.record.hasRecord||!1,$scope.record.isPlaying=!1,$scope.stopRecording(event)},0)}),mediaRec.startRecord(),$scope.durationCounter=maxRecDur,$timeout(function(){$scope.record.isRecording=!0,timeDurInterval=Utility.countInterval(0,maxRecDur,"reverse",function(counter){$timeout(function(){$scope.durationCounter=counter-1|0,totalDur=counter-1|0},0)},function(){$timeout(function(){$scope.stopRecording(event),timeDurInterval=null},0)})},0),Utility.setHeader(!1,{})})},$scope.stopRecording=function(event){timeDurInterval&&(clearInterval(timeDurInterval),timeDurInterval=null),$scope.record.isPlaying?$scope.stopAudio(event):mediaRec&&$scope.record.isRecording===!0&&(mediaRec.stopRecord(),$scope.durationCounter=maxRecDur-totalDur|0,$scope.record.duration=maxRecDur-totalDur|0,$scope.record.isRecording=!1)},$scope.playRecording=function(event){mediaRec&&(mediaRec.play(),mediaRec.pause(),$scope.record.isPlaying=!0,$scope.durationCounter=0,mediaRec.play(),$timeout(function(){timeDurInterval=Utility.countInterval(0,0|mediaRec.getDuration(),"forward",function(counter){$timeout(function(){$scope.durationCounter=counter+1|0},0)},function(){$timeout(function(){$scope.stopAudio(event),$scope.durationCounter=0|mediaRec.getDuration(),timeDurInterval=null},0)})},0))},$scope.stopAudio=function(event){mediaRec&&$timeout(function(){$scope.record.isPlaying=!1,mediaRec.stop()},0)},$scope.doneRecording=function(event){$scope.record.isRecording||($scope.record.showRecordView=!1,$scope.record.isPlaying=!1,Utility.setHeader(!0,{title:"Remind "+selectedContactName,showBackButton:!0,backButtonCallback:!1}),mediaRec&&!$scope.record.id&&$timeout(function(){SA.mediaResource.audioUpload({name:$scope.record.name,nativeURL:$scope.record.nativeURL}).then(function(data){var res=data.response&&JSON.parse(data.response)?JSON.parse(data.response):null;res&&($scope.record.isUploaded=!0,$scope.record.id=res._id,$scope.record.blobURL=res.url,Store.setObject("record",angular.copy($scope.record)),sendBtnTrigger&&(sendReminderToServer(),sendBtnTrigger=!1))},function(err){$scope.record.isUploaded=!1,sendBtnTrigger=!1})},1e3))},$scope.deleteRecording=function(event){mediaRec&&!$scope.record.isRecording&&(mediaRec=null,$scope.record.path="",$scope.record.nativeURL="",$scope.record.isRecording=!1,$scope.record.hasRecord=!1,$scope.record.showRecordView=!0,$scope.record.isPlaying=!1,$scope.record.id="",$scope.record.blobURL="",$scope.record.duration=0,$scope.record.isUploaded=!1,$scope.durationCounter=0),Utility.setHeader(!0,{title:"",showBackButton:!0,backButtonCallback:backBtnAudioCallback,showMenuIcon:!1,transparent:!0})}}]),angular.module("SocialAlarmsApp.general",["ngRoute","services.socialAlarms","services.cordova"]).config(["$stateProvider","$urlRouterProvider",function($stateProvider,$urlRouterProvider){$stateProvider.state("dashboard",{url:"/dashboard",templateUrl:"views/General/Dashboard.html",controller:"DashboardCtrl"}).state("home",{url:"/home",templateUrl:"views/General/Home.html",controller:"HomeCtrl"}).state("respond/reminders",{url:"/respond/reminders",templateUrl:"views/Contacts/SendReminder.html",controller:"ReminderCtrl"}).state("feedback",{url:"/feedback",templateUrl:"views/Settings/Feedback.html",controller:"FeedbackCtrl"}).state("settings",{url:"/settings",templateUrl:"views/Settings/Setting.html",controller:"SettingCtrl",resolve:{user:function($q,Store){return Store.getObject("user")}}})}]),angular.module("SocialAlarmsApp.general").controller("DashboardCtrl",["$scope","$location","$timeout","$route","AppView","Utility","ViewManagement","SA","Contacts","Store","ToastMessage","State","Calendar","Loader",function($scope,$location,$timeout,$route,AppView,Utility,ViewManagement,SA,Contacts,Store,ToastMessage,State,Calendar,Loader){function getReceivedReminders(type,action){type&&(Loader.showLoading(),SA.remindResource.getReminder({filter:"IN",limit:pageSize,skip:"refresh"===action?0:"P"===type?$scope.requestedReminders.length:$scope.myReminders.length,ack_status:type}).$promise.then(function(data){"P"===type?(isGetReminderP=!0,$scope.showSpinnerOnce=!1):"A"===type&&(isGetReminderA=!0),clearLoader(),data&&data.length&&("P"===type?("refresh"===action&&($scope.requestedReminders=[]),[].push.apply($scope.requestedReminders,data||[])):"A"===type&&("refresh"===action&&($scope.myReminders=[]),[].push.apply($scope.myReminders,data||[]))),data&&data.length>=pageSize?"P"===type?$scope.moreReminders.requestedReminders=!0:"A"===type&&($scope.moreReminders.myReminders=!0):"P"===type?$scope.moreReminders.requestedReminders=!1:"A"===type&&($scope.moreReminders.myReminders=!1),"refresh"===action?$scope.$broadcast("scroll.refreshComplete"):"more"===action&&$scope.$broadcast("scroll.infiniteScrollComplete")},function(err){"P"===type?(isGetReminderP=!0,$scope.showSpinnerOnce=!1):"A"===type&&(isGetReminderA=!0),clearLoader(),ToastMessage.home.loadFailed(),"refresh"===action?$scope.$broadcast("scroll.refreshComplete"):"more"===action&&$scope.$broadcast("scroll.infiniteScrollComplete")}))}function getSentReminders(action){SA.remindResource.getAllReminders({limit:pageSize,skip:"refresh"===action?0:$scope.sentReminders.length}).$promise.then(function(data){if(isGetAllReminders=!0,clearLoader(),data&&data.length){"refresh"===action&&($scope.sentReminders=[]);var recvName="";data.forEach(function(reminder){"G"===reminder.status&&(reminder.contacts.forEach(function(contact){recvName+=""===recvName?contact.name||contact.reg_email:", "+(contact.name||contact.reg_email)}),reminder.receiverName=recvName)}),[].push.apply($scope.sentReminders,data)}data&&data.length>=pageSize?$scope.moreReminders.sentReminders=!0:$scope.moreReminders.sentReminders=!1,"refresh"===action?$scope.$broadcast("scroll.refreshComplete"):"more"===action&&$scope.$broadcast("scroll.infiniteScrollComplete")},function(err){clearLoader(),isGetAllReminders=!0,"refresh"===action?$scope.$broadcast("scroll.refreshComplete"):"more"===action&&$scope.$broadcast("scroll.infiniteScrollComplete")})}function rightButtonCallback(){Utility.clearSelectedPeople(),$location.path("/reminder")}function clearLoader(){isGetReminderA&&isGetReminderP&&isGetAllReminders&&(Loader.hideLoading(),isGetReminderA=!1,isGetReminderP=!1,isGetAllReminders=!1)}AppView.setBodyClass("view-dashboard"),Utility.setHeader(!0,{title:"Dashboard",showBackButton:!1,backButtonCallback:!1,showRightButton:!0,rightButtonCallback:rightButtonCallback,rightButtonText:"Send",showMenuIcon:!0}),ViewManagement.pushView("/dashboard"),$scope.requestedReminders=[],$scope.sentReminders=[],$scope.myReminders=[],$scope.moreReminders={requestedReminders:!0,sentReminders:!0,myReminders:!0},$scope.showSpinnerOnce=!0;var pageSize=Utility.isApp()?5:10,isGetReminderA=!1,isGetReminderP=!1,isGetAllReminders=!1;$scope.$on("$viewContentLoaded",function(event){getReceivedReminders("P"),getReceivedReminders("A"),
getSentReminders()}),$scope.goToView=function(view){$location.path(view)},$scope.acceptReminder=function(id,index){function onCalendarSuccess(){$timeout(function(){ToastMessage.reminderToast.setOnCalendar()},0)}function onCalendarError(){$timeout(function(){ToastMessage.reminderToast.cantSetReminder()},0)}var forPostRequest={reminderStatusId:id,type:"accept"};SA.remindResource.reminderResponse(forPostRequest).$promise.then(function(data){1===data.status&&(Utility.isMobileDevice()?Calendar.createCalendarEvent($scope.requestedReminders[index].reminder.content.substring(0,15),$scope.requestedReminders[index].reminder.content.substring(0,15),new Date($scope.requestedReminders[index].reminder.remindDate),onCalendarSuccess,onCalendarError):ToastMessage.reminderToast.reminderAccepted(),$scope.requestedReminders.splice(index,1),$scope.myReminders=[],getReceivedReminders("A"))},function(err){ToastMessage.reminderToast.networkError()})},$scope.rejectReminder=function(id,index){var forPostRequest={reminderStatusId:id,type:"reject"};SA.remindResource.reminderResponse(forPostRequest).$promise.then(function(data){ToastMessage.reminderToast.gotRidOfReminder(),$scope.requestedReminders.splice(index,1)},function(err){ToastMessage.reminderToast.serverError(err.data||err.infoMsg)})},$scope.requestedReminderSelected=function(index){var reminder=$scope.requestedReminders[index];Store.setObject("reminder",reminder),$location.path("/respond/reminders")},$scope.myReminderSelected=function(index){var reminder=$scope.myReminders[index];Store.setObject("reminder",reminder),$location.path("/respond/reminders")},$scope.reminderSelected=function(index,type){var reminder="";"Requested"===type?reminder=$scope.requestedReminders[index]:"Sent"===type?(reminder=$scope.sentReminders[index],State.setStateVar("SentReminder",reminder)):"My"===type&&(reminder=$scope.myReminders[index]),$location.path("/reminderDetail/"+type+"/"+reminder._id)},$scope.showMenu=function(){Utility.setMenu(!0)},$scope.showSendReminder=function(){rightButtonCallback()},$scope.loadMoreReminders=function(catogory){"requestedReminders"===catogory?getReceivedReminders("P","more"):"myReminders"===catogory?getReceivedReminders("A","more"):"sentReminders"===catogory&&getSentReminders("more")},$scope.doRefresh=function(catogory){"requestedReminders"===catogory?getReceivedReminders("P","refresh"):"myReminders"===catogory?getReceivedReminders("A","refresh"):"sentReminders"===catogory&&getSentReminders("refresh")}}]),angular.module("SocialAlarmsApp.general").controller("FeedbackCtrl",["$scope","$filter","AppView","Utility","SA","ToastMessage",function($scope,$filter,AppView,Utility,SA,ToastMessage){function getFeedbackCount(){return SA.loginResource.countFeedbacks().$promise.then(function(res){totalFeedback=res.count},function(err){ToastMessage.feedback.getServerError()})}function getFeedbacks(){return SA.loginResource.getFeedbacks({limit:$scope.feedbacks.length+pageSize,skip:$scope.feedbacks.length}).$promise.then(function(data){[].push.apply($scope.feedbacks,data),$scope.isMoreFeedbacks=$scope.feedbacks.length<totalFeedback&&0!=$scope.feedbacks.length},function(err){ToastMessage.feedback.getServerError()})}function voteFeedback(feedback,voteType,localScope){var alreadyVoted=!1,userId=localStorage.getItem("userId")||"";"DOWN"===voteType?feedback.downVotes.forEach(function(vote,i){vote===userId&&(ToastMessage.feedback.alreadyVoted(),alreadyVoted=!0)}):feedback.upVotes.forEach(function(vote,i){vote===userId&&(ToastMessage.feedback.alreadyVoted(),alreadyVoted=!0)}),alreadyVoted||(localScope.voteInProgress=!0,SA.loginResource.voteFeedback({type:voteType,id:feedback._id}).$promise.then(function(data){feedback.upVotes=data.upVotes,feedback.up_vote_count=data.up_vote_count,feedback.downVotes=data.downVotes,ToastMessage.feedback.voteServerSuccess(),localScope.voteInProgress=!1},function(err){ToastMessage.feedback.voteServerError(),localScope.voteInProgress=!1}))}var pageSize=5,type="Suggestion",totalFeedback=0;AppView.setBodyClass("view-user-settings send-feedback"),Utility.setHeader(!0,{title:"Feedback",showBackButton:!1,backButtonCallback:!1,showMenuIcon:!0}),$scope.currentTab="SHOW",$scope.feedbacks=[],$scope.feedbackTypes=[{type:"Suggestion",selected:!0},{type:"Praise",selected:!1},{type:"Bug",selected:!1}],$scope.isMoreFeedbacks=!1,getFeedbackCount().then(function(){getFeedbacks()}),$scope.setType=function(index){$scope.feedbackTypes.forEach(function(feedback){feedback.selected=!1}),$scope.feedbackTypes[index].selected=!0,type=$scope.feedbackTypes[index].type},$scope.getMoreFeedbacks=getFeedbacks,$scope.voteUp=function(feedBackId){voteFeedback(feedBackId,"UP",this)},$scope.voteDown=function(feedBackId){voteFeedback(feedBackId,"DOWN",this)},$scope.sendFeedback=function(){$scope.feedback?SA.loginResource.sendFeedback({type:type,feedback:$scope.feedback}).$promise.then(function(data){ToastMessage.feedback.showSuccess(),$scope.feedback=""},function(err){ToastMessage.feedback.showServerError()}):ToastMessage.feedback.showEmptyFeedback()}}]),angular.module("SocialAlarmsApp.general").controller("HomeCtrl",["$scope","$location","AppView","Utility","ViewManagement","SA","Contacts","Store","ToastMessage","State",function($scope,$location,AppView,Utility,ViewManagement,SA,Contacts,Store,ToastMessage,State){function rightButtonCallback(){Store.removeItem("selectedContacts"),$location.path("/reminder")}AppView.setBodyClass("view-login"),Utility.setHeader(!0,{title:"Reminders",showBackButton:!0,backButtonCallback:!1,showRightButton:!0,rightButtonCallback:rightButtonCallback,rightButtonText:"Send",showMenuIcon:!1}),Utility.setFooter(!0),ViewManagement.pushView("/home");var reminderReceivedKey="RecvAndAccepted";$scope.$on("$viewContentLoaded",function(event){SA.remindResource.getReminder({filter:"IN"}).$promise.then(function(data){var rems=data.reminders;rems.sort(function(a,b){return a.dateTime>b.dateTime?-1:a.dateTime<b.dateTime?1:0}),State[reminderReceivedKey]=rems.filter(function(reminder){return"A"==reminder.reminderStatus}),$scope.reminders=$scope.reminders=rems.filter(function(reminder){return"P"===reminder.reminderStatus})},function(err){ToastMessage.home.loadFailed()})}),$scope.reminderSelected=function(index){var reminder=$scope.reminders[index];Store.setObject("reminder",reminder),$location.path("/respond/reminders")}}]),angular.module("SocialAlarmsApp.general").controller("SettingCtrl",["$scope","$timeout","$filter","$window","AppView","Utility","user","Store","SA","Keyboard","ToastMessage","Loader","$ionicScrollDelegate",function($scope,$timeout,$filter,$window,AppView,Utility,user,Store,SA,Keyboard,ToastMessage,Loader,$ionicScrollDelegate){if(AppView.setBodyClass("view-user-settings"),Utility.setHeader(!0,{title:"Profile",showBackButton:!1,backButtonCallback:!1,showMenuIcon:!0,transparent:!1}),Utility.setFooter(!0),$scope.user=user,$scope.editableFields=!1,$scope.edituser={name:$scope.user.name||$scope.user.email},$scope.editProfile=function(){$scope.editableFields=!0,$timeout(function(){document.getElementById("name_edit").focus(),Utility.isApp()&&Keyboard.show(function(){$timeout(function(){window.scrollTo(0,document.body.scrollHeight)},300)})},100)},$scope.saveProfile=function(){Utility.isApp()&&$timeout(function(){Keyboard.close()},300),$scope.editableFields=!1,$scope.user.name!==$scope.edituser.name&&($scope.user.name=$scope.edituser.name,Loader.showLoading(),SA.userResource.changeName({name:$scope.user.name}).$promise.then(function(data){Loader.hideLoading(),ToastMessage.userToast.nameChangeSuccess();var user=Store.getObject("user");user.name=$scope.edituser.name,Store.setObject("user",user)},function(err){Loader.hideLoading(),ToastMessage.userToast.failed(err.errorMsg||err.infoMsg)}))},$window.addEventListener("native.keyboardshow",function(e){$timeout(function(){$ionicScrollDelegate.scrollBottom(!0)})}),$window.addEventListener("native.keyboardhide",function(e){$timeout(function(){$ionicScrollDelegate.scrollTop(!0)})}),!document.getElementById("dynamic-image")){var picLink=Store.getObject("user")&&Store.getObject("user").picture?Store.getObject("user").picture:$filter("avatarLink")(Store.getObject("user").email),style=document.createElement("style");style.id="dynamic-image",style.type="text/css",style.innerHTML+='.view-user-settings .large-picture { background: linear-gradient(to right, rgba(254, 93, 79, 0.8), rgba(254, 93, 79, 0.8)), url("'+picLink+'") no-repeat center top/cover transparent !important }',document.getElementsByTagName("head")[0].appendChild(style)}}]),angular.module("SocialAlarmsApp.groups",["ngRoute","services.socialAlarms"]).config(["$stateProvider","$urlRouterProvider",function($stateProvider,$urlRouterProvider){$stateProvider.state("groups",{url:"/groups",templateUrl:"views/Groups/Groups.html",controller:"GroupsCtrl"}).state("groups/:groupId",{url:"/groups/:groupId",templateUrl:"views/Groups/GroupDetail.html",controller:"GroupCtrl"}).state("group-recipient-detail-list",{url:"/group-recipient-detail-list",templateUrl:"views/Groups/groupRecipientDetailList.html",controller:"GroupRecipientListCtrl"}).state("remindPeople",{url:"/remindPeople",templateUrl:"views/Groups/RemindPeople.html",controller:"RemindPeopleCtrl"}).state("fbGroups",{url:"/fbGroups",templateUrl:"views/Groups/FBGroupList.html",controller:"FBGroupListCtrl"})}]),angular.module("SocialAlarmsApp.groups").controller("GroupCtrl",GroupsCtrl),angular.module("SocialAlarmsApp.groups").controller("GroupRecipientListCtrl",GroupRecipientListCtrl),angular.module("SocialAlarmsApp.groups").controller("GroupsCtrl",GroupsCtrl),angular.module("SocialAlarmsApp.groups").controller("FBGroupListCtrl",["$scope","$location","$timeout","SA","AppView","Utility","ViewManagement","Loader","FBIntegration","Store",function($scope,$location,$timeout,SA,AppView,Utility,ViewManagement,Loader,FBIntegration,Store){function nextButtonCallback(){$timeout(function(){$scope.selectedGroups&&$scope.selectedGroups.length&&(Store.setObject("selectedFbGroups",angular.copy($scope.selectedGroups)),$location.path(ViewManagement.popView()))},0)}function toggleNextButton(){$scope.selectedGroups&&$scope.selectedGroups.length?Utility.isShowNextButton(!0):Utility.isShowNextButton(!1)}AppView.setBodyClass("view-contacts"),Utility.setHeader(!0,{title:"Facebook Groups",showBackButton:!0,backButtonCallback:!1,showRightButton:!1,nextButtonCallback:nextButtonCallback,rightButtonCallback:nextButtonCallback,rightButtonText:"Done",showMenuIcon:!1}),Utility.setFooter(!0),ViewManagement.pushView("/fbGroups"),$scope.fbGroups=[],$scope.selectedGroups=[],$scope.paging={},$scope.$on("$viewContentLoaded",function(){Loader.showLoading(),FBIntegration.isFBConnected()?SA.fbResource.getMyGroups().then(function(data){console.log(data),data.data&&data.data.length&&($scope.paging=data.paging,data.data.forEach(function(group,index){group.isTick=!1,$scope.fbGroups.push(group)}),console.log($scope.fbGroups)),Loader.hideLoading()},function(err){Loader.hideLoading(),console.log(err)}):Loader.hideLoading()}),$scope.toggleSelectedGroup=function(index){$scope.fbGroups[index].isTick?($scope.fbGroups[index].isTick=!$scope.fbGroups[index].isTick,$scope.selectedGroups.forEach(function(group,i){group.name===$scope.fbGroups[index].name&&$scope.selectedGroups.splice(i,1)})):($scope.fbGroups[index].isTick=!$scope.fbGroups[index].isTick,$scope.selectedGroups.push(angular.copy($scope.fbGroups[index]))),toggleNextButton()},$scope.loadMore=function(){$scope.paging&&$scope.paging.cursors&&$scope.paging.cursors.after&&(Loader.showLoading(),SA.fbResource.getMoreMyGroups({after:$scope.paging.cursors.after}).then(function(data){console.log(data),data.data&&data.data.length&&($scope.paging=data.paging,data.data.forEach(function(group,index){group.isTick=!1,$scope.fbGroups.push(group)}),console.log($scope.fbGroups)),Loader.hideLoading()},function(err){Loader.hideLoading(),console.log(err)}))}}]),angular.module("SocialAlarmsApp.groups").controller("RemindPeopleCtrl",["$scope","$location","AppView","Utility","Store","ViewManagement","FBIntegration","ToastMessage",function($scope,$location,AppView,Utility,Store,ViewManagement,FBIntegration,ToastMessage){function stopPropagationEvents(e){e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation()}function rightButtonCallback(){$location.path(ViewManagement.popView())}AppView.setBodyClass("view-dashboard-send-reminder"),Utility.setHeader(!0,{title:"Remind People",showBackButton:!0,backButtonCallback:!1,showMenuIcon:!1,showRightButton:!1,rightButtonCallback:rightButtonCallback,rightButtonText:"Done"}),Utility.setFooter(!0),ViewManagement.pushView("/remindPeople"),$scope.fbConnected=FBIntegration.isFBConnected(),$scope.isApp=Utility.isApp(),$scope.phoneContacts=Store.getObject("selectedContacts")||[],$scope.bulkContacts=Store.getObject("selectedBulkContacts")||[],$scope.fbGroups=Store.getObject("selectedFbGroups")||[],($scope.phoneContacts&&$scope.phoneContacts.length||$scope.bulkContacts&&$scope.bulkContacts.length)&&Utility.isShowNextButton(!0),$scope.gotoRecipientDetails=function(e){Utility.isApp()?$scope.phoneContacts.length?$location.path("/recipient-details"):$scope.moveToContacts(e):ToastMessage.commonToast.downloadApp()},$scope.moveToContacts=function(e){Utility.isApp()?(stopPropagationEvents(e),$location.path("/contacts")):ToastMessage.commonToast.downloadApp()},$scope.moveToBulkInvite=function(e){stopPropagationEvents(e),$location.path("/bulk-invite")},$scope.moveToFbGroups=function(e){stopPropagationEvents(e),$location.path("/fbGroups")}}]),angular.module("SocialAlarmsApp.login",["ngRoute","services.socialAlarms"]).config(["$stateProvider","$urlRouterProvider",function($stateProvider,$urlRouterProvider){$urlRouterProvider.otherwise("/login"),$stateProvider.state("login",{url:"/login",templateUrl:"views/Login/Login.html",controller:"LoginCtrl",resolve:{loggedIn:function(Context){return Context.hasAccessToken()}}}).state("forgetPassword",{url:"/forgetPassword",templateUrl:"views/ForgetPassword/Forget.html",controller:"ForgotPassCtrl"})}]),angular.module("SocialAlarmsApp.login").controller("ForgotPassCtrl",["$scope","$location","AppView","Utility","ViewManagement","SA","ToastMessage",function($scope,$location,AppView,Utility,ViewManagement,SA,ToastMessage){AppView.setBodyClass("view-login"),Utility.setHeader(!0,{title:"Forget Password",showBackButton:!0,backButtonCallback:!1,showMenuIcon:!1}),Utility.setFooter(!1),ViewManagement.pushView("/forgetPassword"),$scope.emailNotFound=!1,$scope.email="",$scope.sendEmail=function(){var obj={type:"password",email:$scope.email};$scope.email.length?SA.loginResource.forgotPass(obj).$promise.then(function(data){1==data.status?(ToastMessage.forgotPass.linkSent(),$location.path(ViewManagement.popView())):$scope.emailNotFound=!0},function(err){ToastMessage.forgotPass.failed(err.data.errorMsg)}):ToastMessage.forgotPass.emailEmpty()}}]),angular.module("SocialAlarmsApp.login").controller("LaunchCtrl",["$scope","$location","AppView","Utility","ViewManagement","Context","SA","loggedIn",function($scope,$location,AppView,Utility,ViewManagement,Context,SA,loggedIn){AppView.setBodyClass("view-login launch"),Utility.setHeader(!1),Utility.setFooter(!1),ViewManagement.pushView("/launch"),$scope.goToLogin=function(){$location.path("/login")},$scope.goToSignUp=function(){$location.path("/signUp")},$scope.$on("$routeChangeSuccess",function(){loggedIn&&$location.path("/dashboard")})}]),angular.module("SocialAlarmsApp.login").controller("LoginCtrl",["$scope","$location","AppView","Utility","ViewManagement","Context","SA","loggedIn","Store","Device","PushNotification","Loader","FBIntegration",function($scope,$location,AppView,Utility,ViewManagement,Context,SA,loggedIn,Store,Device,PushNotification,Loader,FBIntegration){function validateLoginFields(){return validateUsername()&&validatePassword()?!0:!1}function validateUsername(){return""===$scope.loginObj.username?($scope.isErrorUsername=!0,$scope.errorText="Username required",!1):!0}function validatePassword(){return""===$scope.loginObj.password?($scope.isErrorPassword=!0,$scope.errorText="Password required",!1):$scope.loginObj.password.length<8?($scope.isErrorPassword=!0,$scope.errorText="Username or Password is wrong",!1):!0}function loginSuccess(data){if(isSubmit=!1,Loader.hideLoading(),data&&1===data.status){var prevUserId=localStorage.getItem("userId");prevUserId!=data.userId&&localStorage.clear(),localStorage.setItem("userId",data.userId),Store.setObject("user",data.user),Context.setAccessToken(data.accessToken),SA.init(),Utility.isApp()&&PushNotification.register(),data.isVerified===!1?$location.path("/confirmation"):$location.path("/dashboard")}else $scope.errorText=data.errorMsg||"Username or Password is wrong"}function loginError(data){isSubmit=!1,Loader.hideLoading(),$scope.isErrorPassword=!0,navigator.onLine?$scope.errorText=data.data.errorMsg||"Unsuccessful login":$scope.errorText="Oops! Your internet seems down"}AppView.setBodyClass("view-launch-login"),Utility.setHeader(!1,{title:"Login",showBackButton:!1,backButtonCallback:!1}),Utility.setFooter(!1),ViewManagement.pushView("/login");var isSubmit=!1;$scope.loginObj={username:"",password:""},$scope.$on("$stateChangeSuccess",function(){loggedIn&&$location.path("/dashboard")}),$scope.loginSubmit=function(){if(!isSubmit&&validateLoginFields()){var loginObj={email:$scope.loginObj.username,password:$scope.loginObj.password,type:"NORMAL"};Loader.showLoading(),Utility.isApp()?Device.getDeviceId().then(function(udid){udid&&(isSubmit=!0,loginObj.deviceId=udid,SA.loginResource.login(loginObj).$promise.then(loginSuccess,loginError))}):(isSubmit=!0,SA.loginResource.login(loginObj).$promise.then(loginSuccess,loginError))}},$scope.signup=function(){$location.path("/signUp")},$scope.forgotPassword=function(){$location.path("/forgetPassword")},$scope.fblogin=function(){FBIntegration.login()},$scope.inputKeyUpUsername=function(){$scope.isErrorUsername=!1,$scope.errorText=""},$scope.inputKeyUpPassword=function(){$scope.isErrorPassword=!1,$scope.errorText=""};var successCallback=function(result){console.log("wakeup alarm detected-- "+result)},errorCallback=function(result){console.log("wakeup alarm detected-- "+result)};$scope.setAlarm=function(){var alarms={type:"snooze",time:{seconds:60},extra:{},message:"Hello!!"};console.log("set Alarm"),window.wakeuptimer.snooze(successCallback,errorCallback,alarms)}}]),angular.module("SocialAlarmsApp.reminderStats",["ngRoute","services.socialAlarms"]).config(["$stateProvider","$urlRouterProvider",function($stateProvider,$urlRouterProvider){$stateProvider.state("reminderStats",{url:"/reminderStats",templateUrl:"views/Reminders/ReminderStats.html",controller:"reminderStatsCtrl"}).state("reminderStatsDetail/:id",{url:"/reminderStatsDetail/:id",templateUrl:"views/Reminders/ReminderStatsDetail.html",controller:"reminderStatsDetailCtrl"})}]),angular.module("SocialAlarmsApp.reminderStats").controller("reminderStatsCtrl",["$scope","$location","AppView","Utility","ViewManagement","SA","State",function($scope,$location,AppView,Utility,ViewManagement,SA,State){AppView.setBodyClass("view-igis"),Utility.setHeader(!0,{title:"Reminder Stats",showBackButton:!1,backButtonCallback:!1,showMenuIcon:!0}),Utility.setFooter(!0),ViewManagement.pushView("/reminderStats");var allReminders=[],reminderReceivedKey="RecvAndAccepted",acceptedReminders=State[reminderReceivedKey];$scope.showSentReminders=!0,$scope.sentRemindersClass="active",$scope.myRemindersClass="simple",$scope.acceptedReminders=acceptedReminders||[],$scope.acceptedCount=acceptedReminders&&acceptedReminders.length||0,$scope.GetAllSentReminder=function(){SA.remindResource.getAllReminders().$promise.then(function(data){$scope.sentReminders=data.reminders,allReminders=data.reminders},function(err){})},$scope.tabChanged=function(index){1==index?($scope.showSentReminders=!0,$scope.sentRemindersClass="active",$scope.myRemindersClass="simple"):2==index&&($scope.showSentReminders=!1,$scope.sentRemindersClass="simple",$scope.myRemindersClass="active")},$scope.reminderDetail=function(index){$scope.sentReminders[index]&&$scope.sentReminders[index]._id&&$location.path("/reminderStatsDetail/"+$scope.sentReminders[index]._id)},$scope.$on("$viewContentLoaded",function(){SA.remindResource.getAllReminders().$promise.then(function(data){allReminders=data.reminders.sort(function(a,b){return a.dateTime>b.dateTime?-1:a.dateTime<b.dateTime?1:0}),$scope.sentReminders=allReminders,$scope.allCount=allReminders.length},function(err){}),SA.remindResource.getReminder({filter:"IN"}).$promise.then(function(data){var rems=data.reminders;rems=rems.filter(function(reminder){return"A"==reminder.reminderStatus}),rems.sort(function(a,b){return a.dateTime>b.dateTime?-1:a.dateTime<b.dateTime?1:0}),$scope.acceptedReminders=rems||[],$scope.acceptedCount=rems&&rems.length||0})})}]),angular.module("SocialAlarmsApp.reminderStats").controller("reminderStatsDetailCtrl",["$scope","$location","AppView","Utility","ViewManagement","SA","$routeParams","Loader",function($scope,$location,AppView,Utility,ViewManagement,SA,$routeParams,Loader){function extractEmail(ackMethods){var email;return ackMethods&&ackMethods.length?(ackMethods.some(function(ackMethod){return"email"==ackMethod.type?(email=ackMethod.value,!0):void 0}),email):""}if(AppView.setBodyClass("view-reminder-stats-details"),Utility.setHeader(!0,{title:"Reminder Detail",showBackButton:!0,backButtonCallback:!1}),Utility.setFooter(!0),$routeParams.id)ViewManagement.pushView("/reminderStatsDetail/"+$routeParams.id);else{var prevView=ViewManagement.popView();$location.path(prevView)}$scope.reminderUsers=[],$scope.$on("$viewContentLoaded",function(){Loader.showLoading(),SA.remindResource.getUsersReminderDetail({reminderId:$routeParams.id}).$promise.then(function(data){Loader.hideLoading(),$scope.reminderUsers=data.reminderUsers.map(function(reminderUser){var temp=reminderUser;return temp.email=extractEmail(reminderUser.reminderAckMethods),temp})},function(err){Loader.hideLoading()})})}]),angular.module("SocialAlarmsApp.reminders",["ngRoute","services.socialAlarms"]).config(["$stateProvider","$urlRouterProvider",function($stateProvider,$urlRouterProvider){$stateProvider.state("reminders/:viewname",{url:"/reminders/:viewname",templateUrl:"views/Reminders/RemindersList.html",controller:"RemindersListCtrl"}).state("reminderDetail/:viewname/:reminderid",{url:"/reminderDetail/:viewname/:reminderid",templateUrl:"views/Reminders/ReminderDetail.html",controller:"ReminderDetailCtrl"})}]),angular.module("SocialAlarmsApp.reminders").controller("ReminderDetailCtrl",["$scope","$location","$timeout","$stateParams","$rootScope","AppView","Utility","ViewManagement","SA","Store","ToastMessage","Calendar","State","FileFolder","Loader",function($scope,$location,$timeout,$stateParams,$rootScope,AppView,Utility,ViewManagement,SA,Store,ToastMessage,Calendar,State,FileFolder,Loader){function audioDownloadAndPlay(mediaObj){var audioMedia=mediaObj&&mediaObj.length&&"audio"===mediaObj[0].type?mediaObj[0]:null;if(audioMedia){var fileName=audioMedia._id+".wav",filePath="",directoryPath="";"Sent"!==$scope.viewName?(filePath="RemindZapp/media/audio/"+fileName,directoryPath="RemindZapp/media/audio/"):(filePath="RemindZapp/media/audio/sent/"+fileName,directoryPath="RemindZapp/media/audio/sent/"),FileFolder.getFileResource(filePath,function(file){audioPlay(file)},function(err){$timeout(function(){FileFolder.getDirectoryResource(directoryPath,function(directory){audioDownload(audioMedia.url,directory.nativeURL+fileName)},function(err){"Sent"===$scope.viewName?FileFolder.createSentFolderAndFile(fileName,function(file){audioDownload(audioMedia.url,file.nativeURL)}):FileFolder.createFolderAndFile(fileName,function(file){audioDownload(audioMedia.url,file.nativeURL)})})},1e3)})}}function audioSuccess(){$timeout(function(){$scope.record.isPlaying=!1},0)}function audioError(err){$timeout(function(){$scope.record.isPlaying=!1},0)}function audioPlay(file){if(file){var path=file.nativeURL;Utility.isIOS()&&(path="documents://"+file.fullPath),mediaRec=new Media(path,audioSuccess,audioError),mediaRec.play(),$timeout(function(){$scope.record.isPlaying=!0,$scope.record.hasAudio=!0},0)}}function audioDownload(url,filePath){$scope.record.showAudioLoader=!0,SA.mediaResource.audioDownload(url,filePath).then(function(file){$scope.record.showAudioLoader=!1,$location.path()===routePath&&audioPlay(file)},function(err){$scope.record.showAudioLoader=!1,console.log(err)})}function backButtonCallback(){$timeout(function(){mediaRec&&$scope.record.hasAudio&&(mediaRec.stop(),$scope.record.isPlaying=!1)},0),$location.path(ViewManagement.popView())}$scope.viewName=$stateParams.viewname?$stateParams.viewname:"";var bodyClass=$stateParams.viewname&&"Sent"===$stateParams.viewname?"view-reminder-detail-sender":"view-reminder-detail-acceptor";AppView.setBodyClass(bodyClass),Utility.setHeader(!0,{title:"Reminder Detail",showBackButton:!0,backButtonCallback:backButtonCallback,showRightButton:!1,rightButtonCallback:!1,rightButtonText:"Send",showMenuIcon:!1});var routePath="/reminderDetail/"+$stateParams.viewname+"/"+$stateParams.reminderid;ViewManagement.pushView(routePath),$scope.reminder={},$scope.reminderStats=[],$scope.helpText="",$scope.isToggleTab=!0,$scope.record={isPlaying:!1,hasAudio:!1,showAudioLoader:!1};var mediaRec=null;$scope.$on("$viewContentLoaded",function(event){"Sent"!==$scope.viewName?SA.remindResource.getSingleReceivedReminder({reminderStatusId:$stateParams.reminderid}).$promise.then(function(reminderData){$scope.reminder=reminderData,$scope.reminder.mediaFiles&&$scope.reminder.mediaFiles.length&&"audio"===$scope.reminder.mediaFiles[0].type&&audioDownloadAndPlay($scope.reminder.mediaFiles)},function(err){ToastMessage.reminderToast.serverError(err.errorMsg||err.infoMsg)}):(SA.remindResource.getUsersReminderDetail({reminderId:$stateParams.reminderid}).$promise.then(function(data){$scope.reminderStats=[],data.reminderUsers&&data.reminderUsers.length&&data.reminderUsers.forEach(function(reminderUser,index){var remUser=reminderUser,remDetails={app:[],email:[]};reminderUser.reminder_details.forEach(function(reminderDetail,i){"APP"===reminderDetail.commethod_type?remDetails.app.push(reminderDetail):"EMAIL"===reminderDetail.commethod_type&&remDetails.email.push(reminderDetail)}),remUser.reminder_details=remDetails,$scope.reminderStats.push(remUser)}),$scope.reminder=data.reminder;var recvName="";$scope.reminder&&($scope.reminder.group_id?($scope.reminder.contacts.forEach(function(contact){recvName+=""===recvName?contact.name||contact.reg_email:", "+(contact.name||contact.reg_email)}),$scope.reminder.receiverName=recvName):$scope.reminder.contacts&&$scope.reminder.contacts.length&&(recvName=$scope.reminder.contacts[0].name||$scope.reminder.contacts[0].reg_email,$scope.reminder.contacts[0].fb_id&&($scope.reminder.fb_id=$scope.reminder.contacts[0].fb_id),$scope.reminder.receiverName=recvName),$scope.reminder.mediaFiles&&$scope.reminder.mediaFiles.length&&"audio"===$scope.reminder.mediaFiles[0].type&&audioDownloadAndPlay($scope.reminder.mediaFiles))},function(err){}),$scope.reminder=State.getStateVar("SentReminder"))}),$scope.acceptReminder=function(id,index){function onCalendarSuccess(){$timeout(function(){ToastMessage.reminderToast.setOnCalendar()},0)}function onCalendarError(){$timeout(function(){ToastMessage.reminderToast.cantSetReminder()},0)}var forPostRequest={reminderStatusId:$stateParams.reminderid,type:"accept"};SA.remindResource.reminderResponse(forPostRequest).$promise.then(function(data){1===data.status&&(Utility.isMobileDevice()?(Calendar.createCalendarEvent($scope.reminder.content.substring(0,15),$scope.reminder.content.substring(0,15),new Date($scope.reminder.remindDate),onCalendarSuccess,onCalendarError),$location.path(ViewManagement.popView())):(ToastMessage.reminderToast.reminderAccepted(),$location.path(ViewManagement.popView())))},function(err){ToastMessage.reminderToast.networkError()})},$scope.rejectReminder=function(id){var forPostRequest={reminderStatusId:$stateParams.reminderid,type:"reject"};SA.remindResource.reminderResponse(forPostRequest).$promise.then(function(data){ToastMessage.reminderToast.gotRidOfReminder(),$location.path(ViewManagement.popView())},function(err){ToastMessage.reminderToast.serverError(err.data||err.infoMsg)})},$scope.seenReminder=function(id){id&&$stateParams.reminderid&&SA.remindResource.seenReminder({reminderStatusId:$stateParams.reminderid,reminderMethodId:id}).$promise.then(function(data){$scope.reminder.reminder_detail_id=null,ToastMessage.reminderToast.seenSuccess()},function(err){ToastMessage.reminderToast.seenError()})},$scope.toggleTab=function(isTab){"Sent"===$scope.viewName&&($scope.isToggleTab=isTab)},$scope.playAudio=function(event){event.preventDefault(),event.stopPropagation(),event.stopImmediatePropagation(),$timeout(function(){mediaRec&&$scope.record.hasAudio&&(mediaRec.play(),$scope.record.isPlaying=!0)},0)},$scope.stopAudio=function(event){event.preventDefault(),event.stopPropagation(),event.stopImmediatePropagation(),$timeout(function(){mediaRec&&$scope.record.hasAudio&&(mediaRec.stop(),$scope.record.isPlaying=!1)},0)},$rootScope.$on("$routeChangeStart",function(){$scope.stopAudio(null)})}]),angular.module("SocialAlarmsApp.reminders").controller("RemindersListCtrl",["$scope","$location","$timeout","$stateParams","$route","AppView","Utility","ViewManagement","SA","Store","ToastMessage","Calendar","State","Loader",function($scope,$location,$timeout,$stateParams,$route,AppView,Utility,ViewManagement,SA,Store,ToastMessage,Calendar,State,Loader){function getReminders(){Loader.showLoading(),"Requested Reminders"===$scope.viewName?getReceivedReminders("P"):"Sent Reminders"===$scope.viewName?SA.remindResource.getAllReminders({limit:pageSize,skip:$scope.reminders.length}).$promise.then(function(data){if(data&&data.length){var recvName="";data.forEach(function(reminder){"G"===reminder.status&&(reminder.contacts.forEach(function(contact){recvName+=""===recvName?contact.name||contact.reg_email:", "+(contact.name||contact.reg_email)}),reminder.receiverName=recvName)}),[].push.apply($scope.reminders,data)}$scope.reminders&&0===$scope.reminders.length?$scope.helpText="You haven't sent any reminders yet.":data&&data.length>=pageSize?$scope.showMoreBtn=!0:$scope.showMoreBtn=!1,Loader.hideLoading()},function(err){Loader.hideLoading(),ToastMessage.home.loadFailed()}):"My Reminders"===$scope.viewName&&getReceivedReminders("A")}function getReceivedReminders(status){SA.remindResource.getReminder({filter:"IN",limit:pageSize,skip:$scope.reminders.length,ack_status:status}).$promise.then(function(data){data&&data.length&&[].push.apply($scope.reminders,data||[]),$scope.reminders&&0===$scope.reminders.length?$scope.helpText="A"===status?"You've no accepted reminders yet.":"You've no requested reminders yet.":data&&data.length>=pageSize?$scope.showMoreBtn=!0:$scope.showMoreBtn=!1,Loader.hideLoading()},function(err){Loader.hideLoading(),ToastMessage.home.loadFailed()})}function rightButtonCallback(){Utility.clearSelectedPeople(),$location.path("/reminder")}$scope.viewName=($stateParams.viewname||"Requested")+" Reminders",AppView.setBodyClass("view-dashboard"),Utility.setHeader(!0,{title:$scope.viewName,showBackButton:!0,backButtonCallback:!1,showRightButton:!0,rightButtonCallback:rightButtonCallback,rightButtonText:"Send",showMenuIcon:!1}),ViewManagement.pushView("/reminders/"+($stateParams.viewname?$stateParams.viewname:"Requested"));var pageSize=25;$scope.reminders=[],$scope.helpText="",$scope.showMoreBtn=!1,$scope.$on("$viewContentLoaded",function(event){getReminders()}),$scope.goToView=function(view){$location.path(view)},$scope.acceptReminder=function(id,index){function onCalendarSuccess(){$timeout(function(){ToastMessage.reminderToast.setOnCalendar()},0)}function onCalendarError(){$timeout(function(){ToastMessage.reminderToast.cantSetReminder();
},0)}var forPostRequest={reminderStatusId:id,type:"accept"};SA.remindResource.reminderResponse(forPostRequest).$promise.then(function(data){1===data.status&&(Utility.isMobileDevice()?(Calendar.createCalendarEvent($scope.reminders[index].reminder.content.substring(0,15),$scope.reminders[index].reminder.content.substring(0,15),new Date($scope.reminders[index].reminder.remindDate),onCalendarSuccess,onCalendarError),$route.reload()):(ToastMessage.reminderToast.reminderAccepted(),$route.reload()))},function(err){ToastMessage.reminderToast.networkError()})},$scope.rejectReminder=function(id){var forPostRequest={reminderStatusId:id,type:"reject"};SA.remindResource.reminderResponse(forPostRequest).$promise.then(function(data){ToastMessage.reminderToast.gotRidOfReminder(),$route.reload()},function(err){ToastMessage.reminderToast.serverError(err.data||err.infoMsg)})},$scope.reminderSelected=function(index){var reminder=$scope.reminders[index];$location.path("/reminderDetail/"+$stateParams.viewname+"/"+reminder._id)},$scope.moreBtn=function(){getReminders()}}]),angular.module("SocialAlarmsApp.signUp",["ngRoute","services.socialAlarms"]).config(["$stateProvider","$urlRouterProvider",function($stateProvider,$urlRouterProvider){$stateProvider.state("signUp",{url:"/signUp",templateUrl:"views/SignUp/SignUp.html",controller:"SignUpCtrl",resolve:{login:function($q,Context,$timeout,$location){var defer=$q.defer();return $timeout(function(){defer.resolve()},0),defer.promise}}}).state("confirmation",{url:"/confirmation",templateUrl:"views/SignUp/Confirmation.html",controller:"ConfirmationCtrl"})}]),angular.module("SocialAlarmsApp.signUp").controller("ConfirmationCtrl",["$scope","$location","AppView","Utility","SA","Context","$timeout","Store","ToastMessage",function($scope,$location,AppView,Utility,SA,Context,$timeout,Store,ToastMessage){function validateVerificationField(){return""!==$scope.verificationCode?!0:($scope.isError=!0,$scope.errorMessage="Please enter verification code",!1)}function confirmationSuccess(data){0!=data.status?$location.path("/dashboard"):($scope.isError=!0,$scope.errorMessage="Sorry, wrong code")}function confirmationError(data){$scope.isError=!0,$scope.errorMessage="Sorry, wrong code"}function resentSuccess(data){1==data.status&&ToastMessage.verify.resentSuccessfull()}function resentError(){ToastMessage.verify.resentFailed()}AppView.setBodyClass("view-verify"),Utility.setHeader(!0,{title:"Confirmation View",showBackButton:!1,backButtonCallback:!1}),Utility.setFooter(!1),$scope.verificationCode="",$scope.verificationSubmit=function(){validateVerificationField()?SA.signupResource.verify({verificationToken:$scope.verificationCode}).$promise.then(confirmationSuccess,confirmationError):($scope.isError=!0,$scope.errorMessage="Sorry, wrong code")},$scope.skipVerification=function(){$location.path("/dashboard")},$scope.resendVerification=function(){var user=Store.getObject("user");SA.signupResource.resedVerifyCode({email:user.email}).$promise.then(resentSuccess,resentError)},$scope.inputKeyUpCode=function(){$scope.isError=!1,$scope.errorMessage=""}}]),angular.module("SocialAlarmsApp.signUp").controller("SignUpCtrl",["$scope","$location","AppView","Utility","ViewManagement","SA","Context","DeviceReady","ToastMessage","Device","PushNotification","Store","Loader",function($scope,$location,AppView,Utility,ViewManagement,SA,Context,DeviceReady,ToastMessage,Device,PushNotification,Store,Loader){function validateSignUpFields(){return validateEmail()&&validatePassword()&&validateContactNumber()?!0:!1}function validateEmail(){var emailReg=/^[\+_a-zA-Z0-9-]+(\.[\+_a-zA-Z0-9-]+)*@[a-zA-Z0-9-]+(\.[a-zA-Z0-9-]+)*(\.[a-zA-Z]{2,4})$/;return""!==$scope.signUpObj.emailAddress&&emailReg.test($scope.signUpObj.emailAddress)?!0:($scope.isErrorEmail=!0,$scope.errorEmailText="Enter a valid email",!1)}function validatePassword(){return""===$scope.signUpObj.password?($scope.isErrorPassword=!0,$scope.errorPasswordText="Password required",!1):$scope.signUpObj.password.length<8?($scope.isErrorPassword=!0,$scope.errorPasswordText="Must be atleast 8 characters",!1):!0}function validateContactNumber(){return/^((\+92)|(0092))-{0,1}\d{3}-{0,1}\d{7}$|^\d{11}$|^\d{4}-\d{7}$|^$/.test($scope.signUpObj.contactNumber)}function signupSuccess(data){isSubmit=!1,Loader.hideLoading(),data&&1==data.status?(localStorage.clear(),localStorage.setItem("userId",data.userId),Store.setObject("user",data.user),Context.setAccessToken(data.accessToken),SA.init(),Utility.isApp()&&PushNotification.register(),$location.path("/confirmation")):ToastMessage.signup.failed(data.errorMsg)}function signupError(data){isSubmit=!1,Loader.hideLoading(),ToastMessage.signup.poorConnectivity()}AppView.setBodyClass("view-signup"),Utility.setHeader(!0,{title:"Sign Up",showBackButton:!0,backButtonCallback:!1}),Utility.setFooter(!1),ViewManagement.pushView("/signUp");var isSubmit=!1;$scope.signUpObj={username:"",emailAddress:"",password:"",contactNumber:""},$scope.isErrorEmail=!1,$scope.isErrorContact=!1,$scope.isErrorPassword=!1,$scope.showPrivacyNote=!0,$scope.showNote=function(val){DeviceReady.isReady()&&($scope.showPrivacyNote=val)},$scope.onChange=function(type){"email"==type?$scope.isErrorEmail=!validateEmail():"password"==type?$scope.isErrorPassword=!validatePassword():"contact"==type&&($scope.isErrorContact=$scope.validateContact())},$scope.signUpSubmit=function(){if(!isSubmit&&validateSignUpFields()){isSubmit=!0;var signUpObj={phoneNumber:$scope.signUpObj.contactNumber,email:$scope.signUpObj.emailAddress,password:$scope.signUpObj.password};Loader.showLoading(),SA.signupResource.signup(signUpObj).$promise.then(signupSuccess,signupError)}},$scope.inputKeyUpUsername=function(){},$scope.inputKeyUpEmail=function(){},$scope.inputKeyUpPassword=function(){},$scope.validateContact=function(){var ret=validateContactNumber();return!ret}}]);